var jm=Object.defineProperty;var qm=(e,t,i)=>t in e?jm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Km=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var et=(e,t,i)=>(qm(e,typeof t!="symbol"?t+"":t,i),i);var PI=Km((NI,Xm)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();var zi=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(zi||{}),Td=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(Td||{}),Oa=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(Oa||{}),W=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(W||{}),De=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(De||{}),M=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(M||{}),ls=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(ls||{}),z=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(z||{}),La=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(La||{}),Pe=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Pe||{}),ui=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(ui||{}),Oe=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(Oe||{}),we=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(we||{}),Ie=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Ie||{}),tl=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(tl||{}),oe=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(oe||{}),Mt=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(Mt||{}),Ct=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(Ct||{}),Me=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Me||{});const Zm={createCanvas:(e,t)=>{const i=document.createElement("canvas");return i.width=e,i.height=t,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},B={ADAPTER:Zm,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Wo=/iPhone/i,Yl=/iPod/i,Wl=/iPad/i,Xl=/\biOS-universal(?:.+)Mac\b/i,Xo=/\bAndroid(?:.+)Mobile\b/i,Vl=/Android/i,Wi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,$r=/Silk/i,Ue=/Windows Phone/i,jl=/\bWindows(?:.+)ARM\b/i,ql=/BlackBerry/i,Kl=/BB10/i,Zl=/Opera Mini/i,Jl=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ql=/Mobile(?:.+)Firefox\b/i,tc=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function Jm(e){return function(t){return t.test(e)}}function ec(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var i=t.userAgent,s=i.split("[FBAN");typeof s[1]<"u"&&(i=s[0]),s=i.split("Twitter"),typeof s[1]<"u"&&(i=s[0]);var r=Jm(i),n={apple:{phone:r(Wo)&&!r(Ue),ipod:r(Yl),tablet:!r(Wo)&&(r(Wl)||tc(t))&&!r(Ue),universal:r(Xl),device:(r(Wo)||r(Yl)||r(Wl)||r(Xl)||tc(t))&&!r(Ue)},amazon:{phone:r(Wi),tablet:!r(Wi)&&r($r),device:r(Wi)||r($r)},android:{phone:!r(Ue)&&r(Wi)||!r(Ue)&&r(Xo),tablet:!r(Ue)&&!r(Wi)&&!r(Xo)&&(r($r)||r(Vl)),device:!r(Ue)&&(r(Wi)||r($r)||r(Xo)||r(Vl))||r(/\bokhttp\b/i)},windows:{phone:r(Ue),tablet:r(jl),device:r(Ue)||r(jl)},other:{blackberry:r(ql),blackberry10:r(Kl),opera:r(Zl),firefox:r(Ql),chrome:r(Jl),device:r(ql)||r(Kl)||r(Zl)||r(Ql)||r(Jl)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Qm=ec.default??ec,Xe=Qm(globalThis.navigator);B.RETINA_PREFIX=/@([0-9\.]+)x/;B.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Vo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ad(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t_(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function s(){if(this instanceof s){var r=[null];r.push.apply(r,arguments);var n=Function.bind.apply(t,r);return new n}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(i,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}),i}var Rd={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new r(c,u||h,d),p=i?i+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new s:delete h._events[l]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=i?i+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(l){var c=i?i+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,d,f,p){var m=i?i+l:l;if(!this._events[m])return!1;var _=this._events[m],y=arguments.length,b,g;if(_.fn){switch(_.once&&this.removeListener(l,_.fn,void 0,!0),y){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,c),!0;case 3:return _.fn.call(_.context,c,u),!0;case 4:return _.fn.call(_.context,c,u,d),!0;case 5:return _.fn.call(_.context,c,u,d,f),!0;case 6:return _.fn.call(_.context,c,u,d,f,p),!0}for(g=1,b=new Array(y-1);g<y;g++)b[g-1]=arguments[g];_.fn.apply(_.context,b)}else{var v=_.length,S;for(g=0;g<v;g++)switch(_[g].once&&this.removeListener(l,_[g].fn,void 0,!0),y){case 1:_[g].fn.call(_[g].context);break;case 2:_[g].fn.call(_[g].context,c);break;case 3:_[g].fn.call(_[g].context,c,u);break;case 4:_[g].fn.call(_[g].context,c,u,d);break;default:if(!b)for(S=1,b=new Array(y-1);S<y;S++)b[S-1]=arguments[S];_[g].fn.apply(_[g].context,b)}}return!0},a.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,d){var f=i?i+l:l;if(!this._events[f])return this;if(!c)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&o(this,f);else{for(var m=0,_=[],y=p.length;m<y;m++)(p[m].fn!==c||d&&!p[m].once||u&&p[m].context!==u)&&_.push(p[m]);_.length?this._events[f]=_.length===1?_[0]:_:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&o(this,c)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a})(Rd);var e_=Rd.exports;const Dr=Ad(e_);var el={exports:{}};el.exports=Eo;el.exports.default=Eo;function Eo(e,t,i){i=i||2;var s=t&&t.length,r=s?t[0]*i:e.length,n=Id(e,0,r,i,!0),o=[];if(!n||n.next===n.prev)return o;var a,h,l,c,u,d,f;if(s&&(n=o_(e,t,n,i)),e.length>80*i){a=l=e[0],h=c=e[1];for(var p=i;p<r;p+=i)u=e[p],d=e[p+1],u<a&&(a=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);f=Math.max(l-a,c-h),f=f!==0?32767/f:0}return _r(n,o,i,a,h,f,0),o}function Id(e,t,i,s,r){var n,o;if(r===Ga(e,t,i,s)>0)for(n=t;n<i;n+=s)o=ic(n,e[n],e[n+1],o);else for(n=i-s;n>=t;n-=s)o=ic(n,e[n],e[n+1],o);return o&&xo(o,o.next)&&(yr(o),o=o.next),o}function Li(e,t){if(!e)return e;t||(t=e);var i=e,s;do if(s=!1,!i.steiner&&(xo(i,i.next)||xt(i.prev,i,i.next)===0)){if(yr(i),i=t=i.prev,i===i.next)break;s=!0}else i=i.next;while(s||i!==t);return t}function _r(e,t,i,s,r,n,o){if(e){!o&&n&&u_(e,s,r,n);for(var a=e,h,l;e.prev!==e.next;){if(h=e.prev,l=e.next,n?s_(e,s,r,n):i_(e)){t.push(h.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),yr(e),e=l.next,a=l.next;continue}if(e=l,e===a){o?o===1?(e=r_(Li(e),t,i),_r(e,t,i,s,r,n,2)):o===2&&n_(e,t,i,s,r,n):_r(Li(e),t,i,s,r,n,1);break}}}}function i_(e){var t=e.prev,i=e,s=e.next;if(xt(t,i,s)>=0)return!1;for(var r=t.x,n=i.x,o=s.x,a=t.y,h=i.y,l=s.y,c=r<n?r<o?r:o:n<o?n:o,u=a<h?a<l?a:l:h<l?h:l,d=r>n?r>o?r:o:n>o?n:o,f=a>h?a>l?a:l:h>l?h:l,p=s.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&ns(r,a,n,h,o,l,p.x,p.y)&&xt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function s_(e,t,i,s){var r=e.prev,n=e,o=e.next;if(xt(r,n,o)>=0)return!1;for(var a=r.x,h=n.x,l=o.x,c=r.y,u=n.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=a>h?a>l?a:l:h>l?h:l,_=c>u?c>d?c:d:u>d?u:d,y=Fa(f,p,t,i,s),b=Fa(m,_,t,i,s),g=e.prevZ,v=e.nextZ;g&&g.z>=y&&v&&v.z<=b;){if(g.x>=f&&g.x<=m&&g.y>=p&&g.y<=_&&g!==r&&g!==o&&ns(a,c,h,u,l,d,g.x,g.y)&&xt(g.prev,g,g.next)>=0||(g=g.prevZ,v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&ns(a,c,h,u,l,d,v.x,v.y)&&xt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;g&&g.z>=y;){if(g.x>=f&&g.x<=m&&g.y>=p&&g.y<=_&&g!==r&&g!==o&&ns(a,c,h,u,l,d,g.x,g.y)&&xt(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;v&&v.z<=b;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&ns(a,c,h,u,l,d,v.x,v.y)&&xt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function r_(e,t,i){var s=e;do{var r=s.prev,n=s.next.next;!xo(r,n)&&Cd(r,s,s.next,n)&&gr(r,n)&&gr(n,r)&&(t.push(r.i/i|0),t.push(s.i/i|0),t.push(n.i/i|0),yr(s),yr(s.next),s=e=n),s=s.next}while(s!==e);return Li(s)}function n_(e,t,i,s,r,n){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&p_(o,a)){var h=kd(o,a);o=Li(o,o.next),h=Li(h,h.next),_r(o,t,i,s,r,n,0),_r(h,t,i,s,r,n,0);return}a=a.next}o=o.next}while(o!==e)}function o_(e,t,i,s){var r=[],n,o,a,h,l;for(n=0,o=t.length;n<o;n++)a=t[n]*s,h=n<o-1?t[n+1]*s:e.length,l=Id(e,a,h,s,!1),l===l.next&&(l.steiner=!0),r.push(f_(l));for(r.sort(a_),n=0;n<r.length;n++)i=h_(r[n],i);return i}function a_(e,t){return e.x-t.x}function h_(e,t){var i=l_(e,t);if(!i)return t;var s=kd(i,e);return Li(s,s.next),Li(i,i.next)}function l_(e,t){var i=t,s=e.x,r=e.y,n=-1/0,o;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=s&&a>n&&(n=a,o=i.x<i.next.x?i:i.next,a===s))return o}i=i.next}while(i!==t);if(!o)return null;var h=o,l=o.x,c=o.y,u=1/0,d;i=o;do s>=i.x&&i.x>=l&&s!==i.x&&ns(r<c?s:n,r,l,c,r<c?n:s,r,i.x,i.y)&&(d=Math.abs(r-i.y)/(s-i.x),gr(i,e)&&(d<u||d===u&&(i.x>o.x||i.x===o.x&&c_(o,i)))&&(o=i,u=d)),i=i.next;while(i!==h);return o}function c_(e,t){return xt(e.prev,e,t.prev)<0&&xt(t.next,e,e.next)<0}function u_(e,t,i,s){var r=e;do r.z===0&&(r.z=Fa(r.x,r.y,t,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,d_(r)}function d_(e){var t,i,s,r,n,o,a,h,l=1;do{for(i=e,e=null,n=null,o=0;i;){for(o++,s=i,a=0,t=0;t<l&&(a++,s=s.nextZ,!!s);t++);for(h=l;a>0||h>0&&s;)a!==0&&(h===0||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:e=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(o>1);return e}function Fa(e,t,i,s,r){return e=(e-i)*r|0,t=(t-s)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function f_(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function ns(e,t,i,s,r,n,o,a){return(r-o)*(t-a)>=(e-o)*(n-a)&&(e-o)*(s-a)>=(i-o)*(t-a)&&(i-o)*(n-a)>=(r-o)*(s-a)}function p_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!m_(e,t)&&(gr(e,t)&&gr(t,e)&&__(e,t)&&(xt(e.prev,e,t.prev)||xt(e,t.prev,t))||xo(e,t)&&xt(e.prev,e,e.next)>0&&xt(t.prev,t,t.next)>0)}function xt(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function xo(e,t){return e.x===t.x&&e.y===t.y}function Cd(e,t,i,s){var r=Wr(xt(e,t,i)),n=Wr(xt(e,t,s)),o=Wr(xt(i,s,e)),a=Wr(xt(i,s,t));return!!(r!==n&&o!==a||r===0&&Yr(e,i,t)||n===0&&Yr(e,s,t)||o===0&&Yr(i,e,s)||a===0&&Yr(i,t,s))}function Yr(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Wr(e){return e>0?1:e<0?-1:0}function m_(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Cd(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function gr(e,t){return xt(e.prev,e,e.next)<0?xt(e,t,e.next)>=0&&xt(e,e.prev,t)>=0:xt(e,t,e.prev)<0||xt(e,e.next,t)<0}function __(e,t){var i=e,s=!1,r=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==e);return s}function kd(e,t){var i=new Ua(e.i,e.x,e.y),s=new Ua(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function ic(e,t,i,s){var r=new Ua(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function yr(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ua(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Eo.deviation=function(e,t,i,s){var r=t&&t.length,n=r?t[0]*i:e.length,o=Math.abs(Ga(e,0,n,i));if(r)for(var a=0,h=t.length;a<h;a++){var l=t[a]*i,c=a<h-1?t[a+1]*i:e.length;o-=Math.abs(Ga(e,l,c,i))}var u=0;for(a=0;a<s.length;a+=3){var d=s[a]*i,f=s[a+1]*i,p=s[a+2]*i;u+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function Ga(e,t,i,s){for(var r=0,n=t,o=i-s;n<i;n+=s)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}Eo.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)for(var o=0;o<t;o++)i.vertices.push(e[r][n][o]);r>0&&(s+=e[r-1].length,i.holes.push(s))}return i};var g_=el.exports;const y_=Ad(g_);var Vn={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Vn.exports;(function(e,t){(function(i){var s=t&&!t.nodeType&&t,r=e&&!e.nodeType&&e,n=typeof Vo=="object"&&Vo;(n.global===n||n.window===n||n.self===n)&&(i=n);var o,a=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",_=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-l,S=Math.floor,R=String.fromCharCode,T;function x(k){throw new RangeError(g[k])}function C(k,$){for(var q=k.length,ot=[];q--;)ot[q]=$(k[q]);return ot}function P(k,$){var q=k.split("@"),ot="";q.length>1&&(ot=q[0]+"@",k=q[1]),k=k.replace(b,".");var it=k.split("."),At=C(it,$).join(".");return ot+At}function I(k){for(var $=[],q=0,ot=k.length,it,At;q<ot;)it=k.charCodeAt(q++),it>=55296&&it<=56319&&q<ot?(At=k.charCodeAt(q++),(At&64512)==56320?$.push(((it&1023)<<10)+(At&1023)+65536):($.push(it),q--)):$.push(it);return $}function D(k){return C(k,function($){var q="";return $>65535&&($-=65536,q+=R($>>>10&1023|55296),$=56320|$&1023),q+=R($),q}).join("")}function E(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:h}function w(k,$){return k+22+75*(k<26)-(($!=0)<<5)}function F(k,$,q){var ot=0;for(k=q?S(k/d):k>>1,k+=S(k/$);k>v*c>>1;ot+=h)k=S(k/v);return S(ot+(v+1)*k/(k+u))}function G(k){var $=[],q=k.length,ot,it=0,At=p,gt=f,Y,lt,yt,at,K,X,_t,St,se;for(Y=k.lastIndexOf(m),Y<0&&(Y=0),lt=0;lt<Y;++lt)k.charCodeAt(lt)>=128&&x("not-basic"),$.push(k.charCodeAt(lt));for(yt=Y>0?Y+1:0;yt<q;){for(at=it,K=1,X=h;yt>=q&&x("invalid-input"),_t=E(k.charCodeAt(yt++)),(_t>=h||_t>S((a-it)/K))&&x("overflow"),it+=_t*K,St=X<=gt?l:X>=gt+c?c:X-gt,!(_t<St);X+=h)se=h-St,K>S(a/se)&&x("overflow"),K*=se;ot=$.length+1,gt=F(it-at,ot,at==0),S(it/ot)>a-At&&x("overflow"),At+=S(it/ot),it%=ot,$.splice(it++,0,At)}return D($)}function N(k){var $,q,ot,it,At,gt,Y,lt,yt,at,K,X=[],_t,St,se,zs;for(k=I(k),_t=k.length,$=p,q=0,At=f,gt=0;gt<_t;++gt)K=k[gt],K<128&&X.push(R(K));for(ot=it=X.length,it&&X.push(m);ot<_t;){for(Y=a,gt=0;gt<_t;++gt)K=k[gt],K>=$&&K<Y&&(Y=K);for(St=ot+1,Y-$>S((a-q)/St)&&x("overflow"),q+=(Y-$)*St,$=Y,gt=0;gt<_t;++gt)if(K=k[gt],K<$&&++q>a&&x("overflow"),K==$){for(lt=q,yt=h;at=yt<=At?l:yt>=At+c?c:yt-At,!(lt<at);yt+=h)zs=lt-at,se=h-at,X.push(R(w(at+zs%se,0))),lt=S(zs/se);X.push(R(w(lt,0))),At=F(q,St,ot==it),q=0,++ot}++q,++$}return X.join("")}function nt(k){return P(k,function($){return _.test($)?G($.slice(4).toLowerCase()):$})}function pt(k){return P(k,function($){return y.test($)?"xn--"+N($):$})}if(o={version:"1.4.1",ucs2:{decode:I,encode:D},decode:G,encode:N,toASCII:pt,toUnicode:nt},s&&r)if(e.exports==s)r.exports=o;else for(T in o)o.hasOwnProperty(T)&&(s[T]=o[T]);else i.punycode=o})(Vo)})(Vn,Vn.exports);var v_=Vn.exports,b_=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},i=Symbol("test"),s=Object(i);if(typeof i=="string"||Object.prototype.toString.call(i)!=="[object Symbol]"||Object.prototype.toString.call(s)!=="[object Symbol]")return!1;var r=42;t[i]=r;for(i in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==i||!Object.prototype.propertyIsEnumerable.call(t,i))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,i);if(o.value!==r||o.enumerable!==!0)return!1}return!0},sc=typeof Symbol<"u"&&Symbol,E_=b_,x_=function(){return typeof sc!="function"||typeof Symbol!="function"||typeof sc("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:E_()},rc={foo:{}},w_=Object,S_=function(){return{__proto__:rc}.foo===rc.foo&&!({__proto__:null}instanceof w_)},T_="Function.prototype.bind called on incompatible ",jo=Array.prototype.slice,A_=Object.prototype.toString,R_="[object Function]",I_=function(t){var i=this;if(typeof i!="function"||A_.call(i)!==R_)throw new TypeError(T_+i);for(var s=jo.call(arguments,1),r,n=function(){if(this instanceof r){var c=i.apply(this,s.concat(jo.call(arguments)));return Object(c)===c?c:this}else return i.apply(t,s.concat(jo.call(arguments)))},o=Math.max(0,i.length-s.length),a=[],h=0;h<o;h++)a.push("$"+h);if(r=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(n),i.prototype){var l=function(){};l.prototype=i.prototype,r.prototype=new l,l.prototype=null}return r},C_=I_,il=Function.prototype.bind||C_,k_=il,D_=k_.call(Function.call,Object.prototype.hasOwnProperty),Z,xs=SyntaxError,Dd=Function,cs=TypeError,qo=function(e){try{return Dd('"use strict"; return ('+e+").constructor;")()}catch{}},Mi=Object.getOwnPropertyDescriptor;if(Mi)try{Mi({},"")}catch{Mi=null}var Ko=function(){throw new cs},P_=Mi?function(){try{return arguments.callee,Ko}catch{try{return Mi(arguments,"callee").get}catch{return Ko}}}():Ko,Xi=x_(),M_=S_(),Ot=Object.getPrototypeOf||(M_?function(e){return e.__proto__}:null),Zi={},N_=typeof Uint8Array>"u"||!Ot?Z:Ot(Uint8Array),Ni={"%AggregateError%":typeof AggregateError>"u"?Z:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Z:ArrayBuffer,"%ArrayIteratorPrototype%":Xi&&Ot?Ot([][Symbol.iterator]()):Z,"%AsyncFromSyncIteratorPrototype%":Z,"%AsyncFunction%":Zi,"%AsyncGenerator%":Zi,"%AsyncGeneratorFunction%":Zi,"%AsyncIteratorPrototype%":Zi,"%Atomics%":typeof Atomics>"u"?Z:Atomics,"%BigInt%":typeof BigInt>"u"?Z:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Z:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Z:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Z:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Z:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Z:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Z:FinalizationRegistry,"%Function%":Dd,"%GeneratorFunction%":Zi,"%Int8Array%":typeof Int8Array>"u"?Z:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Z:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Z:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Xi&&Ot?Ot(Ot([][Symbol.iterator]())):Z,"%JSON%":typeof JSON=="object"?JSON:Z,"%Map%":typeof Map>"u"?Z:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Xi||!Ot?Z:Ot(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Z:Promise,"%Proxy%":typeof Proxy>"u"?Z:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Z:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Z:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Xi||!Ot?Z:Ot(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Z:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Xi&&Ot?Ot(""[Symbol.iterator]()):Z,"%Symbol%":Xi?Symbol:Z,"%SyntaxError%":xs,"%ThrowTypeError%":P_,"%TypedArray%":N_,"%TypeError%":cs,"%Uint8Array%":typeof Uint8Array>"u"?Z:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Z:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Z:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Z:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Z:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Z:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Z:WeakSet};if(Ot)try{null.error}catch(e){var B_=Ot(Ot(e));Ni["%Error.prototype%"]=B_}var O_=function e(t){var i;if(t==="%AsyncFunction%")i=qo("async function () {}");else if(t==="%GeneratorFunction%")i=qo("function* () {}");else if(t==="%AsyncGeneratorFunction%")i=qo("async function* () {}");else if(t==="%AsyncGenerator%"){var s=e("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if(t==="%AsyncIteratorPrototype%"){var r=e("%AsyncGenerator%");r&&Ot&&(i=Ot(r.prototype))}return Ni[t]=i,i},nc={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Pr=il,jn=D_,L_=Pr.call(Function.call,Array.prototype.concat),F_=Pr.call(Function.apply,Array.prototype.splice),oc=Pr.call(Function.call,String.prototype.replace),qn=Pr.call(Function.call,String.prototype.slice),U_=Pr.call(Function.call,RegExp.prototype.exec),G_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,H_=/\\(\\)?/g,z_=function(t){var i=qn(t,0,1),s=qn(t,-1);if(i==="%"&&s!=="%")throw new xs("invalid intrinsic syntax, expected closing `%`");if(s==="%"&&i!=="%")throw new xs("invalid intrinsic syntax, expected opening `%`");var r=[];return oc(t,G_,function(n,o,a,h){r[r.length]=a?oc(h,H_,"$1"):o||n}),r},$_=function(t,i){var s=t,r;if(jn(nc,s)&&(r=nc[s],s="%"+r[0]+"%"),jn(Ni,s)){var n=Ni[s];if(n===Zi&&(n=O_(s)),typeof n>"u"&&!i)throw new cs("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:s,value:n}}throw new xs("intrinsic "+t+" does not exist!")},sl=function(t,i){if(typeof t!="string"||t.length===0)throw new cs("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof i!="boolean")throw new cs('"allowMissing" argument must be a boolean');if(U_(/^%?[^%]*%?$/,t)===null)throw new xs("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var s=z_(t),r=s.length>0?s[0]:"",n=$_("%"+r+"%",i),o=n.name,a=n.value,h=!1,l=n.alias;l&&(r=l[0],F_(s,L_([0,1],l)));for(var c=1,u=!0;c<s.length;c+=1){var d=s[c],f=qn(d,0,1),p=qn(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new xs("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(h=!0),r+="."+d,o="%"+r+"%",jn(Ni,o))a=Ni[o];else if(a!=null){if(!(d in a)){if(!i)throw new cs("base intrinsic for "+t+" exists, but the property is not available.");return}if(Mi&&c+1>=s.length){var m=Mi(a,d);u=!!m,u&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else u=jn(a,d),a=a[d];u&&!h&&(Ni[o]=a)}}return a},Pd={exports:{}};(function(e){var t=il,i=sl,s=i("%Function.prototype.apply%"),r=i("%Function.prototype.call%"),n=i("%Reflect.apply%",!0)||t.call(r,s),o=i("%Object.getOwnPropertyDescriptor%",!0),a=i("%Object.defineProperty%",!0),h=i("%Math.max%");if(a)try{a({},"a",{value:1})}catch{a=null}e.exports=function(u){var d=n(t,r,arguments);if(o&&a){var f=o(d,"length");f.configurable&&a(d,"length",{value:1+h(0,u.length-(arguments.length-1))})}return d};var l=function(){return n(t,s,arguments)};a?a(e.exports,"apply",{value:l}):e.exports.apply=l})(Pd);var Y_=Pd.exports,Md=sl,Nd=Y_,W_=Nd(Md("String.prototype.indexOf")),X_=function(t,i){var s=Md(t,!!i);return typeof s=="function"&&W_(t,".prototype.")>-1?Nd(s):s};const V_={},j_=Object.freeze(Object.defineProperty({__proto__:null,default:V_},Symbol.toStringTag,{value:"Module"})),q_=t_(j_);var rl=typeof Map=="function"&&Map.prototype,Zo=Object.getOwnPropertyDescriptor&&rl?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Kn=rl&&Zo&&typeof Zo.get=="function"?Zo.get:null,ac=rl&&Map.prototype.forEach,nl=typeof Set=="function"&&Set.prototype,Jo=Object.getOwnPropertyDescriptor&&nl?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Zn=nl&&Jo&&typeof Jo.get=="function"?Jo.get:null,hc=nl&&Set.prototype.forEach,K_=typeof WeakMap=="function"&&WeakMap.prototype,nr=K_?WeakMap.prototype.has:null,Z_=typeof WeakSet=="function"&&WeakSet.prototype,or=Z_?WeakSet.prototype.has:null,J_=typeof WeakRef=="function"&&WeakRef.prototype,lc=J_?WeakRef.prototype.deref:null,Q_=Boolean.prototype.valueOf,tg=Object.prototype.toString,eg=Function.prototype.toString,ig=String.prototype.match,ol=String.prototype.slice,ni=String.prototype.replace,sg=String.prototype.toUpperCase,cc=String.prototype.toLowerCase,Bd=RegExp.prototype.test,uc=Array.prototype.concat,Ce=Array.prototype.join,rg=Array.prototype.slice,dc=Math.floor,Ha=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Qo=Object.getOwnPropertySymbols,za=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,ws=typeof Symbol=="function"&&typeof Symbol.iterator=="object",jt=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ws||"symbol")?Symbol.toStringTag:null,Od=Object.prototype.propertyIsEnumerable,fc=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function pc(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||Bd.call(/e/,t))return t;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var s=e<0?-dc(-e):dc(e);if(s!==e){var r=String(s),n=ol.call(t,r.length+1);return ni.call(r,i,"$&_")+"."+ni.call(ni.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ni.call(t,i,"$&_")}var $a=q_,mc=$a.custom,_c=Fd(mc)?mc:null,ng=function e(t,i,s,r){var n=i||{};if(ei(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ei(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=ei(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ei(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ei(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Gd(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?pc(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?pc(t,l):l}var c=typeof n.depth>"u"?5:n.depth;if(typeof s>"u"&&(s=0),s>=c&&c>0&&typeof t=="object")return Ya(t)?"[Array]":"[Object]";var u=wg(n,s);if(typeof r>"u")r=[];else if(Ud(r,t)>=0)return"[Circular]";function d(E,w,F){if(w&&(r=rg.call(r),r.push(w)),F){var G={depth:n.depth};return ei(n,"quoteStyle")&&(G.quoteStyle=n.quoteStyle),e(E,G,s+1,r)}return e(E,n,s+1,r)}if(typeof t=="function"&&!gc(t)){var f=pg(t),p=Xr(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Ce.call(p,", ")+" }":"")}if(Fd(t)){var m=ws?ni.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):za.call(t);return typeof t=="object"&&!ws?$s(m):m}if(bg(t)){for(var _="<"+cc.call(String(t.nodeName)),y=t.attributes||[],b=0;b<y.length;b++)_+=" "+y[b].name+"="+Ld(og(y[b].value),"double",n);return _+=">",t.childNodes&&t.childNodes.length&&(_+="..."),_+="</"+cc.call(String(t.nodeName))+">",_}if(Ya(t)){if(t.length===0)return"[]";var g=Xr(t,d);return u&&!xg(g)?"["+Wa(g,u)+"]":"[ "+Ce.call(g,", ")+" ]"}if(hg(t)){var v=Xr(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Od.call(t,"cause")?"{ ["+String(t)+"] "+Ce.call(uc.call("[cause]: "+d(t.cause),v),", ")+" }":v.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ce.call(v,", ")+" }"}if(typeof t=="object"&&o){if(_c&&typeof t[_c]=="function"&&$a)return $a(t,{depth:c-s});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(mg(t)){var S=[];return ac&&ac.call(t,function(E,w){S.push(d(w,t,!0)+" => "+d(E,t))}),yc("Map",Kn.call(t),S,u)}if(yg(t)){var R=[];return hc&&hc.call(t,function(E){R.push(d(E,t))}),yc("Set",Zn.call(t),R,u)}if(_g(t))return ta("WeakMap");if(vg(t))return ta("WeakSet");if(gg(t))return ta("WeakRef");if(cg(t))return $s(d(Number(t)));if(dg(t))return $s(d(Ha.call(t)));if(ug(t))return $s(Q_.call(t));if(lg(t))return $s(d(String(t)));if(!ag(t)&&!gc(t)){var T=Xr(t,d),x=fc?fc(t)===Object.prototype:t instanceof Object||t.constructor===Object,C=t instanceof Object?"":"null prototype",P=!x&&jt&&Object(t)===t&&jt in t?ol.call(Ei(t),8,-1):C?"Object":"",I=x||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",D=I+(P||C?"["+Ce.call(uc.call([],P||[],C||[]),": ")+"] ":"");return T.length===0?D+"{}":u?D+"{"+Wa(T,u)+"}":D+"{ "+Ce.call(T,", ")+" }"}return String(t)};function Ld(e,t,i){var s=(i.quoteStyle||t)==="double"?'"':"'";return s+e+s}function og(e){return ni.call(String(e),/"/g,"&quot;")}function Ya(e){return Ei(e)==="[object Array]"&&(!jt||!(typeof e=="object"&&jt in e))}function ag(e){return Ei(e)==="[object Date]"&&(!jt||!(typeof e=="object"&&jt in e))}function gc(e){return Ei(e)==="[object RegExp]"&&(!jt||!(typeof e=="object"&&jt in e))}function hg(e){return Ei(e)==="[object Error]"&&(!jt||!(typeof e=="object"&&jt in e))}function lg(e){return Ei(e)==="[object String]"&&(!jt||!(typeof e=="object"&&jt in e))}function cg(e){return Ei(e)==="[object Number]"&&(!jt||!(typeof e=="object"&&jt in e))}function ug(e){return Ei(e)==="[object Boolean]"&&(!jt||!(typeof e=="object"&&jt in e))}function Fd(e){if(ws)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!za)return!1;try{return za.call(e),!0}catch{}return!1}function dg(e){if(!e||typeof e!="object"||!Ha)return!1;try{return Ha.call(e),!0}catch{}return!1}var fg=Object.prototype.hasOwnProperty||function(e){return e in this};function ei(e,t){return fg.call(e,t)}function Ei(e){return tg.call(e)}function pg(e){if(e.name)return e.name;var t=ig.call(eg.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function Ud(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}function mg(e){if(!Kn||!e||typeof e!="object")return!1;try{Kn.call(e);try{Zn.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function _g(e){if(!nr||!e||typeof e!="object")return!1;try{nr.call(e,nr);try{or.call(e,or)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function gg(e){if(!lc||!e||typeof e!="object")return!1;try{return lc.call(e),!0}catch{}return!1}function yg(e){if(!Zn||!e||typeof e!="object")return!1;try{Zn.call(e);try{Kn.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function vg(e){if(!or||!e||typeof e!="object")return!1;try{or.call(e,or);try{nr.call(e,nr)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function bg(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function Gd(e,t){if(e.length>t.maxStringLength){var i=e.length-t.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return Gd(ol.call(e,0,t.maxStringLength),t)+s}var r=ni.call(ni.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Eg);return Ld(r,"single",t)}function Eg(e){var t=e.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return i?"\\"+i:"\\x"+(t<16?"0":"")+sg.call(t.toString(16))}function $s(e){return"Object("+e+")"}function ta(e){return e+" { ? }"}function yc(e,t,i,s){var r=s?Wa(i,s):Ce.call(i,", ");return e+" ("+t+") {"+r+"}"}function xg(e){for(var t=0;t<e.length;t++)if(Ud(e[t],`
`)>=0)return!1;return!0}function wg(e,t){var i;if(e.indent==="	")i="	";else if(typeof e.indent=="number"&&e.indent>0)i=Ce.call(Array(e.indent+1)," ");else return null;return{base:i,prev:Ce.call(Array(t+1),i)}}function Wa(e,t){if(e.length===0)return"";var i=`
`+t.prev+t.base;return i+Ce.call(e,","+i)+`
`+t.prev}function Xr(e,t){var i=Ya(e),s=[];if(i){s.length=e.length;for(var r=0;r<e.length;r++)s[r]=ei(e,r)?t(e[r],e):""}var n=typeof Qo=="function"?Qo(e):[],o;if(ws){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a]}for(var h in e)ei(e,h)&&(i&&String(Number(h))===h&&h<e.length||ws&&o["$"+h]instanceof Symbol||(Bd.call(/[^\w$]/,h)?s.push(t(h,e)+": "+t(e[h],e)):s.push(h+": "+t(e[h],e))));if(typeof Qo=="function")for(var l=0;l<n.length;l++)Od.call(e,n[l])&&s.push("["+t(n[l])+"]: "+t(e[n[l]],e));return s}var al=sl,Os=X_,Sg=ng,Tg=al("%TypeError%"),Vr=al("%WeakMap%",!0),jr=al("%Map%",!0),Ag=Os("WeakMap.prototype.get",!0),Rg=Os("WeakMap.prototype.set",!0),Ig=Os("WeakMap.prototype.has",!0),Cg=Os("Map.prototype.get",!0),kg=Os("Map.prototype.set",!0),Dg=Os("Map.prototype.has",!0),hl=function(e,t){for(var i=e,s;(s=i.next)!==null;i=s)if(s.key===t)return i.next=s.next,s.next=e.next,e.next=s,s},Pg=function(e,t){var i=hl(e,t);return i&&i.value},Mg=function(e,t,i){var s=hl(e,t);s?s.value=i:e.next={key:t,next:e.next,value:i}},Ng=function(e,t){return!!hl(e,t)},Bg=function(){var t,i,s,r={assert:function(n){if(!r.has(n))throw new Tg("Side channel does not contain "+Sg(n))},get:function(n){if(Vr&&n&&(typeof n=="object"||typeof n=="function")){if(t)return Ag(t,n)}else if(jr){if(i)return Cg(i,n)}else if(s)return Pg(s,n)},has:function(n){if(Vr&&n&&(typeof n=="object"||typeof n=="function")){if(t)return Ig(t,n)}else if(jr){if(i)return Dg(i,n)}else if(s)return Ng(s,n);return!1},set:function(n,o){Vr&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new Vr),Rg(t,n,o)):jr?(i||(i=new jr),kg(i,n,o)):(s||(s={key:{},next:null}),Mg(s,n,o))}};return r},Og=String.prototype.replace,Lg=/%20/g,ea={RFC1738:"RFC1738",RFC3986:"RFC3986"},ll={default:ea.RFC3986,formatters:{RFC1738:function(e){return Og.call(e,Lg,"+")},RFC3986:function(e){return String(e)}},RFC1738:ea.RFC1738,RFC3986:ea.RFC3986},Fg=ll,ia=Object.prototype.hasOwnProperty,Ci=Array.isArray,Se=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),Ug=function(t){for(;t.length>1;){var i=t.pop(),s=i.obj[i.prop];if(Ci(s)){for(var r=[],n=0;n<s.length;++n)typeof s[n]<"u"&&r.push(s[n]);i.obj[i.prop]=r}}},Hd=function(t,i){for(var s=i&&i.plainObjects?Object.create(null):{},r=0;r<t.length;++r)typeof t[r]<"u"&&(s[r]=t[r]);return s},Gg=function e(t,i,s){if(!i)return t;if(typeof i!="object"){if(Ci(t))t.push(i);else if(t&&typeof t=="object")(s&&(s.plainObjects||s.allowPrototypes)||!ia.call(Object.prototype,i))&&(t[i]=!0);else return[t,i];return t}if(!t||typeof t!="object")return[t].concat(i);var r=t;return Ci(t)&&!Ci(i)&&(r=Hd(t,s)),Ci(t)&&Ci(i)?(i.forEach(function(n,o){if(ia.call(t,o)){var a=t[o];a&&typeof a=="object"&&n&&typeof n=="object"?t[o]=e(a,n,s):t.push(n)}else t[o]=n}),t):Object.keys(i).reduce(function(n,o){var a=i[o];return ia.call(n,o)?n[o]=e(n[o],a,s):n[o]=a,n},r)},Hg=function(t,i){return Object.keys(i).reduce(function(s,r){return s[r]=i[r],s},t)},zg=function(e,t,i){var s=e.replace(/\+/g," ");if(i==="iso-8859-1")return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch{return s}},$g=function(t,i,s,r,n){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),s==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;++h){var l=o.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||n===Fg.RFC1738&&(l===40||l===41)){a+=o.charAt(h);continue}if(l<128){a=a+Se[l];continue}if(l<2048){a=a+(Se[192|l>>6]+Se[128|l&63]);continue}if(l<55296||l>=57344){a=a+(Se[224|l>>12]+Se[128|l>>6&63]+Se[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|o.charCodeAt(h)&1023),a+=Se[240|l>>18]+Se[128|l>>12&63]+Se[128|l>>6&63]+Se[128|l&63]}return a},Yg=function(t){for(var i=[{obj:{o:t},prop:"o"}],s=[],r=0;r<i.length;++r)for(var n=i[r],o=n.obj[n.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];typeof c=="object"&&c!==null&&s.indexOf(c)===-1&&(i.push({obj:o,prop:l}),s.push(c))}return Ug(i),t},Wg=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},Xg=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},Vg=function(t,i){return[].concat(t,i)},jg=function(t,i){if(Ci(t)){for(var s=[],r=0;r<t.length;r+=1)s.push(i(t[r]));return s}return i(t)},zd={arrayToObject:Hd,assign:Hg,combine:Vg,compact:Yg,decode:zg,encode:$g,isBuffer:Xg,isRegExp:Wg,maybeMap:jg,merge:Gg},$d=Bg,kn=zd,ar=ll,qg=Object.prototype.hasOwnProperty,vc={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,i){return t+"["+i+"]"},repeat:function(t){return t}},Ye=Array.isArray,Kg=Array.prototype.push,Yd=function(e,t){Kg.apply(e,Ye(t)?t:[t])},Zg=Date.prototype.toISOString,bc=ar.default,Xt={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:kn.encode,encodeValuesOnly:!1,format:bc,formatter:ar.formatters[bc],indices:!1,serializeDate:function(t){return Zg.call(t)},skipNulls:!1,strictNullHandling:!1},Jg=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},sa={},Qg=function e(t,i,s,r,n,o,a,h,l,c,u,d,f,p,m,_){for(var y=t,b=_,g=0,v=!1;(b=b.get(sa))!==void 0&&!v;){var S=b.get(t);if(g+=1,typeof S<"u"){if(S===g)throw new RangeError("Cyclic object value");v=!0}typeof b.get(sa)>"u"&&(g=0)}if(typeof h=="function"?y=h(i,y):y instanceof Date?y=u(y):s==="comma"&&Ye(y)&&(y=kn.maybeMap(y,function(G){return G instanceof Date?u(G):G})),y===null){if(n)return a&&!p?a(i,Xt.encoder,m,"key",d):i;y=""}if(Jg(y)||kn.isBuffer(y)){if(a){var R=p?i:a(i,Xt.encoder,m,"key",d);return[f(R)+"="+f(a(y,Xt.encoder,m,"value",d))]}return[f(i)+"="+f(String(y))]}var T=[];if(typeof y>"u")return T;var x;if(s==="comma"&&Ye(y))p&&a&&(y=kn.maybeMap(y,a)),x=[{value:y.length>0?y.join(",")||null:void 0}];else if(Ye(h))x=h;else{var C=Object.keys(y);x=l?C.sort(l):C}for(var P=r&&Ye(y)&&y.length===1?i+"[]":i,I=0;I<x.length;++I){var D=x[I],E=typeof D=="object"&&typeof D.value<"u"?D.value:y[D];if(!(o&&E===null)){var w=Ye(y)?typeof s=="function"?s(P,D):P:P+(c?"."+D:"["+D+"]");_.set(t,g);var F=$d();F.set(sa,_),Yd(T,e(E,w,s,r,n,o,s==="comma"&&p&&Ye(y)?null:a,h,l,c,u,d,f,p,m,F))}}return T},ty=function(t){if(!t)return Xt;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var i=t.charset||Xt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var s=ar.default;if(typeof t.format<"u"){if(!qg.call(ar.formatters,t.format))throw new TypeError("Unknown format option provided.");s=t.format}var r=ar.formatters[s],n=Xt.filter;return(typeof t.filter=="function"||Ye(t.filter))&&(n=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Xt.addQueryPrefix,allowDots:typeof t.allowDots>"u"?Xt.allowDots:!!t.allowDots,charset:i,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Xt.charsetSentinel,delimiter:typeof t.delimiter>"u"?Xt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Xt.encode,encoder:typeof t.encoder=="function"?t.encoder:Xt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Xt.encodeValuesOnly,filter:n,format:s,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Xt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Xt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Xt.strictNullHandling}},ey=function(e,t){var i=e,s=ty(t),r,n;typeof s.filter=="function"?(n=s.filter,i=n("",i)):Ye(s.filter)&&(n=s.filter,r=n);var o=[];if(typeof i!="object"||i===null)return"";var a;t&&t.arrayFormat in vc?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=vc[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;r||(r=Object.keys(i)),s.sort&&r.sort(s.sort);for(var c=$d(),u=0;u<r.length;++u){var d=r[u];s.skipNulls&&i[d]===null||Yd(o,Qg(i[d],d,h,l,s.strictNullHandling,s.skipNulls,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}var f=o.join(s.delimiter),p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},Ss=zd,Xa=Object.prototype.hasOwnProperty,iy=Array.isArray,Bt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Ss.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},sy=function(e){return e.replace(/&#(\d+);/g,function(t,i){return String.fromCharCode(parseInt(i,10))})},Wd=function(e,t){return e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1?e.split(","):e},ry="utf8=%26%2310003%3B",ny="utf8=%E2%9C%93",oy=function(t,i){var s={__proto__:null},r=i.ignoreQueryPrefix?t.replace(/^\?/,""):t,n=i.parameterLimit===1/0?void 0:i.parameterLimit,o=r.split(i.delimiter,n),a=-1,h,l=i.charset;if(i.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===ny?l="utf-8":o[h]===ry&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var c=o[h],u=c.indexOf("]="),d=u===-1?c.indexOf("="):u+1,f,p;d===-1?(f=i.decoder(c,Bt.decoder,l,"key"),p=i.strictNullHandling?null:""):(f=i.decoder(c.slice(0,d),Bt.decoder,l,"key"),p=Ss.maybeMap(Wd(c.slice(d+1),i),function(m){return i.decoder(m,Bt.decoder,l,"value")})),p&&i.interpretNumericEntities&&l==="iso-8859-1"&&(p=sy(p)),c.indexOf("[]=")>-1&&(p=iy(p)?[p]:p),Xa.call(s,f)?s[f]=Ss.combine(s[f],p):s[f]=p}return s},ay=function(e,t,i,s){for(var r=s?t:Wd(t,i),n=e.length-1;n>=0;--n){var o,a=e[n];if(a==="[]"&&i.parseArrays)o=[].concat(r);else{o=i.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!i.parseArrays&&h===""?o={0:r}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&i.parseArrays&&l<=i.arrayLimit?(o=[],o[l]=r):h!=="__proto__"&&(o[h]=r)}r=o}return r},hy=function(t,i,s,r){if(t){var n=s.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=s.depth>0&&o.exec(n),l=h?n.slice(0,h.index):n,c=[];if(l){if(!s.plainObjects&&Xa.call(Object.prototype,l)&&!s.allowPrototypes)return;c.push(l)}for(var u=0;s.depth>0&&(h=a.exec(n))!==null&&u<s.depth;){if(u+=1,!s.plainObjects&&Xa.call(Object.prototype,h[1].slice(1,-1))&&!s.allowPrototypes)return;c.push(h[1])}return h&&c.push("["+n.slice(h.index)+"]"),ay(c,i,s,r)}},ly=function(t){if(!t)return Bt;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=typeof t.charset>"u"?Bt.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?Bt.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Bt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Bt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Bt.arrayLimit,charset:i,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Bt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Bt.comma,decoder:typeof t.decoder=="function"?t.decoder:Bt.decoder,delimiter:typeof t.delimiter=="string"||Ss.isRegExp(t.delimiter)?t.delimiter:Bt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Bt.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Bt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Bt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Bt.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Bt.strictNullHandling}},cy=function(e,t){var i=ly(t);if(e===""||e===null||typeof e>"u")return i.plainObjects?Object.create(null):{};for(var s=typeof e=="string"?oy(e,i):e,r=i.plainObjects?Object.create(null):{},n=Object.keys(s),o=0;o<n.length;++o){var a=n[o],h=hy(a,s[a],i,typeof e=="string");r=Ss.merge(r,h,i)}return i.allowSparse===!0?r:Ss.compact(r)},uy=ey,dy=cy,fy=ll,py={formats:fy,parse:dy,stringify:uy},my=v_;function ve(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var _y=/^([a-z0-9.+-]+:)/i,gy=/:[0-9]*$/,yy=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,vy=["<",">",'"',"`"," ","\r",`
`,"	"],by=["{","}","|","\\","^","`"].concat(vy),Va=["'"].concat(by),Ec=["%","/","?",";","#"].concat(Va),xc=["/","?","#"],Ey=255,wc=/^[+a-z0-9A-Z_-]{0,63}$/,xy=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,wy={javascript:!0,"javascript:":!0},ja={javascript:!0,"javascript:":!0},us={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},qa=py;function wo(e,t,i){if(e&&typeof e=="object"&&e instanceof ve)return e;var s=new ve;return s.parse(e,t,i),s}ve.prototype.parse=function(e,t,i){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),r=s!==-1&&s<e.indexOf("#")?"?":"#",n=e.split(r),o=/\\/g;n[0]=n[0].replace(o,"/"),e=n.join(r);var a=e;if(a=a.trim(),!i&&e.split("#").length===1){var h=yy.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=qa.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=_y.exec(a);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,a=a.substr(l.length)}if(i||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var u=a.substr(0,2)==="//";u&&!(l&&ja[l])&&(a=a.substr(2),this.slashes=!0)}if(!ja[l]&&(u||l&&!us[l])){for(var d=-1,f=0;f<xc.length;f++){var p=a.indexOf(xc[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,_;d===-1?_=a.lastIndexOf("@"):_=a.lastIndexOf("@",d),_!==-1&&(m=a.slice(0,_),a=a.slice(_+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Ec.length;f++){var p=a.indexOf(Ec[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var b=this.hostname.split(/\./),f=0,g=b.length;f<g;f++){var v=b[f];if(v&&!v.match(wc)){for(var S="",R=0,T=v.length;R<T;R++)v.charCodeAt(R)>127?S+="x":S+=v[R];if(!S.match(wc)){var x=b.slice(0,f),C=b.slice(f+1),P=v.match(xy);P&&(x.push(P[1]),C.unshift(P[2])),C.length&&(a="/"+C.join(".")+a),this.hostname=x.join(".");break}}}this.hostname.length>Ey?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=my.toASCII(this.hostname));var I=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+I,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!wy[c])for(var f=0,g=Va.length;f<g;f++){var E=Va[f];if(a.indexOf(E)!==-1){var w=encodeURIComponent(E);w===E&&(w=escape(E)),a=a.split(E).join(w)}}var F=a.indexOf("#");F!==-1&&(this.hash=a.substr(F),a=a.slice(0,F));var G=a.indexOf("?");if(G!==-1?(this.search=a.substr(G),this.query=a.substr(G+1),t&&(this.query=qa.parse(this.query)),a=a.slice(0,G)):t&&(this.search="",this.query={}),a&&(this.pathname=a),us[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var I=this.pathname||"",N=this.search||"";this.path=I+N}return this.href=this.format(),this};function Sy(e){return typeof e=="string"&&(e=wo(e)),e instanceof ve?e.format():ve.prototype.format.call(e)}ve.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",s=this.hash||"",r=!1,n="";this.host?r=e+this.host:this.hostname&&(r=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=qa.stringify(this.query));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||us[t])&&r!==!1?(r="//"+(r||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):r||(r=""),s&&s.charAt(0)!=="#"&&(s="#"+s),o&&o.charAt(0)!=="?"&&(o="?"+o),i=i.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+r+i+o+s};function Ty(e,t){return wo(e,!1,!0).resolve(t)}ve.prototype.resolve=function(e){return this.resolveObject(wo(e,!1,!0)).format()};ve.prototype.resolveObject=function(e){if(typeof e=="string"){var t=new ve;t.parse(e,!1,!0),e=t}for(var i=new ve,s=Object.keys(this),r=0;r<s.length;r++){var n=s[r];i[n]=this[n]}if(i.hash=e.hash,e.href==="")return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(i[h]=e[h])}return us[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!us[e.protocol]){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];i[u]=e[u]}return i.href=i.format(),i}if(i.protocol=e.protocol,!e.host&&!ja[e.protocol]){for(var g=(e.pathname||"").split("/");g.length&&!(e.host=g.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),i.pathname=g.join("/")}else i.pathname=e.pathname;if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var d=i.pathname||"",f=i.search||"";i.path=d+f}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var p=i.pathname&&i.pathname.charAt(0)==="/",m=e.host||e.pathname&&e.pathname.charAt(0)==="/",_=m||p||i.host&&e.pathname,y=_,b=i.pathname&&i.pathname.split("/")||[],g=e.pathname&&e.pathname.split("/")||[],v=i.protocol&&!us[i.protocol];if(v&&(i.hostname="",i.port=null,i.host&&(b[0]===""?b[0]=i.host:b.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(g[0]===""?g[0]=e.host:g.unshift(e.host)),e.host=null),_=_&&(g[0]===""||b[0]==="")),m)i.host=e.host||e.host===""?e.host:i.host,i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname,i.search=e.search,i.query=e.query,b=g;else if(g.length)b||(b=[]),b.pop(),b=b.concat(g),i.search=e.search,i.query=e.query;else if(e.search!=null){if(v){i.host=b.shift(),i.hostname=i.host;var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;S&&(i.auth=S.shift(),i.hostname=S.shift(),i.host=i.hostname)}return i.search=e.search,i.query=e.query,(i.pathname!==null||i.search!==null)&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!b.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var R=b.slice(-1)[0],T=(i.host||e.host||b.length>1)&&(R==="."||R==="..")||R==="",x=0,C=b.length;C>=0;C--)R=b[C],R==="."?b.splice(C,1):R===".."?(b.splice(C,1),x++):x&&(b.splice(C,1),x--);if(!_&&!y)for(;x--;x)b.unshift("..");_&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")&&b.unshift(""),T&&b.join("/").substr(-1)!=="/"&&b.push("");var P=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(v){i.hostname=P?"":b.length?b.shift():"",i.host=i.hostname;var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;S&&(i.auth=S.shift(),i.hostname=S.shift(),i.host=i.hostname)}return _=_||i.host&&b.length,_&&!P&&b.unshift(""),b.length>0?i.pathname=b.join("/"):(i.pathname=null,i.path=null),(i.pathname!==null||i.search!==null)&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i};ve.prototype.parseHost=function(){var e=this.host,t=gy.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var Ay=wo,Ry=Ty,Iy=Sy;const Cy={parse:Ay,format:Iy,resolve:Ry};function he(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function Ys(e){return e.split("?")[0].split("#")[0]}function ky(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Dy(e,t,i){return e.replace(new RegExp(ky(t),"g"),i)}function Py(e,t){let i="",s=0,r=-1,n=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(i.length<2||s!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){const h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",s=0):(i=i.slice(0,h),s=i.length-1-i.lastIndexOf("/")),r=a,n=0;continue}}else if(i.length===2||i.length===1){i="",s=0,r=a,n=0;continue}}t&&(i.length>0?i+="/..":i="..",s=2)}else i.length>0?i+=`/${e.slice(r+1,a)}`:i=e.slice(r+1,a),s=a-r-1;r=a,n=0}else o===46&&n!==-1?++n:n=-1}return i}const Vt={toPosix(e){return Dy(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){he(e),e=this.toPosix(e);let t="";const i=/^file:\/\/\//.exec(e),s=/^[^/:]+:\/\//.exec(e),r=/^[^/:]+:\//.exec(e);if(i||s||r){const n=(i==null?void 0:i[0])||(s==null?void 0:s[0])||(r==null?void 0:r[0]);t=n,e=e.slice(n.length)}return t},toAbsolute(e,t,i){if(this.isDataUrl(e))return e;const s=Ys(this.toPosix(t??B.ADAPTER.getBaseUrl())),r=Ys(this.toPosix(i??this.rootname(s)));return he(e),e=this.toPosix(e),e.startsWith("/")?Vt.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(s,e)},normalize(e){if(e=this.toPosix(e),he(e),e.length===0)return".";let t="";const i=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const s=e.endsWith("/");return e=Py(e,!1),e.length>0&&s&&(e+="/"),i?`/${e}`:t+e},isAbsolute(e){return he(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let i=0;i<e.length;++i){const s=e[i];if(he(s),s.length>0)if(t===void 0)t=s;else{const r=e[i-1]??"";this.extname(r)?t+=`/../${s}`:t+=`/${s}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(he(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const i=t===47;let s=-1,r=!0;const n=this.getProtocol(e),o=e;e=e.slice(n.length);for(let a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!r){s=a;break}}else r=!1;return s===-1?i?"/":this.isUrl(o)?n+e:n:i&&s===1?"//":n+e.slice(0,s)},rootname(e){he(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const i=e.indexOf("/",t.length);i!==-1?t=e.slice(0,i):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){he(e),t&&he(t),e=Ys(this.toPosix(e));let i=0,s=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){const h=e.charCodeAt(n);if(h===47){if(!r){i=n+1;break}}else a===-1&&(r=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(s=n):(o=-1,s=a))}return i===s?s=a:s===-1&&(s=e.length),e.slice(i,s)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!r){i=n+1;break}}else s===-1&&(r=!1,s=n+1);return s===-1?"":e.slice(i,s)},extname(e){he(e),e=Ys(this.toPosix(e));let t=-1,i=0,s=-1,r=!0,n=0;for(let o=e.length-1;o>=0;--o){const a=e.charCodeAt(o);if(a===47){if(!r){i=o+1;break}continue}s===-1&&(r=!1,s=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||s===-1||n===0||n===1&&t===s-1&&t===i+1?"":e.slice(t,s)},parse(e){he(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=Ys(this.toPosix(e));let i=e.charCodeAt(0);const s=this.isAbsolute(e);let r;t.root=this.rootname(e),s||this.hasProtocol(e)?r=1:r=0;let n=-1,o=0,a=-1,h=!0,l=e.length-1,c=0;for(;l>=r;--l){if(i=e.charCodeAt(l),i===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),i===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&s?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(o,a)):(o===0&&s?(t.name=e.slice(1,n),t.base=e.slice(1,a)):(t.name=e.slice(o,n),t.base=e.slice(o,a)),t.ext=e.slice(n,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Sc={};function J(e,t,i=3){if(Sc[t])return;let s=new Error().stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(s=s.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(s))),Sc[t]=!0}let ra;function My(){return typeof ra>"u"&&(ra=function(){var i;const t={stencil:!0,failIfMajorPerformanceCaveat:B.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!B.ADAPTER.getWebGLRenderingContext())return!1;const s=B.ADAPTER.createCanvas();let r=s.getContext("webgl",t)||s.getContext("experimental-webgl",t);const n=!!((i=r==null?void 0:r.getContextAttributes())!=null&&i.stencil);if(r){const o=r.getExtension("WEBGL_lose_context");o&&o.loseContext()}return r=null,n}catch{return!1}}()),ra}var Ny={grad:.9,turn:360,rad:360/(2*Math.PI)},Ge=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},Lt=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},ae=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=1),e>i?i:e>t?e:t},Xd=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},Tc=function(e){return{r:ae(e.r,0,255),g:ae(e.g,0,255),b:ae(e.b,0,255),a:ae(e.a)}},na=function(e){return{r:Lt(e.r),g:Lt(e.g),b:Lt(e.b),a:Lt(e.a,3)}},By=/^#([0-9a-f]{3,8})$/i,qr=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Vd=function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=Math.max(t,i,s),o=n-Math.min(t,i,s),a=o?n===t?(i-s)/o:n===i?2+(s-t)/o:4+(t-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},jd=function(e){var t=e.h,i=e.s,s=e.v,r=e.a;t=t/360*6,i/=100,s/=100;var n=Math.floor(t),o=s*(1-i),a=s*(1-(t-n)*i),h=s*(1-(1-t+n)*i),l=n%6;return{r:255*[s,a,o,o,h,s][l],g:255*[h,s,s,a,o,o][l],b:255*[o,o,h,s,s,a][l],a:r}},Ac=function(e){return{h:Xd(e.h),s:ae(e.s,0,100),l:ae(e.l,0,100),a:ae(e.a)}},Rc=function(e){return{h:Lt(e.h),s:Lt(e.s),l:Lt(e.l),a:Lt(e.a,3)}},Ic=function(e){return jd((i=(t=e).s,{h:t.h,s:(i*=((s=t.l)<50?s:100-s)/100)>0?2*i/(s+i)*100:0,v:s+i,a:t.a}));var t,i,s},hr=function(e){return{h:(t=Vd(e)).h,s:(r=(200-(i=t.s))*(s=t.v)/100)>0&&r<200?i*s/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,i,s,r},Oy=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ly=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fy=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Uy=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ka={string:[[function(e){var t=By.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?Lt(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?Lt(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=Fy.exec(e)||Uy.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:Tc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Oy.exec(e)||Ly.exec(e);if(!t)return null;var i,s,r=Ac({h:(i=t[1],s=t[2],s===void 0&&(s="deg"),Number(i)*(Ny[s]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Ic(r)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=r===void 0?1:r;return Ge(t)&&Ge(i)&&Ge(s)?Tc({r:Number(t),g:Number(i),b:Number(s),a:Number(n)}):null},"rgb"],[function(e){var t=e.h,i=e.s,s=e.l,r=e.a,n=r===void 0?1:r;if(!Ge(t)||!Ge(i)||!Ge(s))return null;var o=Ac({h:Number(t),s:Number(i),l:Number(s),a:Number(n)});return Ic(o)},"hsl"],[function(e){var t=e.h,i=e.s,s=e.v,r=e.a,n=r===void 0?1:r;if(!Ge(t)||!Ge(i)||!Ge(s))return null;var o=function(a){return{h:Xd(a.h),s:ae(a.s,0,100),v:ae(a.v,0,100),a:ae(a.a)}}({h:Number(t),s:Number(i),v:Number(s),a:Number(n)});return jd(o)},"hsv"]]},Cc=function(e,t){for(var i=0;i<t.length;i++){var s=t[i][0](e);if(s)return[s,t[i][1]]}return[null,void 0]},Gy=function(e){return typeof e=="string"?Cc(e.trim(),Ka.string):typeof e=="object"&&e!==null?Cc(e,Ka.object):[null,void 0]},oa=function(e,t){var i=hr(e);return{h:i.h,s:ae(i.s+100*t,0,100),l:i.l,a:i.a}},aa=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},kc=function(e,t){var i=hr(e);return{h:i.h,s:i.s,l:ae(i.l+100*t,0,100),a:i.a}},Za=function(){function e(t){this.parsed=Gy(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return Lt(aa(this.rgba),2)},e.prototype.isDark=function(){return aa(this.rgba)<.5},e.prototype.isLight=function(){return aa(this.rgba)>=.5},e.prototype.toHex=function(){return t=na(this.rgba),i=t.r,s=t.g,r=t.b,o=(n=t.a)<1?qr(Lt(255*n)):"","#"+qr(i)+qr(s)+qr(r)+o;var t,i,s,r,n,o},e.prototype.toRgb=function(){return na(this.rgba)},e.prototype.toRgbString=function(){return t=na(this.rgba),i=t.r,s=t.g,r=t.b,(n=t.a)<1?"rgba("+i+", "+s+", "+r+", "+n+")":"rgb("+i+", "+s+", "+r+")";var t,i,s,r,n},e.prototype.toHsl=function(){return Rc(hr(this.rgba))},e.prototype.toHslString=function(){return t=Rc(hr(this.rgba)),i=t.h,s=t.s,r=t.l,(n=t.a)<1?"hsla("+i+", "+s+"%, "+r+"%, "+n+")":"hsl("+i+", "+s+"%, "+r+"%)";var t,i,s,r,n},e.prototype.toHsv=function(){return t=Vd(this.rgba),{h:Lt(t.h),s:Lt(t.s),v:Lt(t.v),a:Lt(t.a,3)};var t},e.prototype.invert=function(){return Te({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Te(oa(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Te(oa(this.rgba,-t))},e.prototype.grayscale=function(){return Te(oa(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Te(kc(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Te(kc(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Te({r:(i=this.rgba).r,g:i.g,b:i.b,a:t}):Lt(this.rgba.a,3);var i},e.prototype.hue=function(t){var i=hr(this.rgba);return typeof t=="number"?Te({h:t,s:i.s,l:i.l,a:i.a}):Lt(i.h)},e.prototype.isEqual=function(t){return this.toHex()===Te(t).toHex()},e}(),Te=function(e){return e instanceof Za?e:new Za(e)},Dc=[],Hy=function(e){e.forEach(function(t){Dc.indexOf(t)<0&&(t(Za,Ka),Dc.push(t))})};function zy(e,t){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var r in i)s[i[r]]=r;var n={};e.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=s[this.toHex()];if(l)return l;if(o!=null&&o.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var f in i)n[f]=new e(i[f]).toRgb();for(var p in i){var m=(a=c,h=n[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<u&&(u=m,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":i[a];return h?new e(h).toRgb():null},"name"])}Hy([zy]);const ds=class{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof ds)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((r,n)=>r===t[n]);if(e!==null&&t!==null){const r=Object.keys(e),n=Object.keys(t);return r.length!==n.length?!1:r.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,i,s]=this._components;return{r:e,g:t,b:i,a:s}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,s]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e??[];const[t,i,s]=this._components;return e[0]=t,e[1]=i,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,s,r]=ds.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=s,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,r=this._int&255;return t&&(i=i*e+.5|0,s=s*e+.5|0,r=r*e+.5|0),(e*255<<24)+(i<<16)+(s<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,s,r]=this._components;return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e}normalize(e){let t,i,s,r;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const n=e;t=(n>>16&255)/255,i=(n>>8&255)/255,s=(n&255)/255,r=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,s,r=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,s,r=255]=e,t/=255,i/=255,s/=255,r/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=ds.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const n=Te(e);n.isValid()&&({r:t,g:i,b:s,a:r}=n.rgba,t/=255,i/=255,s/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=s,this._components[3]=r,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((s,r)=>{e[r]=Math.min(Math.max(s,t),i)}),e)}};let ct=ds;ct.shared=new ds;ct.temp=new ds;ct.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function $y(e){return J("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),ct.shared.setValue(e).toHex()}function Yy(e){return J("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),ct.shared.setValue(e).toNumber()}function Wy(){const e=[],t=[];for(let s=0;s<32;s++)e[s]=s,t[s]=s;e[W.NORMAL_NPM]=W.NORMAL,e[W.ADD_NPM]=W.ADD,e[W.SCREEN_NPM]=W.SCREEN,t[W.NORMAL]=W.NORMAL_NPM,t[W.ADD]=W.ADD_NPM,t[W.SCREEN]=W.SCREEN_NPM;const i=[];return i.push(t),i.push(e),i}const qd=Wy();function Kd(e,t){return qd[t?1:0][e]}function Xy(e,t=null){const i=e*6;if(t=t||new Uint16Array(i),t.length!==i)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${i}`);for(let s=0,r=0;s<i;s+=6,r+=4)t[s+0]=r+0,t[s+1]=r+1,t[s+2]=r+2,t[s+3]=r+0,t[s+4]=r+2,t[s+5]=r+3;return t}function Zd(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Jn(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Pc(e){return!(e&e-1)&&!!e}function Mc(e){let t=(e>65535?1:0)<<4;e>>>=t;let i=(e>255?1:0)<<3;return e>>>=i,t|=i,i=(e>15?1:0)<<2,e>>>=i,t|=i,i=(e>3?1:0)<<1,e>>>=i,t|=i,t|e>>1}function fs(e,t,i){const s=e.length;let r;if(t>=s||i===0)return;i=t+i>s?s-t:i;const n=s-i;for(r=t;r<n;++r)e[r]=e[r+i];e.length=n}function oi(e){return e===0?0:e<0?-1:1}let Vy=0;function Fi(){return++Vy}const Jd=class{constructor(e,t,i,s){this.left=e,this.top=t,this.right=i,this.bottom=s}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Ja=Jd;Ja.EMPTY=new Jd(0,0,0,0);const Nc={},Ae=Object.create(null),ti=Object.create(null);class jy{constructor(t,i,s){this._canvas=B.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=s||B.RESOLUTION,this.resize(t,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,i){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Bc(e,t,i){for(let s=0,r=4*i*t;s<t;++s,r+=4)if(e[r+3]!==0)return!1;return!0}function Oc(e,t,i,s,r){const n=4*t;for(let o=s,a=s*n+4*i;o<=r;++o,a+=n)if(e[a+3]!==0)return!1;return!0}function qy(e){const{width:t,height:i}=e,s=e.getContext("2d",{willReadFrequently:!0});if(s===null)throw new TypeError("Failed to get canvas 2D context");const n=s.getImageData(0,0,t,i).data;let o=0,a=0,h=t-1,l=i-1;for(;a<i&&Bc(n,t,a);)++a;if(a===i)return Ja.EMPTY;for(;Bc(n,t,l);)--l;for(;Oc(n,t,o,a,l);)++o;for(;Oc(n,t,h,a,l);)--h;return++h,++l,new Ja(o,a,h,l)}function Ky(e){const t=qy(e),{width:i,height:s}=t;let r=null;if(!t.isEmpty()){const n=e.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(t.left,t.top,i,s)}return{width:i,height:s,data:r}}let Kr;function Zy(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Kr||(Kr=document.createElement("a")),Kr.href=e;const i=Cy.parse(Kr.href),s=!i.port&&t.port===""||i.port===t.port;return i.hostname!==t.hostname||!s||i.protocol!==t.protocol?"anonymous":""}function fi(e,t=1){var s;const i=(s=B.RETINA_PREFIX)==null?void 0:s.exec(e);return i?parseFloat(i[1]):t}var O=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(O||{});const Qa=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Lc=(e,t)=>Qa(e).priority??t,H={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Qa).forEach(t=>{t.type.forEach(i=>{var s,r;return(r=(s=this._removeHandlers)[i])==null?void 0:r.call(s,t)})}),this},add(...e){return e.map(Qa).forEach(t=>{t.type.forEach(i=>{const s=this._addHandlers,r=this._queue;s[i]?s[i](t):(r[i]=r[i]||[],r[i].push(t))})}),this},handle(e,t,i){const s=this._addHandlers,r=this._removeHandlers;if(s[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);s[e]=t,r[e]=i;const n=this._queue;return n[e]&&(n[e].forEach(o=>t(o)),delete n[e]),this},handleByMap(e,t){return this.handle(e,i=>{t[i.name]=i.ref},i=>{delete t[i.name]})},handleByList(e,t,i=-1){return this.handle(e,s=>{t.includes(s.ref)||(t.push(s.ref),t.sort((r,n)=>Lc(n,i)-Lc(r,i)))},s=>{const r=t.indexOf(s.ref);r!==-1&&t.splice(r,1)})}};class th{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Jy=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Qy(e){let t="";for(let i=0;i<e;++i)i>0&&(t+=`
else `),i<e-1&&(t+=`if(test == ${i}.0){}`);return t}function t0(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=Jy.replace(/%forloop%/gi,Qy(e));if(t.shaderSource(i,s),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))e=e/2|0;else break}return e}const ha=0,la=1,ca=2,ua=3,da=4,fa=5;class Qe{constructor(){this.data=0,this.blendMode=W.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ha)}set blend(t){!!(this.data&1<<ha)!==t&&(this.data^=1<<ha)}get offsets(){return!!(this.data&1<<la)}set offsets(t){!!(this.data&1<<la)!==t&&(this.data^=1<<la)}get culling(){return!!(this.data&1<<ca)}set culling(t){!!(this.data&1<<ca)!==t&&(this.data^=1<<ca)}get depthTest(){return!!(this.data&1<<ua)}set depthTest(t){!!(this.data&1<<ua)!==t&&(this.data^=1<<ua)}get depthMask(){return!!(this.data&1<<fa)}set depthMask(t){!!(this.data&1<<fa)!==t&&(this.data^=1<<fa)}get clockwiseFrontFace(){return!!(this.data&1<<da)}set clockwiseFrontFace(t){!!(this.data&1<<da)!==t&&(this.data^=1<<da)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==W.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Qe;return t.depthTest=!1,t.blend=!0,t}}const eh=[];function Qd(e,t){if(!e)return null;let i="";if(typeof e=="string"){const s=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);s&&(i=s[1].toLowerCase())}for(let s=eh.length-1;s>=0;--s){const r=eh[s];if(r.test&&r.test(e,i))return new r(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class be{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,i,s,r,n,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,i,s,r,n,o,a,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const i=this.items.indexOf(t);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(be.prototype,{dispatch:{value:be.prototype.emit},run:{value:be.prototype.emit}});class vr{constructor(t=0,i=0){this._width=t,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new be("setRealSize"),this.onUpdate=new be("update"),this.onError=new be("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,i){(t!==this._width||i!==this._height)&&(this._width=t,this._height=i,this.onResize.emit(t,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,i,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,i){return!1}}class Mr extends vr{constructor(t,i){const{width:s,height:r}=i||{};if(!s||!r)throw new Error("BufferResource width or height invalid");super(s,r),this.data=t}upload(t,i,s){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===we.UNPACK);const n=i.realWidth,o=i.realHeight;return s.width===n&&s.height===o?r.texSubImage2D(i.target,0,0,0,n,o,i.format,s.type,this.data):(s.width=n,s.height=o,r.texImage2D(i.target,0,s.internalFormat,n,o,0,i.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const e0={scaleMode:Pe.NEAREST,format:M.RGBA,alphaMode:we.NPM},Ji=class extends Dr{constructor(e=null,t=null){super(),t=Object.assign({},Ji.defaultOptions,t);const{alphaMode:i,mipmap:s,anisotropicLevel:r,scaleMode:n,width:o,height:a,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=t;e&&!(e instanceof vr)&&(e=Qd(e,f),e.internal=!0),this.resolution=d||B.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=n,this.format=l,this.type=c,this.target=u,this.alphaMode=i,this.uid=Fi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Pc(this.realWidth)&&Pc(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ti[this.cacheId],delete Ae[this.cacheId],this.cacheId=null),this.dispose(),Ji.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=B.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let r=null;if(s)r=e;else{if(!e._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${o}_${Fi()}`}r=e._pixiId}let n=ti[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new Ji(e,t),n.cacheId=r,Ji.addToCache(n,r)),n}static fromBuffer(e,t,i,s){e=e||new Float32Array(t*i*4);const r=new Mr(e,{width:t,height:i}),n=e instanceof Float32Array?z.FLOAT:z.UNSIGNED_BYTE;return new Ji(r,Object.assign({},e0,{type:n},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ti[t]&&ti[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ti[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ti[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete ti[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ti[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let V=Ji;V.defaultOptions={mipmap:Oe.POW2,anisotropicLevel:0,scaleMode:Pe.LINEAR,wrapMode:ui.CLAMP,alphaMode:we.UNPACK,target:ls.TEXTURE_2D,format:M.RGBA,type:z.UNSIGNED_BYTE};V._globalBatch=0;class ih{constructor(){this.texArray=null,this.blend=0,this.type=De.TRIANGLES,this.start=0,this.size=0,this.data=null}}let i0=0;class Rt{constructor(t,i=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=i,this.id=i0++,this.disposeRunner=new be("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Me.ELEMENT_ARRAY_BUFFER:Me.ARRAY_BUFFER}get index(){return this.type===Me.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Rt(t)}}class Qn{constructor(t,i=0,s=!1,r=z.FLOAT,n,o,a,h=1){this.buffer=t,this.size=i,this.normalized=s,this.type=r,this.stride=n,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,i,s,r,n){return new Qn(t,i,s,r,n)}}const s0={Float32Array,Uint32Array,Int32Array,Uint8Array};function r0(e,t){let i=0,s=0;const r={};for(let h=0;h<e.length;h++)s+=t[h],i+=e[h].length;const n=new ArrayBuffer(i*4);let o=null,a=0;for(let h=0;h<e.length;h++){const l=t[h],c=e[h],u=Zd(c);r[u]||(r[u]=new s0[u](n)),o=r[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*s+a,p=d%l;o[f+p]=c[d]}a+=l}return new Float32Array(n)}const Fc={5126:4,5123:2,5121:1};let n0=0;const o0={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class pi{constructor(t=[],i={}){this.buffers=t,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=n0++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new be("disposeGeometry"),this.refCount=0}addAttribute(t,i,s=0,r=!1,n,o,a,h=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof Rt||(i instanceof Array&&(i=new Float32Array(i)),i=new Rt(i));const l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],i,s,r,n);return this}let c=this.buffers.indexOf(i);return c===-1&&(this.buffers.push(i),c=this.buffers.length-1),this.attributes[t]=new Qn(c,s,r,n,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Rt||(t instanceof Array&&(t=new Uint16Array(t)),t=new Rt(t)),t.type=Me.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],i=[],s=new Rt;let r;for(r in this.attributes){const n=this.attributes[r],o=this.buffers[n.buffer];t.push(o.data),i.push(n.size*Fc[n.type]/4),n.buffer=0}for(s.data=r0(t,i),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const i=this.attributes[t];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new pi;for(let i=0;i<this.buffers.length;i++)t.buffers[i]=new Rt(this.buffers[i].data.slice(0));for(const i in this.attributes){const s=this.attributes[i];t.attributes[i]=new Qn(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Me.ELEMENT_ARRAY_BUFFER),t}static merge(t){const i=new pi,s=[],r=[],n=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)r[h]=r[h]||0,r[h]+=o.buffers[h].data.length,n[h]=0}for(let a=0;a<o.buffers.length;a++)s[a]=new o0[Zd(o.buffers[a].data)](r[a]),i.buffers[a]=new Rt(s[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)s[h].set(o.buffers[h].data,n[h]),n[h]+=o.buffers[h].data.length}if(i.attributes=o.attributes,o.indexBuffer){i.indexBuffer=i.buffers[o.buffers.indexOf(o.indexBuffer)],i.indexBuffer.type=Me.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(h+=d.size*Fc[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)i.indexBuffer.data[f+l]+=a;a+=t[u].buffers[c].data.length/h,l+=d.length}}return i}}class tf extends pi{constructor(t=!1){super(),this._buffer=new Rt(null,t,!1),this._indexBuffer=new Rt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,z.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,z.FLOAT).addAttribute("aColor",this._buffer,4,!0,z.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,z.FLOAT).addIndex(this._indexBuffer)}}const to=Math.PI*2,a0=180/Math.PI,h0=Math.PI/180;var zt=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(zt||{});class st{constructor(t=0,i=0){this.x=0,this.y=0,this.x=t,this.y=i}clone(){return new st(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,i=t){return this.x=t,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Zr=[new st,new st,new st,new st];class j{constructor(t=0,i=0,s=0,r=0){this.x=Number(t),this.y=Number(i),this.width=Number(s),this.height=Number(r),this.type=zt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new j(0,0,0,0)}clone(){return new j(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,i){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(t,i){if(!i){const x=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=x)return!1;const P=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>P}const s=this.left,r=this.right,n=this.top,o=this.bottom;if(r<=s||o<=n)return!1;const a=Zr[0].set(t.left,t.top),h=Zr[1].set(t.left,t.bottom),l=Zr[2].set(t.right,t.top),c=Zr[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const u=Math.sign(i.a*i.d-i.b*i.c);if(u===0||(i.apply(a,a),i.apply(h,h),i.apply(l,l),i.apply(c,c),Math.max(a.x,h.x,l.x,c.x)<=s||Math.min(a.x,h.x,l.x,c.x)>=r||Math.max(a.y,h.y,l.y,c.y)<=n||Math.min(a.y,h.y,l.y,c.y)>=o))return!1;const d=u*(h.y-a.y),f=u*(a.x-h.x),p=d*s+f*n,m=d*r+f*n,_=d*s+f*o,y=d*r+f*o;if(Math.max(p,m,_,y)<=d*a.x+f*a.y||Math.min(p,m,_,y)>=d*c.x+f*c.y)return!1;const b=u*(a.y-l.y),g=u*(l.x-a.x),v=b*s+g*n,S=b*r+g*n,R=b*s+g*o,T=b*r+g*o;return!(Math.max(v,S,R,T)<=b*a.x+g*a.y||Math.min(v,S,R,T)>=b*c.x+g*c.y)}pad(t=0,i=t){return this.x-=t,this.y-=i,this.width+=t*2,this.height+=i*2,this}fit(t){const i=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=i,this.width=Math.max(s-i,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,i=.001){const s=Math.ceil((this.x+this.width-i)*t)/t,r=Math.ceil((this.y+this.height-i)*t)/t;return this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=s-this.x,this.height=r-this.y,this}enlarge(t){const i=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=i,this.width=s-i,this.y=r,this.height=n-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class cl{constructor(t=0,i=0,s=0){this.x=t,this.y=i,this.radius=s,this.type=zt.CIRC}clone(){return new cl(this.x,this.y,this.radius)}contains(t,i){if(this.radius<=0)return!1;const s=this.radius*this.radius;let r=this.x-t,n=this.y-i;return r*=r,n*=n,r+n<=s}getBounds(){return new j(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ul{constructor(t=0,i=0,s=0,r=0){this.x=t,this.y=i,this.width=s,this.height=r,this.type=zt.ELIP}clone(){return new ul(this.x,this.y,this.width,this.height)}contains(t,i){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,r=(i-this.y)/this.height;return s*=s,r*=r,s+r<=1}getBounds(){return new j(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class ps{constructor(...t){let i=Array.isArray(t[0])?t[0]:t;if(typeof i[0]!="number"){const s=[];for(let r=0,n=i.length;r<n;r++)s.push(i[r].x,i[r].y);i=s}this.points=i,this.type=zt.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),i=new ps(t);return i.closeStroke=this.closeStroke,i}contains(t,i){let s=!1;const r=this.points.length/2;for(let n=0,o=r-1;n<r;o=n++){const a=this.points[n*2],h=this.points[n*2+1],l=this.points[o*2],c=this.points[o*2+1];h>i!=c>i&&t<(l-a)*((i-h)/(c-h))+a&&(s=!s)}return s}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,i)=>`${t}, ${i}`,"")}]`}}class dl{constructor(t=0,i=0,s=0,r=0,n=20){this.x=t,this.y=i,this.width=s,this.height=r,this.radius=n,this.type=zt.RREC}clone(){return new dl(this.x,this.y,this.width,this.height,this.radius)}contains(t,i){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+s&&i<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let r=t-(this.x+s),n=i-(this.y+s);const o=s*s;if(r*r+n*n<=o||(r=t-(this.x+this.width-s),r*r+n*n<=o)||(n=i-(this.y+this.height-s),r*r+n*n<=o)||(r=t-(this.x+s),r*r+n*n<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class bt{constructor(t=1,i=0,s=0,r=1,n=0,o=0){this.array=null,this.a=t,this.b=i,this.c=s,this.d=r,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,i,s,r,n,o){return this.a=t,this.b=i,this.c=s,this.d=r,this.tx=n,this.ty=o,this}toArray(t,i){this.array||(this.array=new Float32Array(9));const s=i||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,i){i=i||new st;const s=t.x,r=t.y;return i.x=this.a*s+this.c*r+this.tx,i.y=this.b*s+this.d*r+this.ty,i}applyInverse(t,i){i=i||new st;const s=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return i.x=this.d*s*r+-this.c*s*n+(this.ty*this.c-this.tx*this.d)*s,i.y=this.a*s*n+-this.b*s*r+(-this.ty*this.a+this.tx*this.b)*s,i}translate(t,i){return this.tx+=t,this.ty+=i,this}scale(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this}rotate(t){const i=Math.cos(t),s=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*i-this.b*s,this.b=r*s+this.b*i,this.c=n*i-this.d*s,this.d=n*s+this.d*i,this.tx=o*i-this.ty*s,this.ty=o*s+this.ty*i,this}append(t){const i=this.a,s=this.b,r=this.c,n=this.d;return this.a=t.a*i+t.b*r,this.b=t.a*s+t.b*n,this.c=t.c*i+t.d*r,this.d=t.c*s+t.d*n,this.tx=t.tx*i+t.ty*r+this.tx,this.ty=t.tx*s+t.ty*n+this.ty,this}setTransform(t,i,s,r,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(s*this.a+r*this.c),this.ty=i-(s*this.b+r*this.d),this}prepend(t){const i=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const s=this.a,r=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this}decompose(t){const i=this.a,s=this.b,r=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-r,n),h=Math.atan2(s,i),l=Math.abs(a+h);return l<1e-5||Math.abs(to-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(i*i+s*s),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(o.x*i+o.y*r),t.position.y=this.ty+(o.x*s+o.y*n),t}invert(){const t=this.a,i=this.b,s=this.c,r=this.d,n=this.tx,o=t*r-i*s;return this.a=r/o,this.b=-i/o,this.c=-s/o,this.d=t/o,this.tx=(s*this.ty-r*n)/o,this.ty=-(t*this.ty-i*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new bt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new bt}static get TEMP_MATRIX(){return new bt}}const Ti=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ai=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ri=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ii=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],sh=[],ef=[],Jr=Math.sign;function l0(){for(let e=0;e<16;e++){const t=[];sh.push(t);for(let i=0;i<16;i++){const s=Jr(Ti[e]*Ti[i]+Ri[e]*Ai[i]),r=Jr(Ai[e]*Ti[i]+Ii[e]*Ai[i]),n=Jr(Ti[e]*Ri[i]+Ri[e]*Ii[i]),o=Jr(Ai[e]*Ri[i]+Ii[e]*Ii[i]);for(let a=0;a<16;a++)if(Ti[a]===s&&Ai[a]===r&&Ri[a]===n&&Ii[a]===o){t.push(a);break}}}for(let e=0;e<16;e++){const t=new bt;t.set(Ti[e],Ai[e],Ri[e],Ii[e],0,0),ef.push(t)}}l0();const Et={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Ti[e],uY:e=>Ai[e],vX:e=>Ri[e],vY:e=>Ii[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>sh[e][t],sub:(e,t)=>sh[e][Et.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Et.S:Et.N:Math.abs(t)*2<=Math.abs(e)?e>0?Et.E:Et.W:t>0?e>0?Et.SE:Et.SW:e>0?Et.NE:Et.NW,matrixAppendRotationInv:(e,t,i=0,s=0)=>{const r=ef[Et.inv(t)];r.tx=i,r.ty=s,e.append(r)}};class ai{constructor(t,i,s=0,r=0){this._x=s,this._y=r,this.cb=t,this.scope=i}clone(t=this.cb,i=this.scope){return new ai(t,i,this._x,this._y)}set(t=0,i=t){return(this._x!==t||this._y!==i)&&(this._x=t,this._y=i,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const sf=class{constructor(){this.worldTransform=new bt,this.localTransform=new bt,this.position=new ai(this.onChange,this,0,0),this.scale=new ai(this.onChange,this,1,1),this.pivot=new ai(this.onChange,this,0,0),this.skew=new ai(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const i=e.worldTransform,s=this.worldTransform;s.a=t.a*i.a+t.b*i.c,s.b=t.a*i.b+t.b*i.d,s.c=t.c*i.a+t.d*i.c,s.d=t.c*i.b+t.d*i.d,s.tx=t.tx*i.a+t.ty*i.c+i.tx,s.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let fl=sf;fl.IDENTITY=new sf;var c0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,u0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Uc(e,t,i){const s=e.createShader(t);return e.shaderSource(s,i),e.compileShader(s),s}function pa(e){const t=new Array(e);for(let i=0;i<t.length;i++)t[i]=!1;return t}function rf(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return pa(2*t);case"bvec3":return pa(3*t);case"bvec4":return pa(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ms=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>e.type==="vec3"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],d0={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},f0={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function p0(e,t){var s;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in e.uniforms){const n=t[r];if(!n){(s=e.uniforms[r])!=null&&s.group&&(e.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const o=e.uniforms[r];let a=!1;for(let h=0;h<ms.length;h++)if(ms[h].test(n,o)){i.push(ms[h].code(r,o)),a=!0;break}if(!a){const l=(n.size===1&&!n.isArray?d0:f0)[n.type].replace("location",`ud["${r}"].location`);i.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const nf={};let Vi=nf;function m0(){if(Vi===nf||Vi!=null&&Vi.isContextLost()){const e=B.ADAPTER.createCanvas();let t;B.PREFER_ENV>=zi.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Vi=t}return Vi}let Qr;function _0(){if(!Qr){Qr=oe.MEDIUM;const e=m0();e&&e.getShaderPrecisionFormat&&(Qr=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?oe.HIGH:oe.MEDIUM)}return Qr}function Gc(e,t){const i=e.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),s=e.getShaderInfoLog(t),r=s.split(`
`),n={},o=r.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),a=[""];o.forEach(l=>{i[l-1]=`%c${i[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=i.join(`
`);a[0]=h,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function g0(e,t,i,s){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||Gc(e,i),e.getShaderParameter(s,e.COMPILE_STATUS)||Gc(e,s),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const y0={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function of(e){return y0[e]}let tn=null;const Hc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function af(e,t){if(!tn){const i=Object.keys(Hc);tn={};for(let s=0;s<i.length;++s){const r=i[s];tn[e[r]]=Hc[r]}}return tn[t]}function zc(e,t,i){if(e.substring(0,9)!=="precision"){let s=t;return t===oe.HIGH&&i!==oe.HIGH&&(s=oe.MEDIUM),`precision ${s} float;
${e}`}else if(i!==oe.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let Ws;function v0(){if(typeof Ws=="boolean")return Ws;try{Ws=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ws=!1}return Ws}let b0=0;const en={},Qi=class{constructor(e,t,i="pixi-shader",s={}){this.extra={},this.id=b0++,this.vertexSrc=e||Qi.defaultVertexSrc,this.fragmentSrc=t||Qi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),en[i]?(en[i]++,i+=`-${en[i]}`):en[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=zc(this.vertexSrc,Qi.defaultVertexPrecision,oe.HIGH),this.fragmentSrc=zc(this.fragmentSrc,Qi.defaultFragmentPrecision,_0())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return u0}static get defaultFragmentSrc(){return c0}static from(e,t,i){const s=e+t;let r=Nc[s];return r||(Nc[s]=r=new Qi(e,t,i)),r}};let ye=Qi;ye.defaultVertexPrecision=oe.HIGH;ye.defaultFragmentPrecision=Xe.apple.device?oe.HIGH:oe.MEDIUM;let E0=0;class Ee{constructor(t,i,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=E0++,this.static=!!i,this.ubo=!!s,t instanceof Rt?(this.buffer=t,this.buffer.type=Me.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Rt(new Float32Array(1)),this.buffer.type=Me.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,i,s){if(!this.ubo)this.uniforms[t]=new Ee(i,s);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,i,s){return new Ee(t,i,s)}static uboFrom(t,i){return new Ee(t,i??!0,!0)}}class Ne{constructor(t,i){this.uniformBindCount=0,this.program=t,i?i instanceof Ee?this.uniformGroup=i:this.uniformGroup=new Ee(i):this.uniformGroup=new Ee({}),this.disposeRunner=new be("disposeShader")}checkUniformExists(t,i){if(i.uniforms[t])return!0;for(const s in i.uniforms){const r=i.uniforms[s];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,i,s){const r=ye.from(t,i);return new Ne(r,s)}}class x0{constructor(t,i){if(this.vertexSrc=t,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const s=new Int32Array(t);for(let n=0;n<t;n++)s[n]=n;this.defaultGroupCache[t]=Ee.from({uSamplers:s},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ye(this.vertexSrc,r)}const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new bt,default:this.defaultGroupCache[t]};return new Ne(this.programCache[t],i)}generateSampleSrc(t){let i="";i+=`
`,i+=`
`;for(let s=0;s<t;s++)s>0&&(i+=`
else `),s<t-1&&(i+=`if(vTextureId < ${s}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${s}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}}class rh{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function w0(){return!Xe.apple.device}function S0(e){let t=!0;const i=B.ADAPTER.getNavigator();if(Xe.tablet||Xe.phone){if(Xe.apple.device){const s=i.userAgent.match(/OS (\d+)_(\d+)?/);s&&parseInt(s[1],10)<11&&(t=!1)}if(Xe.android.device){const s=i.userAgent.match(/Android\s([0-9.]*)/);s&&parseInt(s[1],10)<7&&(t=!1)}}return t?e:4}class So{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var T0=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,A0=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const ce=class extends So{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=tf,this.vertexSize=6,this.state=Qe.for2d(),this.size=ce.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??S0(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??w0(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return J("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return A0}static get defaultFragmentTemplate(){return T0}setShaderGenerator({vertex:e=ce.defaultVertexSrc,fragment:t=ce.defaultFragmentTemplate}={}){this.shaderGenerator=new x0(e,t)}contextChange(){const e=this.renderer.gl;B.PREFER_ENV===zi.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ce.defaultMaxTextures),this.maxTextures=t0(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=ce,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new ih);for(;t.length<s;)t.push(new rh);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=ce._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let o=++V._globalBatch,a=0,h=i[0],l=0;s.copyBoundTextures(r,t);for(let c=0;c<this._bufferSize;++c){const u=e[c];e[c]=null,u._batchEnabled!==o&&(h.count>=t&&(s.boundArray(h,r,o,t),this.buildDrawCalls(h,l,c),l=c,h=i[++a],++o),u._batchEnabled=o,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(s.boundArray(h,r,o,t),this.buildDrawCalls(h,l,this._bufferSize),++a,++o);for(let c=0;c<r.length;c++)r[c]=null;V._globalBatch=o}buildDrawCalls(e,t,i){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:n,vertexSize:o}=this,a=ce._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=a[h];u.start=this._iIndex,u.texArray=e;for(let d=t;d<i;++d){const f=s[d],p=f._texture.baseTexture,m=qd[p.alphaMode?1:0][f.blendMode];s[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=a[++h],u.texArray=e,u.start=c),this.packInterleavedGeometry(f,r,n,l,c),l+=f.vertexData.length/2*o,c+=f.indices.length,u.blend=m}t<i&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;ce.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,s=ce._drawCallPool;let r=null;for(let n=0;n<e;n++){const{texArray:o,type:a,size:h,start:l,blend:c}=s[n];r!==o&&(r=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,i.set(this.state),t.drawElements(a,h,t.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ce.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Jn(Math.ceil(e/8)),i=Mc(t),s=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new th(s*this.vertexSize*4)),r}getIndexBuffer(e){const t=Jn(Math.ceil(e/12)),i=Mc(t),s=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(e,t,i,s,r){const{uint32View:n,float32View:o}=t,a=s/this.vertexSize,h=e.uvs,l=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),f=ct.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let p=0;p<c.length;p+=2)o[s++]=c[p],o[s++]=c[p+1],o[s++]=h[p],o[s++]=h[p+1],n[s++]=f,o[s++]=u;for(let p=0;p<l.length;p++)i[r++]=a+l[p]}};let me=ce;me.defaultBatchSize=4096;me.extension={name:"batch",type:O.RendererPlugin};me._drawCallPool=[];me._textureArrayPool=[];H.add(me);var R0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,I0=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Zs=class extends Ne{constructor(e,t,i){const s=ye.from(e||Zs.defaultVertexSrc,t||Zs.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Zs.defaultResolution,this.multisample=Zs.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Qe}apply(e,t,i,s,r){e.applyFilter(this,t,i,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return I0}static get defaultFragmentSrc(){return R0}};let Yt=Zs;Yt.defaultResolution=1;Yt.defaultMultisample=Ct.NONE;class To{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ct(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:i,background:s,backgroundAlpha:r}=t,n=s??i;n!==void 0&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}To.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};To.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"background"};H.add(To);class hf{constructor(t){this.renderer=t,this.emptyRenderer=new So(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,i){const{boundTextures:s}=this.renderer.texture;for(let r=i-1;r>=0;--r)t[r]=s[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,i,s,r){const{elements:n,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const c=n[l],u=c._batchLocation;if(u>=0&&u<r&&i[u]===c){o[l]=u;continue}for(;h<r;){const d=i[h];if(d&&d._batchEnabled===s&&d._batchLocation===h){h++;continue}o[l]=h,c._batchLocation=h,i[h]=c;break}}}destroy(){this.renderer=null}}hf.extension={type:O.RendererSystem,name:"batch"};H.add(hf);let $c=0;class Ao{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=$c++}init(t){if(t.context)this.initFromContext(t.context);else{const i=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=$c++,this.renderer.runners.contextChange.emit(t);const i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const i=this.createContext(this.renderer.view,t);this.initFromContext(i)}createContext(t,i){let s;if(B.PREFER_ENV>=zi.WEBGL2&&(s=t.getContext("webgl2",i)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,i={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const i=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ao.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Ao.extension={type:O.RendererSystem,name:"context"};H.add(Ao);class C0 extends Mr{upload(t,i,s){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===we.UNPACK);const n=i.realWidth,o=i.realHeight;return s.width===n&&s.height===o?r.texSubImage2D(i.target,0,0,0,n,o,i.format,s.type,this.data):(s.width=n,s.height=o,r.texImage2D(i.target,0,s.internalFormat,n,o,0,i.format,s.type,this.data)),!0}}class nh{constructor(t,i){this.width=Math.round(t||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new be("disposeFramebuffer"),this.multisample=Ct.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,i){return this.colorTextures[t]=i||new V(null,{scaleMode:Pe.NEAREST,resolution:1,mipmap:Oe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new V(new C0(null,{width:this.width,height:this.height}),{scaleMode:Pe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Oe.OFF,format:M.DEPTH_COMPONENT,type:z.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,i){if(t=Math.round(t),i=Math.round(i),!(t===this.width&&i===this.height)){this.width=t,this.height=i,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const r=this.colorTextures[s],n=r.resolution;r.setSize(t/n,i/n)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,i/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class lf extends V{constructor(t={}){if(typeof t=="number"){const i=arguments[0],s=arguments[1],r=arguments[2],n=arguments[3];t={width:i,height:s,scaleMode:r,resolution:n}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=Ct.NONE),super(null,t),this.mipmap=Oe.OFF,this.valid=!0,this._clear=new ct([0,0,0,0]),this.framebuffer=new nh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,i){this.framebuffer.resize(t*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class mi extends vr{constructor(t){const i=t,s=i.naturalWidth||i.videoWidth||i.width,r=i.naturalHeight||i.videoHeight||i.height;super(s,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,i,s){s===void 0&&!i.startsWith("data:")?t.crossOrigin=Zy(i):s!==!1&&(t.crossOrigin=typeof s=="string"?s:"anonymous")}upload(t,i,s,r){const n=t.gl,o=i.realWidth,a=i.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1&&r.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===we.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&s.width===o&&s.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,s.type,r):(s.width=o,s.height=a,n.texImage2D(i.target,0,s.internalFormat,i.format,s.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,i=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(i,s),super.update()}dispose(){this.source=null}}class cf extends mi{constructor(t,i){if(i=i||{},typeof t=="string"){const s=new Image;mi.crossOrigin(s,t,i.crossorigin),s.src=t,t=s}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(i.createBitmap??B.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((i,s)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?i(this.process()):i(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=o=>{s(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const i=globalThis.createImageBitmap,s=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then(r=>r.blob()).then(r=>i(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===we.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,i,s){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,i,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,i,s,this.bitmap),!this.preserveBitmap){let r=!0;const n=i._glTextures;for(const o in n){const a=n[o];if(a!==s&&a.dirtyId!==i.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class uf{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,i,s){const r=i.width,n=i.height;if(s){const o=t.width/2/r,a=t.height/2/n,h=t.x/r+o,l=t.y/n+a;s=Et.add(s,Et.NW),this.x0=h+o*Et.uX(s),this.y0=l+a*Et.uY(s),s=Et.add(s,2),this.x1=h+o*Et.uX(s),this.y1=l+a*Et.uY(s),s=Et.add(s,2),this.x2=h+o*Et.uX(s),this.y2=l+a*Et.uY(s),s=Et.add(s,2),this.x3=h+o*Et.uX(s),this.y3=l+a*Et.uY(s)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Yc=new uf;function sn(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class L extends Dr{constructor(t,i,s,r,n,o,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new j(0,0,1,1)),t instanceof L&&(t=t.baseTexture),this.baseTexture=t,this._frame=i,this.trim=r,this.valid=!1,this._uvs=Yc,this.uvMatrix=null,this.orig=s||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new st(o.x,o.y):new st(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=i:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:i}=this.baseTexture;i!=null&&i.url&&Ae[i.url]&&L.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,L.removeFromCache(this),this.textureCacheIds=null}clone(){var r;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),s=new L(this.baseTexture,!this.noFrame&&t,i,(r=this.trim)==null?void 0:r.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(s._frame=t),s}updateUvs(){this._uvs===Yc&&(this._uvs=new uf),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,i={},s=B.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else if(t instanceof V){if(!t.cacheId){const a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${Fi()}`,V.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${Fi()}`}n=t._pixiId}let o=Ae[n];if(r&&s&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof V)?(i.resolution||(i.resolution=fi(t)),o=new L(new V(t,i)),o.baseTexture.cacheId=n,V.addToCache(o.baseTexture,n),L.addToCache(o,n)):!o&&t instanceof V&&(o=new L(t),L.addToCache(o,n)),o}static fromURL(t,i){const s=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),r=L.from(t,Object.assign({resourceOptions:s},i),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(t,i,s,r){return new L(V.fromBuffer(t,i,s,r))}static fromLoader(t,i,s,r){const n=new V(t,Object.assign({scaleMode:V.defaultOptions.scaleMode,resolution:fi(i)},r)),{resource:o}=n;o instanceof cf&&(o.url=i);const a=new L(n);return s||(s=i),V.addToCache(a.baseTexture,s),L.addToCache(a,s),s!==i&&(V.addToCache(a.baseTexture,i),L.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,i){i&&(t.textureCacheIds.includes(i)||t.textureCacheIds.push(i),Ae[i]&&Ae[i]!==t&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),Ae[i]=t)}static removeFromCache(t){if(typeof t=="string"){const i=Ae[t];if(i){const s=i.textureCacheIds.indexOf(t);return s>-1&&i.textureCacheIds.splice(s,1),delete Ae[t],i}}else if(t!=null&&t.textureCacheIds){for(let i=0;i<t.textureCacheIds.length;++i)Ae[t.textureCacheIds[i]]===t&&delete Ae[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:i,y:s,width:r,height:n}=t,o=i+r>this.baseTexture.width,a=s+n>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${i} + ${r} = ${i+r} > ${this.baseTexture.width}`,c=`Y: ${s} + ${n} = ${s+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return L._EMPTY||(L._EMPTY=new L(new V),sn(L._EMPTY),sn(L._EMPTY.baseTexture)),L._EMPTY}static get WHITE(){if(!L._WHITE){const t=B.ADAPTER.createCanvas(16,16),i=t.getContext("2d");t.width=16,t.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),L._WHITE=new L(V.from(t)),sn(L._WHITE),sn(L._WHITE.baseTexture)}return L._WHITE}}class $i extends L{constructor(t,i){super(t,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,i,s=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,o=Math.round(i*r)/r;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,s&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:i}=this;i.resolution!==t&&(i.setResolution(t),this.resize(i.width,i.height,!1))}static create(t){return new $i(new lf(t))}}class df{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,i,s=Ct.NONE){const r=new lf(Object.assign({width:t,height:i,resolution:1,multisample:s},this.textureOptions));return new $i(r)}getOptimalTexture(t,i,s=1,r=Ct.NONE){let n;t=Math.ceil(t*s-1e-6),i=Math.ceil(i*s-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||i!==this._pixelsHeight?(t=Jn(t),i=Jn(i),n=((t&65535)<<16|i&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,i,r)),o.filterPoolKey=n,o.setResolution(s),o}getFilterTexture(t,i,s){const r=this.getOptimalTexture(t.width,t.height,i||t.resolution,s||Ct.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const i=t.filterPoolKey;t.filterFrame=null,this.texturePool[i].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const i in this.texturePool){const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}df.SCREEN_KEY=-1;class k0 extends pi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class ff extends pi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Rt(this.vertices),this.uvBuffer=new Rt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,i){let s=0,r=0;return this.uvs[0]=s,this.uvs[1]=r,this.uvs[2]=s+i.width/t.width,this.uvs[3]=r,this.uvs[4]=s+i.width/t.width,this.uvs[5]=r+i.height/t.height,this.uvs[6]=s,this.uvs[7]=r+i.height/t.height,s=i.x,r=i.y,this.vertices[0]=s,this.vertices[1]=r,this.vertices[2]=s+i.width,this.vertices[3]=r,this.vertices[4]=s+i.width,this.vertices[5]=r+i.height,this.vertices[6]=s,this.vertices[7]=r+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class D0{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ct.NONE,this.sourceFrame=new j,this.destinationFrame=new j,this.bindingSourceFrame=new j,this.bindingDestinationFrame=new j,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const rn=[new st,new st,new st,new st],ma=new bt;class pf{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new df,this.statePool=[],this.quad=new k0,this.quadUv=new ff,this.tempRect=new j,this.activeState={},this.globalUniforms=new Ee({outputFrame:new j,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,i){const s=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new D0,o=this.renderer.renderTexture;let a=i[0].resolution,h=i[0].multisample,l=i[0].padding,c=i[0].autoFit,u=i[0].legacy??!0;for(let p=1;p<i.length;p++){const m=i[p];a=Math.min(a,m.resolution),h=Math.min(h,m.multisample),l=this.useMaxPadding?Math.max(l,m.padding):l+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(n),n.resolution=a,n.multisample=h,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(l);const d=this.tempRect.copyFrom(o.sourceFrame);s.projection.transform&&this.transformAABB(ma.copyFrom(s.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,h),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=s.projection.transform,s.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,f),s.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,i=t.pop(),s=i.filters;this.activeState=i;const r=this.globalUniforms.uniforms;r.outputFrame=i.sourceFrame,r.resolution=i.resolution;const n=r.inputSize,o=r.inputPixel,a=r.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*i.resolution),o[1]=Math.round(n[1]*i.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=i.sourceFrame.width*n[2]-.5*o[2],a[3]=i.sourceFrame.height*n[3]-.5*o[3],i.legacy){const l=r.filterArea;l[0]=i.destinationFrame.width,l[1]=i.destinationFrame.height,l[2]=i.sourceFrame.x,l[3]=i.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),s.length===1)s[0].apply(this,i.renderTexture,h.renderTexture,Ie.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let l=i.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,i.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<s.length-1;++u){u===1&&i.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,i.resolution),c.filterFrame=l.filterFrame),s[u].apply(this,l,c,Ie.CLEAR,i);const d=l;l=c,c=d}s[u].apply(this,l,h.renderTexture,Ie.BLEND,i),u>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}i.clear(),this.statePool.push(i)}bindAndClear(t,i=Ie.CLEAR){const{renderTexture:s,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,s.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(i===Ie.CLEAR||i===Ie.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,i,s,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(s,r),t.uniforms.uSampler=i,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(De.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(De.TRIANGLE_STRIP))}calculateSpriteMatrix(t,i){const{sourceFrame:s,destinationFrame:r}=this.activeState,{orig:n}=i._texture,o=t.set(r.width,0,0,r.height,s.x,s.y),a=i.worldTransform.copyTo(bt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(i.anchor.x,i.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,i,s=1,r=Ct.NONE){return this.texturePool.getOptimalTexture(t,i,s,r)}getFilterTexture(t,i,s){if(typeof t=="number"){const n=t;t=i,i=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,i||t.resolution,s||Ct.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,i){const s=rn[0],r=rn[1],n=rn[2],o=rn[3];s.set(i.left,i.top),r.set(i.left,i.bottom),n.set(i.right,i.top),o.set(i.right,i.bottom),t.apply(s,s),t.apply(r,r),t.apply(n,n),t.apply(o,o);const a=Math.min(s.x,r.x,n.x,o.x),h=Math.min(s.y,r.y,n.y,o.y),l=Math.max(s.x,r.x,n.x,o.x),c=Math.max(s.y,r.y,n.y,o.y);i.x=a,i.y=h,i.width=l-a,i.height=c-h}roundFrame(t,i,s,r,n){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(n){const{a:o,b:a,c:h,d:l}=n;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}n=n?ma.copyFrom(n):ma.identity(),n.translate(-s.x,-s.y).scale(r.width/s.width,r.height/s.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(i),this.transformAABB(n.invert(),t)}}}pf.extension={type:O.RendererSystem,name:"filter"};H.add(pf);class P0{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ct.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const M0=new j;class mf{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new nh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new j,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;B.PREFER_ENV===zi.WEBGL_LEGACY&&(i=null,s=null),i?t.drawBuffers=r=>i.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,i,s=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=s),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),i){const o=i.width>>s,a=i.height>>s,h=o/i.width;this.setViewport(i.x*h,i.y*h,o,a)}else{const o=t.width>>s,a=t.height>>s;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,i,s,r){const n=this.viewport;t=Math.round(t),i=Math.round(i),s=Math.round(s),r=Math.round(r),(n.width!==s||n.height!==r||n.x!==t||n.y!==i)&&(n.x=t,n.y=i,n.width=s,n.height=r,this.gl.viewport(t,i,s,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,i,s,r,n=Oa.COLOR|Oa.DEPTH){const{gl:o}=this;o.clearColor(t,i,s,r),o.clear(n)}initFramebuffer(t){const{gl:i}=this,s=new P0(i.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let n=r.length;i.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=r[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&s.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,i){const{gl:s}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;s.drawBuffers||(o=Math.min(o,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||s.createRenderbuffer():r.msaaBuffer&&(s.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&r.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,r.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,r.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,i),a.push(s.COLOR_ATTACHMENT0+h))}if(a.length>1&&s.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const l=t.depthTexture;this.renderer.texture.bind(l,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,i)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,r.stencil),r.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,r.stencil)):r.stencil&&(s.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:i}=this;let s=Ct.NONE;if(t<=1||i===null)return s;for(let r=0;r<i.length;r++)if(i[r]<=t){s=i[r];break}return s===1&&(s=Ct.NONE),s}blit(t,i,s){const{current:r,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!r)return;const h=r.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const c=r.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new nh(r.width,r.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}i||(i=M0,i.width=r.width,i.height=r.height),s||(s=i);const l=i.width===s.width&&i.height===s.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(i.left,i.top,i.right,i.bottom,s.left,s.top,s.right,s.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,i){const s=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),i||(r.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&r.deleteRenderbuffer(s.msaaBuffer),s.stencil&&r.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,i)}disposeAll(t){const i=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<i.length;s++)this.disposeFramebuffer(i[s],t)}forceStencil(){const t=this.current;if(!t)return;const i=t.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;t.stencil=!0;const s=t.width,r=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,s,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,s,r),i.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new j}destroy(){this.renderer=null}}mf.extension={type:O.RendererSystem,name:"framebuffer"};H.add(mf);const _a={5126:4,5123:2,5121:1};class _f{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let s=this.renderer.context.extensions.vertexArrayObject;B.PREFER_ENV===zi.WEBGL_LEGACY&&(s=null),s?(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=r=>s.bindVertexArrayOES(r),t.deleteVertexArray=r=>s.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){const s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=(r,n)=>s.vertexAttribDivisorANGLE(r,n),t.drawElementsInstanced=(r,n,o,a,h)=>s.drawElementsInstancedANGLE(r,n,o,a,h),t.drawArraysInstanced=(r,n,o,a)=>s.drawArraysInstancedANGLE(r,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(t,i){i=i||this.renderer.shader.shader;const{gl:s}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const o=r[i.program.id]||this.initGeometryVao(t,i,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?s.bindVertexArray(o):this.activateVao(t,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,i=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const r=t.buffers[s];i.update(r)}}checkCompatibility(t,i){const s=t.attributes,r=i.attributeData;for(const n in r)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,i){const s=t.attributes,r=i.attributeData,n=["g",t.id];for(const o in s)r[o]&&n.push(o,r[o].location);return n.join("-")}initGeometryVao(t,i,s=!0){const r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=i.program;a.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[a.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*_a[d[m].type];for(const m in d){const _=d[m],y=_.size;_.stride===void 0&&(f[_.buffer]===y*_a[_.type]?_.stride=0:_.stride=f[_.buffer]),_.start===void 0&&(_.start=p[_.buffer],p[_.buffer]+=y*_a[_.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let m=0;m<u.length;m++){const _=u[m];o.bind(_),s&&_._glBuffers[n].refCount++}return this.activateVao(t,a),l[a.id]=c,l[h]=c,r.bindVertexArray(null),o.unbind(Me.ARRAY_BUFFER),c}disposeGeometry(t,i){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const s=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!s){if(o)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&o.dispose(n[h],i))}if(!i){for(const h in s)if(h[0]==="g"){const l=s[h];this._activeVao===l&&this.unbind(),r.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const i=Object.keys(this.managedGeometries);for(let s=0;s<i.length;s++)this.disposeGeometry(this.managedGeometries[i[s]],t)}activateVao(t,i){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in a){const c=a[l],u=o[c.buffer],d=u._glBuffers[r];if(i.attributeData[l]){h!==d&&(n.bind(u),h=d);const f=i.attributeData[l].location;if(s.enableVertexAttribArray(f),s.vertexAttribPointer(f,c.size,c.type||s.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)s.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,i,s,r){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,i||o.indexBuffer.data.length,h,(s||0)*a,r||1):n.drawElements(t,i||o.indexBuffer.data.length,h,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,s,i||o.getSize(),r||1):n.drawArrays(t,s,i||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}_f.extension={type:O.RendererSystem,name:"geometry"};H.add(_f);const Wc=new bt;class gf{constructor(t,i){this._texture=t,this.mapCoord=new bt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,i){i===void 0&&(i=t);const s=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],o=t[r+1];i[r]=n*s.a+o*s.c+s.tx,i[r+1]=n*s.b+o*s.d+s.ty}return i}update(t){const i=this._texture;if(!i||!i.valid||!t&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;const s=i._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const r=i.orig,n=i.trim;n&&(Wc.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Wc));const o=i.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(i._frame.x+h+l)/o.width,a[1]=(i._frame.y+h+l)/o.height,a[2]=(i._frame.x+i._frame.width-h+l)/o.width,a[3]=(i._frame.y+i._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=i._frame.width===o.width&&i._frame.height===o.height&&i.rotate===0,!0}}var N0=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,B0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class O0 extends Yt{constructor(t,i,s){let r=null;typeof t!="string"&&i===void 0&&s===void 0&&(r=t,t=void 0,i=void 0,s=void 0),super(t||B0,i||N0,s),this.maskSprite=r,this.maskMatrix=new bt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,i,s,r){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new gf(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,i,s,r))}}class L0{constructor(t=null){this.type=Mt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Yt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Mt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class yf{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,i){let s=i;if(!s.isMaskData){const n=this.maskDataPool.pop()||new L0;n.pooled=!0,n.maskObject=i,s=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(r),s._colorMask=r?r._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==Mt.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case Mt.SCISSOR:this.renderer.scissor.push(s);break;case Mt.STENCIL:this.renderer.stencil.push(s);break;case Mt.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case Mt.COLOR:this.pushColorMask(s);break}s.type===Mt.SPRITE&&this.maskStack.push(s)}pop(t){const i=this.maskStack.pop();if(!(!i||i._target!==t)){if(i.enabled)switch(i.type){case Mt.SCISSOR:this.renderer.scissor.pop(i);break;case Mt.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case Mt.SPRITE:this.popSpriteMask(i);break;case Mt.COLOR:this.popColorMask(i);break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){const s=this.maskStack[this.maskStack.length-1];s.type===Mt.SPRITE&&s._filters&&(s._filters[0].maskSprite=s.maskObject)}}}detect(t){const i=t.maskObject;i?i.isSprite?t.type=Mt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Mt.SCISSOR:t.type=Mt.STENCIL:t.type=Mt.COLOR}pushSpriteMask(t){const{maskObject:i}=t,s=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new O0]));const n=this.renderer,o=n.renderTexture;let a,h;if(o.current){const c=o.current;a=t.resolution||c.resolution,h=t.multisample??c.multisample}else a=t.resolution||n.resolution,h=t.multisample??n.multisample;r[0].resolution=a,r[0].multisample=h,r[0].maskSprite=i;const l=s.filterArea;s.filterArea=i.getBounds(!0),n.filter.push(s,r),s.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const i=t._colorMask,s=t._colorMask=i&t.colorMask;s!==i&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}popColorMask(t){const i=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==i&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}destroy(){this.renderer=null}}yf.extension={type:O.RendererSystem,name:"mask"};H.add(yf);class vf{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:i}=this.renderer,s=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==s&&(r===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Xc=new bt,Vc=[],Dn=class extends vf{constructor(e){super(e),this.glConst=B.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:s}=this,r=s.renderTexture,n=i.getBounds(!0,Vc.pop()??new j);this.roundFrameToPixels(n,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:s,d:r}=e;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||Dn.isMatrixRotated(t.worldTransform)||Dn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,s,r){Dn.isMatrixRotated(r)||(r=r?Xc.copyFrom(r):Xc.identity(),r.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Vc.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let bf=Dn;bf.extension={type:O.RendererSystem,name:"scissor"};H.add(bf);class Ef extends vf{constructor(t){super(t),this.glConst=B.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const i=t.maskObject,{gl:s}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,r,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(t._colorMask=n,s.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=s?s._colorMask:15;r!==0&&(s._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(s._colorMask=r,i.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ef.extension={type:O.RendererSystem,name:"stencil"};H.add(Ef);class xf{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const i in t)this.plugins[i]=new t[i](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}xf.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"_plugin"};H.add(xf);class wf{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new bt,this.transform=null}update(t,i,s,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,i,s,r){const n=this.projectionMatrix,o=r?-1:1;n.identity(),n.a=1/i.width*2,n.d=o*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-o-i.y*n.d}setTransform(t){}destroy(){this.renderer=null}}wf.extension={type:O.RendererSystem,name:"projection"};H.add(wf);const F0=new fl;class Sf{constructor(t){this.renderer=t,this._tempMatrix=new bt}generateTexture(t,i){const{region:s,...r}=i||{},n=s||t.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const o=$i.create({width:n.width,height:n.height,...r});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const a=t.transform;return t.transform=F0,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}Sf.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"textureGenerator"};H.add(Sf);const wi=new j,Xs=new j;class Tf{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new j,this.destinationFrame=new j,this.viewportFrame=new j}contextChange(){var i;const t=(i=this.renderer)==null?void 0:i.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,i,s){const r=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,i||(wi.width=t.frame.width,wi.height=t.frame.height,i=wi),s||(Xs.x=t.frame.x,Xs.y=t.frame.y,Xs.width=i.width,Xs.height=i.height,s=Xs),o=n.framebuffer):(a=r.resolution,i||(wi.width=r._view.screen.width,wi.height=r._view.screen.height,i=wi),s||(s=wi,s.width=i.width,s.height=i.height));const h=this.viewportFrame;h.x=s.x*a,h.y=s.y*a,h.width=s.width*a,h.height=s.height*a,t||(h.y=r.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(s,i,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(s)}clear(t,i){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=ct.shared.setValue(t||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:h,y:l,width:c,height:u}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,u)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,i),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Tf.extension={type:O.RendererSystem,name:"renderTexture"};H.add(Tf);class U0{constructor(t,i){this.program=t,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function G0(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const n=t.getActiveAttrib(e,r);if(n.name.startsWith("gl_"))continue;const o=af(t,n.type),a={type:o,name:n.name,size:of(o),location:t.getAttribLocation(e,n.name)};i[n.name]=a}return i}function H0(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const n=t.getActiveUniform(e,r),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),h=af(t,n.type);i[o]={name:o,index:r,type:h,size:n.size,isArray:a,value:rf(h,n.size)}}return i}function z0(e,t){var h;const i=Uc(e,e.VERTEX_SHADER,t.vertexSrc),s=Uc(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,i),e.attachShader(r,s);const n=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||g0(e,r,i,s),t.attributeData=G0(r,e),t.uniformData=H0(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,e.bindAttribLocation(r,c,l[c]);e.linkProgram(r)}e.deleteShader(i),e.deleteShader(s);const o={};for(const l in t.uniformData){const c=t.uniformData[l];o[l]={location:e.getUniformLocation(r,l),value:rf(c.type,c.size)}}return new U0(r,o)}function $0(e,t,i,s,r){i.buffer.update(r)}const Y0={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Af={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function W0(e){const t=e.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let i=0,s=0,r=0;for(let n=0;n<t.length;n++){const o=t[n];if(i=Af[o.data.type],o.data.size>1&&(i=Math.max(i,16)*o.data.size),o.dataLen=i,s%i!==0&&s<16){const a=s%i%16;s+=a,r+=a}s+i>16?(r=Math.ceil(r/16)*16,o.offset=r,r+=i,s=i):(o.offset=r,s+=i,r+=i)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function X0(e,t){const i=[];for(const s in e)t[s]&&i.push(t[s]);return i.sort((s,r)=>s.index-r.index),i}function V0(e,t){if(!e.autoManage)return{size:0,syncFunc:$0};const i=X0(e.uniforms,t),{uboElements:s,size:r}=W0(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<s.length;o++){const a=s[o],h=e.uniforms[a.data.name],l=a.data.name;let c=!1;for(let u=0;u<ms.length;u++){const d=ms[u];if(d.codeUbo&&d.test(a.data,h)){n.push(`offset = ${a.offset/4};`,ms[u].codeUbo(a.data.name,h)),c=!0;break}}if(!c)if(a.data.size>1){const u=of(a.data.type),d=Math.max(Af[a.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=Y0[a.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let j0=0;const nn={textureCount:0,uboCount:0};class Rf{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=j0++}systemCheck(){if(!v0())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,i){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,r=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(r.program)),i||(nn.textureCount=0,nn.uboCount=0,this.syncUniformGroup(t.uniformGroup,nn)),r}setUniforms(t){const i=this.shader.program,s=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,i){const s=this.getGlProgram();(!t.static||t.dirtyId!==s.uniformDirtyGroups[t.id])&&(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,i))}syncUniforms(t,i,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(i.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const i=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=p0(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[i],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,i){const s=this.getGlProgram();if(!t.static||t.dirtyId!==0||!s.uniformGroups[t.id]){t.dirtyId=0;const r=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,i);t.buffer.update(),r(s.uniformData,t.uniforms,this.renderer,nn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[i])}createSyncBufferGroup(t,i,s){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(i.program,s);i.uniformBufferBindings[s]=this.shader.uniformBindCount,r.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=V0(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return i.uniformGroups[t.id]=a.syncFunc,i.uniformGroups[t.id]}getSignature(t,i,s){const r=t.uniforms,n=[`${s}-`];for(const o in r)n.push(o),i[o]&&n.push(i[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const i=this.gl,s=t.program,r=z0(i,s);return s.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Rf.extension={type:O.RendererSystem,name:"shader"};H.add(Rf);class Ro{constructor(t){this.renderer=t}run(t){const{renderer:i}=this;i.runners.init.emit(i.options),t.hello&&console.log(`PixiJS 7.2.4 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}}Ro.defaultOptions={hello:!1};Ro.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"startup"};H.add(Ro);function q0(e,t=[]){return t[W.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.ADD]=[e.ONE,e.ONE],t[W.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.NONE]=[0,0],t[W.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[W.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[W.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[W.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[W.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[W.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[W.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[W.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[W.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[W.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[W.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const K0=0,Z0=1,J0=2,Q0=3,tv=4,ev=5,oh=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=W.NONE,this._blendEq=!1,this.map=[],this.map[K0]=this.setBlend,this.map[Z0]=this.setOffset,this.map[J0]=this.setCullFace,this.map[Q0]=this.setDepthTest,this.map[tv]=this.setFrontFace,this.map[ev]=this.setDepthMask,this.checks=[],this.defaultState=new Qe,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=q0(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(oh.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(oh.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let If=oh;If.extension={type:O.RendererSystem,name:"state"};H.add(If);class iv extends Dr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const i=(t.priority??[]).filter(r=>t.systems[r]),s=[...i,...Object.keys(t.systems).filter(r=>!i.includes(r))];for(const r of s)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(i=>{this.runners[i]=new be(i)})}addSystem(t,i){const s=new t(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=s,this._systemsHash[i]=s;for(const r in this.runners)this.runners[r].add(s);return this}emitWithCustomOptions(t,i){const s=Object.keys(this._systemsHash);t.items.forEach(r=>{const n=s.find(o=>this._systemsHash[o]===r);r[t.name](i[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Pn=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Pn.defaultMaxIdle,this.checkCountMax=Pn.defaultCheckCountMax,this.mode=Pn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==tl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let s=0;s<t.length;s++){const r=t[s];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[s]=null,i=!0)}if(i){let s=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[s++]=t[r]);t.length=s}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}};let _e=Pn;_e.defaultMode=tl.AUTO;_e.defaultMaxIdle=60*60;_e.defaultCheckCountMax=60*10;_e.extension={type:O.RendererSystem,name:"textureGC"};H.add(_e);class ga{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=z.UNSIGNED_BYTE,this.internalFormat=M.RGBA,this.samplerType=0}}function sv(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[z.UNSIGNED_BYTE]:{[M.RGBA]:e.RGBA8,[M.RGB]:e.RGB8,[M.RG]:e.RG8,[M.RED]:e.R8,[M.RGBA_INTEGER]:e.RGBA8UI,[M.RGB_INTEGER]:e.RGB8UI,[M.RG_INTEGER]:e.RG8UI,[M.RED_INTEGER]:e.R8UI,[M.ALPHA]:e.ALPHA,[M.LUMINANCE]:e.LUMINANCE,[M.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[z.BYTE]:{[M.RGBA]:e.RGBA8_SNORM,[M.RGB]:e.RGB8_SNORM,[M.RG]:e.RG8_SNORM,[M.RED]:e.R8_SNORM,[M.RGBA_INTEGER]:e.RGBA8I,[M.RGB_INTEGER]:e.RGB8I,[M.RG_INTEGER]:e.RG8I,[M.RED_INTEGER]:e.R8I},[z.UNSIGNED_SHORT]:{[M.RGBA_INTEGER]:e.RGBA16UI,[M.RGB_INTEGER]:e.RGB16UI,[M.RG_INTEGER]:e.RG16UI,[M.RED_INTEGER]:e.R16UI,[M.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[z.SHORT]:{[M.RGBA_INTEGER]:e.RGBA16I,[M.RGB_INTEGER]:e.RGB16I,[M.RG_INTEGER]:e.RG16I,[M.RED_INTEGER]:e.R16I},[z.UNSIGNED_INT]:{[M.RGBA_INTEGER]:e.RGBA32UI,[M.RGB_INTEGER]:e.RGB32UI,[M.RG_INTEGER]:e.RG32UI,[M.RED_INTEGER]:e.R32UI,[M.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[z.INT]:{[M.RGBA_INTEGER]:e.RGBA32I,[M.RGB_INTEGER]:e.RGB32I,[M.RG_INTEGER]:e.RG32I,[M.RED_INTEGER]:e.R32I},[z.FLOAT]:{[M.RGBA]:e.RGBA32F,[M.RGB]:e.RGB32F,[M.RG]:e.RG32F,[M.RED]:e.R32F,[M.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[z.HALF_FLOAT]:{[M.RGBA]:e.RGBA16F,[M.RGB]:e.RGB16F,[M.RG]:e.RG16F,[M.RED]:e.R16F},[z.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:e.RGB565},[z.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:e.RGBA4},[z.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:e.RGB5_A1},[z.UNSIGNED_INT_2_10_10_10_REV]:{[M.RGBA]:e.RGB10_A2,[M.RGBA_INTEGER]:e.RGB10_A2UI},[z.UNSIGNED_INT_10F_11F_11F_REV]:{[M.RGB]:e.R11F_G11F_B10F},[z.UNSIGNED_INT_5_9_9_9_REV]:{[M.RGB]:e.RGB9_E5},[z.UNSIGNED_INT_24_8]:{[M.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[z.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[M.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[z.UNSIGNED_BYTE]:{[M.RGBA]:e.RGBA,[M.RGB]:e.RGB,[M.ALPHA]:e.ALPHA,[M.LUMINANCE]:e.LUMINANCE,[M.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[z.UNSIGNED_SHORT_5_6_5]:{[M.RGB]:e.RGB},[z.UNSIGNED_SHORT_4_4_4_4]:{[M.RGBA]:e.RGBA},[z.UNSIGNED_SHORT_5_5_5_1]:{[M.RGBA]:e.RGBA}},t}class Cf{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new V,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=sv(t);const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let r=0;r<i;r++)this.boundTextures[r]=null;this.emptyTextures={};const s=new ga(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new ga(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,i=0){const{gl:s}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[i]!==t&&(this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),s.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[i]=t}else this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:i,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<s.length;r++)s[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<s.length;r++)s[r]===t&&(this.currentLocation!==r&&(i.activeTexture(i.TEXTURE0+r),this.currentLocation=r),i.bindTexture(t.target,this.emptyTextures[t.target].texture),s[r]=null)}ensureSamplerType(t){const{boundTextures:i,hasIntegerTextures:s,CONTEXT_UID:r}=this;if(s)for(let n=t-1;n>=0;--n){const o=i[n];o&&o._glTextures[r].samplerType!==La.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const i=new ga(this.gl.createTexture());return i.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),i}initTextureType(t,i){var s;i.internalFormat=((s=this.internalFormats[t.type])==null?void 0:s[t.format])??t.format,this.webGLVersion===2&&t.type===z.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=t.type}updateTexture(t){var r;const i=t._glTextures[this.CONTEXT_UID];if(!i)return;const s=this.renderer;if(this.initTextureType(t,i),(r=t.resource)!=null&&r.upload(s,t,i))i.samplerType!==La.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,o=t.realHeight,a=s.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(t.target,0,i.internalFormat,n,o,0,t.format,i.type,null))}t.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(t),i.dirtyId=t.dirtyId}destroyTexture(t,i){const{gl:s}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!i)){const r=this.managedTextures.indexOf(t);r!==-1&&fs(this.managedTextures,r,1)}}updateTextureStyle(t){var s;const i=t._glTextures[this.CONTEXT_UID];i&&((t.mipmap===Oe.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?i.mipmap=!1:i.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?i.wrapMode=ui.CLAMP:i.wrapMode=t.wrapMode,(s=t.resource)!=null&&s.style(this.renderer,t,i)||this.setStyle(t,i),i.dirtyStyleId=t.dirtyStyleId)}setStyle(t,i){const s=this.gl;if(i.mipmap&&t.mipmap!==Oe.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,i.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===Pe.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===Pe.LINEAR){const n=Math.min(t.anisotropicLevel,s.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===Pe.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===Pe.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Cf.extension={type:O.RendererSystem,name:"texture"};H.add(Cf);class kf{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,i){const{gl:s,renderer:r}=this;i&&r.shader.bind(i),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:i,renderer:s,CONTEXT_UID:r}=this,n=i.createTransformFeedback();t._glTransformFeedbacks[r]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(s.buffer.update(a),a._glBuffers[r].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[r].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,i){const s=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!i&&n.dispose(a,i))}s&&(i||r.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}kf.extension={type:O.RendererSystem,name:"transformFeedback"};H.add(kf);class Io{constructor(t){this.renderer=t}init(t){this.screen=new j(0,0,t.width,t.height),this.element=t.view||B.ADAPTER.createCanvas(),this.resolution=t.resolution||B.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,i){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(i*this.resolution);const s=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=s,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",s,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var i;t&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Io.defaultOptions={width:800,height:600,resolution:B.RESOLUTION,autoDensity:!1};Io.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"_view"};H.add(Io);B.PREFER_ENV=zi.WEBGL2;B.STRICT_TEXTURE_CACHE=!1;B.RENDER_OPTIONS={...Ao.defaultOptions,...To.defaultOptions,...Io.defaultOptions,...Ro.defaultOptions};Object.defineProperties(B,{WRAP_MODE:{get(){return V.defaultOptions.wrapMode},set(e){J("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),V.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return V.defaultOptions.scaleMode},set(e){J("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),V.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return V.defaultOptions.mipmap},set(e){J("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),V.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return V.defaultOptions.anisotropicLevel},set(e){J("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),V.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return J("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Yt.defaultResolution},set(e){Yt.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return J("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Yt.defaultMultisample},set(e){Yt.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return me.defaultMaxTextures},set(e){J("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),me.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return me.defaultBatchSize},set(e){J("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),me.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return me.canUploadSameBuffer},set(e){J("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),me.canUploadSameBuffer=e}},GC_MODE:{get(){return _e.defaultMode},set(e){J("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),_e.defaultMode=e}},GC_MAX_IDLE:{get(){return _e.defaultMaxIdle},set(e){J("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),_e.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return _e.defaultCheckCountMax},set(e){J("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),_e.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return ye.defaultVertexPrecision},set(e){J("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ye.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return ye.defaultFragmentPrecision},set(e){J("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ye.defaultFragmentPrecision=e}}});var _i=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(_i||{});class ya{constructor(t,i=null,s=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=i,this.priority=s,this.once=r}match(t,i=null){return this.fn===t&&this.context===i}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const i=this.next;return this.next=t?null:i,this.previous=null,i}}const te=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ya(null,null,1/0),this.deltaMS=1/te.targetFPMS,this.elapsedMS=1/te.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=_i.NORMAL){return this._addListener(new ya(e,t,i))}addOnce(e,t,i=_i.NORMAL){return this._addListener(new ya(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*te.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,te.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!te._shared){const e=te._shared=new te;e.autoStart=!0,e._protected=!0}return te._shared}static get system(){if(!te._system){const e=te._system=new te;e.autoStart=!0,e._protected=!0}return te._system}};let kt=te;kt.targetFPMS=.06;Object.defineProperties(B,{TARGET_FPMS:{get(){return kt.targetFPMS},set(e){J("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),kt.targetFPMS=e}}});class Df{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,_i.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?kt.shared:new kt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Df.extension=O.Application;H.add(Df);const Pf=[];H.handleByList(O.Renderer,Pf);function rv(e){for(const t of Pf)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var nv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,ov=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const av=nv,Mf=ov;class Nf{constructor(t){this.renderer=t}contextChange(t){let i;if(this.renderer.context.webGLVersion===1){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}i>=Ct.HIGH?this.multisample=Ct.HIGH:i>=Ct.MEDIUM?this.multisample=Ct.MEDIUM:i>=Ct.LOW?this.multisample=Ct.LOW:this.multisample=Ct.NONE}destroy(){}}Nf.extension={type:O.RendererSystem,name:"_multisample"};H.add(Nf);class hv{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Bf{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);i.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:i}=this;i.bindBuffer(t,null)}bindBufferBase(t,i){const{gl:s,CONTEXT_UID:r}=this;if(this.boundBufferBases[i]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[i]=t,s.bindBufferBase(s.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(t,i,s){const{gl:r,CONTEXT_UID:n}=this;s=s||0;const o=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,i||0,o.buffer,s*256,256)}update(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,i.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{const n=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,n)}}dispose(t,i){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),s&&(i||r.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const i=Object.keys(this.managedBuffers);for(let s=0;s<i.length;s++)this.dispose(this.managedBuffers[i[s]],t)}createGLBuffer(t){const{CONTEXT_UID:i,gl:s}=this;return t._glBuffers[i]=new hv(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]}}Bf.extension={type:O.RendererSystem,name:"buffer"};H.add(Bf);class Of{constructor(t){this.renderer=t}render(t,i){const s=this.renderer;let r,n,o,a;if(i&&(r=i.renderTexture,n=i.clear,o=i.transform,a=i.skipUpdateTransform),this.renderingToScreen=!r,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=o,!s.context.isLost){if(r||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}s.renderTexture.bind(r),s.batch.currentRenderer.start(),(n??s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),r&&(i.blit&&s.framebuffer.blit(),r.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Of.extension={type:O.RendererSystem,name:"objectRenderer"};H.add(Of);const ah=class extends iv{constructor(e){super(),this.type=Td.WEBGL,e=Object.assign({},B.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ee({projectionMatrix:new bt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ah.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(J("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=ah.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:My()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return J("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return J("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return J("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return J("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let Ls=ah;Ls.extension={type:O.Renderer,priority:1};Ls.__plugins={};Ls.__systems={};H.handleByMap(O.RendererPlugin,Ls.__plugins);H.handleByMap(O.RendererSystem,Ls.__systems);H.add(Ls);class Lf extends vr{constructor(t,i){const{width:s,height:r}=i||{};super(s,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new V;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,i){for(let s=0;s<this.length;s++)t[s]&&(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof vr?this.addResourceAt(t[s],s):this.addResourceAt(Qd(t[s],i),s))}dispose(){for(let t=0,i=this.length;t<i;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[i].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=t,this.items[i].on("update",t.update,t)}unbind(t){super.unbind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",t.update,t)}load(){if(this._load)return this._load;const i=this.items.map(s=>s.resource).filter(s=>s).map(s=>s.load());return this._load=Promise.all(i).then(()=>{const{realWidth:s,realHeight:r}=this.items[0];return this.resize(s,r),Promise.resolve(this)}),this._load}}class lv extends Lf{constructor(t,i){const{width:s,height:r}=i||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:s,height:r}),n&&this.initFromArray(n,i)}addBaseTextureAt(t,i){if(t.resource)this.addResourceAt(t.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=ls.TEXTURE_2D_ARRAY}upload(t,i,s){const{length:r,itemDirtyIds:n,items:o}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,r,0,i.format,s.type,null);for(let h=0;h<r;h++){const l=o[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,i.format,s.type,l.resource.source))}return!0}}class cv extends mi{constructor(t){super(t)}static test(t){const{OffscreenCanvas:i}=globalThis;return i&&t instanceof i?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Js=class extends Lf{constructor(e,t){const{width:i,height:s,autoLoad:r,linkBaseTexture:n}=t||{};if(e&&e.length!==Js.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:s});for(let o=0;o<Js.SIDES;o++)this.items[o].target=ls.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,e&&this.initFromArray(e,t),r!==!1&&this.load()}bind(e){super.bind(e),e.target=ls.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=ls.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const s=this.itemDirtyIds;for(let r=0;r<Js.SIDES;r++){const n=this.items[r];(s[r]<n.dirtyId||i.dirtyId<t.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(e,n,i),s[r]=n.dirtyId):s[r]<-1&&(e.gl.texImage2D(n.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),s[r]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Js.SIDES}};let Ff=Js;Ff.SIDES=6;class os extends mi{constructor(t,i){i=i||{};let s,r;typeof t=="string"?(s=os.EMPTY,r=t):(s=t,r=null),super(s),this.url=r,this.crossOrigin=i.crossOrigin??!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,i)=>{if(this.url===null){t(this);return}try{const s=await B.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await s.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===we.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(s){if(this.destroyed)return;i(s),this.onError.emit(s)}}),this._load)}upload(t,i,s){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(t,i,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return os._EMPTY=os._EMPTY??B.ADAPTER.createCanvas(0,0),os._EMPTY}}const Mn=class extends mi{constructor(e,t){t=t||{},super(B.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},Mn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;mi.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*t,r=this._overrideHeight||this._overrideWidth/t*i),s=Math.round(s),r=Math.round(r);const n=this.source;n.width=s,n.height=r,n._pixiId=`canvas_${Fi()}`,n.getContext("2d").drawImage(e,0,0,t,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(e){const t=Mn.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Mn.SVG_XML.test(e)}};let br=Mn;br.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;br.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const hh=class extends mi{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const s=e[0].src||e[0];mi.crossOrigin(i,s,t.crossorigin);for(let r=0;r<e.length;++r){const n=document.createElement("source");let{src:o,mime:a}=e[r];o=o||e[r];const h=o.split("?").shift().toLowerCase(),l=h.slice(h.lastIndexOf(".")+1);a=a||hh.MIME_TYPES[l]||`video/${l}`,n.src=o,n.type=a,i.appendChild(n)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=kt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(kt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(kt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(kt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(kt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(kt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||hh.TYPES.includes(t)}};let pl=hh;pl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];pl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};eh.push(os,cf,cv,pl,br,Mr,Ff,lv);class eo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?j.EMPTY:(t=t||new j(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,i){const{a:s,b:r,c:n,d:o,tx:a,ty:h}=t,l=s*i.x+n*i.y+a,c=r*i.x+o*i.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let i=this.minX,s=this.minY,r=this.maxX,n=this.maxY,o=t[0],a=t[1];i=o<i?o:i,s=a<s?a:s,r=o>r?o:r,n=a>n?a:n,o=t[2],a=t[3],i=o<i?o:i,s=a<s?a:s,r=o>r?o:r,n=a>n?a:n,o=t[4],a=t[5],i=o<i?o:i,s=a<s?a:s,r=o>r?o:r,n=a>n?a:n,o=t[6],a=t[7],i=o<i?o:i,s=a<s?a:s,r=o>r?o:r,n=a>n?a:n,this.minX=i,this.minY=s,this.maxX=r,this.maxY=n}addFrame(t,i,s,r,n){this.addFrameMatrix(t.worldTransform,i,s,r,n)}addFrameMatrix(t,i,s,r,n){const o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,_=o*i+h*s+c,y=a*i+l*s+u;d=_<d?_:d,f=y<f?y:f,p=_>p?_:p,m=y>m?y:m,_=o*r+h*s+c,y=a*r+l*s+u,d=_<d?_:d,f=y<f?y:f,p=_>p?_:p,m=y>m?y:m,_=o*i+h*n+c,y=a*i+l*n+u,d=_<d?_:d,f=y<f?y:f,p=_>p?_:p,m=y>m?y:m,_=o*r+h*n+c,y=a*r+l*n+u,d=_<d?_:d,f=y<f?y:f,p=_>p?_:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,i,s){let r=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let h=i;h<s;h+=2){const l=t[h],c=t[h+1];r=l<r?l:r,n=c<n?c:n,o=l>o?l:o,a=c>a?c:a}this.minX=r,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,i,s,r){this.addVerticesMatrix(t.worldTransform,i,s,r)}addVerticesMatrix(t,i,s,r,n=0,o=n){const a=t.a,h=t.b,l=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,_=this.maxY;for(let y=s;y<r;y+=2){const b=i[y],g=i[y+1],v=a*b+l*g+u,S=c*g+h*b+d;f=Math.min(f,v-n),m=Math.max(m,v+n),p=Math.min(p,S-o),_=Math.max(_,S+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=_}addBounds(t){const i=this.minX,s=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<i?t.minX:i,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,i){const s=t.minX>i.minX?t.minX:i.minX,r=t.minY>i.minY?t.minY:i.minY,n=t.maxX<i.maxX?t.maxX:i.maxX,o=t.maxY<i.maxY?t.maxY:i.maxY;if(s<=n&&r<=o){const a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=s<a?s:a,this.minY=r<h?r:h,this.maxX=n>l?n:l,this.maxY=o>c?o:c}}addBoundsMatrix(t,i){this.addFrameMatrix(i,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,i){const s=t.minX>i.x?t.minX:i.x,r=t.minY>i.y?t.minY:i.y,n=t.maxX<i.x+i.width?t.maxX:i.x+i.width,o=t.maxY<i.y+i.height?t.maxY:i.y+i.height;if(s<=n&&r<=o){const a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=s<a?s:a,this.minY=r<h?r:h,this.maxX=n>l?n:l,this.maxY=o>c?o:c}}pad(t=0,i=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=i,this.maxY+=i)}addFramePad(t,i,s,r,n,o){t-=n,i-=o,s+=n,r+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>r?this.maxY:r}}class wt extends Dr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new fl,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new eo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const i=Object.keys(t);for(let s=0;s<i.length;++s){const r=i[s];Object.defineProperty(wt.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,i){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new j),i=this._boundsRect),this._bounds.getRectangle(i)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new j),t=this._localBoundsRect),this._localBounds||(this._localBounds=new eo);const i=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=s,this.transform=i,this._bounds=r,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,i,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,i)}toLocal(t,i,s,r){return i&&(t=i.toGlobal(t,s,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,i=0,s=1,r=1,n=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=i,this.scale.x=s||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new uv),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*a0}set angle(t){this.transform.rotation=t*h0}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=t,this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}}}class uv extends wt{constructor(){super(...arguments),this.sortDirty=null}}wt.prototype.displayObjectUpdateTransform=wt.prototype.updateTransform;const dv=new bt;function fv(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const lh=class extends wt{constructor(){super(),this.children=[],this.sortableChildren=lh.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),s=this.getChildIndex(t);this.children[i]=t,this.children[s]=e,this.onChildrenChange(i<s?i:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);fs(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,fs(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,fs(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,s=t,r=s-i;let n;if(r>0&&r<=s){n=this.children.splice(i,r);for(let o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<n.length;++o)n[o].emit("removed",this),this.emit("childRemoved",n[o],this,o);return n}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(fv),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let s=0,r=this.children.length;s<r;++s){const n=this.children[s];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==lh.prototype._render&&(i=this.getBounds(!0));const r=e.projection.transform;if(r&&(s?(s=dv.copyFrom(s),s.prepend(r)):s=r),i&&t.intersects(i,s))this._render(e);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){const a=this.children[n],h=a.cullable;a.cullable=h||!this.cullArea,a.render(e),a.cullable=h}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,s=this.children.length;i<s;++i)this.children[i].render(e)}}renderAdvanced(e){var r,n,o;const t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let a=0;a<t.length;a++)t[a].enabled&&this._enabledFilters.push(t[a])}const s=t&&((r=this._enabledFilters)==null?void 0:r.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Mt.NONE));if(s&&e.batch.flush(),t&&((n=this._enabledFilters)!=null&&n.length)&&e.filter.push(this,this._enabledFilters),i&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let a=0,h=this.children.length;a<h;++a)this.children[a].render(e)}s&&e.batch.flush(),i&&e.mask.pop(this),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,i=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<i.length;++s)i[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Qt=lh;Qt.defaultSortableChildren=!1;Qt.prototype.containerUpdateTransform=Qt.prototype.updateTransform;Object.defineProperties(B,{SORTABLE_CHILDREN:{get(){return Qt.defaultSortableChildren},set(e){J("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Qt.defaultSortableChildren=e}}});const Vs=new st,pv=new Uint16Array([0,1,2,0,2,3]);class xi extends Qt{constructor(t){super(),this._anchor=new ai(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new ct(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=W.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||L.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=pv,this.pluginName="batch",this.isSprite=!0,this._roundPixels=B.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=oi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=oi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const i=this.transform.worldTransform,s=i.a,r=i.b,n=i.c,o=i.d,a=i.tx,h=i.ty,l=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,m=0,_=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,_=c.y-d._y*u.height,m=_+c.height):(p=-d._x*u.width,f=p+u.width,_=-d._y*u.height,m=_+u.height),l[0]=s*p+n*_+a,l[1]=o*_+r*p+h,l[2]=s*f+n*_+a,l[3]=o*_+r*f+h,l[4]=s*f+n*m+a,l[5]=o*m+r*f+h,l[6]=s*p+n*m+a,l[7]=o*m+r*p+h,this._roundPixels){const y=B.RESOLUTION;for(let b=0;b<l.length;++b)l[b]=Math.round(l[b]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,i=this.vertexTrimmedData,s=t.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty,d=-r._x*s.width,f=d+s.width,p=-r._y*s.height,m=p+s.height;i[0]=o*d+h*p+c,i[1]=l*p+a*d+u,i[2]=o*f+h*p+c,i[3]=l*p+a*f+u,i[4]=o*f+h*m+c,i[5]=l*m+a*f+u,i[6]=o*d+h*m+c,i[7]=l*m+a*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,i=this._texture.orig;!t||t.width===i.width&&t.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new eo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new j),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Vs);const i=this._texture.orig.width,s=this._texture.orig.height,r=-i*this.anchor.x;let n=0;return Vs.x>=r&&Vs.x<r+i&&(n=-s*this.anchor.y,Vs.y>=n&&Vs.y<n+s)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!s)}this._texture=null}static from(t,i){const s=t instanceof L?t:L.from(t,i);return new xi(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const i=oi(this.scale.x)||1;this.scale.x=i*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const i=oi(this.scale.y)||1;this.scale.y=i*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||L.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Uf=new bt;wt.prototype._cacheAsBitmap=!1;wt.prototype._cacheData=null;wt.prototype._cacheAsBitmapResolution=null;wt.prototype._cacheAsBitmapMultisample=null;class mv{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(wt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new mv),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});wt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};wt.prototype._initCachedDisplayObject=function(t){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const i=this.alpha;this.alpha=1,t.batch.flush();const s=this.getLocalBounds(null,!0).clone();if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;s.pad(p)}s.ceil(B.RESOLUTION);const r=t.renderTexture.current,n=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,h=$i.create({width:s.width,height:s.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${Fi()}`;this._cacheData.textureCacheId=l,V.addToCache(h.baseTexture,l),L.addToCache(h,l);const c=this.transform.localTransform.copyTo(Uf).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(r,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new xi(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(s.x/s.width),u.anchor.y=-(s.y/s.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};wt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};wt.prototype._initCachedDisplayObjectCanvas=function(t){var c;if((c=this._cacheData)!=null&&c.sprite)return;const i=this.getLocalBounds(null,!0),s=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,n=t._projTransform;i.ceil(B.RESOLUTION);const o=$i.create({width:i.width,height:i.height}),a=`cacheAsBitmap_${Fi()}`;this._cacheData.textureCacheId=a,V.addToCache(o.baseTexture,a),L.addToCache(o,a);const h=Uf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=i.x,h.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const l=new xi(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(i.x/i.width),l.anchor.y=-(i.y/i.height),l.alpha=s,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};wt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};wt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};wt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,V.removeFromCache(this._cacheData.textureCacheId),L.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};wt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};wt.prototype.name=null;Qt.prototype.getChildByName=function(t,i){for(let s=0,r=this.children.length;s<r;s++)if(this.children[s].name===t)return this.children[s];if(i)for(let s=0,r=this.children.length;s<r;s++){const n=this.children[s];if(!n.getChildByName)continue;const o=n.getChildByName(t,!0);if(o)return o}return null};wt.prototype.getGlobalPosition=function(t=new st,i=!1){return this.parent?this.parent.toGlobal(this.position,t,i):(t.x=this.position.x,t.y=this.position.y),t};var _v=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class gv extends Yt{constructor(t=1){super(av,_v,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const yv={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},vv=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function bv(e){const t=yv[e],i=t.length;let s=vv,r="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<e;a++){let h=n.replace("%index%",a.toString());o=a,a>=i&&(o=e-a-1),h=h.replace("%value%",t[o].toString()),r+=h,r+=`
`}return s=s.replace("%blur%",r),s=s.replace("%size%",e.toString()),s}const Ev=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function xv(e,t){const i=Math.ceil(e/2);let s=Ev,r="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<e;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(i-1)}.0`),r+=a,r+=`
`}return s=s.replace("%blur%",r),s=s.replace("%size%",e.toString()),s}class ch extends Yt{constructor(t,i=8,s=4,r=Yt.defaultResolution,n=5){const o=xv(n,t),a=bv(n);super(o,a),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=s,this.blur=i}apply(t,i,s,r){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/i.width):this.uniforms.strength=1/s.height*(s.height/i.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/i.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/i.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,i,s,r);else{const n=t.getFilterTexture(),o=t.renderer;let a=i,h=n;this.state.blend=!1,t.applyFilter(this,a,h,Ie.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,Ie.BLIT),this.uniforms.uSampler=h;const c=h;h=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,s,r),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class wv extends Yt{constructor(t=8,i=4,s=Yt.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ch(!0,t,i,s,r),this.blurYFilter=new ch(!1,t,i,s,r),this.resolution=s,this.quality=i,this.blur=t,this.repeatEdgePixels=!1}apply(t,i,s,r){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,i,a,Ie.CLEAR),this.blurYFilter.apply(t,a,s,r),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,i,s,r):this.blurXFilter.apply(t,i,s,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var Sv=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class uh extends Yt{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Mf,Sv,t),this.alpha=1}_loadMatrix(t,i=!1){let s=t;i&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,i,s){return t[0]=i[0]*s[0]+i[1]*s[5]+i[2]*s[10]+i[3]*s[15],t[1]=i[0]*s[1]+i[1]*s[6]+i[2]*s[11]+i[3]*s[16],t[2]=i[0]*s[2]+i[1]*s[7]+i[2]*s[12]+i[3]*s[17],t[3]=i[0]*s[3]+i[1]*s[8]+i[2]*s[13]+i[3]*s[18],t[4]=i[0]*s[4]+i[1]*s[9]+i[2]*s[14]+i[3]*s[19]+i[4],t[5]=i[5]*s[0]+i[6]*s[5]+i[7]*s[10]+i[8]*s[15],t[6]=i[5]*s[1]+i[6]*s[6]+i[7]*s[11]+i[8]*s[16],t[7]=i[5]*s[2]+i[6]*s[7]+i[7]*s[12]+i[8]*s[17],t[8]=i[5]*s[3]+i[6]*s[8]+i[7]*s[13]+i[8]*s[18],t[9]=i[5]*s[4]+i[6]*s[9]+i[7]*s[14]+i[8]*s[19]+i[9],t[10]=i[10]*s[0]+i[11]*s[5]+i[12]*s[10]+i[13]*s[15],t[11]=i[10]*s[1]+i[11]*s[6]+i[12]*s[11]+i[13]*s[16],t[12]=i[10]*s[2]+i[11]*s[7]+i[12]*s[12]+i[13]*s[17],t[13]=i[10]*s[3]+i[11]*s[8]+i[12]*s[13]+i[13]*s[18],t[14]=i[10]*s[4]+i[11]*s[9]+i[12]*s[14]+i[13]*s[19]+i[14],t[15]=i[15]*s[0]+i[16]*s[5]+i[17]*s[10]+i[18]*s[15],t[16]=i[15]*s[1]+i[16]*s[6]+i[17]*s[11]+i[18]*s[16],t[17]=i[15]*s[2]+i[16]*s[7]+i[17]*s[12]+i[18]*s[17],t[18]=i[15]*s[3]+i[16]*s[8]+i[17]*s[13]+i[18]*s[18],t[19]=i[15]*s[4]+i[16]*s[9]+i[17]*s[14]+i[18]*s[19]+i[19],t}_colorMatrix(t){const i=new Float32Array(t);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i}brightness(t,i){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,i)}tint(t,i){const[s,r,n]=ct.shared.setValue(t).toArray(),o=[s,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,i)}greyscale(t,i){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,i)}blackAndWhite(t){const i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,t)}hue(t,i){t=(t||0)/180*Math.PI;const s=Math.cos(t),r=Math.sin(t),n=Math.sqrt,o=1/3,a=n(o),h=s+(1-s)*o,l=o*(1-s)-a*r,c=o*(1-s)+a*r,u=o*(1-s)+a*r,d=s+o*(1-s),f=o*(1-s)-a*r,p=o*(1-s)-a*r,m=o*(1-s)+a*r,_=s+o*(1-s),y=[h,l,c,0,0,u,d,f,0,0,p,m,_,0,0,0,0,0,1,0];this._loadMatrix(y,i)}contrast(t,i){const s=(t||0)+1,r=-.5*(s-1),n=[s,0,0,0,r,0,s,0,0,r,0,0,s,0,r,0,0,0,1,0];this._loadMatrix(n,i)}saturate(t=0,i){const s=t*2/3+1,r=(s-1)*-.5,n=[s,r,r,0,0,r,s,r,0,0,r,r,s,0,0,0,0,0,1,0];this._loadMatrix(n,i)}desaturate(){this.saturate(-1)}negative(t){const i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,t)}sepia(t){const i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,t)}technicolor(t){const i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,t)}polaroid(t){const i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,t)}toBGR(t){const i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,t)}kodachrome(t){const i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,t)}browni(t){const i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,t)}vintage(t){const i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,t)}colorTone(t,i,s,r,n){t=t||.2,i=i||.15,s=s||16770432,r=r||3375104;const o=ct.shared,[a,h,l]=o.setValue(s).toArray(),[c,u,d]=o.setValue(r).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,c,u,d,i,0,a-c,h-u,l-d,0,0];this._loadMatrix(f,n)}night(t,i){t=t||.1;const s=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(s,i)}predator(t,i){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,i)}lsd(t){const i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}uh.prototype.grayscale=uh.prototype.greyscale;var Tv=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,Av=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class Rv extends Yt{constructor(t,i){const s=new bt;t.renderable=!1,super(Av,Tv,{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=s,i==null&&(i=20),this.scale=new st(i,i)}apply(t,i,s,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,i,s,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var Iv=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Cv=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class kv extends Yt{constructor(){super(Cv,Iv)}}var Dv=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class Pv extends Yt{constructor(t=.5,i=Math.random()){super(Mf,Dv,{uNoise:0,uSeed:0}),this.noise=t,this.seed=i}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const jc={AlphaFilter:gv,BlurFilter:wv,BlurFilterPass:ch,ColorMatrixFilter:uh,DisplacementFilter:Rv,FXAAFilter:kv,NoiseFilter:Pv};Object.entries(jc).forEach(([e,t])=>{Object.defineProperty(jc,e,{get(){return J("7.1.0",`filters.${e} has moved to ${e}`),t}})});class Mv{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(kt.system.add(this.tickerUpdate,this,_i.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(kt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const si=new Mv;class Nr{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Nr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new st,this.page=new st,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,i,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,i,s,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class io extends Nr{constructor(){super(...arguments),this.client=new st,this.movement=new st,this.offset=new st,this.global=new st,this.screen=new st}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,i,s){return t.worldTransform.applyInverse(s||this.global,i)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,i,s,r,n,o,a,h,l,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class ue extends io{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Ts extends io{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ts.DOM_DELTA_PIXEL=0;Ts.DOM_DELTA_LINE=1;Ts.DOM_DELTA_PAGE=2;const Nv=2048,Bv=new st,va=new st;class Ov{constructor(t){this.dispatch=new Dr,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,i){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:i,priority:0}),this.mappingTable[t].sort((s,r)=>s.priority-r.priority)}dispatchEvent(t,i){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,i),this.dispatch.emit(i||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const i=this.mappingTable[t.type];if(i)for(let s=0,r=i.length;s<r;s++)i[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,i){si.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,Bv.set(t,i),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,i){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,n=s.length-1;r<n;r++)if(t.currentTarget=s[r],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,i),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let r=s.length-2;r>=0;r--)if(t.currentTarget=s[r],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,i,s=this._allInteractiveElements){if(s.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(i)?i:[i];for(let n=s.length-1;n>=0;n--)r.forEach(o=>{t.currentTarget=s[n],this.notifyTarget(t,o)})}propagationPath(t){const i=[t];for(let s=0;s<Nv&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(t.parent),t=t.parent}return i.reverse(),i}hitTestMoveRecursive(t,i,s,r,n,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||i==="dynamic")&&(si.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(i)?i:d.eventMode,s,r,n,o||n(t,s));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(i),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!n(t,s)&&r(t,s)?l?[t]:[]:null}hitTestRecursive(t,i,s,r,n){if(this._interactivePrune(t)||n(t,s))return null;if((t.eventMode==="dynamic"||i==="dynamic")&&(si.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const c=h[l],u=this.hitTestRecursive(c,this._isInteractive(i)?i:c.eventMode,s,r,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const o=this._isInteractive(i),a=t.isInteractive();return o&&r(t,s)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,i){var s;if(t.hitArea&&(t.worldTransform.applyInverse(i,va),!t.hitArea.contains(va.x,va.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!((s=r.containsPoint)!=null&&s.call(r,i)))return!0}return!1}hitTestFn(t,i){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(i):!1}notifyTarget(t,i){var n,o;i=i??t.type;const s=`on${i}`;(o=(n=t.currentTarget)[s])==null||o.call(n,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${i}capture`:i;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,i)}mapPointerDown(t){if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerdown"),i.pointerType==="touch")this.dispatchEvent(i,"touchstart");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const r=i.button===2;this.dispatchEvent(i,r?"rightdown":"mousedown")}const s=this.trackingData(t.pointerId);s.pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(t){var h,l;if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const i=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const s=i.pointerType==="mouse"||i.pointerType==="pen",r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.overTargets);if(((h=r.overTargets)==null?void 0:h.length)>0&&n!==i.target){const c=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,c,n);if(this.dispatchEvent(u,"pointerout"),s&&this.dispatchEvent(u,"mouseout"),!i.composedPath().includes(n)){const d=this.createPointerEvent(t,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!i.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),s&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(n!==i.target){const c=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(i,c);this.dispatchEvent(u,"pointerover"),s&&this.dispatchEvent(u,"mouseover");let d=n==null?void 0:n.parent;for(;d&&d!==this.rootTarget.parent&&d!==i.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const p=this.clonePointerEvent(i,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==n&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),s&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(u)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(i,"pointermove"),a&&o.push("globalpointermove"),i.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),a&&o.push("globaltouchmove")),s&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=i.target)==null?void 0:l.cursor),o.length>0&&this.all(i,o),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(t){var o;if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId),s=this.createPointerEvent(t),r=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(o=s.target)==null?void 0:o.cursor);const n=this.clonePointerEvent(s,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;i.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId);if(i.overTargets){const s=t.pointerType==="mouse"||t.pointerType==="pen",r=this.findMountedTarget(i.overTargets),n=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(n),s&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",r);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;i.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),s.pointerType==="touch")this.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const a=s.button===2;this.dispatchEvent(s,a?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]);let o=n;if(n&&!s.composedPath().includes(n)){let a=n;for(;a&&!s.composedPath().includes(a);){if(s.currentTarget=a,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")this.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const h=s.button===2;this.notifyTarget(s,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete r.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(s,"click");a.target=o,a.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:i});const h=r.clicksByButton[t.button];if(h.target===a.target&&i-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=i,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof ue)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(s){let n=s;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof Ts)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const i=this.createWheelEvent(t);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(t){if(!t)return null;let i=t[0];for(let s=1;s<t.length&&t[s].parent===i;s++)i=t[s];return i}createPointerEvent(t,i,s){const r=this.allocateEvent(ue);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=s??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],typeof i=="string"&&(r.type=i),r}createWheelEvent(t){const i=this.allocateEvent(Ts);return this.copyWheelData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(t,i){const s=this.allocateEvent(ue);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=i??s.type,s}copyWheelData(t,i){i.deltaMode=t.deltaMode,i.deltaX=t.deltaX,i.deltaY=t.deltaY,i.deltaZ=t.deltaZ}copyPointerData(t,i){t instanceof ue&&i instanceof ue&&(i.pointerId=t.pointerId,i.width=t.width,i.height=t.height,i.isPrimary=t.isPrimary,i.pointerType=t.pointerType,i.pressure=t.pressure,i.tangentialPressure=t.tangentialPressure,i.tiltX=t.tiltX,i.tiltY=t.tiltY,i.twist=t.twist)}copyMouseData(t,i){t instanceof io&&i instanceof io&&(i.altKey=t.altKey,i.button=t.button,i.buttons=t.buttons,i.client.copyFrom(t.client),i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.movement.copyFrom(t.movement),i.screen.copyFrom(t.screen),i.shiftKey=t.shiftKey,i.global.copyFrom(t.global))}copyData(t,i){i.isTrusted=t.isTrusted,i.srcElement=t.srcElement,i.timeStamp=performance.now(),i.type=t.type,i.detail=t.detail,i.view=t.view,i.which=t.which,i.layer.copyFrom(t.layer),i.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const i=this.eventPool.get(t).pop()||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=null,i.target=null,i}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(t)}notifyListeners(t,i){const s=t.currentTarget._events[i];if(s&&t.currentTarget.isInteractive())if("fn"in s)s.once&&t.currentTarget.removeListener(i,s.fn,void 0,!0),s.fn.call(s.context,t);else for(let r=0,n=s.length;r<n&&!t.propagationImmediatelyStopped;r++)s[r].once&&t.currentTarget.removeListener(i,s[r].fn,void 0,!0),s[r].fn.call(s[r].context,t)}}const Lv=1,Fv={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},dh=class{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Ov(null),si.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ue(null),this.rootWheelEvent=new Ts(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...dh.defaultEventFeatures},{set:(t,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),t[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,dh._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let i=0,s=t.length;i<s;i++){const r=t[i],n=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;si.pointerMoved();const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let r=0,n=s.length;r<n;r++){const o=this.bootstrapEvent(this.rootPointerEvent,s[r]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,si.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;si.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;si.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){let s;this.domElement.parentElement?s=this.domElement.getBoundingClientRect():s={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*r,e.y=(i-s.top)*(this.domElement.height/s.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,s=e.changedTouches.length;i<s;i++){const r=e.changedTouches[i];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=Lv),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Fv[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};let Er=dh;Er.extension={name:"events",type:[O.RendererSystem,O.CanvasRendererSystem]};Er.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};H.add(Er);function qc(e){return e==="dynamic"||e==="static"}const Uv={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??qc(Er.defaultEventMode)},set interactive(e){J("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Er.defaultEventMode},set eventMode(e){this._internalInteractive=qc(e),this._internalEventMode=e},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(e,t,i){const s=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,r=typeof t=="function"?void 0:t;e=s?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,r)},removeEventListener(e,t,i){const s=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,r=typeof t=="function"?void 0:t;e=s?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,r)},dispatchEvent(e){if(!(e instanceof Nr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};wt.mixin(Uv);const Gv={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};wt.mixin(Gv);const Hv=9,on=100,zv=0,$v=0,Kc=2,Zc=1,Yv=-1e3,Wv=-1e3,Xv=2;class Gf{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Xe.tablet||Xe.phone)&&this.createTouchHook();const i=document.createElement("div");i.style.width=`${on}px`,i.style.height=`${on}px`,i.style.position="absolute",i.style.top=`${zv}px`,i.style.left=`${$v}px`,i.style.zIndex=Kc.toString(),this.div=i,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Zc}px`,t.style.height=`${Zc}px`,t.style.position="absolute",t.style.top=`${Yv}px`,t.style.left=`${Wv}px`,t.style.zIndex=Xv.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const i=t.children;if(i)for(let s=0;s<i.length;s++)this.updateAccessibleObjects(i[s])}update(){const t=performance.now();if(Xe.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:i,y:s,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=r/o*h,c=n/a*h;let u=this.div;u.style.left=`${i}px`,u.style.top=`${s}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,fs(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=`${(m.tx+p.x*m.a)*l}px`,u.style.top=`${(m.ty+p.y*m.d)*c}px`,u.style.width=`${p.width*m.a*l}px`,u.style.height=`${p.height*m.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*l}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*l}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:i,height:s}=this.renderer;t.x+t.width>i&&(t.width=i-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=`${on}px`,i.style.height=`${on}px`,i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=Kc.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=t.accessiblePointerEvents,i.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?i.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(i.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&i.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(i),t._accessibleActive=!0,t._accessibleDiv=i,i.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,i){const{displayObject:s}=t.target,r=this.renderer.events.rootBoundary,n=Object.assign(new Nr(r),{target:s});r.rootTarget=this.renderer.lastObjectRendered,i.forEach(o=>r.dispatchEvent(n,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Hv&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Gf.extension={name:"accessibility",type:[O.RendererPlugin,O.CanvasRendererPlugin]};H.add(Gf);const fh=class{constructor(e){this.stage=new Qt,e=Object.assign({forceCanvas:!1},e),this.renderer=rv(e),fh._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const i=fh._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let ml=fh;ml._plugins=[];H.handleByList(O.Application,ml._plugins);class Hf{static init(t){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let i,s;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,s=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;i=r,s=n}this.renderer.resize(i,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Hf.extension=O.Application;H.add(Hf);const Jc={loader:O.LoadParser,resolver:O.ResolveParser,cache:O.CacheParser,detection:O.DetectionParser};H.handle(O.Asset,e=>{const t=e.ref;Object.entries(Jc).filter(([i])=>!!t[i]).forEach(([i,s])=>H.add(Object.assign(t[i],{extension:t[i].extension??s})))},e=>{const t=e.ref;Object.keys(Jc).filter(i=>!!t[i]).forEach(i=>H.remove(t[i]))});class Vv{constructor(t,i=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=i}add(t){t.forEach(i=>{this._assetList.push(i)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],i=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<i;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Br(e,t){if(Array.isArray(t)){for(const i of t)if(e.startsWith(`data:${i}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Yi(e,t){const i=e.split("?")[0],s=Vt.extname(i).toLowerCase();return Array.isArray(t)?t.includes(s):s===t}const je=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(i=>typeof i=="string"?t(i):i):e),ph=(e,t)=>{const i=t.split("?")[1];return i&&(e+=`?${i}`),e};function zf(e,t,i,s,r){const n=t[i];for(let o=0;o<n.length;o++){const a=n[o];i<t.length-1?zf(e.replace(s[i],a),t,i+1,s,r):r.push(e.replace(s[i],a))}}function jv(e){const t=/\{(.*?)\}/g,i=e.match(t),s=[];if(i){const r=[];i.forEach(n=>{const o=n.substring(1,n.length-1).split(",");r.push(o)}),zf(e,r,0,i,s)}else s.push(e);return s}const so=e=>!Array.isArray(e);class qv{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const i=this._cache.get(t);return i||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),i}set(t,i){const s=je(t);let r;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(i)){r=h.getCacheableAssets(s,i);break}}r||(r={},s.forEach(a=>{r[a]=i}));const n=Object.keys(r),o={cacheKeys:n,keys:s};if(s.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==i&&console.warn("[Cache] already has key:",a),this._cache.set(a,r[a])}),i instanceof L){const a=i;s.forEach(h=>{a.baseTexture!==L.EMPTY.baseTexture&&V.addToCache(a.baseTexture,h),L.addToCache(a,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const i=this._cacheMap.get(t);i.cacheKeys.forEach(r=>{this._cache.delete(r)}),i.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const js=new qv;class Kv{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,i,s)=>(this._parsersValidated=!1,t[i]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,i){const s={promise:null,parser:null};return s.promise=(async()=>{var o,a;let r=null,n=null;if(i.loadParser&&(n=this._parserHash[i.loadParser],n||console.warn(`[Assets] specified load parser "${i.loadParser}" not found while loading ${t}`)),!n){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,i,this))){n=l;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,i,this),s.parser=n;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,r,i,this))&&(r=await l.parse(r,i,this)||r,s.parser=l)}return r})(),s}async load(t,i){this._parsersValidated||this._validateParsers();let s=0;const r={},n=so(t),o=je(t,l=>({src:l})),a=o.length,h=o.map(async l=>{const c=Vt.toAbsolute(l.src);if(!r[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),r[l.src]=await this.promiseCache[c].promise,i&&i(++s/a)}catch(u){throw delete this.promiseCache[c],delete r[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?r[o[0].src]:r}async unload(t){const s=je(t,r=>({src:r})).map(async r=>{var a,h;const n=Vt.toAbsolute(r.src),o=this.promiseCache[n];if(o){const l=await o.promise;(h=(a=o.parser)==null?void 0:a.unload)==null||h.call(a,l,r,this),delete this.promiseCache[n]}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,i)=>(t[i.name]&&console.warn(`[Assets] loadParser name conflict "${i.name}"`),{...t,[i.name]:i}),{})}}var Fe=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Fe||{});const Zv=".json",Jv="application/json",Qv={extension:{type:O.LoadParser,priority:Fe.Low},name:"loadJson",test(e){return Br(e,Jv)||Yi(e,Zv)},async load(e){return await(await B.ADAPTER.fetch(e)).json()}};H.add(Qv);const tb=".txt",eb="text/plain",ib={name:"loadTxt",extension:{type:O.LoadParser,priority:Fe.Low},test(e){return Br(e,eb)||Yi(e,tb)},async load(e){return await(await B.ADAPTER.fetch(e)).text()}};H.add(ib);const sb=["normal","bold","100","200","300","400","500","600","700","800","900"],rb=[".ttf",".otf",".woff",".woff2"],nb=["font/ttf","font/otf","font/woff","font/woff2"],ob=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function ab(e){const t=Vt.extname(e),r=Vt.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let n=r.length>0;for(const a of r)if(!a.match(ob)){n=!1;break}let o=r.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const hb={extension:{type:O.LoadParser,priority:Fe.Low},name:"loadWebFont",test(e){return Br(e,nb)||Yi(e,rb)},async load(e,t){var s,r,n;const i=B.ADAPTER.getFontFaceSet();if(i){const o=[],a=((s=t.data)==null?void 0:s.family)??ab(e),h=((n=(r=t.data)==null?void 0:r.weights)==null?void 0:n.filter(c=>sb.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const u=h[c],d=new FontFace(a,`url(${encodeURI(e)})`,{...l,weight:u});await d.load(),i.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>B.ADAPTER.getFontFaceSet().delete(t))}};H.add(hb);let Qc=0,ba;const lb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",cb={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${lb}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},ub={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Ea;class db{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const i=URL.createObjectURL(new Blob([cb.code],{type:"application/javascript"})),s=new Worker(i);s.addEventListener("message",r=>{s.terminate(),URL.revokeObjectURL(i),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){ba===void 0&&(ba=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ba&&(Ea||(Ea=URL.createObjectURL(new Blob([ub.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Ea),t.addEventListener("message",i=>{this.complete(i.data),this.returnWorker(i.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,i){await this._initWorkers();const s=new Promise((r,n)=>{this.queue.push({id:t,arguments:i,resolve:r,reject:n})});return this.next(),s}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const i=this.queue.pop(),s=i.id;this.resolveHash[Qc]={resolve:i.resolve,reject:i.reject},t.postMessage({data:i.arguments,uuid:Qc++,id:s})}}const tu=new db;function Co(e,t,i){const s=new L(e);return s.baseTexture.on("dispose",()=>{delete t.promiseCache[i]}),s}const fb=[".jpeg",".jpg",".png",".webp",".avif"],pb=["image/jpeg","image/png","image/webp","image/avif"];async function mb(e){const t=await B.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const i=await t.blob();return await createImageBitmap(i)}const ko={name:"loadTextures",extension:{type:O.LoadParser,priority:Fe.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return Br(e,pb)||Yi(e,fb)},async load(e,t,i){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await tu.isImageBitmapSupported()?s=await tu.loadImageBitmap(e):s=await mb(e):s=await new Promise(n=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=e,s.complete?n(s):s.onload=()=>{n(s)}});const r=new V(s,{resolution:fi(e),...t.data});return r.resource.src=e,Co(r,i,e)},unload(e){e.destroy(!0)}};H.add(ko);const _b=".svg",gb="image/svg+xml",yb={extension:{type:O.LoadParser,priority:Fe.High},name:"loadSVG",test(e){return Br(e,gb)||Yi(e,_b)},async testParse(e){return br.test(e)},async parse(e,t,i){var o;const s=new br(e,(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions);await s.load();const r=new V(s,{resolution:fi(e),...t==null?void 0:t.data});return r.resource.src=e,Co(r,i,e)},async load(e,t){return(await B.ADAPTER.fetch(e)).text()},unload:ko.unload};H.add(yb);class vb{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,i)=>`${t}${this._bundleIdConnector}${i}`,extractAssetIdFromBundle:(t,i)=>i.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(i=>{this._preferredOrder.push(i),i.priority||(i.priority=Object.keys(i.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const i=t;this._defaultSearchParams=Object.keys(i).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(i[s])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(i=>{this.addBundle(i.name,i.assets)})}addBundle(t,i){const s=[];Array.isArray(i)?i.forEach(r=>{if(typeof r.name=="string"){const n=this._createBundleAssetId(t,r.name);s.push(n),this.add([r.name,n],r.srcs,r.data)}else{const n=r.name.map(o=>this._createBundleAssetId(t,o));n.forEach(o=>{s.push(o)}),this.add([...r.name,...n],r.srcs)}}):Object.keys(i).forEach(r=>{s.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],i[r])}),this._bundles[t]=s}add(t,i,s){const r=je(t);r.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(i)||(typeof i=="string"?i=jv(i):i=[i]);const n=i.map(o=>{let a=o;if(typeof o=="string"){let h=!1;for(let l=0;l<this._parsers.length;l++){const c=this._parsers[l];if(c.test(o)){a=c.parse(o),h=!0;break}}h||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=r),(this._basePath||this._rootPath)&&(a.src=Vt.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??s,a});r.forEach(o=>{this._assetMap[o]=n})}resolveBundle(t){const i=so(t);t=je(t);const s={};return t.forEach(r=>{const n=this._bundles[r];if(n){const o=this.resolve(n),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(r,h)]=l}s[r]=a}}),i?s[t[0]]:s}resolveUrl(t){const i=this.resolve(t);if(typeof t!="string"){const s={};for(const r in i)s[r]=i[r].src;return s}return i.src}resolve(t){const i=so(t);t=je(t);const s={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const o=this._getPreferredOrder(n),a=n[0];o==null||o.priority.forEach(h=>{o.params[h].forEach(l=>{const c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[r]=n[0]??a}else{let n=r;(this._basePath||this._rootPath)&&(n=Vt.toAbsolute(n,this._basePath,this._rootPath)),n=this._appendDefaultSearchParams(n),this._resolverHash[r]={src:n}}s[r]=this._resolverHash[r]}),i?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let i=0;i<t.length;i++){const s=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(s.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const i=/\?/.test(t)?"&":"?";return`${t}${i}${this._defaultSearchParams}`}}class bb{constructor(){this._detections=[],this._initialized=!1,this.resolver=new vb,this.loader=new Kv,this.cache=js,this._backgroundLoader=new Vv(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,o,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const i=((n=t.texturePreference)==null?void 0:n.resolution)??1,s=typeof i=="number"?[i]:i;let r=[];if((o=t.texturePreference)!=null&&o.format){const h=(a=t.texturePreference)==null?void 0:a.format;r=typeof h=="string"?[h]:h;for(const l of this._detections)await l.test()||(r=await l.remove(r))}else for(const h of this._detections)await h.test()&&(r=await h.add(r));this.resolver.prefer({params:{format:r,resolution:s}}),t.preferences&&this.setPreferences(t.preferences)}add(t,i,s){this.resolver.add(t,i,s)}async load(t,i){this._initialized||await this.init();const s=so(t),r=je(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),n=this.resolver.resolve(r),o=await this._mapLoadToResolve(n,i);return s?o[r[0]]:o}addBundle(t,i){this.resolver.addBundle(t,i)}async loadBundle(t,i){this._initialized||await this.init();let s=!1;typeof t=="string"&&(s=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},o=Object.keys(r);let a=0,h=0;const l=()=>{i==null||i(++a/h)},c=o.map(u=>{const d=r[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[u]=f})});return await Promise.all(c),s?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(i))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolveBundle(t);Object.values(i).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return js.get(t);const i={};for(let s=0;s<t.length;s++)i[s]=js.get(t[s]);return i}async _mapLoadToResolve(t,i){const s=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(s,i);this._backgroundLoader.active=!0;const o={};return s.forEach((a,h)=>{const l=n[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[r[h]]=l,js.set(c,l)}),o}async unload(t){this._initialized||await this.init();const i=je(t).map(r=>typeof r!="string"?r.src:r),s=this.resolver.resolve(i);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=je(t);const i=this.resolver.resolveBundle(t),s=Object.keys(i).map(r=>this._unloadFromResolved(i[r]));await Promise.all(s)}async _unloadFromResolved(t){const i=Object.values(t);i.forEach(s=>{js.remove(s.src)}),await this.loader.unload(i)}get detections(){return this._detections}get preferWorkers(){return ko.config.preferWorkers}set preferWorkers(t){J("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(i=>{i.config&&Object.keys(i.config).filter(s=>s in t).forEach(s=>{i.config[s]=t[s]})})}}const an=new bb;H.handleByList(O.LoadParser,an.loader.parsers).handleByList(O.ResolveParser,an.resolver.parsers).handleByList(O.CacheParser,an.cache.parsers).handleByList(O.DetectionParser,an.detections);const Eb={extension:O.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof L),getCacheableAssets:(e,t)=>{const i={};return e.forEach(s=>{t.forEach((r,n)=>{i[s+(n===0?"":n+1)]=r})}),i}};H.add(Eb);const xb={extension:{type:O.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await B.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};H.add(xb);const wb={extension:{type:O.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await B.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};H.add(wb);const eu=["png","jpg","jpeg"],Sb={extension:{type:O.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...eu],remove:async e=>e.filter(t=>!eu.includes(t))};H.add(Sb);const Tb={extension:O.ResolveParser,test:ko.test,parse:e=>{var t;return{resolution:parseFloat(((t=B.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};H.add(Tb);var ee=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(ee||{});const ro={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let He,ts;function iu(){ts={s3tc:He.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:He.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:He.getExtension("WEBGL_compressed_texture_etc"),etc1:He.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:He.getExtension("WEBGL_compressed_texture_pvrtc")||He.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:He.getExtension("WEBGL_compressed_texture_atc"),astc:He.getExtension("WEBGL_compressed_texture_astc")}}const Ab={extension:{type:O.DetectionParser,priority:2},test:async()=>{const t=B.ADAPTER.createCanvas().getContext("webgl");return t?(He=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{ts||iu();const t=[];for(const i in ts)ts[i]&&t.push(i);return[...t,...e]},remove:async e=>(ts||iu(),e.filter(t=>!(t in ts)))};H.add(Ab);class Rb extends Mr{constructor(t,i={width:1,height:1,autoLoad:!0}){let s,r;typeof t=="string"?(s=t,r=new Uint8Array):(s=null,r=t),super(r,i),this.origin=s,this.buffer=r?new th(r):null,this._load=null,this.loaded=!1,this.origin!==null&&i.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new th(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Bi extends Rb{constructor(t,i){super(t,i),this.format=i.format,this.levels=i.levels||1,this._width=i.width,this._height=i.height,this._extension=Bi._formatToExtension(this.format),(i.levelBuffers||this.buffer)&&(this._levelBuffers=i.levelBuffers||Bi._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,i,s){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:h,levelWidth:l,levelHeight:c,levelBuffer:u}=this._levelBuffers[o];r.compressedTexImage2D(r.TEXTURE_2D,h,this.format,l,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Bi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,i,s,r,n,o,a){const h=new Array(s);let l=t.byteOffset,c=o,u=a,d=c+r-1&~(r-1),f=u+n-1&~(n-1),p=d*f*ro[i];for(let m=0;m<s;m++)h[m]={levelID:m,levelWidth:s>1?c:d,levelHeight:s>1?u:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,c=c>>1||1,u=u>>1||1,d=c+r-1&~(r-1),f=u+n-1&~(n-1),p=d*f*ro[i];return h}}const xa=4,hn=124,Ib=32,su=20,Cb=542327876,ln={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},kb={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},cn={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Db=1,Pb=2,Mb=4,Nb=64,Bb=512,Ob=131072,Lb=827611204,Fb=861165636,Ub=894720068,Gb=808540228,Hb=4,zb={[Lb]:ee.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Fb]:ee.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Ub]:ee.COMPRESSED_RGBA_S3TC_DXT5_EXT},$b={[70]:ee.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:ee.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:ee.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:ee.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:ee.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:ee.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:ee.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:ee.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:ee.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Yb(e){const t=new Uint32Array(e);if(t[0]!==Cb)throw new Error("Invalid DDS file magic word");const s=new Uint32Array(e,0,hn/Uint32Array.BYTES_PER_ELEMENT),r=s[ln.HEIGHT],n=s[ln.WIDTH],o=s[ln.MIPMAP_COUNT],a=new Uint32Array(e,ln.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Ib/Uint32Array.BYTES_PER_ELEMENT),h=a[Db];if(h&Mb){const l=a[kb.FOURCC];if(l!==Gb){const g=zb[l],v=xa+hn,S=new Uint8Array(e,v);return[new Bi(S,{format:g,width:n,height:r,levels:o})]}const c=xa+hn,u=new Uint32Array(t.buffer,c,su/Uint32Array.BYTES_PER_ELEMENT),d=u[cn.DXGI_FORMAT],f=u[cn.RESOURCE_DIMENSION],p=u[cn.MISC_FLAG],m=u[cn.ARRAY_SIZE],_=$b[d];if(_===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===Hb)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const y=new Array,b=xa+hn+su;if(m===1)y.push(new Uint8Array(e,b));else{const g=ro[_];let v=0,S=n,R=r;for(let x=0;x<o;x++){const C=Math.max(1,S+3&-4),P=Math.max(1,R+3&-4),I=C*P*g;v+=I,S=S>>>1,R=R>>>1}let T=b;for(let x=0;x<m;x++)y.push(new Uint8Array(e,T,v)),T+=v}return y.map(g=>new Bi(g,{format:_,width:n,height:r,levels:o}))}throw h&Nb?new Error("DDSParser does not support uncompressed texture data."):h&Bb?new Error("DDSParser does not supported YUV uncompressed texture data."):h&Ob?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&Pb?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const ru=[171,75,84,88,32,49,49,187,13,10,26,10],Wb=67305985,le={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},mh=64,nu={[z.UNSIGNED_BYTE]:1,[z.UNSIGNED_SHORT]:2,[z.INT]:4,[z.UNSIGNED_INT]:4,[z.FLOAT]:4,[z.HALF_FLOAT]:8},Xb={[M.RGBA]:4,[M.RGB]:3,[M.RG]:2,[M.RED]:1,[M.LUMINANCE]:1,[M.LUMINANCE_ALPHA]:2,[M.ALPHA]:1},Vb={[z.UNSIGNED_SHORT_4_4_4_4]:2,[z.UNSIGNED_SHORT_5_5_5_1]:2,[z.UNSIGNED_SHORT_5_6_5]:2};function jb(e,t,i=!1){const s=new DataView(t);if(!qb(e,s))return null;const r=s.getUint32(le.ENDIANNESS,!0)===Wb,n=s.getUint32(le.GL_TYPE,r),o=s.getUint32(le.GL_FORMAT,r),a=s.getUint32(le.GL_INTERNAL_FORMAT,r),h=s.getUint32(le.PIXEL_WIDTH,r),l=s.getUint32(le.PIXEL_HEIGHT,r)||1,c=s.getUint32(le.PIXEL_DEPTH,r)||1,u=s.getUint32(le.NUMBER_OF_ARRAY_ELEMENTS,r)||1,d=s.getUint32(le.NUMBER_OF_FACES,r),f=s.getUint32(le.NUMBER_OF_MIPMAP_LEVELS,r),p=s.getUint32(le.BYTES_OF_KEY_VALUE_DATA,r);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const m=4,_=4,y=h+3&-4,b=l+3&-4,g=new Array(u);let v=h*l;n===0&&(v=y*b);let S;if(n!==0?nu[n]?S=nu[n]*Xb[o]:S=Vb[n]:S=ro[a],S===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const R=i?Zb(s,p,r):null;let x=v*S,C=h,P=l,I=y,D=b,E=mh+p;for(let w=0;w<f;w++){const F=s.getUint32(E,r);let G=E+4;for(let N=0;N<u;N++){let nt=g[N];nt||(nt=g[N]=new Array(f)),nt[w]={levelID:w,levelWidth:f>1||n!==0?C:I,levelHeight:f>1||n!==0?P:D,levelBuffer:new Uint8Array(t,G,x)},G+=x}E+=F+4,E=E%4!==0?E+4-E%4:E,C=C>>1||1,P=P>>1||1,I=C+m-1&~(m-1),D=P+_-1&~(_-1),x=I*D*S}return n!==0?{uncompressed:g.map(w=>{let F=w[0].levelBuffer,G=!1;return n===z.FLOAT?F=new Float32Array(w[0].levelBuffer.buffer,w[0].levelBuffer.byteOffset,w[0].levelBuffer.byteLength/4):n===z.UNSIGNED_INT?(G=!0,F=new Uint32Array(w[0].levelBuffer.buffer,w[0].levelBuffer.byteOffset,w[0].levelBuffer.byteLength/4)):n===z.INT&&(G=!0,F=new Int32Array(w[0].levelBuffer.buffer,w[0].levelBuffer.byteOffset,w[0].levelBuffer.byteLength/4)),{resource:new Mr(F,{width:w[0].levelWidth,height:w[0].levelHeight}),type:n,format:G?Kb(o):o}}),kvData:R}:{compressed:g.map(w=>new Bi(null,{format:a,width:h,height:l,levels:f,levelBuffers:w})),kvData:R}}function qb(e,t){for(let i=0;i<ru.length;i++)if(t.getUint8(i)!==ru[i])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function Kb(e){switch(e){case M.RGBA:return M.RGBA_INTEGER;case M.RGB:return M.RGB_INTEGER;case M.RG:return M.RG_INTEGER;case M.RED:return M.RED_INTEGER;default:return e}}function Zb(e,t,i){const s=new Map;let r=0;for(;r<t;){const n=e.getUint32(mh+r,i),o=mh+r+4,a=3-(n+3)%4;if(n===0||n>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&e.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(e.buffer,o,h)),c=new DataView(e.buffer,o+h+1,n-h-1);s.set(l,c),r+=4+n+a}return s}const Jb={extension:{type:O.LoadParser,priority:Fe.High},name:"loadDDS",test(e){return Yi(e,".dds")},async load(e,t,i){const r=await(await B.ADAPTER.fetch(e)).arrayBuffer(),o=Yb(r).map(a=>{const h=new V(a,{mipmap:Oe.OFF,alphaMode:we.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data});return Co(h,i,e)});return o.length===1?o[0]:o},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};H.add(Jb);const Qb={extension:{type:O.LoadParser,priority:Fe.High},name:"loadKTX",test(e){return Yi(e,".ktx")},async load(e,t,i){const r=await(await B.ADAPTER.fetch(e)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=jb(e,r),h=n??o,l={mipmap:Oe.OFF,alphaMode:we.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data},c=h.map(u=>{h===o&&Object.assign(l,{type:u.type,format:u.format});const d=new V(u,l);return d.ktxKeyValueData=a,Co(d,i,e)});return c.length===1?c[0]:c},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};H.add(Qb);const tE={extension:O.ResolveParser,test:e=>{const i=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(i)},parse:e=>{var s,r;if(e.split("?")[0].split(".").pop()==="ktx"){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some(o=>e.endsWith(o)))return{resolution:parseFloat(((s=B.RETINA_PREFIX.exec(e))==null?void 0:s[1])??"1"),format:n.find(o=>e.endsWith(o)),src:e}}return{resolution:parseFloat(((r=B.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:e.split(".").pop(),src:e}}};H.add(tE);const eE=new j,iE=4,Qs=class{constructor(e){this.renderer=e}async image(e,t,i){const s=new Image;return s.src=await this.base64(e,t,i),s}async base64(e,t,i){const s=this.canvas(e);if(s.toBlob!==void 0)return new Promise((r,n)=>{s.toBlob(o=>{if(!o){n(new Error("ICanvas.toBlob failed!"));return}const a=new FileReader;a.onload=()=>r(a.result),a.onerror=n,a.readAsDataURL(o)},t,i)});if(s.toDataURL!==void 0)return s.toDataURL(t,i);if(s.convertToBlob!==void 0){const r=await s.convertToBlob({type:t,quality:i});return new Promise((n,o)=>{const a=new FileReader;a.onload=()=>n(a.result),a.onerror=o,a.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(e,t);n&&Qs._flipY(i,s,r),Qs._unpremultiplyAlpha(i);const o=new jy(s,r,1),a=new ImageData(new Uint8ClampedArray(i.buffer),s,r);return o.context.putImageData(a,0,0),o.canvas}pixels(e,t){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(e,t);return n&&Qs._flipY(i,s,r),Qs._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,r=!1,n,o=!1;if(e&&(e instanceof $i?n=e:(n=i.generateTexture(e,{resolution:i.resolution,multisample:i.multisample}),o=!0)),n){if(s=n.baseTexture.resolution,t=t??n.frame,r=!1,!o){i.renderTexture.bind(n);const u=n.framebuffer.glFramebuffers[i.CONTEXT_UID];u.blitFramebuffer&&i.framebuffer.bind(u.blitFramebuffer)}}else s=i.resolution,t||(t=eE,t.width=i.width/s,t.height=i.height/s),r=!0,i.renderTexture.bind();const a=Math.round(t.width*s),h=Math.round(t.height*s),l=new Uint8Array(iE*a*h),c=i.gl;return c.readPixels(Math.round(t.x*s),Math.round(t.y*s),a,h,c.RGBA,c.UNSIGNED_BYTE,l),o&&(n==null||n.destroy(!0)),{pixels:l,width:a,height:h,flipY:r}}destroy(){this.renderer=null}static _flipY(e,t,i){const s=t<<2,r=i>>1,n=new Uint8Array(s);for(let o=0;o<r;o++){const a=o*s,h=(i-o-1)*s;n.set(e.subarray(a,a+s)),e.copyWithin(a,h,h+s),e.set(n,h)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const s=e[i+3];if(s!==0){const r=255.001/s;e[i]=e[i]*r+.5,e[i+1]=e[i+1]*r+.5,e[i+2]=e[i+2]*r+.5}}}};let $f=Qs;$f.extension={name:"extract",type:O.RendererSystem};H.add($f);const no={build(e){const t=e.points;let i,s,r,n,o,a;if(e.type===zt.CIRC){const p=e.shape;i=p.x,s=p.y,o=a=p.radius,r=n=0}else if(e.type===zt.ELIP){const p=e.shape;i=p.x,s=p.y,o=p.width,a=p.height,r=n=0}else{const p=e.shape,m=p.width/2,_=p.height/2;i=p.x+m,s=p.y+_,o=a=Math.max(0,Math.min(p.radius,Math.min(m,_))),r=m-o,n=_-a}if(!(o>=0&&a>=0&&r>=0&&n>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(r?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=i+r,t[1]=t[3]=s+n,t[2]=t[4]=i-r,t[5]=t[7]=s-n;return}let c=0,u=h*4+(r?2:0)+2,d=u,f=l;{const p=r+o,m=n,_=i+p,y=i-p,b=s+m;if(t[c++]=_,t[c++]=b,t[--u]=b,t[--u]=y,n){const g=s-m;t[d++]=y,t[d++]=g,t[--f]=g,t[--f]=_}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),_=r+Math.cos(m)*o,y=n+Math.sin(m)*a,b=i+_,g=i-_,v=s+y,S=s-y;t[c++]=b,t[c++]=v,t[--u]=v,t[--u]=g,t[d++]=g,t[d++]=S,t[--f]=S,t[--f]=b}{const p=r,m=n+a,_=i+p,y=i-p,b=s+m,g=s-m;t[c++]=_,t[c++]=b,t[--f]=g,t[--f]=_,r&&(t[c++]=y,t[c++]=b,t[--f]=g,t[--f]=y)}},triangulate(e,t){const i=e.points,s=t.points,r=t.indices;if(i.length===0)return;let n=s.length/2;const o=n;let a,h;if(e.type!==zt.RREC){const c=e.shape;a=c.x,h=c.y}else{const c=e.shape;a=c.x+c.width/2,h=c.y+c.height/2}const l=e.matrix;s.push(e.matrix?l.a*a+l.c*h+l.tx:a,e.matrix?l.b*a+l.d*h+l.ty:h),n++,s.push(i[0],i[1]);for(let c=2;c<i.length;c+=2)s.push(i[c],i[c+1]),r.push(n++,o,n);r.push(o+1,o,n)}};function ou(e,t=!1){const i=e.length;if(i<6)return;let s=0;for(let r=0,n=e[i-2],o=e[i-1];r<i;r+=2){const a=e[r],h=e[r+1];s+=(a-n)*(h+o),n=a,o=h}if(!t&&s>0||t&&s<=0){const r=i/2;for(let n=r+r%2;n<i;n+=2){const o=i-n-2,a=i-n-1,h=n,l=n+1;[e[o],e[h]]=[e[h],e[o]],[e[a],e[l]]=[e[l],e[a]]}}}const Yf={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let i=e.points;const s=e.holes,r=t.points,n=t.indices;if(i.length>=6){ou(i,!1);const o=[];for(let l=0;l<s.length;l++){const c=s[l];ou(c.points,!0),o.push(i.length/2),i=i.concat(c.points)}const a=y_(i,o,2);if(!a)return;const h=r.length/2;for(let l=0;l<a.length;l+=3)n.push(a[l]+h),n.push(a[l+1]+h),n.push(a[l+2]+h);for(let l=0;l<i.length;l++)r.push(i[l])}}},sE={build(e){const t=e.shape,i=t.x,s=t.y,r=t.width,n=t.height,o=e.points;o.length=0,r>=0&&n>=0&&o.push(i,s,i+r,s,i+r,s+n,i,s+n)},triangulate(e,t){const i=e.points,s=t.points;if(i.length===0)return;const r=s.length/2;s.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},rE={build(e){no.build(e)},triangulate(e,t){no.triangulate(e,t)}};var fe=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(fe||{}),Di=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Di||{});const As={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let i=Math.ceil(e/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class au{static curveTo(t,i,s,r,n,o){const a=o[o.length-2],l=o[o.length-1]-i,c=a-t,u=r-i,d=s-t,f=Math.abs(l*d-c*u);if(f<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==i)&&o.push(t,i),null;const p=l*l+c*c,m=u*u+d*d,_=l*u+c*d,y=n*Math.sqrt(p)/f,b=n*Math.sqrt(m)/f,g=y*_/p,v=b*_/m,S=y*d+b*c,R=y*u+b*l,T=c*(b+g),x=l*(b+g),C=d*(y+v),P=u*(y+v),I=Math.atan2(x-R,T-S),D=Math.atan2(P-R,C-S);return{cx:S+t,cy:R+i,radius:n,startAngle:I,endAngle:D,anticlockwise:c*u>d*l}}static arc(t,i,s,r,n,o,a,h,l){const c=a-o,u=As._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/to)*40),d=c/(u*2),f=d*2,p=Math.cos(d),m=Math.sin(d),_=u-1,y=_%1/_;for(let b=0;b<=_;++b){const g=b+y*b,v=d+o+f*g,S=Math.cos(v),R=-Math.sin(v);l.push((p*S+m*R)*n+s,(p*-R+m*S)*n+r)}}}class nE{constructor(){this.reset()}begin(t,i,s){this.reset(),this.style=t,this.start=i,this.attribStart=s}end(t,i){this.attribSize=i-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class _l{static curveLength(t,i,s,r,n,o,a,h){let c=0,u=0,d=0,f=0,p=0,m=0,_=0,y=0,b=0,g=0,v=0,S=t,R=i;for(let T=1;T<=10;++T)u=T/10,d=u*u,f=d*u,p=1-u,m=p*p,_=m*p,y=_*t+3*m*u*s+3*p*d*n+f*a,b=_*i+3*m*u*r+3*p*d*o+f*h,g=S-y,v=R-b,S=y,R=b,c+=Math.sqrt(g*g+v*v);return c}static curveTo(t,i,s,r,n,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const c=As._segmentsCount(_l.curveLength(h,l,t,i,s,r,n,o));let u=0,d=0,f=0,p=0,m=0;a.push(h,l);for(let _=1,y=0;_<=c;++_)y=_/c,u=1-y,d=u*u,f=d*u,p=y*y,m=p*y,a.push(f*h+3*d*y*t+3*u*p*s+m*n,f*l+3*d*y*i+3*u*p*r+m*o)}}function hu(e,t,i,s,r,n,o,a){const h=e-i*r,l=t-s*r,c=e+i*n,u=t+s*n;let d,f;o?(d=s,f=-i):(d=-s,f=i);const p=h+d,m=l+f,_=c+d,y=u+f;return a.push(p,m,_,y),2}function Si(e,t,i,s,r,n,o,a){const h=i-e,l=s-t;let c=Math.atan2(h,l),u=Math.atan2(r-e,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),_=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/_;if(d+=y,a){o.push(e,t,i,s);for(let b=1,g=d;b<_;b++,g+=y)o.push(e,t,e+Math.sin(g)*m,t+Math.cos(g)*m);o.push(e,t,r,n)}else{o.push(i,s,e,t);for(let b=1,g=d;b<_;b++,g+=y)o.push(e+Math.sin(g)*m,t+Math.cos(g)*m,e,t);o.push(r,n,e,t)}return _*2}function oE(e,t){const i=e.shape;let s=e.points||i.points.slice();const r=t.closePointEps;if(s.length===0)return;const n=e.lineStyle,o=new st(s[0],s[1]),a=new st(s[s.length-2],s[s.length-1]),h=i.type!==zt.POLY||i.closeStroke,l=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(h){s=s.slice(),l&&(s.pop(),s.pop(),a.set(s[s.length-2],s[s.length-1]));const N=(o.x+a.x)*.5,nt=(a.y+o.y)*.5;s.unshift(N,nt),s.push(N,nt)}const c=t.points,u=s.length/2;let d=s.length;const f=c.length/2,p=n.width/2,m=p*p,_=n.miterLimit*n.miterLimit;let y=s[0],b=s[1],g=s[2],v=s[3],S=0,R=0,T=-(b-v),x=y-g,C=0,P=0,I=Math.sqrt(T*T+x*x);T/=I,x/=I,T*=p,x*=p;const D=n.alignment,E=(1-D)*2,w=D*2;h||(n.cap===Di.ROUND?d+=Si(y-T*(E-w)*.5,b-x*(E-w)*.5,y-T*E,b-x*E,y+T*w,b+x*w,c,!0)+2:n.cap===Di.SQUARE&&(d+=hu(y,b,T,x,E,w,!0,c))),c.push(y-T*E,b-x*E,y+T*w,b+x*w);for(let N=1;N<u-1;++N){y=s[(N-1)*2],b=s[(N-1)*2+1],g=s[N*2],v=s[N*2+1],S=s[(N+1)*2],R=s[(N+1)*2+1],T=-(b-v),x=y-g,I=Math.sqrt(T*T+x*x),T/=I,x/=I,T*=p,x*=p,C=-(v-R),P=g-S,I=Math.sqrt(C*C+P*P),C/=I,P/=I,C*=p,P*=p;const nt=g-y,pt=b-v,k=g-S,$=R-v,q=nt*k+pt*$,ot=pt*k-$*nt,it=ot<0;if(Math.abs(ot)<.001*Math.abs(q)){c.push(g-T*E,v-x*E,g+T*w,v+x*w),q>=0&&(n.join===fe.ROUND?d+=Si(g,v,g-T*E,v-x*E,g-C*E,v-P*E,c,!1)+4:d+=2,c.push(g-C*w,v-P*w,g+C*E,v+P*E));continue}const At=(-T+y)*(-x+v)-(-T+g)*(-x+b),gt=(-C+S)*(-P+v)-(-C+g)*(-P+R),Y=(nt*gt-k*At)/ot,lt=($*At-pt*gt)/ot,yt=(Y-g)*(Y-g)+(lt-v)*(lt-v),at=g+(Y-g)*E,K=v+(lt-v)*E,X=g-(Y-g)*w,_t=v-(lt-v)*w,St=Math.min(nt*nt+pt*pt,k*k+$*$),se=it?E:w,zs=St+se*se*m,Vm=yt<=zs;let zr=n.join;if(zr===fe.MITER&&yt/m>_&&(zr=fe.BEVEL),Vm)switch(zr){case fe.MITER:{c.push(at,K,X,_t);break}case fe.BEVEL:{it?c.push(at,K,g+T*w,v+x*w,at,K,g+C*w,v+P*w):c.push(g-T*E,v-x*E,X,_t,g-C*E,v-P*E,X,_t),d+=2;break}case fe.ROUND:{it?(c.push(at,K,g+T*w,v+x*w),d+=Si(g,v,g+T*w,v+x*w,g+C*w,v+P*w,c,!0)+4,c.push(at,K,g+C*w,v+P*w)):(c.push(g-T*E,v-x*E,X,_t),d+=Si(g,v,g-T*E,v-x*E,g-C*E,v-P*E,c,!1)+4,c.push(g-C*E,v-P*E,X,_t));break}}else{switch(c.push(g-T*E,v-x*E,g+T*w,v+x*w),zr){case fe.MITER:{it?c.push(X,_t,X,_t):c.push(at,K,at,K),d+=2;break}case fe.ROUND:{it?d+=Si(g,v,g+T*w,v+x*w,g+C*w,v+P*w,c,!0)+2:d+=Si(g,v,g-T*E,v-x*E,g-C*E,v-P*E,c,!1)+2;break}}c.push(g-C*E,v-P*E,g+C*w,v+P*w),d+=2}}y=s[(u-2)*2],b=s[(u-2)*2+1],g=s[(u-1)*2],v=s[(u-1)*2+1],T=-(b-v),x=y-g,I=Math.sqrt(T*T+x*x),T/=I,x/=I,T*=p,x*=p,c.push(g-T*E,v-x*E,g+T*w,v+x*w),h||(n.cap===Di.ROUND?d+=Si(g-T*(E-w)*.5,v-x*(E-w)*.5,g-T*E,v-x*E,g+T*w,v+x*w,c,!1)+2:n.cap===Di.SQUARE&&(d+=hu(g,v,T,x,E,w,!1,c)));const F=t.indices,G=As.epsilon*As.epsilon;for(let N=f;N<d+f-2;++N)y=c[N*2],b=c[N*2+1],g=c[(N+1)*2],v=c[(N+1)*2+1],S=c[(N+2)*2],R=c[(N+2)*2+1],!(Math.abs(y*(v-R)+g*(R-b)+S*(b-v))<G)&&F.push(N,N+1,N+2)}function aE(e,t){let i=0;const s=e.shape,r=e.points||s.points,n=s.type!==zt.POLY||s.closeStroke;if(r.length===0)return;const o=t.points,a=t.indices,h=r.length/2,l=o.length/2;let c=l;for(o.push(r[0],r[1]),i=1;i<h;i++)o.push(r[i*2],r[i*2+1]),a.push(c,c+1),c++;n&&a.push(c,l)}function lu(e,t){e.lineStyle.native?aE(e,t):oE(e,t)}class gl{static curveLength(t,i,s,r,n,o){const a=t-2*s+n,h=i-2*r+o,l=2*s-2*t,c=2*r-2*i,u=4*(a*a+h*h),d=4*(a*l+h*c),f=l*l+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),_=2*u*m,y=2*Math.sqrt(f),b=d/m;return(_*p+m*d*(p-y)+(4*f*u-d*d)*Math.log((2*m+b+p)/(b+y)))/(4*_)}static curveTo(t,i,s,r,n){const o=n[n.length-2],a=n[n.length-1],h=As._segmentsCount(gl.curveLength(o,a,t,i,s,r));let l=0,c=0;for(let u=1;u<=h;++u){const d=u/h;l=o+(t-o)*d,c=a+(i-a)*d,n.push(l+(t+(s-t)*d-l)*d,c+(i+(r-i)*d-c)*d)}}}const wa={[zt.POLY]:Yf,[zt.CIRC]:no,[zt.ELIP]:no,[zt.RECT]:sE,[zt.RREC]:rE},cu=[],un=[];class oo{constructor(t,i=null,s=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=i,this.matrix=r,this.type=t.type}clone(){return new oo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ji=new st,Wf=class extends tf{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new eo,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),un.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),cu.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,s=null){const r=new oo(e,t,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new oo(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const s=t[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,ji):ji.copyFrom(e),s.shape.contains(ji.x,ji.y))){let r=!1;if(s.holes){for(let n=0;n<s.holes.length;n++)if(s.holes[n].shape.contains(ji.x,ji.y)){r=!0;break}}if(!r)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const h=t[a],l=h.fillStyle,c=h.lineStyle;wa[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(l.visible||c.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?l:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,_=this.points.length/2;p.wrapMode=ui.REPEAT,d===0?this.processFill(h):this.processLine(h);const y=this.points.length/2-_;y!==0&&(i&&!this._compareStyles(s,f)&&(i.end(m,_),i=null),i||(i=cu.pop()||new nE,i.begin(f,m,_),this.batches.push(i),s=f),this.addUvs(this.points,e,f.texture,_,y,f.matrix))}}const r=this.indices.length,n=this.points.length/2;if(i&&i.end(r,n),this.batches.length===0){this.batchable=!0;return}const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],s=i.fillStyle,r=i.lineStyle;if(s&&!s.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const s=e[t];for(let r=0;r<s.size;r++){const n=s.start+r;this.indicesUint16[n]=this.indicesUint16[n]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Wf.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++V._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),un.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let s=un.pop();s||(s=new ih,s.texArray=new rh),s.texArray.count=0,s.start=0,s.size=0,s.type=De.TRIANGLES;let r=0,n=null,o=0,a=!1,h=De.TRIANGLES,l=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,h=a?De.LINES:De.TRIANGLES,n=null,r=d,e++),n!==p&&(n=p,p._batchEnabled!==e&&(r===d&&(e++,r=0,s.size>0&&(s=un.pop(),s||(s=new ih,s.texArray=new rh),this.drawCalls.push(s)),s.start=l,s.size=0,s.texArray.count=0,s.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=r,p.wrapMode=ui.REPEAT,s.texArray.elements[s.texArray.count++]=p,r++)),s.size+=u.size,l+=u.size,o=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(i,o,u.attribSize,u.attribStart)}V._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(e.length*3*4),n=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let h=0;h<e.length/2;h++)n[a++]=e[h*2],n[a++]=e[h*2+1],n[a++]=t[h*2],n[a++]=t[h*2+1],o[a++]=i[h],n[a++]=s[h];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Yf.triangulate(e,this):wa[e.type].triangulate(e,this)}processLine(e){lu(e,this);for(let t=0;t<e.holes.length;t++)lu(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];wa[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const s=e[i*2],r=e[i*2+1];e[i*2]=t.a*s+t.c*r+t.tx,e[i*2+1]=t.b*s+t.d*r+t.ty}}addColors(e,t,i,s,r=0){const n=ct.shared.setValue(t).toLittleEndianNumber(),o=ct.shared.setValue(n).toPremultiplied(i);e.length=Math.max(e.length,r+s);for(let a=0;a<s;a++)e[r+a]=o}addTextureIds(e,t,i,s=0){e.length=Math.max(e.length,s+i);for(let r=0;r<i;r++)e[s+r]=t}addUvs(e,t,i,s,r,n=null){let o=0;const a=t.length,h=i.frame;for(;o<r;){let c=e[(s+o)*2],u=e[(s+o)*2+1];if(n){const d=n.a*c+n.c*u+n.tx;u=n.b*c+n.d*u+n.ty,c=d}o++,t.push(c/h.width,u/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(t,i,a,r)}adjustUvs(e,t,i,s){const r=t.baseTexture,n=1e-6,o=i+s*2,a=t.frame,h=a.width/r.width,l=a.height/r.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(e[i]+n),f=Math.floor(e[i+1]+n);for(let p=i+2;p<o;p+=2)d=Math.min(d,Math.floor(e[p]+n)),f=Math.min(f,Math.floor(e[p+1]+n));c-=d,u-=f;for(let p=i;p<o;p+=2)e[p]=(e[p]+c)*h,e[p+1]=(e[p+1]+u)*l}};let Xf=Wf;Xf.BATCHABLE_SIZE=100;class Do{constructor(){this.color=16777215,this.alpha=1,this.texture=L.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Do;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=L.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class yl extends Do{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Di.BUTT,this.join=fe.MITER,this.miterLimit=10}clone(){const t=new yl;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Sa={},Nn=class extends Qt{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Do,this._lineStyle=new yl,this._matrix=null,this._holeMode=!1,this.state=Qe.for2d(),this._geometry=e||new Xf,this._geometry.refCount++,this._transformID=-1,this._tintColor=new ct(16777215),this.blendMode=W.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Nn(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,s=.5,r=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:s,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:L.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Di.BUTT,join:fe.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new ps,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new ps,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return(s!==e||r!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._initCurve();const r=this.currentPath.points;return r.length===0&&this.moveTo(0,0),gl.curveTo(e,t,i,s,r),this}bezierCurveTo(e,t,i,s,r,n){return this._initCurve(),_l.curveTo(e,t,i,s,r,n,this.currentPath.points),this}arcTo(e,t,i,s,r){this._initCurve(e,t);const n=this.currentPath.points,o=au.curveTo(e,t,i,s,r,n);if(o){const{cx:a,cy:h,radius:l,startAngle:c,endAngle:u,anticlockwise:d}=o;this.arc(a,h,l,c,u,d)}return this}arc(e,t,i,s,r,n=!1){if(s===r)return this;if(!n&&r<=s?r+=to:n&&s<=r&&(s+=to),r-s===0)return this;const a=e+Math.cos(s)*i,h=t+Math.sin(s)*i,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(a,h)}else this.moveTo(a,h),c=this.currentPath.points;return au.arc(a,h,e,t,i,s,r,n,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:L.WHITE,color:e,alpha:t})}normalizeColor(e){const t=ct.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:L.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,s){return this.drawShape(new j(e,t,i,s))}drawRoundedRect(e,t,i,s,r){return this.drawShape(new dl(e,t,i,s,r))}drawCircle(e,t,i){return this.drawShape(new cl(e,t,i))}drawEllipse(e,t,i,s){return this.drawShape(new ul(e,t,i,s))}drawPolygon(...e){let t,i=!0;const s=e[0];s.points?(i=s.closeStroke,t=s.points):Array.isArray(e[0])?t=e[0]:t=e;const r=new ps(t);return r.closeStroke=i,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===zt.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let s=0;s<i;s++){const r=e.batches[s],n=r.style.color,o=new Float32Array(this.vertexData.buffer,r.attribStart*4*2,r.attribSize*2),a=new Float32Array(e.uvsFloat32.buffer,r.attribStart*4*2,r.attribSize*2),h=new Uint16Array(e.indicesUint16.buffer,r.start*2,r.size),l={vertexData:o,blendMode:t,indices:h,uvs:a,_batchRGB:ct.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[s]=l}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,s=this.worldAlpha,r=t.uniforms,n=i.drawCalls;r.translationMatrix=this.transform.worldTransform,ct.shared.setValue(this._tintColor).premultiply(s).toArray(r.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let o=0,a=n.length;o<a;o++)this._renderDrawCallDirect(e,i.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:i,type:s,size:r,start:n}=t,o=i.count;for(let a=0;a<o;a++)e.texture.bind(i.elements[a],a);e.geometry.draw(s,r,n)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!Sa[i]){const{maxTextures:s}=e.plugins[i],r=new Int32Array(s);for(let a=0;a<s;a++)r[a]=a;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new bt,default:Ee.from({uSamplers:r},!0)},o=e.plugins[i]._shader.program;Sa[i]=new Ne(o,n)}t=Sa[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:s,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,i,s,r)}containsPoint(e){return this.worldTransform.applyInverse(e,Nn._TEMP_POINT),this._geometry.containsPoint(Nn._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=ct.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const d=h[u],f=h[u+1];l[c++]=i*d+r*f+o,l[c++]=n*f+s*d+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Or=Nn;Or.curves=As;Or._TEMP_POINT=new st;class hE{constructor(t,i){this.uvBuffer=t,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}}const Ta=new st,uu=new ps,Vf=class extends Qt{constructor(e,t,i,s=De.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||Qe.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=B.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===De.TRIANGLES&&t.length<Vf.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],i=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==i.length&&(this.vertexData=new Float32Array(i.length));const r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,h=r.d,l=r.tx,c=r.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=i[d*2],p=i[d*2+1];u[d*2]=n*f+a*p+l,u[d*2+1]=o*f+h*p+c}if(this._roundPixels){const d=B.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=s}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new hE(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Ta);const t=this.geometry.getBuffer("aVertexPosition").data,i=uu.points,s=this.geometry.getIndex().data,r=s.length,n=this.drawMode===4?3:1;for(let o=0;o+2<r;o+=n){const a=s[o]*2,h=s[o+1]*2,l=s[o+2]*2;if(i[0]=t[a],i[1]=t[a+1],i[2]=t[h],i[3]=t[h+1],i[4]=t[l],i[5]=t[l+1],uu.contains(Ta.x,Ta.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let _h=Vf;_h.BATCHABLE_SIZE=100;class lE extends pi{constructor(t,i,s){super();const r=new Rt(t),n=new Rt(i,!0),o=new Rt(s,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,z.FLOAT).addAttribute("aTextureCoord",n,2,!1,z.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var cE=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,uE=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class du extends Ne{constructor(t,i){const s={uSampler:t,alpha:1,uTextureMatrix:bt.IDENTITY,uColor:new Float32Array([1,1,1,1])};i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i),i.uniforms&&Object.assign(s,i.uniforms),super(i.program||ye.from(uE,cE),s),this._colorDirty=!1,this.uvMatrix=new gf(t),this.batchable=i.program===void 0,this.pluginName=i.pluginName,this._tintColor=new ct(i.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=i.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const i=this.texture.baseTexture.alphaMode;ct.shared.setValue(this._tintColor).premultiply(this._alpha,i).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class fu{constructor(t,i,s){this.geometry=new pi,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||z.FLOAT,offset:n.offset},i[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let i=0;this.indexBuffer=new Rt(Xy(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=i,i+=a.size,this.dynamicStride+=a.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new Rt(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=r,r+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Rt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===z.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===z.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,i,s){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(t,i,s,n.type===z.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,i,s){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(t,i,s,n.type===z.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var dE=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,fE=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class jf extends So{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new bt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:z.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ne.from(fE,dE,{}),this.state=Qe.for2d()}render(t){const i=t.children,s=t._maxSize,r=t._batchSize,n=this.renderer;let o=i.length;if(o===0)return;o>s&&!t.autoResize&&(o=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=i[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=Kd(t.blendMode,l),n.state.set(this.state);const c=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=ct.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=r,p+=1){let m=o-f;m>r&&(m=r),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const _=a[p];_.uploadDynamic(i,f,m);const y=t._bufferUpdateIDs[p]||0;d=d||_._updateID<y,d&&(_._updateID=t._updateID,_.uploadStatic(i,f,m)),n.geometry.bind(_.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const i=[],s=t._maxSize,r=t._batchSize,n=t._properties;for(let o=0;o<s;o+=r)i.push(new fu(this.properties,n,r));return i}_generateOneMoreBuffer(t){const i=t._batchSize,s=t._properties;return new fu(this.properties,s,i)}uploadVertices(t,i,s,r,n,o){let a=0,h=0,l=0,c=0;for(let u=0;u<s;++u){const d=t[i+u],f=d._texture,p=d.scale.x,m=d.scale.y,_=f.trim,y=f.orig;_?(h=_.x-d.anchor.x*y.width,a=h+_.width,c=_.y-d.anchor.y*y.height,l=c+_.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),c=y.height*-d.anchor.y),r[o]=h*p,r[o+1]=c*m,r[o+n]=a*p,r[o+n+1]=c*m,r[o+n*2]=a*p,r[o+n*2+1]=l*m,r[o+n*3]=h*p,r[o+n*3+1]=l*m,o+=n*4}}uploadPosition(t,i,s,r,n,o){for(let a=0;a<s;a++){const h=t[i+a].position;r[o]=h.x,r[o+1]=h.y,r[o+n]=h.x,r[o+n+1]=h.y,r[o+n*2]=h.x,r[o+n*2+1]=h.y,r[o+n*3]=h.x,r[o+n*3+1]=h.y,o+=n*4}}uploadRotation(t,i,s,r,n,o){for(let a=0;a<s;a++){const h=t[i+a].rotation;r[o]=h,r[o+n]=h,r[o+n*2]=h,r[o+n*3]=h,o+=n*4}}uploadUvs(t,i,s,r,n,o){for(let a=0;a<s;++a){const h=t[i+a]._texture._uvs;h?(r[o]=h.x0,r[o+1]=h.y0,r[o+n]=h.x1,r[o+n+1]=h.y1,r[o+n*2]=h.x2,r[o+n*2+1]=h.y2,r[o+n*3]=h.x3,r[o+n*3+1]=h.y3,o+=n*4):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+n*2]=0,r[o+n*2+1]=0,r[o+n*3]=0,r[o+n*3+1]=0,o+=n*4)}}uploadTint(t,i,s,r,n,o){for(let a=0;a<s;++a){const h=t[i+a],l=ct.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);r[o]=l,r[o+n]=l,r[o+n*2]=l,r[o+n*3]=l,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}jf.extension={name:"particle",type:O.RendererPlugin};H.add(jf);var Po=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Po||{});const dn={willReadFrequently:!0},U=class{static get experimentalLetterSpacingSupported(){let e=U._experimentalLetterSpacingSupported;if(e!==void 0){const t=B.ADAPTER.getCanvasRenderingContext2D().prototype;e=U._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,s,r,n,o,a,h){this.text=e,this.style=t,this.width=i,this.height=s,this.lines=r,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(e,t,i,s=U._canvas){i=i??t.wordWrap;const r=t.toFontString(),n=U.measureFont(r);n.fontSize===0&&(n.fontSize=t.fontSize,n.ascent=t.fontSize);const o=s.getContext("2d",dn);o.font=r;const h=(i?U.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let p=0;p<h.length;p++){const m=U._measureText(h[p],t.letterSpacing,o);l[p]=m,c=Math.max(c,m)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||n.fontSize+t.strokeThickness;let f=Math.max(d,n.fontSize+t.strokeThickness*2)+(h.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new U(e,t,u,f,h,l,d+t.leading,c,n)}static _measureText(e,t,i){let s=!1;U.experimentalLetterSpacingSupported&&(U.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let r=i.measureText(e).width;return r>0&&(s?r-=t:r+=(U.graphemeSegmenter(e).length-1)*t),r}static wordWrap(e,t,i=U._canvas){const s=i.getContext("2d",dn);let r=0,n="",o="";const a=Object.create(null),{letterSpacing:h,whiteSpace:l}=t,c=U.collapseSpaces(l),u=U.collapseNewlines(l);let d=!c;const f=t.wordWrapWidth+h,p=U.tokenize(e);for(let m=0;m<p.length;m++){let _=p[m];if(U.isNewline(_)){if(!u){o+=U.addLine(n),d=!c,n="",r=0;continue}_=" "}if(c){const b=U.isBreakingSpace(_),g=U.isBreakingSpace(n[n.length-1]);if(b&&g)continue}const y=U.getFromCache(_,h,a,s);if(y>f)if(n!==""&&(o+=U.addLine(n),n="",r=0),U.canBreakWords(_,t.breakWords)){const b=U.wordWrapSplit(_);for(let g=0;g<b.length;g++){let v=b[g],S=v,R=1;for(;b[g+R];){const x=b[g+R];if(!U.canBreakChars(S,x,_,g,t.breakWords))v+=x;else break;S=x,R++}g+=R-1;const T=U.getFromCache(v,h,a,s);T+r>f&&(o+=U.addLine(n),d=!1,n="",r=0),n+=v,r+=T}}else{n.length>0&&(o+=U.addLine(n),n="",r=0);const b=m===p.length-1;o+=U.addLine(_,!b),d=!1,n="",r=0}else y+r>f&&(d=!1,o+=U.addLine(n),n="",r=0),(n.length>0||!U.isBreakingSpace(_)||d)&&(n+=_,r+=y)}return o+=U.addLine(n,!1),o}static addLine(e,t=!0){return e=U.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,s){let r=i[e];return typeof r!="number"&&(r=U._measureText(e,t,s)+t,i[e]=r),r}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!U.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:U._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:U._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){const r=e[s],n=e[s+1];if(U.isBreakingSpace(r,n)||U.isNewline(r)){i!==""&&(t.push(i),i=""),t.push(r);continue}i+=r}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,s,r){return!0}static wordWrapSplit(e){return U.graphemeSegmenter(e)}static measureFont(e){if(U._fonts[e])return U._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=U._canvas,s=U._context;s.font=e;const r=U.METRICS_STRING+U.BASELINE_SYMBOL,n=Math.ceil(s.measureText(r).width);let o=Math.ceil(s.measureText(U.BASELINE_SYMBOL).width);const a=Math.ceil(U.HEIGHT_MULTIPLIER*o);if(o=o*U.BASELINE_MULTIPLIER|0,n===0||a===0)return U._fonts[e]=t,t;i.width=n,i.height=a,s.fillStyle="#f00",s.fillRect(0,0,n,a),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,o);const h=s.getImageData(0,0,n,a).data,l=h.length,c=n*4;let u=0,d=0,f=!1;for(u=0;u<o;++u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d+=c;else break}for(t.ascent=o-u,d=l-c,f=!1,u=a;u>o;--u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d-=c;else break}return t.descent=u-o,t.fontSize=t.ascent+t.descent,U._fonts[e]=t,t}static clearMetrics(e=""){e?delete U._fonts[e]:U._fonts={}}static get _canvas(){if(!U.__canvas){let e;try{const t=new OffscreenCanvas(0,0),i=t.getContext("2d",dn);if(i!=null&&i.measureText)return U.__canvas=t,t;e=B.ADAPTER.createCanvas()}catch{e=B.ADAPTER.createCanvas()}e.width=e.height=10,U.__canvas=e}return U.__canvas}static get _context(){return U.__context||(U.__context=U._canvas.getContext("2d",dn)),U.__context}};let Ht=U;Ht.METRICS_STRING="|ÉqÅ";Ht.BASELINE_SYMBOL="M";Ht.BASELINE_MULTIPLIER=1.4;Ht.HEIGHT_MULTIPLIER=2;Ht.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(i=>i.segment)}return e=>[...e]})();Ht.experimentalLetterSpacing=!1;Ht._fonts={};Ht._newlines=[10,13];Ht._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const pE=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],tr=class{constructor(e){this.styleID=0,this.reset(),Ra(this,e,e)}clone(){const e={};return Ra(e,this,tr.defaultStyle),new tr(e)}reset(){Ra(this,tr.defaultStyle,tr.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Aa(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Aa(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){mE(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Aa(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let s=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!pE.includes(s)&&(s=`"${s}"`),t[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let Ke=tr;Ke.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Po.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Aa(e){const t=ct.shared;return Array.isArray(e)?e.map(i=>t.setValue(i).toHex()):t.setValue(e).toHex()}function mE(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function Ra(e,t,i){for(const s in i)Array.isArray(t[s])?e[s]=t[s].slice():e[s]=t[s]}const _E={texture:!0,children:!1,baseTexture:!0},gh=class extends xi{constructor(e,t,i){let s=!1;i||(i=B.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const r=L.from(i);r.orig=new j,r.trim=new j,super(r),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=gh.defaultResolution??B.RESOLUTION,this._autoResolution=gh.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ht.experimentalLetterSpacing}static set experimentalLetterSpacing(e){J("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ht.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,s=Ht.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,n=s.height,o=s.lines,a=s.lineHeight,h=s.lineWidths,l=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let u,d;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const m=t.dropShadow&&p===0,_=m?Math.ceil(Math.max(1,n)+t.padding*2):0,y=_*this._resolution;if(m){i.fillStyle="black",i.strokeStyle="black";const g=t.dropShadowColor,v=t.dropShadowBlur*this._resolution,S=t.dropShadowDistance*this._resolution;i.shadowColor=ct.shared.setValue(g).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=v,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*S,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*S+y}else i.fillStyle=this._generateFillStyle(t,o,s),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let b=(a-c.fontSize)/2;a-c.fontSize<0&&(b=0);for(let g=0;g<o.length;g++)u=t.strokeThickness/2,d=t.strokeThickness/2+g*a+c.ascent+b,t.align==="right"?u+=l-h[g]:t.align==="center"&&(u+=(l-h[g])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[g],u+t.padding,d+t.padding-_,!0),t.fill&&this.drawLetterSpacing(o[g],u+t.padding,d+t.padding-_)}this.updateTexture()}drawLetterSpacing(e,t,i,s=!1){const n=this._style.letterSpacing;let o=!1;if(Ht.experimentalLetterSpacingSupported&&(Ht.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let a=t;const h=Ht.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let u=0;u<h.length;++u){const d=h[u];s?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let f="";for(let p=u+1;p<h.length;++p)f+=h[p];c=this.context.measureText(f).width,a+=l-c+n,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const n=Ky(e);n.data&&(e.width=n.width,e.height=n.height,this.context.putImageData(n.data,0,0))}const t=this._texture,i=this._style,s=i.trim?0:i.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let r;const n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-n-o*2,h=this.canvas.height/this._resolution-n-o*2,l=s.slice(),c=e.fillGradientStops.slice();if(!c.length){const u=l.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(l.unshift(s[0]),c.unshift(0),l.push(s[s.length-1]),c.push(1),e.fillGradientType===Po.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,h+o);const u=i.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const f=i.lineHeight*(d-1)+u,p=i.lineHeight*d;let m=p;d>0&&f>p&&(m=(p+f)/2);const _=p+u,y=i.lineHeight*(d+1);let b=_;d+1<t.length&&y<_&&(b=(_+y)/2);const g=(b-m)/h;for(let v=0;v<l.length;v++){let S=0;typeof c[v]=="number"?S=c[v]:S=v/l.length;let R=Math.min(1,Math.max(0,m/h+S*g));R=Number(R.toFixed(5)),r.addColorStop(R,l[v])}}}else{r=this.context.createLinearGradient(o,h/2,a+o,h/2);const u=l.length+1;let d=1;for(let f=0;f<l.length;f++){let p;typeof c[f]=="number"?p=c[f]:p=d/u,r.addColorStop(p,l[f]),d++}}return r}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},_E,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=oi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=oi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Ke?this._style=e:this._style=new Ke(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let vl=gh;vl.defaultAutoResolution=!0;class gE{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function yE(e,t){var s;let i=!1;if((s=e==null?void 0:e._textures)!=null&&s.length){for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof L){const n=e._textures[r].baseTexture;t.includes(n)||(t.push(n),i=!0)}}return i}function vE(e,t){if(e.baseTexture instanceof V){const i=e.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function bE(e,t){if(e._texture&&e._texture instanceof L){const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function EE(e,t){return t instanceof vl?(t.updateText(!0),!0):!1}function xE(e,t){if(t instanceof Ke){const i=t.toFontString();return Ht.measureFont(i),!0}return!1}function wE(e,t){if(e instanceof vl){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function SE(e,t){return e instanceof Ke?(t.includes(e)||t.push(e),!0):!1}const qf=class{constructor(e){this.limiter=new gE(qf.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(wE),this.registerFindHook(SE),this.registerFindHook(yE),this.registerFindHook(vE),this.registerFindHook(bE),this.registerUploadHook(EE),this.registerUploadHook(xE)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,kt.system.addOnce(this.tick,this,_i.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)kt.system.addOnce(this.tick,this,_i.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Qt)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&kt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let ao=qf;ao.uploadsPerFrame=4;Object.defineProperties(B,{UPLOADS_PER_FRAME:{get(){return ao.uploadsPerFrame},set(e){J("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ao.uploadsPerFrame=e}}});function Kf(e,t){return t instanceof V?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function TE(e,t){if(!(t instanceof Or))return!1;const{geometry:i}=t;t.finishPoly(),i.updateBatches();const{batches:s}=i;for(let r=0;r<s.length;r++){const{texture:n}=s[r].style;n&&Kf(e,n.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function AE(e,t){return e instanceof Or?(t.push(e),!0):!1}class Zf extends ao{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(AE),this.registerUploadHook(Kf),this.registerUploadHook(TE)}}Zf.extension={name:"prepare",type:O.RendererSystem};H.add(Zf);class ho extends xi{constructor(t,i=!0){super(t[0]instanceof L?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=i,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(kt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(kt.shared.add(this.update,this,_i.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const i=this.animationSpeed*t,s=this.currentFrame;if(this._durations!==null){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=i/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=i;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const i=[];for(let s=0;s<t.length;++s)i.push(L.from(t[s]));return new ho(i)}static fromImages(t){const i=[];for(let s=0;s<t.length;++s)i.push(L.from(t[s]));return new ho(i)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof L)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let i=0;i<t.length;i++)this._textures.push(t[i].texture),this._durations.push(t[i].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const i=this.currentFrame;this._currentTime=t,i!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(kt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(kt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}var RE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,IE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,CE=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,pu=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,kE=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const fn=new bt;class Jf extends So{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new ff,this.state=Qe.for2d()}contextChange(){const t=this.renderer,i={globals:t.globalUniforms};this.simpleShader=Ne.from(pu,kE,i),this.shader=t.context.webGLVersion>1?Ne.from(IE,RE,i):Ne.from(pu,CE,i)}render(t){const i=this.renderer,s=this.quad;let r=s.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;r=s.uvs,r[0]=r[6]=-n,r[1]=r[3]=-o,r[2]=r[4]=1-n,r[5]=r[7]=1-o,s.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[i.CONTEXT_UID]?d=h.wrapMode!==ui.CLAMP:h.wrapMode===ui.CLAMP&&(h.wrapMode=ui.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,_=t._width,y=t._height;fn.set(c.a*p/_,c.b*p/y,c.c*m/_,c.d*m/y,c.tx/_,c.ty/y),fn.invert(),d?fn.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=fn.toArray(!0),f.uniforms.uColor=ct.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,i.shader.bind(f),i.geometry.bind(s),this.state.blendMode=Kd(t.blendMode,l),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Jf.extension={name:"tilingSprite",type:O.RendererPlugin};H.add(Jf);const er=class{constructor(e,t,i=null){this.linkedSheets=[],this._texture=e instanceof L?e:null,this.baseTexture=e instanceof V?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=fi(e,null);return i===null&&(i=parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=er.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=er.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const s=this._frameKeys[t],r=this._frames[s],n=r.frame;if(n){let o=null,a=null;const h=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,l=new j(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);r.rotated?o=new j(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):o=new j(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(a=new j(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new L(this.baseTexture,o,l,a,r.rotated?2:0,r.anchor,r.borders),L.addToCache(this.textures[s],s)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const s=e[t][i];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*er.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*er.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let yh=er;yh.BATCH_SIZE=1e3;const DE=["jpg","png","jpeg","avif","webp"];function Qf(e,t,i){const s={};if(e.forEach(r=>{s[r]=t}),Object.keys(t.textures).forEach(r=>{s[r]=t.textures[r]}),!i){const r=Vt.dirname(e[0]);t.linkedSheets.forEach((n,o)=>{const a=Qf([`${r}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(s,a)})}return s}const PE={extension:O.Asset,cache:{test:e=>e instanceof yh,getCacheableAssets:(e,t)=>Qf(e,t,!1)},resolver:{test:e=>{const i=e.split("?")[0].split("."),s=i.pop(),r=i.pop();return s==="json"&&DE.includes(r)},parse:e=>{var i;const t=e.split(".");return{resolution:parseFloat(((i=B.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:O.LoadParser,priority:Fe.Normal},async testParse(e,t){return Vt.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,i){var l,c;let s=Vt.dirname(t.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let r=s+e.meta.image;r=ph(r,t.src);const o=(await i.load([r]))[r],a=new yh(o.baseTexture,e,t.src);await a.parse();const h=(l=e==null?void 0:e.meta)==null?void 0:l.related_multi_packs;if(Array.isArray(h)){const u=[];for(const f of h){if(typeof f!="string")continue;let p=s+f;(c=t.data)!=null&&c.ignoreMultiPack||(p=ph(p,t.src),u.push(i.load({src:p,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);a.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[a].concat(a.linkedSheets.filter(p=>p!==f))})}return a},unload(e){e.destroy(!0)}}};H.add(PE);class lo{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Bn{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const i=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in i){const o=i[n].match(/^[a-z]+/gm)[0],a=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const c=a[l].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[u]=p}s[o].push(h)}const r=new lo;return s.info.forEach(n=>r.info.push({face:n.face,size:parseInt(n.size,10)})),s.common.forEach(n=>r.common.push({lineHeight:parseInt(n.lineHeight,10)})),s.page.forEach(n=>r.page.push({id:parseInt(n.id,10),file:n.file})),s.char.forEach(n=>r.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),s.kerning.forEach(n=>r.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),s.distanceField.forEach(n=>r.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),r}}class vh{static test(t){const i=t;return"getElementsByTagName"in i&&i.getElementsByTagName("page").length&&i.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const i=new lo,s=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<s.length;l++)i.info.push({face:s[l].getAttribute("face"),size:parseInt(s[l].getAttribute("size"),10)});for(let l=0;l<r.length;l++)i.common.push({lineHeight:parseInt(r[l].getAttribute("lineHeight"),10)});for(let l=0;l<n.length;l++)i.page.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});for(let l=0;l<o.length;l++){const c=o[l];i.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)i.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)i.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return i}}class bh{static test(t){return typeof t=="string"&&t.includes("<font>")?vh.test(B.ADAPTER.parseXML(t)):!1}static parse(t){return vh.parse(B.ADAPTER.parseXML(t))}}const Ia=[Bn,vh,bh];function ME(e){for(let t=0;t<Ia.length;t++)if(Ia[t].test(e))return Ia[t];return null}function NE(e,t,i,s,r,n){const o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=e.width/s-h-l*2,u=e.height/s-h-l*2,d=o.slice(),f=i.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),i.fillGradientType===Po.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,l,c/2,u+l);let p=0;const _=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let y=0;y<r.length;y++){const b=n.lineHeight*y;for(let g=0;g<d.length;g++){let v=0;typeof f[g]=="number"?v=f[g]:v=g/d.length;const S=b/u+v*_;let R=Math.max(p,S);R=Math.min(R,1),a.addColorStop(R,d[g]),p=R}}}else{a=t.createLinearGradient(l,u/2,c+l,u/2);const p=d.length+1;let m=1;for(let _=0;_<d.length;_++){let y;typeof f[_]=="number"?y=f[_]:y=m/p,a.addColorStop(y,d[_]),m++}}return a}function BE(e,t,i,s,r,n,o){const a=i.text,h=i.fontProperties;t.translate(s,r),t.scale(n,n);const l=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=NE(e,t,o,n,[a],i),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=o.dropShadowBlur*n,f=o.dropShadowDistance*n;t.shadowColor=ct.shared.setValue(u).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,c+i.lineHeight-h.descent),o.fill&&t.fillText(a,l,c+i.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function On(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function tp(e){return Array.from?Array.from(e):e.split("")}function OE(e){typeof e=="string"&&(e=[e]);const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...tp(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const de=class{constructor(e,t,i){var l;const[s]=e.info,[r]=e.common,[n]=e.page,[o]=e.distanceField,a=fi(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=r.lineHeight/a,this.chars={},this.pageTextures=h;for(let c=0;c<e.page.length;c++){const{id:u,file:d}=e.page[c];h[u]=t instanceof Array?t[c]:t[d],o!=null&&o.fieldType&&o.fieldType!=="none"&&(h[u].baseTexture.alphaMode=we.NO_PREMULTIPLIED_ALPHA,h[u].baseTexture.mipmap=Oe.OFF)}for(let c=0;c<e.char.length;c++){const{id:u,page:d}=e.char[c];let{x:f,y:p,width:m,height:_,xoffset:y,yoffset:b,xadvance:g}=e.char[c];f/=a,p/=a,m/=a,_/=a,y/=a,b/=a,g/=a;const v=new j(f+h[d].frame.x/a,p+h[d].frame.y/a,m,_);this.chars[u]={xOffset:y,yOffset:b,xAdvance:g,kerning:{},texture:new L(h[d].baseTexture,v),page:d}}for(let c=0;c<e.kerning.length;c++){let{first:u,second:d,amount:f}=e.kerning[c];u/=a,d/=a,f/=a,this.chars[d]&&(this.chars[d].kerning[u]=f)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=((l=o==null?void 0:o.fieldType)==null?void 0:l.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let s;if(e instanceof lo)s=e;else{const n=ME(e);if(!n)throw new Error("Unrecognized data format for font.");s=n.parse(e)}t instanceof L&&(t=[t]);const r=new de(s,t,i);return de.available[r.font]=r,r}static uninstall(e){const t=de.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete de.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:r,resolution:n,textureWidth:o,textureHeight:a,...h}=Object.assign({},de.defaultOptions,i),l=OE(s),c=t instanceof Ke?t:new Ke(t),u=o,d=new lo;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f=0,p=0,m,_,y,b=0;const g=[];for(let S=0;S<l.length;S++){m||(m=B.ADAPTER.createCanvas(),m.width=o,m.height=a,_=m.getContext("2d"),y=new V(m,{resolution:n,...h}),g.push(new L(y)),d.page.push({id:g.length-1,file:""}));const R=l[S],T=Ht.measureText(R,c,!1,m),x=T.width,C=Math.ceil(T.height),P=Math.ceil((c.fontStyle==="italic"?2:1)*x);if(p>=a-C*n){if(p===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--S,m=null,_=null,y=null,p=0,f=0,b=0;continue}if(b=Math.max(C+T.fontProperties.descent,b),P*n+f>=u){if(f===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--S,p+=b*n,p=Math.ceil(p),f=0,b=0;continue}BE(m,_,T,f,p,n,c);const I=On(T.text);d.char.push({id:I,page:g.length-1,x:f/n,y:p/n,width:P,height:C,xoffset:0,yoffset:0,xadvance:x-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(P+2*r)*n,f=Math.ceil(f)}for(let S=0,R=l.length;S<R;S++){const T=l[S];for(let x=0;x<R;x++){const C=l[x],P=_.measureText(T).width,I=_.measureText(C).width,E=_.measureText(T+C).width-(P+I);E&&d.kerning.push({first:On(T),second:On(C),amount:E})}}const v=new de(d,g,!0);return de.available[e]!==void 0&&de.uninstall(e),de.available[e]=v,v}};let Zt=de;Zt.ALPHA=[["a","z"],["A","Z"]," "];Zt.NUMERIC=[["0","9"]];Zt.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Zt.ASCII=[[" ","~"]];Zt.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:de.ALPHANUMERIC};Zt.available={};var LE=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,FE=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const mu=[],_u=[],gu=[],ep=class extends Qt{constructor(e,t={}){super();const{align:i,tint:s,maxWidth:r,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},ep.styleDefaults,t);if(!Zt.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new ct(s),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=e,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new ai(()=>{this.dirty=!0},this,0,0),this._roundPixels=B.ROUND_PIXELS,this.dirty=!0,this._resolution=B.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var P;const e=Zt.available[this._fontName],t=this.fontSize,i=t/e.size,s=new st,r=[],n=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=tp(a),l=this._maxWidth*e.size/t,c=e.distanceFieldType==="none"?mu:_u;let u=null,d=0,f=0,p=0,m=-1,_=0,y=0,b=0,g=0;for(let I=0;I<h.length;I++){const D=h[I],E=On(D);if(/(?:\s)/.test(D)&&(m=I,_=d,g++),D==="\r"||D===`
`){n.push(d),o.push(-1),f=Math.max(f,d),++p,++y,s.x=0,s.y+=e.lineHeight,u=null,g=0;continue}const w=e.chars[E];if(!w)continue;u&&w.kerning[u]&&(s.x+=w.kerning[u]);const F=gu.pop()||{texture:L.EMPTY,line:0,charCode:0,prevSpaces:0,position:new st};F.texture=w.texture,F.line=p,F.charCode=E,F.position.x=Math.round(s.x+w.xOffset+this._letterSpacing/2),F.position.y=Math.round(s.y+w.yOffset),F.prevSpaces=g,r.push(F),d=F.position.x+Math.max(w.xAdvance-w.xOffset,w.texture.orig.width),s.x+=w.xAdvance+this._letterSpacing,b=Math.max(b,w.yOffset+w.texture.height),u=E,m!==-1&&l>0&&s.x>l&&(++y,fs(r,1+m-y,1+I-m),I=m,m=-1,n.push(_),o.push(r.length>0?r[r.length-1].prevSpaces:0),f=Math.max(f,_),p++,s.x=0,s.y+=e.lineHeight,u=null,g=0)}const v=h[h.length-1];v!=="\r"&&v!==`
`&&(/(?:\s)/.test(v)&&(d=_),n.push(d),f=Math.max(f,d),o.push(-1));const S=[];for(let I=0;I<=p;I++){let D=0;this._align==="right"?D=f-n[I]:this._align==="center"?D=(f-n[I])/2:this._align==="justify"&&(D=o[I]<0?0:(f-n[I])/o[I]),S.push(D)}const R=r.length,T={},x=[],C=this._activePagesMeshData;c.push(...C);for(let I=0;I<R;I++){const D=r[I].texture,E=D.baseTexture.uid;if(!T[E]){let w=c.pop();if(!w){const G=new lE;let N,nt;e.distanceFieldType==="none"?(N=new du(L.EMPTY),nt=W.NORMAL):(N=new du(L.EMPTY,{program:ye.from(FE,LE),uniforms:{uFWidth:0}}),nt=W.NORMAL_NPM);const pt=new _h(G,N);pt.blendMode=nt,w={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:pt,vertices:null,uvs:null,indices:null}}w.index=0,w.indexCount=0,w.vertexCount=0,w.uvsCount=0,w.total=0;const{_textureCache:F}=this;F[E]=F[E]||new L(D.baseTexture),w.mesh.texture=F[E],w.mesh.tint=this._tintColor.value,x.push(w),T[E]=w}T[E].total++}for(let I=0;I<C.length;I++)x.includes(C[I])||this.removeChild(C[I].mesh);for(let I=0;I<x.length;I++)x[I].mesh.parent!==this&&this.addChild(x[I].mesh);this._activePagesMeshData=x;for(const I in T){const D=T[I],E=D.total;if(!(((P=D.indices)==null?void 0:P.length)>6*E)||D.vertices.length<_h.BATCHABLE_SIZE*2)D.vertices=new Float32Array(4*2*E),D.uvs=new Float32Array(4*2*E),D.indices=new Uint16Array(6*E);else{const w=D.total,F=D.vertices;for(let G=w*4*2;G<F.length;G++)F[G]=0}D.mesh.size=6*E}for(let I=0;I<R;I++){const D=r[I];let E=D.position.x+S[D.line]*(this._align==="justify"?D.prevSpaces:1);this._roundPixels&&(E=Math.round(E));const w=E*i,F=D.position.y*i,G=D.texture,N=T[G.baseTexture.uid],nt=G.frame,pt=G._uvs,k=N.index++;N.indices[k*6+0]=0+k*4,N.indices[k*6+1]=1+k*4,N.indices[k*6+2]=2+k*4,N.indices[k*6+3]=0+k*4,N.indices[k*6+4]=2+k*4,N.indices[k*6+5]=3+k*4,N.vertices[k*8+0]=w,N.vertices[k*8+1]=F,N.vertices[k*8+2]=w+nt.width*i,N.vertices[k*8+3]=F,N.vertices[k*8+4]=w+nt.width*i,N.vertices[k*8+5]=F+nt.height*i,N.vertices[k*8+6]=w,N.vertices[k*8+7]=F+nt.height*i,N.uvs[k*8+0]=pt.x0,N.uvs[k*8+1]=pt.y0,N.uvs[k*8+2]=pt.x1,N.uvs[k*8+3]=pt.y1,N.uvs[k*8+4]=pt.x2,N.uvs[k*8+5]=pt.y2,N.uvs[k*8+6]=pt.x3,N.uvs[k*8+7]=pt.y3}this._textWidth=f*i,this._textHeight=(s.y+e.lineHeight)*i;for(const I in T){const D=T[I];if(this.anchor.x!==0||this.anchor.y!==0){let G=0;const N=this._textWidth*this.anchor.x,nt=this._textHeight*this.anchor.y;for(let pt=0;pt<D.total;pt++)D.vertices[G++]-=N,D.vertices[G++]-=nt,D.vertices[G++]-=N,D.vertices[G++]-=nt,D.vertices[G++]-=N,D.vertices[G++]-=nt,D.vertices[G++]-=N,D.vertices[G++]-=nt}this._maxLineHeight=b*i;const E=D.mesh.geometry.getBuffer("aVertexPosition"),w=D.mesh.geometry.getBuffer("aTextureCoord"),F=D.mesh.geometry.getIndex();E.data=D.vertices,w.data=D.uvs,F.data=D.indices,E.update(),w.update(),F.update()}for(let I=0;I<r.length;I++)gu.push(r[I]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:s}=Zt.available[this._fontName];if(i!=="none"){const{a:r,b:n,c:o,d:a}=this.worldTransform,h=Math.sqrt(r*r+n*n),l=Math.sqrt(o*o+a*a),c=(Math.abs(h)+Math.abs(l))/2,u=this.fontSize/s,d=e._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Zt.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Zt.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Zt.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,s=Zt.available[this._fontName].distanceFieldType==="none"?mu:_u;s.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],s.filter(r=>t[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=L.EMPTY});for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};let UE=ep;UE.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const GE=[".xml",".fnt"],HE={extension:{type:O.LoadParser,priority:Fe.Normal},name:"loadBitmapFont",test(e){return GE.includes(Vt.extname(e).toLowerCase())},async testParse(e){return Bn.test(e)||bh.test(e)},async parse(e,t,i){const s=Bn.test(e)?Bn.parse(e):bh.parse(e),{src:r}=t,{page:n}=s,o=[];for(let l=0;l<n.length;++l){const c=n[l].file;let u=Vt.join(Vt.dirname(r),c);u=ph(u,r),o.push(u)}const a=await i.load(o),h=o.map(l=>a[l]);return Zt.install(s,h,!0)},async load(e,t){return(await B.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};H.add(HE);const es=class extends Ke{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new es(Object.keys(es.defaultOptions).reduce((t,i)=>({...t,[i]:e[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete es.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:i}=es;if(i[e]){const s=i[e];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return B.ADAPTER.fetch(e).then(s=>s.blob()).then(async s=>new Promise((r,n)=>{const o=URL.createObjectURL(s),a=new FileReader;a.onload=()=>r([o,a.result]),a.onerror=n,a.readAsDataURL(s)})).then(async([s,r])=>{const n=Object.assign({family:Vt.basename(e,Vt.extname(e)),weight:"normal",style:"normal",src:s,dataSrc:r,refs:1,originalUrl:e,fontFace:null},t);i[e]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(i=>!this._overrides.includes(i));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(i=>this._overrides.includes(i));t.length>0&&(this._overrides=this._overrides.filter(i=>!t.includes(i)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=Yy(e)),typeof e=="number"?$y(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const r=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,es.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=B.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let lr=es;lr.availableFonts={};lr.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const is=class extends xi{constructor(e="",t={}){super(L.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const i=new Image,s=L.from(i,{scaleMode:B.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new j,s.trim=new j,this.texture=s;const r="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),a=document.createElementNS(r,"foreignObject"),h=document.createElementNS(n,"div"),l=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=is.defaultMaxWidth,this.maxHeight=is.defaultMaxHeight,this._domElement=h,this._styleElement=l,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(l),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=is.defaultAutoResolution,this._resolution=is.defaultResolution??B.RESOLUTION,this.text=e,this.style=t}measureText(e){var a,h;const{text:t,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const n=Math.min(this.maxWidth,Math.ceil(r.width)),o=Math.min(this.maxHeight,Math.ceil(r.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(a=this._style)==null?void 0:a.toCSS(s)}),this._styleElement.textContent=(h=this._style)==null?void 0:h.toGlobalCSS()),{width:n+i.padding*2,height:o+i.padding*2}}async updateText(e=!0){const{style:t,_image:i,_loadImage:s}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:n}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,r)),i.height=s.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise(o=>{s.onload=async()=>{await t.onBeforeDraw(),this._loading=!1,i.src=s.src,s.onload=null,s.src="",this.updateTexture(),o()};const a=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:s}=this,{padding:r}=e,{baseTexture:n}=t;t.trim.width=t._frame.width=i.width/s,t.trim.height=t._frame.height=i.height/s,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var i,s,r,n,o;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},is.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=t,(s=this._svgRoot)==null||s.remove(),this._svgRoot=t,(r=this._domElement)==null||r.remove(),this._domElement=t,(n=this._foreignObject)==null||n.remove(),this._foreignObject=t,(o=this._styleElement)==null||o.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=oi(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=oi(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof lr?(this.ownsStyle=!1,this._style=e):e instanceof Ke?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=lr.from(e)):(this.ownsStyle=!0,this._style=new lr(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Mo=is;Mo.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};Mo.defaultMaxWidth=2024;Mo.defaultMaxHeight=2024;Mo.defaultAutoResolution=!0;const zE=e=>{let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t&=t}return new Uint32Array([t])[0].toString(36)};function ip(e){let t="";for(const i of e.sprites)t+=`${i.url},${i.x},${i.y},${i.width},${i.height}`;return t+=`${e.width},${e.height}`,t=zE(t),t}class $E{constructor(){et(this,"prerenderedSprites",{});et(this,"fullSheetTextures",{})}async getTextureList(t){const i=ip(t);if(!(i in this.prerenderedSprites)){const s=await this.prerenderSprites(t.sprites);this.prerenderedSprites[i]=s}return this.prerenderedSprites[i]}async getFullSheetTexture(t){if(!(t in this.fullSheetTextures)){const i=await L.fromURL(t);this.fullSheetTextures[t]=i}return this.fullSheetTextures[t]}async prerenderSprites(t){const i=t.map(r=>r.url),s=[];for(let r=0;r<t.length;r++){const n=await this.getFullSheetTexture(i[r]),o=new j(t[r].x,t[r].y,t[r].width,t[r].height),a=new L(n.baseTexture,o,o);s.push(a)}return s}}const YE=new $E;function WE(e){let t="";for(const i of e)t+=ip(i);return t}async function XE(e){return await YE.getTextureList(e)}class VE{constructor(){et(this,"timeOffset",0)}getCurrentTime(){return Date.now()+this.timeOffset}setCurrentTime(t){this.timeOffset=t-Date.now(),console.log("Time offset: ",this.timeOffset)}}const sp=new VE;function Ln(){return sp.getCurrentTime()}function jE(e){sp.setCurrentTime(e)}const rp=Object.prototype.toString;function np(e){switch(rp.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return yi(e,Error)}}function Fs(e,t){return rp.call(e)===`[object ${t}]`}function op(e){return Fs(e,"ErrorEvent")}function yu(e){return Fs(e,"DOMError")}function qE(e){return Fs(e,"DOMException")}function gi(e){return Fs(e,"String")}function ap(e){return e===null||typeof e!="object"&&typeof e!="function"}function Rs(e){return Fs(e,"Object")}function bl(e){return typeof Event<"u"&&yi(e,Event)}function KE(e){return typeof Element<"u"&&yi(e,Element)}function ZE(e){return Fs(e,"RegExp")}function El(e){return!!(e&&e.then&&typeof e.then=="function")}function JE(e){return Rs(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function hp(e){return typeof e=="number"&&e!==e}function yi(e,t){try{return e instanceof t}catch{return!1}}function pn(e){return e&&e.Math==Math?e:void 0}const Jt=typeof globalThis=="object"&&pn(globalThis)||typeof window=="object"&&pn(window)||typeof self=="object"&&pn(self)||typeof global=="object"&&pn(global)||function(){return this}()||{};function Lr(){return Jt}function xl(e,t,i){const s=i||Jt,r=s.__SENTRY__=s.__SENTRY__||{};return r[e]||(r[e]=t())}const Fn=Lr(),QE=80;function vi(e,t={}){try{let i=e;const s=5,r=[];let n=0,o=0;const a=" > ",h=a.length;let l;const c=Array.isArray(t)?t:t.keyAttrs,u=!Array.isArray(t)&&t.maxStringLength||QE;for(;i&&n++<s&&(l=tx(i,c),!(l==="html"||n>1&&o+r.length*h+l.length>=u));)r.push(l),o+=l.length,i=i.parentNode;return r.reverse().join(a)}catch{return"<unknown>"}}function tx(e,t){const i=e,s=[];let r,n,o,a,h;if(!i||!i.tagName)return"";s.push(i.tagName.toLowerCase());const l=t&&t.length?t.filter(u=>i.getAttribute(u)).map(u=>[u,i.getAttribute(u)]):null;if(l&&l.length)l.forEach(u=>{s.push(`[${u[0]}="${u[1]}"]`)});else if(i.id&&s.push(`#${i.id}`),r=i.className,r&&gi(r))for(n=r.split(/\s+/),h=0;h<n.length;h++)s.push(`.${n[h]}`);const c=["aria-label","type","name","title","alt"];for(h=0;h<c.length;h++)o=c[h],a=i.getAttribute(o),a&&s.push(`[${o}="${a}"]`);return s.join("")}function ex(){try{return Fn.document.location.href}catch{return""}}function ix(e){return Fn.document&&Fn.document.querySelector?Fn.document.querySelector(e):null}const sx="Sentry Logger ",co=["debug","info","warn","error","log","assert","trace"];function lp(e){if(!("console"in Jt))return e();const t=Jt.console,i={};co.forEach(s=>{const r=t[s]&&t[s].__sentry_original__;s in t&&r&&(i[s]=t[s],t[s]=r)});try{return e()}finally{Object.keys(i).forEach(s=>{t[s]=i[s]})}}function vu(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1}};return typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?co.forEach(i=>{t[i]=(...s)=>{e&&lp(()=>{Jt.console[i](`${sx}[${i}]:`,...s)})}}):co.forEach(i=>{t[i]=()=>{}}),t}let A;typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?A=xl("logger",vu):A=vu();const rx=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function nx(e){return e==="http"||e==="https"}function No(e,t=!1){const{host:i,path:s,pass:r,port:n,projectId:o,protocol:a,publicKey:h}=e;return`${a}://${h}${t&&r?`:${r}`:""}@${i}${n?`:${n}`:""}/${s&&`${s}/`}${o}`}function ox(e){const t=rx.exec(e);if(!t){console.error(`Invalid Sentry Dsn: ${e}`);return}const[i,s,r="",n,o="",a]=t.slice(1);let h="",l=a;const c=l.split("/");if(c.length>1&&(h=c.slice(0,-1).join("/"),l=c.pop()),l){const u=l.match(/^\d+/);u&&(l=u[0])}return cp({host:n,pass:r,path:h,projectId:l,port:o,protocol:i,publicKey:s})}function cp(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function ax(e){if(!(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__))return!0;const{port:t,projectId:i,protocol:s}=e;return["protocol","publicKey","host","projectId"].find(o=>e[o]?!1:(A.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:i.match(/^\d+$/)?nx(s)?t&&isNaN(parseInt(t,10))?(A.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(A.error(`Invalid Sentry Dsn: Invalid protocol ${s}`),!1):(A.error(`Invalid Sentry Dsn: Invalid projectId ${i}`),!1)}function hx(e){const t=typeof e=="string"?ox(e):cp(e);if(!(!t||!ax(t)))return t}class ge extends Error{constructor(t,i="warn"){super(t),this.message=t,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=i}}function cr(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function bu(e,t){if(!Array.isArray(e))return"";const i=[];for(let s=0;s<e.length;s++){const r=e[s];try{i.push(String(r))}catch{i.push("[value cannot be serialized]")}}return i.join(t)}function lx(e,t,i=!1){return gi(e)?ZE(t)?t.test(e):gi(t)?i?e===t:e.includes(t):!1:!1}function Us(e,t=[],i=!1){return t.some(s=>lx(e,s,i))}function Wt(e,t,i){if(!(t in e))return;const s=e[t],r=i(s);if(typeof r=="function")try{up(r,s)}catch{}e[t]=r}function wl(e,t,i){Object.defineProperty(e,t,{value:i,writable:!0,configurable:!0})}function up(e,t){const i=t.prototype||{};e.prototype=t.prototype=i,wl(e,"__sentry_original__",t)}function Sl(e){return e.__sentry_original__}function cx(e){return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}function dp(e){if(np(e))return{message:e.message,name:e.name,stack:e.stack,...xu(e)};if(bl(e)){const t={type:e.type,target:Eu(e.target),currentTarget:Eu(e.currentTarget),...xu(e)};return typeof CustomEvent<"u"&&yi(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function Eu(e){try{return KE(e)?vi(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function xu(e){if(typeof e=="object"&&e!==null){const t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}else return{}}function ux(e,t=40){const i=Object.keys(dp(e));if(i.sort(),!i.length)return"[object has no keys]";if(i[0].length>=t)return cr(i[0],t);for(let s=i.length;s>0;s--){const r=i.slice(0,s).join(", ");if(!(r.length>t))return s===i.length?r:cr(r,t)}return""}function Be(e){return Eh(e,new Map)}function Eh(e,t){if(Rs(e)){const i=t.get(e);if(i!==void 0)return i;const s={};t.set(e,s);for(const r of Object.keys(e))typeof e[r]<"u"&&(s[r]=Eh(e[r],t));return s}if(Array.isArray(e)){const i=t.get(e);if(i!==void 0)return i;const s=[];return t.set(e,s),e.forEach(r=>{s.push(Eh(r,t))}),s}return e}const fp=50,wu=/\(error: (.*)\)/;function pp(...e){const t=e.sort((i,s)=>i[0]-s[0]).map(i=>i[1]);return(i,s=0)=>{const r=[],n=i.split(`
`);for(let o=s;o<n.length;o++){const a=n[o];if(a.length>1024)continue;const h=wu.test(a)?a.replace(wu,"$1"):a;if(!h.match(/\S*Error: /)){for(const l of t){const c=l(h);if(c){r.push(c);break}}if(r.length>=fp)break}}return fx(r)}}function dx(e){return Array.isArray(e)?pp(...e):e}function fx(e){if(!e.length)return[];const t=e.slice(0,fp),i=t[t.length-1].function;i&&/sentryWrapped/.test(i)&&t.pop(),t.reverse();const s=t[t.length-1].function;return s&&/captureMessage|captureException/.test(s)&&t.pop(),t.map(r=>({...r,filename:r.filename||t[t.length-1].filename,function:r.function||"?"}))}const Ca="<anonymous>";function bi(e){try{return!e||typeof e!="function"?Ca:e.name||Ca}catch{return Ca}}const xh=Lr();function mp(){if(!("fetch"in xh))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function wh(e){return e&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function px(){if(!mp())return!1;if(wh(xh.fetch))return!0;let e=!1;const t=xh.document;if(t&&typeof t.createElement=="function")try{const i=t.createElement("iframe");i.hidden=!0,t.head.appendChild(i),i.contentWindow&&i.contentWindow.fetch&&(e=wh(i.contentWindow.fetch)),t.head.removeChild(i)}catch(i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",i)}return e}const mn=Lr();function mx(){const e=mn.chrome,t=e&&e.app&&e.app.runtime,i="history"in mn&&!!mn.history.pushState&&!!mn.history.replaceState;return!t&&i}const vt=Lr(),hi="__sentry_xhr_v2__",ur={},Su={};function _x(e){if(!Su[e])switch(Su[e]=!0,e){case"console":gx();break;case"dom":Tx();break;case"xhr":bx();break;case"fetch":yx();break;case"history":Ex();break;case"error":Ax();break;case"unhandledrejection":Rx();break;default:(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("unknown instrumentation type:",e);return}}function $t(e,t){ur[e]=ur[e]||[],ur[e].push(t),_x(e)}function xe(e,t){if(!(!e||!ur[e]))for(const i of ur[e]||[])try{i(t)}catch(s){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${bi(i)}
Error:`,s)}}function gx(){"console"in vt&&co.forEach(function(e){e in vt.console&&Wt(vt.console,e,function(t){return function(...i){xe("console",{args:i,level:e}),t&&t.apply(vt.console,i)}})})}function yx(){px()&&Wt(vt,"fetch",function(e){return function(...t){const{method:i,url:s}=vx(t),r={args:t,fetchData:{method:i,url:s},startTimestamp:Date.now()};return xe("fetch",{...r}),e.apply(vt,t).then(n=>(xe("fetch",{...r,endTimestamp:Date.now(),response:n}),n),n=>{throw xe("fetch",{...r,endTimestamp:Date.now(),error:n}),n})}})}function Sh(e,t){return!!e&&typeof e=="object"&&!!e[t]}function Tu(e){return typeof e=="string"?e:e?Sh(e,"url")?e.url:e.toString?e.toString():"":""}function vx(e){if(e.length===0)return{method:"GET",url:""};if(e.length===2){const[i,s]=e;return{url:Tu(i),method:Sh(s,"method")?String(s.method).toUpperCase():"GET"}}const t=e[0];return{url:Tu(t),method:Sh(t,"method")?String(t.method).toUpperCase():"GET"}}function bx(){if(!("XMLHttpRequest"in vt))return;const e=XMLHttpRequest.prototype;Wt(e,"open",function(t){return function(...i){const s=i[1],r=this[hi]={method:gi(i[0])?i[0].toUpperCase():i[0],url:i[1],request_headers:{}};gi(s)&&r.method==="POST"&&s.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const n=()=>{const o=this[hi];if(o&&this.readyState===4){try{o.status_code=this.status}catch{}xe("xhr",{args:i,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:this})}};return"onreadystatechange"in this&&typeof this.onreadystatechange=="function"?Wt(this,"onreadystatechange",function(o){return function(...a){return n(),o.apply(this,a)}}):this.addEventListener("readystatechange",n),Wt(this,"setRequestHeader",function(o){return function(...a){const[h,l]=a,c=this[hi];return c&&(c.request_headers[h.toLowerCase()]=l),o.apply(this,a)}}),t.apply(this,i)}}),Wt(e,"send",function(t){return function(...i){const s=this[hi];return s&&i[0]!==void 0&&(s.body=i[0]),xe("xhr",{args:i,startTimestamp:Date.now(),xhr:this}),t.apply(this,i)}})}let _n;function Ex(){if(!mx())return;const e=vt.onpopstate;vt.onpopstate=function(...i){const s=vt.location.href,r=_n;if(_n=s,xe("history",{from:r,to:s}),e)try{return e.apply(this,i)}catch{}};function t(i){return function(...s){const r=s.length>2?s[2]:void 0;if(r){const n=_n,o=String(r);_n=o,xe("history",{from:n,to:o})}return i.apply(this,s)}}Wt(vt.history,"pushState",t),Wt(vt.history,"replaceState",t)}const xx=1e3;let gn,yn;function wx(e,t){if(!e||e.type!==t.type)return!0;try{if(e.target!==t.target)return!0}catch{}return!1}function Sx(e){if(e.type!=="keypress")return!1;try{const t=e.target;if(!t||!t.tagName)return!0;if(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)return!1}catch{}return!0}function Au(e,t=!1){return i=>{if(!i||yn===i||Sx(i))return;const s=i.type==="keypress"?"input":i.type;gn===void 0?(e({event:i,name:s,global:t}),yn=i):wx(yn,i)&&(e({event:i,name:s,global:t}),yn=i),clearTimeout(gn),gn=vt.setTimeout(()=>{gn=void 0},xx)}}function Tx(){if(!("document"in vt))return;const e=xe.bind(null,"dom"),t=Au(e,!0);vt.document.addEventListener("click",t,!1),vt.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach(i=>{const s=vt[i]&&vt[i].prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(Wt(s,"addEventListener",function(r){return function(n,o,a){if(n==="click"||n=="keypress")try{const h=this,l=h.__sentry_instrumentation_handlers__=h.__sentry_instrumentation_handlers__||{},c=l[n]=l[n]||{refCount:0};if(!c.handler){const u=Au(e);c.handler=u,r.call(this,n,u,a)}c.refCount++}catch{}return r.call(this,n,o,a)}}),Wt(s,"removeEventListener",function(r){return function(n,o,a){if(n==="click"||n=="keypress")try{const h=this,l=h.__sentry_instrumentation_handlers__||{},c=l[n];c&&(c.refCount--,c.refCount<=0&&(r.call(this,n,c.handler,a),c.handler=void 0,delete l[n]),Object.keys(l).length===0&&delete h.__sentry_instrumentation_handlers__)}catch{}return r.call(this,n,o,a)}}))})}let vn=null;function Ax(){vn=vt.onerror,vt.onerror=function(e,t,i,s,r){return xe("error",{column:s,error:r,line:i,msg:e,url:t}),vn&&!vn.__SENTRY_LOADER__?vn.apply(this,arguments):!1},vt.onerror.__SENTRY_INSTRUMENTED__=!0}let bn=null;function Rx(){bn=vt.onunhandledrejection,vt.onunhandledrejection=function(e){return xe("unhandledrejection",e),bn&&!bn.__SENTRY_LOADER__?bn.apply(this,arguments):!0},vt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Ix(){const e=typeof WeakSet=="function",t=e?new WeakSet:[];function i(r){if(e)return t.has(r)?!0:(t.add(r),!1);for(let n=0;n<t.length;n++)if(t[n]===r)return!0;return t.push(r),!1}function s(r){if(e)t.delete(r);else for(let n=0;n<t.length;n++)if(t[n]===r){t.splice(n,1);break}}return[i,s]}function qe(){const e=Jt,t=e.crypto||e.msCrypto;if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");const i=t&&t.getRandomValues?()=>t.getRandomValues(new Uint8Array(1))[0]:()=>Math.random()*16;return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,s=>(s^(i()&15)>>s/4).toString(16))}function _p(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function ri(e){const{message:t,event_id:i}=e;if(t)return t;const s=_p(e);return s?s.type&&s.value?`${s.type}: ${s.value}`:s.type||s.value||i||"<unknown>":i||"<unknown>"}function Th(e,t,i){const s=e.exception=e.exception||{},r=s.values=s.values||[],n=r[0]=r[0]||{};n.value||(n.value=t||""),n.type||(n.type=i||"Error")}function xr(e,t){const i=_p(e);if(!i)return;const s={type:"generic",handled:!0},r=i.mechanism;if(i.mechanism={...s,...r,...t},t&&"data"in t){const n={...r&&r.data,...t.data};i.mechanism.data=n}}function Ru(e){if(e&&e.__sentry_captured__)return!0;try{wl(e,"__sentry_captured__",!0)}catch{}return!1}function gp(e){return Array.isArray(e)?e:[e]}function Cx(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function kx(){return"npm"}function yp(){return!Cx()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function Dx(e,t){return e.require(t)}function ke(e,t=100,i=1/0){try{return Ah("",e,t,i)}catch(s){return{ERROR:`**non-serializable** (${s})`}}}function vp(e,t=3,i=100*1024){const s=ke(e,t);return Bx(s)>i?vp(e,t-1,i):s}function Ah(e,t,i=1/0,s=1/0,r=Ix()){const[n,o]=r;if(t==null||["number","boolean","string"].includes(typeof t)&&!hp(t))return t;const a=Px(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const h=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:i;if(h===0)return a.replace("object ","");if(n(t))return"[Circular ~]";const l=t;if(l&&typeof l.toJSON=="function")try{const f=l.toJSON();return Ah("",f,h-1,s,r)}catch{}const c=Array.isArray(t)?[]:{};let u=0;const d=dp(t);for(const f in d){if(!Object.prototype.hasOwnProperty.call(d,f))continue;if(u>=s){c[f]="[MaxProperties ~]";break}const p=d[f];c[f]=Ah(f,p,h-1,s,r),u++}return o(t),c}function Px(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(JE(t))return"[SyntheticEvent]";if(typeof t=="number"&&t!==t)return"[NaN]";if(typeof t=="function")return`[Function: ${bi(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const i=Mx(t);return/^HTML(\w*)Element$/.test(i)?`[HTMLElement: ${i}]`:`[object ${i}]`}catch(i){return`**non-serializable** (${i})`}}function Mx(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function Nx(e){return~-encodeURI(e).split(/%..|./).length}function Bx(e){return Nx(JSON.stringify(e))}var ze;(function(e){e[e.PENDING=0]="PENDING";const i=1;e[e.RESOLVED=i]="RESOLVED";const s=2;e[e.REJECTED=s]="REJECTED"})(ze||(ze={}));function Ui(e){return new qt(t=>{t(e)})}function uo(e){return new qt((t,i)=>{i(e)})}class qt{__init(){this._state=ze.PENDING}__init2(){this._handlers=[]}constructor(t){qt.prototype.__init.call(this),qt.prototype.__init2.call(this),qt.prototype.__init3.call(this),qt.prototype.__init4.call(this),qt.prototype.__init5.call(this),qt.prototype.__init6.call(this);try{t(this._resolve,this._reject)}catch(i){this._reject(i)}}then(t,i){return new qt((s,r)=>{this._handlers.push([!1,n=>{if(!t)s(n);else try{s(t(n))}catch(o){r(o)}},n=>{if(!i)r(n);else try{s(i(n))}catch(o){r(o)}}]),this._executeHandlers()})}catch(t){return this.then(i=>i,t)}finally(t){return new qt((i,s)=>{let r,n;return this.then(o=>{n=!1,r=o,t&&t()},o=>{n=!0,r=o,t&&t()}).then(()=>{if(n){s(r);return}i(r)})})}__init3(){this._resolve=t=>{this._setResult(ze.RESOLVED,t)}}__init4(){this._reject=t=>{this._setResult(ze.REJECTED,t)}}__init5(){this._setResult=(t,i)=>{if(this._state===ze.PENDING){if(El(i)){i.then(this._resolve,this._reject);return}this._state=t,this._value=i,this._executeHandlers()}}}__init6(){this._executeHandlers=()=>{if(this._state===ze.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach(i=>{i[0]||(this._state===ze.RESOLVED&&i[1](this._value),this._state===ze.REJECTED&&i[2](this._value),i[0]=!0)})}}}function Ox(e){const t=[];function i(){return e===void 0||t.length<e}function s(o){return t.splice(t.indexOf(o),1)[0]}function r(o){if(!i())return uo(new ge("Not adding Promise because buffer limit was reached."));const a=o();return t.indexOf(a)===-1&&t.push(a),a.then(()=>s(a)).then(null,()=>s(a).then(null,()=>{})),a}function n(o){return new qt((a,h)=>{let l=t.length;if(!l)return a(!0);const c=setTimeout(()=>{o&&o>0&&a(!1)},o);t.forEach(u=>{Ui(u).then(()=>{--l||(clearTimeout(c),a(!0))},h)})})}return{$:t,add:r,drain:n}}function ka(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const i=t[6]||"",s=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:i,hash:s,relative:t[5]+i+s}}const Lx=["fatal","error","warning","log","info","debug"];function Fx(e){return e==="warn"?"warning":Lx.includes(e)?e:"log"}const bp=Lr(),Rh={nowSeconds:()=>Date.now()/1e3};function Ux(){const{performance:e}=bp;if(!e||!e.now)return;const t=Date.now()-e.now();return{now:()=>e.now(),timeOrigin:t}}function Gx(){try{return Dx(Xm,"perf_hooks").performance}catch{return}}const Da=yp()?Gx():Ux(),Iu=Da===void 0?Rh:{nowSeconds:()=>(Da.timeOrigin+Da.now())/1e3},Bo=Rh.nowSeconds.bind(Rh),Gi=Iu.nowSeconds.bind(Iu),Ze=(()=>{const{performance:e}=bp;if(!e||!e.now)return;const t=3600*1e3,i=e.now(),s=Date.now(),r=e.timeOrigin?Math.abs(e.timeOrigin+i-s):t,n=r<t,o=e.timing&&e.timing.navigationStart,h=typeof o=="number"?Math.abs(o+i-s):t,l=h<t;return n||l?r<=h?e.timeOrigin:o:s})(),Hx=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function zx(e){const t=e.match(Hx);if(!e||!t)return;let i;return t[3]==="1"?i=!0:t[3]==="0"&&(i=!1),{traceId:t[1],parentSampled:i,parentSpanId:t[2]}}function Gs(e,t=[]){return[e,t]}function $x(e,t){const[i,s]=e;return[i,[...s,t]]}function Cu(e,t){const i=e[1];for(const s of i){const r=s[0].type;if(t(s,r))return!0}return!1}function Ih(e,t){return(t||new TextEncoder).encode(e)}function Yx(e,t){const[i,s]=e;let r=JSON.stringify(i);function n(o){typeof r=="string"?r=typeof o=="string"?r+o:[Ih(r,t),o]:r.push(typeof o=="string"?Ih(o,t):o)}for(const o of s){const[a,h]=o;if(n(`
${JSON.stringify(a)}
`),typeof h=="string"||h instanceof Uint8Array)n(h);else{let l;try{l=JSON.stringify(h)}catch{l=JSON.stringify(ke(h))}n(l)}}return typeof r=="string"?r:Wx(r)}function Wx(e){const t=e.reduce((r,n)=>r+n.length,0),i=new Uint8Array(t);let s=0;for(const r of e)i.set(r,s),s+=r.length;return i}function Xx(e,t){const i=typeof e.data=="string"?Ih(e.data,t):e.data;return[Be({type:"attachment",length:i.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),i]}const Vx={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor"};function ku(e){return Vx[e]}function Tl(e){if(!e||!e.sdk)return;const{name:t,version:i}=e.sdk;return{name:t,version:i}}function Ep(e,t,i,s){const r=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!i&&{dsn:No(s)},...r&&{trace:Be({...r})}}}function jx(e,t,i){const s=[{type:"client_report"},{timestamp:i||Bo(),discarded_events:e}];return Gs(t?{dsn:t}:{},[s])}const qx=60*1e3;function Kx(e,t=Date.now()){const i=parseInt(`${e}`,10);if(!isNaN(i))return i*1e3;const s=Date.parse(`${e}`);return isNaN(s)?qx:s-t}function Zx(e,t){return e[t]||e.all||0}function Jx(e,t,i=Date.now()){return Zx(e,t)>i}function Qx(e,{statusCode:t,headers:i},s=Date.now()){const r={...e},n=i&&i["x-sentry-rate-limits"],o=i&&i["retry-after"];if(n)for(const a of n.trim().split(",")){const[h,l]=a.split(":",2),c=parseInt(h,10),u=(isNaN(c)?60:c)*1e3;if(!l)r.all=s+u;else for(const d of l.split(";"))r[d]=s+u}else o?r.all=s+Kx(o,s):t===429&&(r.all=s+60*1e3);return r}const Ch="baggage",xp="sentry-",tw=/^sentry-/,ew=8192;function iw(e){if(!gi(e)&&!Array.isArray(e))return;let t={};if(Array.isArray(e))t=e.reduce((s,r)=>{const n=Du(r);return{...s,...n}},{});else{if(!e)return;t=Du(e)}const i=Object.entries(t).reduce((s,[r,n])=>{if(r.match(tw)){const o=r.slice(xp.length);s[o]=n}return s},{});if(Object.keys(i).length>0)return i}function wp(e){const t=Object.entries(e).reduce((i,[s,r])=>(r&&(i[`${xp}${s}`]=r),i),{});return sw(t)}function Du(e){return e.split(",").map(t=>t.split("=").map(i=>decodeURIComponent(i.trim()))).reduce((t,[i,s])=>(t[i]=s,t),{})}function sw(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[i,s],r)=>{const n=`${encodeURIComponent(i)}=${encodeURIComponent(s)}`,o=r===0?n:`${t},${n}`;return o.length>ew?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Not adding key: ${i} with val: ${s} to baggage header due to exceeding baggage size limits.`),t):o},"")}class rw{constructor(t,i,s,r){et(this,"entities");et(this,"app");et(this,"pixiEntities",{});et(this,"preloadedImages");et(this,"animationIndex",0);et(this,"playerId",null);et(this,"playerX",0);et(this,"playerY",0);et(this,"frameTime",0);et(this,"isMobile",!0);et(this,"mapSize",[0,0,0,0]);et(this,"backgroundContainer",null);et(this,"backgroundTileMap",null);et(this,"touchAreasSprite",null);if(this.entities=i,this.mapSize=r,this.app=t,this.preloadedImages={},console.log("MapDrawer constructor: ",this.entities),this.isMobile=window.innerWidth<600,this.isMobile){this.playerId=s||"";const n=this.entities[this.playerId];n||(window.history.replaceState({},"",window.location.pathname),window.location.reload()),this.playerX=n.x,this.playerY=n.y,this.app.stage.position.set(window.innerWidth/2,window.innerHeight/2),this.app.stage.scale.set(3),this.app.stage.sortableChildren=!0,this.touchAreasSprite=this.createTouchAreasSprite(),this.app.stage.addChild(this.touchAreasSprite),console.log("isMobile",n.x,n.y,this.app.stage.position)}}createTouchAreasSprite(){const i=new Qt,s=(o,a)=>{var h=new Or;h.lineStyle(1,65280),h.drawRect(o,a,32,32),i.addChild(h)};let r=32,n=32;return s(r-32,n),s(r+32,n),s(r,n-32),s(r,n+32),i.zIndex=0,i.pivot.set(32*2-16,32*2),i}async updateAllEntities(){const t=Object.values(this.entities);for(const i of t)await this.updateEntity(i);this.removeDeletedEntities(),this.animationIndex+=1}async removeDeletedEntities(){for(const t of Object.values(this.pixiEntities))this.entities[t.entityID]||(t.sprites.forEach(i=>{this.app.stage.removeChild(i)}),delete this.pixiEntities[t.entityID])}async updateEntity(t){let i=t.x,s=t.y;if((t.action||{}).action=="move"&&t.x_from!=null&&t.y_from!=null&&(t.x_from!=t.x||t.y_from!=t.y)){const c=Ln(),u=t.action?t.action.timeout:0,d=t.action?t.action.time:0;if(d>0){const f=u-c;let m=(d-f)/d;if(m>1&&(m=1),m<0&&(m=0),m!=1/0){const _=t.x_from,y=t.y_from;i=_+(t.x-_)*m,s=y+(t.y-y)*m}}}let r=0,n=0;for(const c of t.animations||[])c.type=="shake"&&(r=Math.random()*4-2,n=Math.random()*4-2);t.id==this.playerId&&(this.app.stage.pivot.copyFrom({x:i-(t.x_offset||0),y:s-(t.y_offset||0)}),this.touchAreasSprite&&this.touchAreasSprite.position.copyFrom(this.app.stage.pivot));let o=this.pixiEntities[t.id];const a=[];for(const c of t.sprites||[])a.push({sprites:c,width:t.width,height:t.height});const h=WE(a);if(!o||h!=o.hash){const c=t.sprites[0].length,u=[];for(let d=0;d<c;d++){const f=[];for(let p=0;p<t.sprites.length;p++)f.push(t.sprites[p][d]);u.push(await XE({sprites:f,width:t.width,height:t.height}))}if(o=this.pixiEntities[t.id],o){for(let d=0;d<c;d++){const f=o.sprites[d];f||A.error(new Error(`Sprite ${d} is missing`)),f.textures=u[d],f.loop=!0,f.gotoAndPlay(0)}o.hash=h}else{const d=[];for(const f of u){const p=new ho(f),m=t.width/p.width;p.scale.set(m,m),p.loop=!0,p.play(),d.push(p),this.app.stage.addChild(p)}this.pixiEntities[t.id]={entityID:t.id,hash:h,sprites:d},o=this.pixiEntities[t.id]}}t.animation_speed==0?o.sprites.forEach(c=>c.gotoAndStop(0)):o.sprites.forEach(c=>{c.animationSpeed=(t.animation_speed||0)*1/20,!c.playing&&c.textures.length>1&&c.play()});let l=t.y;t.carried_by_entity_id&&(l+=32),o.sprites.forEach(c=>c.zIndex=l),o.sprites.forEach(c=>c.x=i+(t.x_offset||0)+r),o.sprites.forEach(c=>c.y=s+(t.y_offset||0)+n)}async setBackground(t){this.backgroundTileMap=t}async buildBackground(){const t=await this.rebuildBackground();t?(this.backgroundContainer=t,t.zIndex=-1e3,this.app.stage.addChild(t),console.log("Added background",t)):console.error("Failed to build background texture")}async rebuildBackground(){if(!this.backgroundTileMap){console.error("No background tile map set");return}const t=this.app.renderer;t.background.color="0xff0000";const i=10*32,s=new Qt,r=0,n=0,o=this.mapSize[0],a=this.mapSize[1],h=this.mapSize[2],l=this.mapSize[3],c=this.backgroundTileMap.grass,u=c.topLeft,d=await L.fromURL(u.url),f=async(p,m,_)=>{const y=new j(_.x,_.y,_.width,_.height),b=new L(d.baseTexture,y,y),g=new xi(b);g.position.x=p,g.position.y=m,g.width=32,g.height=32,s.addChild(g)};for(let p=r-i;p<h+i;p+=32)for(let m=n-i;m<l+i;m+=32){if(p<o||p>h||m<a||m>l){await f(p,m,c.water);continue}if(p==o?m==a?await f(p,m,c.topLeft):m==l?await f(p,m,c.bottomLeft):await f(p,m,c.left):p==h?m==a?await f(p,m,c.topRight):m==l?await f(p,m,c.bottomRight):await f(p,m,c.right):m==a?await f(p,m,c.top):m==l?await f(p,m,c.bottom):await f(p,m,c.center),Math.random()<.2){const _=c[`extra${Math.floor(Math.random()*6)+1}`];await f(p,m,_)}}return s}}function nw(e,t,i,s){const r=new rw(e,t,i,s);return window.mapDrawer=r,r}const Le=Object.create(null);Le.open="0";Le.close="1";Le.ping="2";Le.pong="3";Le.message="4";Le.upgrade="5";Le.noop="6";const Un=Object.create(null);Object.keys(Le).forEach(e=>{Un[Le[e]]=e});const ow={type:"error",data:"parser error"},aw=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",hw=typeof ArrayBuffer=="function",lw=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Sp=({type:e,data:t},i,s)=>aw&&t instanceof Blob?i?s(t):Pu(t,s):hw&&(t instanceof ArrayBuffer||lw(t))?i?s(t):Pu(new Blob([t]),s):s(Le[e]+(t||"")),Pu=(e,t)=>{const i=new FileReader;return i.onload=function(){const s=i.result.split(",")[1];t("b"+(s||""))},i.readAsDataURL(e)},Mu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ir=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Mu.length;e++)ir[Mu.charCodeAt(e)]=e;const cw=e=>{let t=e.length*.75,i=e.length,s,r=0,n,o,a,h;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const l=new ArrayBuffer(t),c=new Uint8Array(l);for(s=0;s<i;s+=4)n=ir[e.charCodeAt(s)],o=ir[e.charCodeAt(s+1)],a=ir[e.charCodeAt(s+2)],h=ir[e.charCodeAt(s+3)],c[r++]=n<<2|o>>4,c[r++]=(o&15)<<4|a>>2,c[r++]=(a&3)<<6|h&63;return l},uw=typeof ArrayBuffer=="function",Tp=(e,t)=>{if(typeof e!="string")return{type:"message",data:Ap(e,t)};const i=e.charAt(0);return i==="b"?{type:"message",data:dw(e.substring(1),t)}:Un[i]?e.length>1?{type:Un[i],data:e.substring(1)}:{type:Un[i]}:ow},dw=(e,t)=>{if(uw){const i=cw(e);return Ap(i,t)}else return{base64:!0,data:e}},Ap=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}},Rp=String.fromCharCode(30),fw=(e,t)=>{const i=e.length,s=new Array(i);let r=0;e.forEach((n,o)=>{Sp(n,!1,a=>{s[o]=a,++r===i&&t(s.join(Rp))})})},pw=(e,t)=>{const i=e.split(Rp),s=[];for(let r=0;r<i.length;r++){const n=Tp(i[r],t);if(s.push(n),n.type==="error")break}return s},Ip=4;function Dt(e){if(e)return mw(e)}function mw(e){for(var t in Dt.prototype)e[t]=Dt.prototype[t];return e}Dt.prototype.on=Dt.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Dt.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this};Dt.prototype.off=Dt.prototype.removeListener=Dt.prototype.removeAllListeners=Dt.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+e];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,r=0;r<i.length;r++)if(s=i[r],s===t||s.fn===t){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+e],this};Dt.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),i=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(i){i=i.slice(0);for(var s=0,r=i.length;s<r;++s)i[s].apply(this,t)}return this};Dt.prototype.emitReserved=Dt.prototype.emit;Dt.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Dt.prototype.hasListeners=function(e){return!!this.listeners(e).length};const re=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Cp(e,...t){return t.reduce((i,s)=>(e.hasOwnProperty(s)&&(i[s]=e[s]),i),{})}const _w=re.setTimeout,gw=re.clearTimeout;function Oo(e,t){t.useNativeTimers?(e.setTimeoutFn=_w.bind(re),e.clearTimeoutFn=gw.bind(re)):(e.setTimeoutFn=re.setTimeout.bind(re),e.clearTimeoutFn=re.clearTimeout.bind(re))}const yw=1.33;function vw(e){return typeof e=="string"?bw(e):Math.ceil((e.byteLength||e.size)*yw)}function bw(e){let t=0,i=0;for(let s=0,r=e.length;s<r;s++)t=e.charCodeAt(s),t<128?i+=1:t<2048?i+=2:t<55296||t>=57344?i+=3:(s++,i+=4);return i}class Ew extends Error{constructor(t,i,s){super(t),this.description=i,this.context=s,this.type="TransportError"}}class kp extends Dt{constructor(t){super(),this.writable=!1,Oo(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,i,s){return super.emitReserved("error",new Ew(t,i,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const i=Tp(t,this.socket.binaryType);this.onPacket(i)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const Dp="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),kh=64,xw={};let Nu=0,En=0,Bu;function Ou(e){let t="";do t=Dp[e%kh]+t,e=Math.floor(e/kh);while(e>0);return t}function Pp(){const e=Ou(+new Date);return e!==Bu?(Nu=0,Bu=e):e+"."+Ou(Nu++)}for(;En<kh;En++)xw[Dp[En]]=En;function Mp(e){let t="";for(let i in e)e.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t}function ww(e){let t={},i=e.split("&");for(let s=0,r=i.length;s<r;s++){let n=i[s].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}let Np=!1;try{Np=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Sw=Np;function Bp(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Sw))return new XMLHttpRequest}catch{}if(!t)try{return new re[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Tw(){}const Aw=function(){return new Bp({xdomain:!1}).responseType!=null}();class Rw extends kp{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const s=location.protocol==="https:";let r=location.port;r||(r=s?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==s}const i=t&&t.forceBase64;this.supportsBinary=Aw&&!i}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const i=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let s=0;this.polling&&(s++,this.once("pollComplete",function(){--s||i()})),this.writable||(s++,this.once("drain",function(){--s||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const i=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};pw(t,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,fw(t,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const i=this.opts.secure?"https":"http";let s="";this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Pp()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(i==="https"&&Number(this.opts.port)!==443||i==="http"&&Number(this.opts.port)!==80)&&(s=":"+this.opts.port);const r=Mp(t),n=this.opts.hostname.indexOf(":")!==-1;return i+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(r.length?"?"+r:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new _s(this.uri(),t)}doWrite(t,i){const s=this.request({method:"POST",data:t});s.on("success",i),s.on("error",(r,n)=>{this.onError("xhr post error",r,n)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(i,s)=>{this.onError("xhr poll error",i,s)}),this.pollXhr=t}}let _s=class Gn extends Dt{constructor(t,i){super(),Oo(this,i),this.opts=i,this.method=i.method||"GET",this.uri=t,this.async=i.async!==!1,this.data=i.data!==void 0?i.data:null,this.create()}create(){const t=Cp(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const i=this.xhr=new Bp(t);try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if(this.method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{i.readyState===4&&(i.status===200||i.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof i.status=="number"?i.status:0)},0))},i.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document<"u"&&(this.index=Gn.requestsCount++,Gn.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Tw,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Gn.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};_s.requestsCount=0;_s.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Lu);else if(typeof addEventListener=="function"){const e="onpagehide"in re?"pagehide":"unload";addEventListener(e,Lu,!1)}}function Lu(){for(let e in _s.requests)_s.requests.hasOwnProperty(e)&&_s.requests[e].abort()}const Op=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,i)=>i(t,0))(),xn=re.WebSocket||re.MozWebSocket,Fu=!0,Iw="arraybuffer",Uu=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Cw extends kp{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),i=this.opts.protocols,s=Uu?{}:Cp(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=Fu&&!Uu?i?new xn(t,i):new xn(t):new xn(t,i,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType||Iw,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let i=0;i<t.length;i++){const s=t[i],r=i===t.length-1;Sp(s,this.supportsBinary,n=>{const o={};try{Fu&&this.ws.send(n)}catch{}r&&Op(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const i=this.opts.secure?"wss":"ws";let s="";this.opts.port&&(i==="wss"&&Number(this.opts.port)!==443||i==="ws"&&Number(this.opts.port)!==80)&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Pp()),this.supportsBinary||(t.b64=1);const r=Mp(t),n=this.opts.hostname.indexOf(":")!==-1;return i+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(r.length?"?"+r:"")}check(){return!!xn}}const kw={websocket:Cw,polling:Rw},Dw=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Pw=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Dh(e){const t=e,i=e.indexOf("["),s=e.indexOf("]");i!=-1&&s!=-1&&(e=e.substring(0,i)+e.substring(i,s).replace(/:/g,";")+e.substring(s,e.length));let r=Dw.exec(e||""),n={},o=14;for(;o--;)n[Pw[o]]=r[o]||"";return i!=-1&&s!=-1&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=Mw(n,n.path),n.queryKey=Nw(n,n.query),n}function Mw(e,t){const i=/\/{2,9}/g,s=t.replace(i,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function Nw(e,t){const i={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,n){r&&(i[r]=n)}),i}let Lp=class ss extends Dt{constructor(t,i={}){super(),this.writeBuffer=[],t&&typeof t=="object"&&(i=t,t=null),t?(t=Dh(t),i.hostname=t.host,i.secure=t.protocol==="https"||t.protocol==="wss",i.port=t.port,t.query&&(i.query=t.query)):i.host&&(i.hostname=Dh(i.host).host),Oo(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ww(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const i=Object.assign({},this.opts.query);i.EIO=Ip,i.transport=t,this.id&&(i.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new kw[t](s)}open(){let t;if(this.opts.rememberUpgrade&&ss.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(t){let i=this.createTransport(t),s=!1;ss.priorWebsocketSuccess=!1;const r=()=>{s||(i.send([{type:"ping",data:"probe"}]),i.once("packet",u=>{if(!s)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;ss.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(c(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=i.name,this.emitReserved("upgradeError",d)}}))};function n(){s||(s=!0,c(),i.close(),i=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=i.name,n(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function h(){o("socket closed")}function l(u){i&&u.name!==i.name&&n()}const c=()=>{i.removeListener("open",r),i.removeListener("error",o),i.removeListener("close",a),this.off("close",h),this.off("upgrading",l)};i.once("open",r),i.once("error",o),i.once("close",a),this.once("close",h),this.once("upgrading",l),i.open()}onOpen(){if(this.readyState="open",ss.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const i=this.upgrades.length;for(;t<i;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=t.data,this.onError(i);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(i+=vw(r)),s>0&&i>this.maxPayload)return this.writeBuffer.slice(0,s);i+=2}return this.writeBuffer}write(t,i,s){return this.sendPacket("message",t,i,s),this}send(t,i,s){return this.sendPacket("message",t,i,s),this}sendPacket(t,i,s,r){if(typeof i=="function"&&(r=i,i=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const n={type:t,data:i,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),t()},s=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}onError(t){ss.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const i=[];let s=0;const r=t.length;for(;s<r;s++)~this.transports.indexOf(t[s])&&i.push(t[s]);return i}};Lp.protocol=Ip;function Bw(e,t="",i){let s=e;i=i||typeof location<"u"&&location,e==null&&(e=i.protocol+"//"+i.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=i.protocol+e:e=i.host+e),/^(https?|wss?):\/\//.test(e)||(typeof i<"u"?e=i.protocol+"//"+e:e="https://"+e),s=Dh(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const n=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+n+":"+s.port+t,s.href=s.protocol+"://"+n+(i&&i.port===s.port?"":":"+s.port),s}const Ow=typeof ArrayBuffer=="function",Lw=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Fp=Object.prototype.toString,Fw=typeof Blob=="function"||typeof Blob<"u"&&Fp.call(Blob)==="[object BlobConstructor]",Uw=typeof File=="function"||typeof File<"u"&&Fp.call(File)==="[object FileConstructor]";function Al(e){return Ow&&(e instanceof ArrayBuffer||Lw(e))||Fw&&e instanceof Blob||Uw&&e instanceof File}function Hn(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let i=0,s=e.length;i<s;i++)if(Hn(e[i]))return!0;return!1}if(Al(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Hn(e.toJSON(),!0);for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&Hn(e[i]))return!0;return!1}function Gw(e){const t=[],i=e.data,s=e;return s.data=Ph(i,t),s.attachments=t.length,{packet:s,buffers:t}}function Ph(e,t){if(!e)return e;if(Al(e)){const i={_placeholder:!0,num:t.length};return t.push(e),i}else if(Array.isArray(e)){const i=new Array(e.length);for(let s=0;s<e.length;s++)i[s]=Ph(e[s],t);return i}else if(typeof e=="object"&&!(e instanceof Date)){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=Ph(e[s],t));return i}return e}function Hw(e,t){return e.data=Mh(e.data,t),delete e.attachments,e}function Mh(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let i=0;i<e.length;i++)e[i]=Mh(e[i],t);else if(typeof e=="object")for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(e[i]=Mh(e[i],t));return e}const zw=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],$w=5;var Q;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Q||(Q={}));class Yw{constructor(t){this.replacer=t}encode(t){return(t.type===Q.EVENT||t.type===Q.ACK)&&Hn(t)?this.encodeAsBinary({type:t.type===Q.EVENT?Q.BINARY_EVENT:Q.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let i=""+t.type;return(t.type===Q.BINARY_EVENT||t.type===Q.BINARY_ACK)&&(i+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(i+=t.nsp+","),t.id!=null&&(i+=t.id),t.data!=null&&(i+=JSON.stringify(t.data,this.replacer)),i}encodeAsBinary(t){const i=Gw(t),s=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(s),r}}function Gu(e){return Object.prototype.toString.call(e)==="[object Object]"}class Rl extends Dt{constructor(t){super(),this.reviver=t}add(t){let i;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(t);const s=i.type===Q.BINARY_EVENT;s||i.type===Q.BINARY_ACK?(i.type=s?Q.EVENT:Q.ACK,this.reconstructor=new Ww(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(Al(t)||t.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(t),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let i=0;const s={type:Number(t.charAt(0))};if(Q[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===Q.BINARY_EVENT||s.type===Q.BINARY_ACK){const n=i+1;for(;t.charAt(++i)!=="-"&&i!=t.length;);const o=t.substring(n,i);if(o!=Number(o)||t.charAt(i)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(t.charAt(i+1)==="/"){const n=i+1;for(;++i&&!(t.charAt(i)===","||i===t.length););s.nsp=t.substring(n,i)}else s.nsp="/";const r=t.charAt(i+1);if(r!==""&&Number(r)==r){const n=i+1;for(;++i;){const o=t.charAt(i);if(o==null||Number(o)!=o){--i;break}if(i===t.length)break}s.id=Number(t.substring(n,i+1))}if(t.charAt(++i)){const n=this.tryParse(t.substr(i));if(Rl.isPayloadValid(s.type,n))s.data=n;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,i){switch(t){case Q.CONNECT:return Gu(i);case Q.DISCONNECT:return i===void 0;case Q.CONNECT_ERROR:return typeof i=="string"||Gu(i);case Q.EVENT:case Q.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&zw.indexOf(i[0])===-1);case Q.ACK:case Q.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ww{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const i=Hw(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Xw=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Rl,Encoder:Yw,get PacketType(){return Q},protocol:$w},Symbol.toStringTag,{value:"Module"}));function pe(e,t,i){return e.on(t,i),function(){e.off(t,i)}}const Vw=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Up extends Dt{constructor(t,i,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=i,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[pe(t,"open",this.onopen.bind(this)),pe(t,"packet",this.onpacket.bind(this)),pe(t,"error",this.onerror.bind(this)),pe(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...i){if(Vw.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(i.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const s={type:Q.EVENT,data:i};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const o=this.ids++,a=i.pop();this._registerAckCallback(o,a),s.id=o}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,i){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[t]=i;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===t&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},r);this.acks[t]=(...o)=>{this.io.clearTimeoutFn(n),i.apply(this,[null,...o])}}emitWithAck(t,...i){const s=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((r,n)=>{i.push((o,a)=>s?o?n(o):r(a):r(o)),this.emit(t,...i)})}_addToQueue(t){let i;typeof t[t.length-1]=="function"&&(i=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((r,...n)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...n)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!t||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Q.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,i)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Q.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Q.EVENT:case Q.BINARY_EVENT:this.onevent(t);break;case Q.ACK:case Q.BINARY_ACK:this.onack(t);break;case Q.DISCONNECT:this.ondisconnect();break;case Q.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const i=t.data||[];t.id!=null&&i.push(this.ack(t.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const s of i)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const i=this;let s=!1;return function(...r){s||(s=!0,i.packet({type:Q.ACK,id:t,data:r}))}}onack(t){const i=this.acks[t.id];typeof i=="function"&&(i.apply(this,t.data),delete this.acks[t.id])}onconnect(t,i){this.id=t,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Q.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const i=this._anyListeners;for(let s=0;s<i.length;s++)if(t===i[s])return i.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const i=this._anyOutgoingListeners;for(let s=0;s<i.length;s++)if(t===i[s])return i.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const s of i)s.apply(this,t.data)}}}function Hs(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Hs.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),i=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+i:e-i}return Math.min(e,this.max)|0};Hs.prototype.reset=function(){this.attempts=0};Hs.prototype.setMin=function(e){this.ms=e};Hs.prototype.setMax=function(e){this.max=e};Hs.prototype.setJitter=function(e){this.jitter=e};class Nh extends Dt{constructor(t,i){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(i=t,t=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,Oo(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((s=i.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Hs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=t;const r=i.parser||Xw;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var i;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(i=this.backoff)===null||i===void 0||i.setMin(t),this)}randomizationFactor(t){var i;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(i=this.backoff)===null||i===void 0||i.setJitter(t),this)}reconnectionDelayMax(t){var i;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(i=this.backoff)===null||i===void 0||i.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Lp(this.uri,this.opts);const i=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=pe(i,"open",function(){s.onopen(),t&&t()}),n=pe(i,"error",o=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",o),t?t(o):s.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&r();const a=this.setTimeoutFn(()=>{r(),i.close(),i.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(r),this.subs.push(n),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(pe(t,"ping",this.onping.bind(this)),pe(t,"data",this.ondata.bind(this)),pe(t,"error",this.onerror.bind(this)),pe(t,"close",this.onclose.bind(this)),pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(i){this.onclose("parse error",i)}}ondecoded(t){Op(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,i){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new Up(this,t,i),this.nsps[t]=s),s}_destroy(t){const i=Object.keys(this.nsps);for(const s of i)if(this.nsps[s].active)return;this._close()}_packet(t){const i=this.encoder.encode(t);for(let s=0;s<i.length;s++)this.engine.write(i[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(r=>{r?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",r)):t.onreconnect()}))},i);this.opts.autoUnref&&s.unref(),this.subs.push(function(){clearTimeout(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const qs={};function zn(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const i=Bw(e,t.path||"/socket.io"),s=i.source,r=i.id,n=i.path,o=qs[r]&&n in qs[r].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let h;return a?h=new Nh(s,t):(qs[r]||(qs[r]=new Nh(s,t)),h=qs[r]),i.query&&!t.query&&(t.query=i.queryKey),h.socket(i.path,t)}Object.assign(zn,{Manager:Nh,Socket:Up,io:zn,connect:zn});const Gp=window.location.protocol+"//"+window.location.host;console.log("URL: ",Gp);class jw{constructor(t){et(this,"entities");et(this,"fullDumpCallback");et(this,"actionCheckTimeout",null);et(this,"nickname");et(this,"socket");this.entities=t.entities,this.nickname=t.nickname,this.fullDumpCallback=t.fullDumpCallback||(()=>{});try{this.socket=zn(Gp,{path:"/castcraft/socket.io",forceNew:!0,retries:10,ackTimeout:1e3})}catch(i){console.log("Error: ",i)}window.onunload=()=>{this.socket.close()}}setEntities(t){console.log("setEntities: ",t),Object.assign(this.entities,t)}handleEntityUpdate(t){for(const i of t.deletedEntityIds)delete this.entities[i];for(const i of Object.values(t.changedEntities))this.entities[i.id]=i}afterFirstConnect(){this.socket.on("entity_update",t=>{this.handleEntityUpdate(t)}),this.socket.on("disconnect",()=>{this.socket.on("connect",()=>{window.location.reload()})})}waitUntilConnected(){return new Promise(t=>{this.socket.on("connect",()=>{fetch("/castcraft/api/firstConnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:this.nickname,requestSid:this.socket.id})}).then(i=>i.json()).then(i=>{if(console.log("connected: ",i),!i||!i.entities)return;this.setEntities(i.entities),this.fullDumpCallback(i),this.afterFirstConnect();const s=Ln();fetch("/castcraft/api/ping",{method:"POST",headers:{"Content-Type":"application/json"}}).then(r=>r.json()).then(r=>{const n=Ln(),a=r.serverTime+(n-s)/2;jE(a),console.log(Ln(),a,(n-s)/2),t(null)})})})})}movePlayer(t){this.socket.emit("movePlayer",{direction:t})}selectItem(t){this.socket.emit("selectItem",{item:t})}playerAction(){this.socket.emit("playerAction",{})}}async function qw(e){const t=new jw(e);return await t.waitUntilConnected(),t}class Kw{constructor(t,i){et(this,"callbacks");this.callbacks=i,t.addEventListener("touchstart",s=>this.handleTouchStart(s)),t.addEventListener("touchmove",s=>this.handleTouchMove(s)),t.addEventListener("touchend",s=>this.handleTouchEnd(s)),console.log("touch input started")}handleTouchStart(t){t.preventDefault(),console.log("touchstart"),console.log(t),this.sendTapNextToPlayer(t)}sendTapNextToPlayer(t){const i=t.touches[0].clientX,s=t.touches[0].clientY,r=window.innerWidth,n=window.innerHeight,o=r/2,a=n/2-32,h=i-o,l=s-a;if(console.log("xDiff",h,"yDiff",l),(h<-60||h>30)&&(l<-60||l>30))return;if(-60<l&&l<20&&-40<h&&h<40){this.callbacks.tapOnPlayer&&this.callbacks.tapOnPlayer();return}let c=0;Math.abs(h)>Math.abs(l)?h>0?c=2:c=3:l>0?c=0:c=1,this.callbacks.tapNextToPlayer&&this.callbacks.tapNextToPlayer(c)}handleTouchMove(t){t.preventDefault(),console.log("touchmove"),console.log(t)}handleTouchEnd(t){t.preventDefault(),console.log("touchend"),console.log(t)}}function Zw(e,t){return new Kw(e,t)}class Jw{constructor(){et(this,"preloadedImages",{});et(this,"preloadedImagesPromises",{})}errorImg(){const t=new Image;return t.src="/img/error.png",t}async getImg(t){if(t in this.preloadedImages)return this.preloadedImages[t];if(t in this.preloadedImagesPromises)return await this.preloadedImagesPromises[t],this.preloadedImages[t];const i=new Image;return i.src=t,this.preloadedImagesPromises[t]=new Promise(s=>{i.onload=()=>{i.decode().then(()=>{this.preloadedImages[t]=i,s()}).catch(r=>{console.log(r),this.preloadedImages[t]=this.errorImg(),s()})},i.onerror=()=>{this.preloadedImages[t]=this.errorImg(),s()}}),await this.preloadedImagesPromises[t],this.preloadedImages[t]}}const Qw=new Jw;async function tS(e){return await Qw.getImg(e)}class eS{constructor(t,i,s,r){et(this,"playerId");et(this,"element");et(this,"globalEntityMap");et(this,"callbacks");this.playerId=s,this.element=t,this.globalEntityMap=i,this.callbacks=r,setInterval(()=>{this.updateInventory()},1e3)}drawEmptyInventory(){this.element.innerHTML="";for(let t=0;t<5;t++)this.element.innerHTML+='<div class="inventory-slot"></div>'}async updateInventory(){this.drawEmptyInventory();const t=this.globalEntityMap[this.playerId];if(!t)return;const i=t.inventory,s=t.holding?t.holding.slug:null;if(!(!i||!i.items))for(let r=0;r<i.items.length;r++){const n=i.items[r],o=this.element.children[r],a=n.sprite;if(!a)continue;const h=document.createElement("canvas");h.width=50,h.height=50;const l=h.getContext("2d",{willReadFrequently:!0});if(!l)continue;const c=await tS(a.url);l.drawImage(c,a.x,a.y,a.width,a.height,0,0,50,50),n.quantity&&n.quantity>1&&(l.fillStyle="black",l.font="20px Arial",l.fillText(n.quantity.toString(),40,40)),n.slug==s&&(l.strokeStyle="red",l.lineWidth=5,l.strokeRect(0,0,50,50)),o.appendChild(h),this.callbacks.selectItem&&o.addEventListener("click",()=>{this.callbacks.selectItem(n)})}}}function iS(e,t,i,s){return new eS(e,t,i,s)}const Il="production";function sS(e){const t=Gi(),i={sid:qe(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>nS(i)};return e&&Is(i,e),i}function Is(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Gi(),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:qe()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const i=e.timestamp-e.started;e.duration=i>=0?i:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function rS(e,t){let i={};t?i={status:t}:e.status==="ok"&&(i={status:"exited"}),Is(e,i)}function nS(e){return Be({sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}const oS=100;class Oi{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}static clone(t){const i=new Oi;return t&&(i._breadcrumbs=[...t._breadcrumbs],i._tags={...t._tags},i._extra={...t._extra},i._contexts={...t._contexts},i._user=t._user,i._level=t._level,i._span=t._span,i._session=t._session,i._transactionName=t._transactionName,i._fingerprint=t._fingerprint,i._eventProcessors=[...t._eventProcessors],i._requestSession=t._requestSession,i._attachments=[...t._attachments],i._sdkProcessingMetadata={...t._sdkProcessingMetadata}),i}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{},this._session&&Is(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,i){return this._tags={...this._tags,[t]:i},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,i){return this._extra={...this._extra,[t]:i},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,i){return i===null?delete this._contexts[t]:this._contexts[t]=i,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this.getSpan();return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;if(typeof t=="function"){const i=t(this);return i instanceof Oi?i:this}return t instanceof Oi?(this._tags={...this._tags,...t._tags},this._extra={...this._extra,...t._extra},this._contexts={...this._contexts,...t._contexts},t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):Rs(t)&&(t=t,this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this}addBreadcrumb(t,i){const s=typeof i=="number"?i:oS;if(s<=0)return this;const r={timestamp:Bo(),...t};return this._breadcrumbs=[...this._breadcrumbs,r].slice(-s),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(t,i={}){if(this._extra&&Object.keys(this._extra).length&&(t.extra={...this._extra,...t.extra}),this._tags&&Object.keys(this._tags).length&&(t.tags={...this._tags,...t.tags}),this._user&&Object.keys(this._user).length&&(t.user={...this._user,...t.user}),this._contexts&&Object.keys(this._contexts).length&&(t.contexts={...this._contexts,...t.contexts}),this._level&&(t.level=this._level),this._transactionName&&(t.transaction=this._transactionName),this._span){t.contexts={trace:this._span.getTraceContext(),...t.contexts};const s=this._span.transaction;if(s){t.sdkProcessingMetadata={dynamicSamplingContext:s.getDynamicSamplingContext(),...t.sdkProcessingMetadata};const r=s.name;r&&(t.tags={transaction:r,...t.tags})}}return this._applyFingerprint(t),t.breadcrumbs=[...t.breadcrumbs||[],...this._breadcrumbs],t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...this._sdkProcessingMetadata},this._notifyEventProcessors([...Hp(),...this._eventProcessors],t,i)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}_notifyEventProcessors(t,i,s,r=0){return new qt((n,o)=>{const a=t[r];if(i===null||typeof a!="function")n(i);else{const h=a({...i},s);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&a.id&&h===null&&A.log(`Event processor "${a.id}" dropped event`),El(h)?h.then(l=>this._notifyEventProcessors(t,l,s,r+1).then(n)).then(null,o):this._notifyEventProcessors(t,h,s,r+1).then(n).then(null,o)}})}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}_applyFingerprint(t){t.fingerprint=t.fingerprint?gp(t.fingerprint):[],this._fingerprint&&(t.fingerprint=t.fingerprint.concat(this._fingerprint)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}}function Hp(){return xl("globalEventProcessors",()=>[])}function Lo(e){Hp().push(e)}const zp=4,aS=100;class $p{constructor(t,i=new Oi,s=zp){this._version=s,this._stack=[{scope:i}],t&&this.bindClient(t)}isOlderThan(t){return this._version<t}bindClient(t){const i=this.getStackTop();i.client=t,t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=Oi.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(t){const i=this.pushScope();try{t(i)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,i){const s=this._lastEventId=i&&i.event_id?i.event_id:qe(),r=new Error("Sentry syntheticException");return this._withClient((n,o)=>{n.captureException(t,{originalException:t,syntheticException:r,...i,event_id:s},o)}),s}captureMessage(t,i,s){const r=this._lastEventId=s&&s.event_id?s.event_id:qe(),n=new Error(t);return this._withClient((o,a)=>{o.captureMessage(t,i,{originalException:t,syntheticException:n,...s,event_id:r},a)}),r}captureEvent(t,i){const s=i&&i.event_id?i.event_id:qe();return t.type||(this._lastEventId=s),this._withClient((r,n)=>{r.captureEvent(t,{...i,event_id:s},n)}),s}lastEventId(){return this._lastEventId}addBreadcrumb(t,i){const{scope:s,client:r}=this.getStackTop();if(!r)return;const{beforeBreadcrumb:n=null,maxBreadcrumbs:o=aS}=r.getOptions&&r.getOptions()||{};if(o<=0)return;const h={timestamp:Bo(),...t},l=n?lp(()=>n(h,i)):h;l!==null&&(r.emit&&r.emit("beforeAddBreadcrumb",l,i),s.addBreadcrumb(l,o))}setUser(t){this.getScope().setUser(t)}setTags(t){this.getScope().setTags(t)}setExtras(t){this.getScope().setExtras(t)}setTag(t,i){this.getScope().setTag(t,i)}setExtra(t,i){this.getScope().setExtra(t,i)}setContext(t,i){this.getScope().setContext(t,i)}configureScope(t){const{scope:i,client:s}=this.getStackTop();s&&t(i)}run(t){const i=Hu(this);try{t(this)}finally{Hu(i)}}getIntegration(t){const i=this.getClient();if(!i)return null;try{return i.getIntegration(t)}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,i){const s=this._callExtensionMethod("startTransaction",t,i);return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&!s&&console.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`),s}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const i=this.getStackTop().scope,s=i.getSession();s&&rS(s),this._sendSessionUpdate(),i.setSession()}startSession(t){const{scope:i,client:s}=this.getStackTop(),{release:r,environment:n=Il}=s&&s.getOptions()||{},{userAgent:o}=Jt.navigator||{},a=sS({release:r,environment:n,user:i.getUser(),...o&&{userAgent:o},...t}),h=i.getSession&&i.getSession();return h&&h.status==="ok"&&Is(h,{status:"exited"}),this.endSession(),i.setSession(a),a}shouldSendDefaultPii(){const t=this.getClient(),i=t&&t.getOptions();return!!(i&&i.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:i}=this.getStackTop(),s=t.getSession();s&&i&&i.captureSession&&i.captureSession(s)}_withClient(t){const{scope:i,client:s}=this.getStackTop();s&&t(s,i)}_callExtensionMethod(t,...i){const r=Fr().__SENTRY__;if(r&&r.extensions&&typeof r.extensions[t]=="function")return r.extensions[t].apply(this,i);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function Fr(){return Jt.__SENTRY__=Jt.__SENTRY__||{extensions:{},hub:void 0},Jt}function Hu(e){const t=Fr(),i=Bh(t);return Yp(t,e),i}function tt(){const e=Fr();if(e.__SENTRY__&&e.__SENTRY__.acs){const t=e.__SENTRY__.acs.getCurrentHub();if(t)return t}return hS(e)}function hS(e=Fr()){return(!lS(e)||Bh(e).isOlderThan(zp))&&Yp(e,new $p),Bh(e)}function lS(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function Bh(e){return xl("hub",()=>new $p,e)}function Yp(e,t){if(!e)return!1;const i=e.__SENTRY__=e.__SENTRY__||{};return i.hub=t,!0}function Cl(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=tt().getClient(),i=e||t&&t.getOptions();return!!i&&(i.enableTracing||"tracesSampleRate"in i||"tracesSampler"in i)}function Ur(e){return(e||tt()).getScope().getTransaction()}let zu=!1;function cS(){zu||(zu=!0,$t("error",Oh),$t("unhandledrejection",Oh))}function Oh(){const e=Ur();if(e){const t="internal_error";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Transaction: ${t} -> Global error occured`),e.setStatus(t)}}Oh.tag="sentry_tracingErrorCallback";class Fo{__init(){this.spans=[]}constructor(t=1e3){Fo.prototype.__init.call(this),this._maxlen=t}add(t){this.spans.length>this._maxlen?t.spanRecorder=void 0:this.spans.push(t)}}class $e{__init2(){this.traceId=qe()}__init3(){this.spanId=qe().substring(16)}__init4(){this.startTimestamp=Gi()}__init5(){this.tags={}}__init6(){this.data={}}__init7(){this.instrumenter="sentry"}constructor(t){if($e.prototype.__init2.call(this),$e.prototype.__init3.call(this),$e.prototype.__init4.call(this),$e.prototype.__init5.call(this),$e.prototype.__init6.call(this),$e.prototype.__init7.call(this),!t)return this;t.traceId&&(this.traceId=t.traceId),t.spanId&&(this.spanId=t.spanId),t.parentSpanId&&(this.parentSpanId=t.parentSpanId),"sampled"in t&&(this.sampled=t.sampled),t.op&&(this.op=t.op),t.description&&(this.description=t.description),t.data&&(this.data=t.data),t.tags&&(this.tags=t.tags),t.status&&(this.status=t.status),t.startTimestamp&&(this.startTimestamp=t.startTimestamp),t.endTimestamp&&(this.endTimestamp=t.endTimestamp),t.instrumenter&&(this.instrumenter=t.instrumenter)}startChild(t){const i=new $e({...t,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(i.spanRecorder=this.spanRecorder,i.spanRecorder&&i.spanRecorder.add(i),i.transaction=this.transaction,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&i.transaction){const s=t&&t.op||"< unknown op >",r=i.transaction.name||"< unknown name >",n=i.transaction.spanId,o=`[Tracing] Starting '${s}' span on transaction '${r}' (${n}).`;i.transaction.metadata.spanMetadata[i.spanId]={logMessage:o},A.log(o)}return i}setTag(t,i){return this.tags={...this.tags,[t]:i},this}setData(t,i){return this.data={...this.data,[t]:i},this}setStatus(t){return this.status=t,this}setHttpStatus(t){this.setTag("http.status_code",String(t));const i=uS(t);return i!=="unknown_error"&&this.setStatus(i),this}isSuccess(){return this.status==="ok"}finish(t){if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:i}=this.transaction.metadata.spanMetadata[this.spanId];i&&A.log(i.replace("Starting","Finishing"))}this.endTimestamp=typeof t=="number"?t:Gi()}toTraceparent(){let t="";return this.sampled!==void 0&&(t=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${t}`}toContext(){return Be({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(t){return this.data=t.data||{},this.description=t.description,this.endTimestamp=t.endTimestamp,this.op=t.op,this.parentSpanId=t.parentSpanId,this.sampled=t.sampled,this.spanId=t.spanId||this.spanId,this.startTimestamp=t.startTimestamp||this.startTimestamp,this.status=t.status,this.tags=t.tags||{},this.traceId=t.traceId||this.traceId,this}getTraceContext(){return Be({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return Be({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}}function uS(e){if(e<400&&e>=100)return"ok";if(e>=400&&e<500)switch(e){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(e>=500&&e<600)switch(e){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}class gs extends $e{__init(){this._measurements={}}__init2(){this._contexts={}}__init3(){this._frozenDynamicSamplingContext=void 0}constructor(t,i){super(t),gs.prototype.__init.call(this),gs.prototype.__init2.call(this),gs.prototype.__init3.call(this),this._hub=i||tt(),this._name=t.name||"",this.metadata={source:"custom",...t.metadata,spanMetadata:{}},this._trimEnd=t.trimEnd,this.transaction=this;const s=this.metadata.dynamicSamplingContext;s&&(this._frozenDynamicSamplingContext={...s})}get name(){return this._name}set name(t){this.setName(t)}setName(t,i="custom"){this._name=t,this.metadata.source=i}initSpanRecorder(t=1e3){this.spanRecorder||(this.spanRecorder=new Fo(t)),this.spanRecorder.add(this)}setContext(t,i){i===null?delete this._contexts[t]:this._contexts[t]=i}setMeasurement(t,i,s=""){this._measurements[t]={value:i,unit:s}}setMetadata(t){this.metadata={...this.metadata,...t}}finish(t){if(this.endTimestamp!==void 0)return;this.name||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(t);const i=this._hub.getClient();if(i&&i.emit&&i.emit("finishTransaction",this),this.sampled!==!0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const s=this.spanRecorder?this.spanRecorder.spans.filter(a=>a!==this&&a.endTimestamp):[];this._trimEnd&&s.length>0&&(this.endTimestamp=s.reduce((a,h)=>a.endTimestamp&&h.endTimestamp?a.endTimestamp>h.endTimestamp?a:h:a).endTimestamp);const r=this.metadata,n={contexts:{...this._contexts,trace:this.getTraceContext()},spans:s,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...r,dynamicSamplingContext:this.getDynamicSamplingContext()},...r.source&&{transaction_info:{source:r.source}}};return Object.keys(this._measurements).length>0&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),n.measurements=this._measurements),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(n)}toContext(){const t=super.toContext();return Be({...t,name:this.name,trimEnd:this._trimEnd})}updateWithContext(t){return super.updateWithContext(t),this.name=t.name||"",this._trimEnd=t.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const t=this._hub||tt(),i=t&&t.getClient();if(!i)return{};const{environment:s,release:r}=i.getOptions()||{},{publicKey:n}=i.getDsn()||{},o=this.metadata.sampleRate,a=o!==void 0?o.toString():void 0,{segment:h}=t.getScope().getUser()||{},l=this.metadata.source,c=l&&l!=="url"?this.name:void 0,u=Be({environment:s||Il,release:r,transaction:c,user_segment:h,public_key:n,trace_id:this.traceId,sample_rate:a});return i.emit&&i.emit("createDsc",u),u}setHub(t){this._hub=t}}const $n={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},dS="finishReason",qi=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"];class fS extends Fo{constructor(t,i,s,r){super(r),this._pushActivity=t,this._popActivity=i,this.transactionSpanId=s}add(t){t.spanId!==this.transactionSpanId&&(t.finish=i=>{t.endTimestamp=typeof i=="number"?i:Gi(),this._popActivity(t.spanId)},t.endTimestamp===void 0&&this._pushActivity(t.spanId)),super.add(t)}}class ii extends gs{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._idleTimeoutCanceledPermanently=!1}__init5(){this._beforeFinishCallbacks=[]}__init6(){this._finishReason=qi[4]}constructor(t,i,s=$n.idleTimeout,r=$n.finalTimeout,n=$n.heartbeatInterval,o=!1){super(t,i),this._idleHub=i,this._idleTimeout=s,this._finalTimeout=r,this._heartbeatInterval=n,this._onScope=o,ii.prototype.__init.call(this),ii.prototype.__init2.call(this),ii.prototype.__init3.call(this),ii.prototype.__init4.call(this),ii.prototype.__init5.call(this),ii.prototype.__init6.call(this),o&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),i.configureScope(a=>a.setSpan(this))),this._restartIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=qi[3],this.finish())},this._finalTimeout)}finish(t=Gi()){if(this._finished=!0,this.activities={},this.op==="ui.action.click"&&this.setTag(dS,this._finishReason),this.spanRecorder){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] finishing IdleTransaction",new Date(t*1e3).toISOString(),this.op);for(const i of this._beforeFinishCallbacks)i(this,t);this.spanRecorder.spans=this.spanRecorder.spans.filter(i=>{if(i.spanId===this.spanId)return!0;i.endTimestamp||(i.endTimestamp=t,i.setStatus("cancelled"),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(i,void 0,2)));const s=i.startTimestamp<t;return s||(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(i,void 0,2)),s}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] No active IdleTransaction");if(this._onScope){const i=this._idleHub.getScope();i.getTransaction()===this&&i.setSpan(void 0)}return super.finish(t)}registerBeforeFinishCallback(t){this._beforeFinishCallbacks.push(t)}initSpanRecorder(t){if(!this.spanRecorder){const i=r=>{this._finished||this._pushActivity(r)},s=r=>{this._finished||this._popActivity(r)};this.spanRecorder=new fS(i,s,this.spanId,t),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}cancelIdleTimeout(t,{restartOnChildSpanChange:i}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=i===!1,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,Object.keys(this.activities).length===0&&this._idleTimeoutCanceledPermanently&&(this._finishReason=qi[5],this.finish(t)))}setFinishReason(t){this._finishReason=t}_restartIdleTimeout(t){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&(this._finishReason=qi[1],this.finish(t))},this._idleTimeout)}_pushActivity(t){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] pushActivity: ${t}`),this.activities[t]=!0,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(t){if(this.activities[t]&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] popActivity ${t}`),delete this.activities[t],(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){const i=Gi();this._idleTimeoutCanceledPermanently?(this._finishReason=qi[5],this.finish(i)):this._restartIdleTimeout(i+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;const t=Object.keys(this.activities).join("");t===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=t,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=qi[0],this.finish()):this._pingHeartbeat()}_pingHeartbeat(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}}function pS(){const t=this.getScope().getSpan();return t?{"sentry-trace":t.toTraceparent()}:{}}function Wp(e,t,i){if(!Cl(t))return e.sampled=!1,e;if(e.sampled!==void 0)return e.setMetadata({sampleRate:Number(e.sampled)}),e;let s;return typeof t.tracesSampler=="function"?(s=t.tracesSampler(i),e.setMetadata({sampleRate:Number(s)})):i.parentSampled!==void 0?s=i.parentSampled:typeof t.tracesSampleRate<"u"?(s=t.tracesSampleRate,e.setMetadata({sampleRate:Number(s)})):(s=1,e.setMetadata({sampleRate:s})),mS(s)?s?(e.sampled=Math.random()<s,e.sampled?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] starting ${e.op} transaction - ${e.name}`),e):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(s)})`),e)):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),e.sampled=!1,e):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("[Tracing] Discarding transaction because of invalid sample rate."),e.sampled=!1,e)}function mS(e){return hp(e)||!(typeof e=="number"||typeof e=="boolean")?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`),!1):e<0||e>1?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${e}.`),!1):!0}function _S(e,t){const i=this.getClient(),s=i&&i.getOptions()||{},r=s.instrumenter||"sentry",n=e.instrumenter||"sentry";r!==n&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(`A transaction was started with instrumenter=\`${n}\`, but the SDK is configured with the \`${r}\` instrumenter.
The transaction will not be sampled. Please use the ${r} instrumentation to start transactions.`),e.sampled=!1);let o=new gs(e,this);return o=Wp(o,s,{parentSampled:e.parentSampled,transactionContext:e,...t}),o.sampled&&o.initSpanRecorder(s._experiments&&s._experiments.maxSpans),i&&i.emit&&i.emit("startTransaction",o),o}function $u(e,t,i,s,r,n,o){const a=e.getClient(),h=a&&a.getOptions()||{};let l=new ii(t,e,i,s,o,r);return l=Wp(l,h,{parentSampled:t.parentSampled,transactionContext:t,...n}),l.sampled&&l.initSpanRecorder(h._experiments&&h._experiments.maxSpans),a&&a.emit&&a.emit("startTransaction",l),l}function gS(){const e=Fr();e.__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=_S),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=pS),cS())}function kl(e,t){return tt().captureException(e,{captureContext:t})}function yS(e,t){tt().setContext(e,t)}function vS(e){tt().withScope(e)}const bS="7";function ES(e){const t=e.protocol?`${e.protocol}:`:"",i=e.port?`:${e.port}`:"";return`${t}//${e.host}${i}${e.path?`/${e.path}`:""}/api/`}function xS(e){return`${ES(e)}${e.projectId}/envelope/`}function wS(e,t){return cx({sentry_key:e.publicKey,sentry_version:bS,...t&&{sentry_client:`${t.name}/${t.version}`}})}function SS(e,t={}){const i=typeof t=="string"?t:t.tunnel,s=typeof t=="string"||!t._metadata?void 0:t._metadata.sdk;return i||`${xS(e)}?${wS(e,s)}`}function TS(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]]),e}function AS(e,t,i,s){const r=Tl(i),n={sent_at:new Date().toISOString(),...r&&{sdk:r},...!!s&&{dsn:No(t)}},o="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return Gs(n,[o])}function RS(e,t,i,s){const r=Tl(i),n=e.type&&e.type!=="replay_event"?e.type:"event";TS(e,i&&i.sdk);const o=Ep(e,r,s,t);return delete e.sdkProcessingMetadata,Gs(o,[[{type:n},e]])}const Yu=[];function IS(e){const t={};return e.forEach(i=>{const{name:s}=i,r=t[s];r&&!r.isDefaultInstance&&i.isDefaultInstance||(t[s]=i)}),Object.keys(t).map(i=>t[i])}function CS(e){const t=e.defaultIntegrations||[],i=e.integrations;t.forEach(o=>{o.isDefaultInstance=!0});let s;Array.isArray(i)?s=[...t,...i]:typeof i=="function"?s=gp(i(t)):s=t;const r=IS(s),n=DS(r,o=>o.name==="Debug");if(n!==-1){const[o]=r.splice(n,1);r.push(o)}return r}function kS(e){const t={};return e.forEach(i=>{i&&Xp(i,t)}),t}function Xp(e,t){t[e.name]=e,Yu.indexOf(e.name)===-1&&(e.setupOnce(Lo,tt),Yu.push(e.name),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`Integration installed: ${e.name}`))}function DS(e,t){for(let i=0;i<e.length;i++)if(t(e[i])===!0)return i;return-1}function Vp(e,t,i,s){const{normalizeDepth:r=3,normalizeMaxBreadth:n=1e3}=e,o={...t,event_id:t.event_id||i.event_id||qe(),timestamp:t.timestamp||Bo()},a=i.integrations||e.integrations.map(c=>c.name);PS(o,e),NS(o,a),t.type===void 0&&MS(o,e.stackParser);let h=s;i.captureContext&&(h=Oi.clone(h).update(i.captureContext));let l=Ui(o);if(h){if(h.getAttachments){const c=[...i.attachments||[],...h.getAttachments()];c.length&&(i.attachments=c)}l=h.applyToEvent(o,i)}return l.then(c=>typeof r=="number"&&r>0?BS(c,r,n):c)}function PS(e,t){const{environment:i,release:s,dist:r,maxValueLength:n=250}=t;"environment"in e||(e.environment="environment"in t?i:Il),e.release===void 0&&s!==void 0&&(e.release=s),e.dist===void 0&&r!==void 0&&(e.dist=r),e.message&&(e.message=cr(e.message,n));const o=e.exception&&e.exception.values&&e.exception.values[0];o&&o.value&&(o.value=cr(o.value,n));const a=e.request;a&&a.url&&(a.url=cr(a.url,n))}const Wu=new WeakMap;function MS(e,t){const i=Jt._sentryDebugIds;if(!i)return;let s;const r=Wu.get(t);r?s=r:(s=new Map,Wu.set(t,s));const n=Object.keys(i).reduce((h,l)=>{let c;const u=s.get(l);u?c=u:(c=t(l),s.set(l,c));for(let d=c.length-1;d>=0;d--){const f=c[d];if(f.filename){h[f.filename]=i[l];break}}return h},{}),o=new Set;try{e.exception.values.forEach(h=>{h.stacktrace.frames.forEach(l=>{l.filename&&o.add(l.filename)})})}catch{}e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const a=e.debug_meta.images;o.forEach(h=>{n[h]&&a.push({type:"sourcemap",code_file:h,debug_id:n[h]})})}function NS(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function BS(e,t,i){if(!e)return null;const s={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(r=>({...r,...r.data&&{data:ke(r.data,t,i)}}))},...e.user&&{user:ke(e.user,t,i)},...e.contexts&&{contexts:ke(e.contexts,t,i)},...e.extra&&{extra:ke(e.extra,t,i)}};return e.contexts&&e.contexts.trace&&s.contexts&&(s.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(s.contexts.trace.data=ke(e.contexts.trace.data,t,i))),e.spans&&(s.spans=e.spans.map(r=>(r.data&&(r.data=ke(r.data,t,i)),r))),s}const Xu="Not capturing exception because it's already been captured.";class ki{__init(){this._integrations={}}__init2(){this._integrationsInitialized=!1}__init3(){this._numProcessing=0}__init4(){this._outcomes={}}__init5(){this._hooks={}}constructor(t){if(ki.prototype.__init.call(this),ki.prototype.__init2.call(this),ki.prototype.__init3.call(this),ki.prototype.__init4.call(this),ki.prototype.__init5.call(this),this._options=t,t.dsn?this._dsn=hx(t.dsn):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("No DSN provided, client will not do anything."),this._dsn){const i=SS(this._dsn,t);this._transport=t.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:i})}}captureException(t,i,s){if(Ru(t)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(Xu);return}let r=i&&i.event_id;return this._process(this.eventFromException(t,i).then(n=>this._captureEvent(n,i,s)).then(n=>{r=n})),r}captureMessage(t,i,s,r){let n=s&&s.event_id;const o=ap(t)?this.eventFromMessage(String(t),i,s):this.eventFromException(t,s);return this._process(o.then(a=>this._captureEvent(a,s,r)).then(a=>{n=a})),n}captureEvent(t,i,s){if(i&&i.originalException&&Ru(i.originalException)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(Xu);return}let r=i&&i.event_id;return this._process(this._captureEvent(t,i,s).then(n=>{r=n})),r}captureSession(t){if(!this._isEnabled()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("SDK not enabled, will not capture session.");return}typeof t.release!="string"?(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),Is(t,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(t){const i=this._transport;return i?this._isClientDoneProcessing(t).then(s=>i.flush(t).then(r=>s&&r)):Ui(!0)}close(t){return this.flush(t).then(i=>(this.getOptions().enabled=!1,i))}setupIntegrations(){this._isEnabled()&&!this._integrationsInitialized&&(this._integrations=kS(this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(t){return this._integrations[t]}getIntegration(t){try{return this._integrations[t.id]||null}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Cannot retrieve integration ${t.id} from the current Client`),null}}addIntegration(t){Xp(t,this._integrations)}sendEvent(t,i={}){if(this._dsn){let s=RS(t,this._dsn,this._options._metadata,this._options.tunnel);for(const n of i.attachments||[])s=$x(s,Xx(n,this._options.transportOptions&&this._options.transportOptions.textEncoder));const r=this._sendEnvelope(s);r&&r.then(n=>this.emit("afterSendEvent",t,n),null)}}sendSession(t){if(this._dsn){const i=AS(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(i)}}recordDroppedEvent(t,i,s){if(this._options.sendClientReports){const r=`${t}:${i}`;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`Adding outcome: "${r}"`),this._outcomes[r]=this._outcomes[r]+1||1}}on(t,i){this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(i)}emit(t,...i){this._hooks[t]&&this._hooks[t].forEach(s=>s(...i))}_updateSessionFromEvent(t,i){let s=!1,r=!1;const n=i.exception&&i.exception.values;if(n){r=!0;for(const h of n){const l=h.mechanism;if(l&&l.handled===!1){s=!0;break}}}const o=t.status==="ok";(o&&t.errors===0||o&&s)&&(Is(t,{...s&&{status:"crashed"},errors:t.errors||Number(r||s)}),this.captureSession(t))}_isClientDoneProcessing(t){return new qt(i=>{let s=0;const r=1,n=setInterval(()=>{this._numProcessing==0?(clearInterval(n),i(!0)):(s+=r,t&&s>=t&&(clearInterval(n),i(!1)))},r)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._dsn!==void 0}_prepareEvent(t,i,s){const r=this.getOptions(),n=Object.keys(this._integrations);return!i.integrations&&n.length>0&&(i.integrations=n),Vp(r,t,i,s)}_captureEvent(t,i={},s){return this._processEvent(t,i,s).then(r=>r.event_id,r=>{if(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__){const n=r;n.logLevel==="log"?A.log(n.message):A.warn(n)}})}_processEvent(t,i,s){const r=this.getOptions(),{sampleRate:n}=r;if(!this._isEnabled())return uo(new ge("SDK not enabled, will not capture event.","log"));const o=qp(t),a=jp(t),h=t.type||"error",l=`before send for type \`${h}\``;if(a&&typeof n=="number"&&Math.random()>n)return this.recordDroppedEvent("sample_rate","error",t),uo(new ge(`Discarding event because it's not included in the random sample (sampling rate = ${n})`,"log"));const c=h==="replay_event"?"replay":h;return this._prepareEvent(t,i,s).then(u=>{if(u===null)throw this.recordDroppedEvent("event_processor",c,t),new ge("An event processor returned `null`, will not send event.","log");if(i.data&&i.data.__sentry__===!0)return u;const f=LS(r,u,i);return OS(f,l)}).then(u=>{if(u===null)throw this.recordDroppedEvent("before_send",c,t),new ge(`${l} returned \`null\`, will not send event.`,"log");const d=s&&s.getSession();!o&&d&&this._updateSessionFromEvent(d,u);const f=u.transaction_info;if(o&&f&&u.transaction!==t.transaction){const p="custom";u.transaction_info={...f,source:p}}return this.sendEvent(u,i),u}).then(null,u=>{throw u instanceof ge?u:(this.captureException(u,{data:{__sentry__:!0},originalException:u}),new ge(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${u}`))})}_process(t){this._numProcessing++,t.then(i=>(this._numProcessing--,i),i=>(this._numProcessing--,i))}_sendEnvelope(t){if(this._transport&&this._dsn)return this.emit("beforeEnvelope",t),this._transport.send(t).then(null,i=>{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("Error while sending event:",i)});(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("Transport disabled")}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.keys(t).map(i=>{const[s,r]=i.split(":");return{reason:s,category:r,quantity:t[i]}})}}function OS(e,t){const i=`${t} must return \`null\` or a valid event.`;if(El(e))return e.then(s=>{if(!Rs(s)&&s!==null)throw new ge(i);return s},s=>{throw new ge(`${t} rejected with ${s}`)});if(!Rs(e)&&e!==null)throw new ge(i);return e}function LS(e,t,i){const{beforeSend:s,beforeSendTransaction:r}=e;return jp(t)&&s?s(t,i):qp(t)&&r?r(t,i):t}function jp(e){return e.type===void 0}function qp(e){return e.type==="transaction"}function FS(e,t){t.debug===!0&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?A.enable():console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle."));const i=tt();i.getScope().update(t.initialScope);const r=new e(t);i.bindClient(r)}const US=30;function Kp(e,t,i=Ox(e.bufferSize||US)){let s={};const r=o=>i.drain(o);function n(o){const a=[];if(Cu(o,(u,d)=>{const f=ku(d);if(Jx(s,f)){const p=Vu(u,d);e.recordDroppedEvent("ratelimit_backoff",f,p)}else a.push(u)}),a.length===0)return Ui();const h=Gs(o[0],a),l=u=>{Cu(h,(d,f)=>{const p=Vu(d,f);e.recordDroppedEvent(u,ku(f),p)})},c=()=>t({body:Yx(h,e.textEncoder)}).then(u=>(u.statusCode!==void 0&&(u.statusCode<200||u.statusCode>=300)&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Sentry responded with status code ${u.statusCode} to sent event.`),s=Qx(s,u),u),u=>{throw l("network_error"),u});return i.add(c).then(u=>u,u=>{if(u instanceof ge)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("Skipped sending event because buffer is full."),l("queue_overflow"),Ui();throw u})}return n.__sentry__baseTransport__=!0,{send:n,flush:r}}function Vu(e,t){if(!(t!=="event"&&t!=="transaction"))return Array.isArray(e)?e[1]:void 0}const ju="7.54.0";let qu;class wr{constructor(){wr.prototype.__init.call(this)}static __initStatic(){this.id="FunctionToString"}__init(){this.name=wr.id}setupOnce(){qu=Function.prototype.toString;try{Function.prototype.toString=function(...t){const i=Sl(this)||this;return qu.apply(i,t)}}catch{}}}wr.__initStatic();const GS=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],HS=[/^.*healthcheck.*$/,/^.*healthy.*$/,/^.*live.*$/,/^.*ready.*$/,/^.*heartbeat.*$/,/^.*\/health$/,/^.*\/healthz$/];class ys{static __initStatic(){this.id="InboundFilters"}__init(){this.name=ys.id}constructor(t={}){this._options=t,ys.prototype.__init.call(this)}setupOnce(t,i){const s=r=>{const n=i();if(n){const o=n.getIntegration(ys);if(o){const a=n.getClient(),h=a?a.getOptions():{},l=zS(o._options,h);return $S(r,l)?null:r}}return r};s.id=this.name,t(s)}}ys.__initStatic();function zS(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:GS],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[],...e.disableTransactionDefaults?[]:HS],ignoreInternal:e.ignoreInternal!==void 0?e.ignoreInternal:!0}}function $S(e,t){return t.ignoreInternal&&qS(e)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Event dropped due to being internal Sentry Error.
Event: ${ri(e)}`),!0):YS(e,t.ignoreErrors)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ri(e)}`),!0):WS(e,t.ignoreTransactions)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${ri(e)}`),!0):XS(e,t.denyUrls)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ri(e)}.
Url: ${fo(e)}`),!0):VS(e,t.allowUrls)?!1:((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ri(e)}.
Url: ${fo(e)}`),!0)}function YS(e,t){return e.type||!t||!t.length?!1:jS(e).some(i=>Us(i,t))}function WS(e,t){if(e.type!=="transaction"||!t||!t.length)return!1;const i=e.transaction;return i?Us(i,t):!1}function XS(e,t){if(!t||!t.length)return!1;const i=fo(e);return i?Us(i,t):!1}function VS(e,t){if(!t||!t.length)return!0;const i=fo(e);return i?Us(i,t):!0}function jS(e){if(e.message)return[e.message];if(e.exception){const{values:t}=e.exception;try{const{type:i="",value:s=""}=t&&t[t.length-1]||{};return[`${s}`,`${i}: ${s}`]}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(`Cannot extract message for event ${ri(e)}`),[]}}return[]}function qS(e){try{return e.exception.values[0].type==="SentryError"}catch{}return!1}function KS(e=[]){for(let t=e.length-1;t>=0;t--){const i=e[t];if(i&&i.filename!=="<anonymous>"&&i.filename!=="[native code]")return i.filename||null}return null}function fo(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch{}return t?KS(t):null}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(`Cannot extract url for event ${ri(e)}`),null}}const dt=Jt;let Lh=0;function Zp(){return Lh>0}function ZS(){Lh++,setTimeout(()=>{Lh--})}function Cs(e,t={},i){if(typeof e!="function")return e;try{const r=e.__sentry_wrapped__;if(r)return r;if(Sl(e))return e}catch{return e}const s=function(){const r=Array.prototype.slice.call(arguments);try{i&&typeof i=="function"&&i.apply(this,arguments);const n=r.map(o=>Cs(o,t));return e.apply(this,n)}catch(n){throw ZS(),vS(o=>{o.addEventProcessor(a=>(t.mechanism&&(Th(a,void 0,void 0),xr(a,t.mechanism)),a.extra={...a.extra,arguments:r},a)),kl(n)}),n}};try{for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}catch{}up(s,e),wl(e,"__sentry_wrapped__",s);try{Object.getOwnPropertyDescriptor(s,"name").configurable&&Object.defineProperty(s,"name",{get(){return e.name}})}catch{}return s}function Jp(e,t){const i=Dl(e,t),s={type:t&&t.name,value:eT(t)};return i.length&&(s.stacktrace={frames:i}),s.type===void 0&&s.value===""&&(s.value="Unrecoverable error caught"),s}function JS(e,t,i,s){const n=tt().getClient(),o=n&&n.getOptions().normalizeDepth,a={exception:{values:[{type:bl(t)?t.constructor.name:s?"UnhandledRejection":"Error",value:`Non-Error ${s?"promise rejection":"exception"} captured with keys: ${ux(t)}`}]},extra:{__serialized__:vp(t,o)}};if(i){const h=Dl(e,i);h.length&&(a.exception.values[0].stacktrace={frames:h})}return a}function Pa(e,t){return{exception:{values:[Jp(e,t)]}}}function Dl(e,t){const i=t.stacktrace||t.stack||"",s=tT(t);try{return e(i,s)}catch{}return[]}const QS=/Minified React error #\d+;/i;function tT(e){if(e){if(typeof e.framesToPop=="number")return e.framesToPop;if(QS.test(e.message))return 1}return 0}function eT(e){const t=e&&e.message;return t?t.error&&typeof t.error.message=="string"?t.error.message:t:"No error message"}function iT(e,t,i,s){const r=i&&i.syntheticException||void 0,n=Pl(e,t,r,s);return xr(n),n.level="error",i&&i.event_id&&(n.event_id=i.event_id),Ui(n)}function sT(e,t,i="info",s,r){const n=s&&s.syntheticException||void 0,o=Fh(e,t,n,r);return o.level=i,s&&s.event_id&&(o.event_id=s.event_id),Ui(o)}function Pl(e,t,i,s,r){let n;if(op(t)&&t.error)return Pa(e,t.error);if(yu(t)||qE(t)){const o=t;if("stack"in t)n=Pa(e,t);else{const a=o.name||(yu(o)?"DOMError":"DOMException"),h=o.message?`${a}: ${o.message}`:a;n=Fh(e,h,i,s),Th(n,h)}return"code"in o&&(n.tags={...n.tags,"DOMException.code":`${o.code}`}),n}return np(t)?Pa(e,t):Rs(t)||bl(t)?(n=JS(e,t,i,r),xr(n,{synthetic:!0}),n):(n=Fh(e,t,i,s),Th(n,`${t}`,void 0),xr(n,{synthetic:!0}),n)}function Fh(e,t,i,s){const r={message:t};if(s&&i){const n=Dl(e,i);n.length&&(r.exception={values:[{value:t,stacktrace:{frames:n}}]})}return r}const wn=1024,Qp="Breadcrumbs";class Sr{static __initStatic(){this.id=Qp}__init(){this.name=Sr.id}constructor(t){Sr.prototype.__init.call(this),this.options={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t}}setupOnce(){this.options.console&&$t("console",nT),this.options.dom&&$t("dom",rT(this.options.dom)),this.options.xhr&&$t("xhr",oT),this.options.fetch&&$t("fetch",aT),this.options.history&&$t("history",hT)}addSentryBreadcrumb(t){this.options.sentry&&tt().addBreadcrumb({category:`sentry.${t.type==="transaction"?"transaction":"event"}`,event_id:t.event_id,level:t.level,message:ri(t)},{event:t})}}Sr.__initStatic();function rT(e){function t(i){let s,r=typeof e=="object"?e.serializeAttribute:void 0,n=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;n&&n>wn&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`\`dom.maxStringLength\` cannot exceed ${wn}, but a value of ${n} was configured. Sentry will use ${wn} instead.`),n=wn),typeof r=="string"&&(r=[r]);try{const o=i.event;s=lT(o)?vi(o.target,{keyAttrs:r,maxStringLength:n}):vi(o,{keyAttrs:r,maxStringLength:n})}catch{s="<unknown>"}s.length!==0&&tt().addBreadcrumb({category:`ui.${i.name}`,message:s},{event:i.event,name:i.name,global:i.global})}return t}function nT(e){for(let i=0;i<e.args.length;i++)if(e.args[i]==="ref=Ref<"){e.args[i+1]="viewRef";break}const t={category:"console",data:{arguments:e.args,logger:"console"},level:Fx(e.level),message:bu(e.args," ")};if(e.level==="assert")if(e.args[0]===!1)t.message=`Assertion failed: ${bu(e.args.slice(1)," ")||"console.assert"}`,t.data.arguments=e.args.slice(1);else return;tt().addBreadcrumb(t,{input:e.args,level:e.level})}function oT(e){const{startTimestamp:t,endTimestamp:i}=e,s=e.xhr[hi];if(!t||!i||!s)return;const{method:r,url:n,status_code:o,body:a}=s,h={method:r,url:n,status_code:o},l={xhr:e.xhr,input:a,startTimestamp:t,endTimestamp:i};tt().addBreadcrumb({category:"xhr",data:h,type:"http"},l)}function aT(e){const{startTimestamp:t,endTimestamp:i}=e;if(i&&!(e.fetchData.url.match(/sentry_key/)&&e.fetchData.method==="POST"))if(e.error){const s=e.fetchData,r={data:e.error,input:e.args,startTimestamp:t,endTimestamp:i};tt().addBreadcrumb({category:"fetch",data:s,level:"error",type:"http"},r)}else{const s={...e.fetchData,status_code:e.response&&e.response.status},r={input:e.args,response:e.response,startTimestamp:t,endTimestamp:i};tt().addBreadcrumb({category:"fetch",data:s,type:"http"},r)}}function hT(e){let t=e.from,i=e.to;const s=ka(dt.location.href);let r=ka(t);const n=ka(i);r.path||(r=s),s.protocol===n.protocol&&s.host===n.host&&(i=n.relative),s.protocol===r.protocol&&s.host===r.host&&(t=r.relative),tt().addBreadcrumb({category:"navigation",data:{from:t,to:i}})}function lT(e){return e&&!!e.target}function cT(e,{metadata:t,tunnel:i,dsn:s}){const r={event_id:e.event_id,sent_at:new Date().toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!i&&!!s&&{dsn:No(s)}},n=uT(e);return Gs(r,[n])}function uT(e){return[{type:"user_report"},e]}class dT extends ki{constructor(t){const i=dt.SENTRY_SDK_SOURCE||kx();t._metadata=t._metadata||{},t._metadata.sdk=t._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:`${i}:@sentry/browser`,version:ju}],version:ju},super(t),t.sendClientReports&&dt.document&&dt.document.addEventListener("visibilitychange",()=>{dt.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(t,i){return iT(this._options.stackParser,t,i,this._options.attachStacktrace)}eventFromMessage(t,i="info",s){return sT(this._options.stackParser,t,i,s,this._options.attachStacktrace)}sendEvent(t,i){const s=this.getIntegrationById(Qp);s&&s.addSentryBreadcrumb&&s.addSentryBreadcrumb(t),super.sendEvent(t,i)}captureUserFeedback(t){if(!this._isEnabled()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("SDK not enabled, will not capture user feedback.");return}const i=cT(t,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(i)}_prepareEvent(t,i,s){return t.platform=t.platform||"javascript",super._prepareEvent(t,i,s)}_flushOutcomes(){const t=this._clearOutcomes();if(t.length===0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("No outcomes to send");return}if(!this._dsn){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("No dsn provided, will not send outcomes");return}(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("Sending outcomes:",t);const i=jx(t,this._options.tunnel&&No(this._dsn));this._sendEnvelope(i)}}let sr;function fT(){if(sr)return sr;if(wh(dt.fetch))return sr=dt.fetch.bind(dt);const e=dt.document;let t=dt.fetch;if(e&&typeof e.createElement=="function")try{const i=e.createElement("iframe");i.hidden=!0,e.head.appendChild(i);const s=i.contentWindow;s&&s.fetch&&(t=s.fetch),e.head.removeChild(i)}catch(i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",i)}return sr=t.bind(dt)}function pT(){sr=void 0}function mT(e,t=fT()){let i=0,s=0;function r(n){const o=n.body.length;i+=o,s++;const a={body:n.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:i<=6e4&&s<15,...e.fetchOptions};try{return t(e.url,a).then(h=>(i-=o,s--,{statusCode:h.status,headers:{"x-sentry-rate-limits":h.headers.get("X-Sentry-Rate-Limits"),"retry-after":h.headers.get("Retry-After")}}))}catch(h){return pT(),i-=o,s--,uo(h)}}return Kp(e,r)}const _T=4;function gT(e){function t(i){return new qt((s,r)=>{const n=new XMLHttpRequest;n.onerror=r,n.onreadystatechange=()=>{n.readyState===_T&&s({statusCode:n.status,headers:{"x-sentry-rate-limits":n.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":n.getResponseHeader("Retry-After")}})},n.open("POST",e.url);for(const o in e.headers)Object.prototype.hasOwnProperty.call(e.headers,o)&&n.setRequestHeader(o,e.headers[o]);n.send(i.body)})}return Kp(e,t)}const Uo="?",yT=30,vT=40,bT=50;function Ml(e,t,i,s){const r={filename:e,function:t,in_app:!0};return i!==void 0&&(r.lineno=i),s!==void 0&&(r.colno=s),r}const ET=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,xT=/\((\S*)(?::(\d+))(?::(\d+))\)/,wT=e=>{const t=ET.exec(e);if(t){if(t[2]&&t[2].indexOf("eval")===0){const n=xT.exec(t[2]);n&&(t[2]=n[1],t[3]=n[2],t[4]=n[3])}const[s,r]=tm(t[1]||Uo,t[2]);return Ml(r,s,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}},ST=[yT,wT],TT=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,AT=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,RT=e=>{const t=TT.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const n=AT.exec(t[3]);n&&(t[1]=t[1]||"eval",t[3]=n[1],t[4]=n[2],t[5]="")}let s=t[3],r=t[1]||Uo;return[r,s]=tm(r,s),Ml(s,r,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},IT=[bT,RT],CT=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,kT=e=>{const t=CT.exec(e);return t?Ml(t[2],t[1]||Uo,+t[3],t[4]?+t[4]:void 0):void 0},DT=[vT,kT],PT=[ST,IT,DT],MT=pp(...PT),tm=(e,t)=>{const i=e.indexOf("safari-extension")!==-1,s=e.indexOf("safari-web-extension")!==-1;return i||s?[e.indexOf("@")!==-1?e.split("@")[0]:Uo,i?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]};class di{static __initStatic(){this.id="GlobalHandlers"}__init(){this.name=di.id}__init2(){this._installFunc={onerror:NT,onunhandledrejection:BT}}constructor(t){di.prototype.__init.call(this),di.prototype.__init2.call(this),this._options={onerror:!0,onunhandledrejection:!0,...t}}setupOnce(){Error.stackTraceLimit=50;const t=this._options;for(const i in t){const s=this._installFunc[i];s&&t[i]&&(FT(i),s(),this._installFunc[i]=void 0)}}}di.__initStatic();function NT(){$t("error",e=>{const[t,i,s]=sm();if(!t.getIntegration(di))return;const{msg:r,url:n,line:o,column:a,error:h}=e;if(Zp()||h&&h.__sentry_own_request__)return;const l=h===void 0&&gi(r)?LT(r,n,o,a):em(Pl(i,h||r,void 0,s,!1),n,o,a);l.level="error",im(t,h,l,"onerror")})}function BT(){$t("unhandledrejection",e=>{const[t,i,s]=sm();if(!t.getIntegration(di))return;let r=e;try{"reason"in e?r=e.reason:"detail"in e&&"reason"in e.detail&&(r=e.detail.reason)}catch{}if(Zp()||r&&r.__sentry_own_request__)return!0;const n=ap(r)?OT(r):Pl(i,r,void 0,s,!0);n.level="error",im(t,r,n,"onunhandledrejection")})}function OT(e){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(e)}`}]}}}function LT(e,t,i,s){const r=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;let n=op(e)?e.message:e,o="Error";const a=n.match(r);return a&&(o=a[1],n=a[2]),em({exception:{values:[{type:o,value:n}]}},t,i,s)}function em(e,t,i,s){const r=e.exception=e.exception||{},n=r.values=r.values||[],o=n[0]=n[0]||{},a=o.stacktrace=o.stacktrace||{},h=a.frames=a.frames||[],l=isNaN(parseInt(s,10))?void 0:s,c=isNaN(parseInt(i,10))?void 0:i,u=gi(t)&&t.length>0?t:ex();return h.length===0&&h.push({colno:l,filename:u,function:"?",in_app:!0,lineno:c}),e}function FT(e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`Global Handler attached: ${e}`)}function im(e,t,i,s){xr(i,{handled:!1,type:s}),e.captureEvent(i,{originalException:t})}function sm(){const e=tt(),t=e.getClient(),i=t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1};return[e,i.stackParser,i.attachStacktrace]}const UT=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];class Tr{static __initStatic(){this.id="TryCatch"}__init(){this.name=Tr.id}constructor(t){Tr.prototype.__init.call(this),this._options={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t}}setupOnce(){this._options.setTimeout&&Wt(dt,"setTimeout",Ku),this._options.setInterval&&Wt(dt,"setInterval",Ku),this._options.requestAnimationFrame&&Wt(dt,"requestAnimationFrame",GT),this._options.XMLHttpRequest&&"XMLHttpRequest"in dt&&Wt(XMLHttpRequest.prototype,"send",HT);const t=this._options.eventTarget;t&&(Array.isArray(t)?t:UT).forEach(zT)}}Tr.__initStatic();function Ku(e){return function(...t){const i=t[0];return t[0]=Cs(i,{mechanism:{data:{function:bi(e)},handled:!0,type:"instrument"}}),e.apply(this,t)}}function GT(e){return function(t){return e.apply(this,[Cs(t,{mechanism:{data:{function:"requestAnimationFrame",handler:bi(e)},handled:!0,type:"instrument"}})])}}function HT(e){return function(...t){const i=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(r=>{r in i&&typeof i[r]=="function"&&Wt(i,r,function(n){const o={mechanism:{data:{function:r,handler:bi(n)},handled:!0,type:"instrument"}},a=Sl(n);return a&&(o.mechanism.data.handler=bi(a)),Cs(n,o)})}),e.apply(this,t)}}function zT(e){const t=dt,i=t[e]&&t[e].prototype;!i||!i.hasOwnProperty||!i.hasOwnProperty("addEventListener")||(Wt(i,"addEventListener",function(s){return function(r,n,o){try{typeof n.handleEvent=="function"&&(n.handleEvent=Cs(n.handleEvent,{mechanism:{data:{function:"handleEvent",handler:bi(n),target:e},handled:!0,type:"instrument"}}))}catch{}return s.apply(this,[r,Cs(n,{mechanism:{data:{function:"addEventListener",handler:bi(n),target:e},handled:!0,type:"instrument"}}),o])}}),Wt(i,"removeEventListener",function(s){return function(r,n,o){const a=n;try{const h=a&&a.__sentry_wrapped__;h&&s.call(this,r,h,o)}catch{}return s.call(this,r,a,o)}}))}const $T="cause",YT=5;class vs{static __initStatic(){this.id="LinkedErrors"}__init(){this.name=vs.id}constructor(t={}){vs.prototype.__init.call(this),this._key=t.key||$T,this._limit=t.limit||YT}setupOnce(){const t=tt().getClient();t&&Lo((i,s)=>{const r=tt().getIntegration(vs);return r?WT(t.getOptions().stackParser,r._key,r._limit,i,s):i})}}vs.__initStatic();function WT(e,t,i,s,r){if(!s.exception||!s.exception.values||!r||!yi(r.originalException,Error))return s;const n=rm(e,i,r.originalException,t);return s.exception.values=[...n,...s.exception.values],s}function rm(e,t,i,s,r=[]){if(!yi(i[s],Error)||r.length+1>=t)return r;const n=Jp(e,i[s]);return rm(e,t,i[s],s,[n,...r])}class bs{constructor(){bs.prototype.__init.call(this)}static __initStatic(){this.id="HttpContext"}__init(){this.name=bs.id}setupOnce(){Lo(t=>{if(tt().getIntegration(bs)){if(!dt.navigator&&!dt.location&&!dt.document)return t;const i=t.request&&t.request.url||dt.location&&dt.location.href,{referrer:s}=dt.document||{},{userAgent:r}=dt.navigator||{},n={...t.request&&t.request.headers,...s&&{Referer:s},...r&&{"User-Agent":r}},o={...t.request,...i&&{url:i},headers:n};return{...t,request:o}}return t})}}bs.__initStatic();class Es{constructor(){Es.prototype.__init.call(this)}static __initStatic(){this.id="Dedupe"}__init(){this.name=Es.id}setupOnce(t,i){const s=r=>{if(r.type)return r;const n=i().getIntegration(Es);if(n){try{if(XT(r,n._previousEvent))return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{return n._previousEvent=r}return n._previousEvent=r}return r};s.id=this.name,t(s)}}Es.__initStatic();function XT(e,t){return t?!!(VT(e,t)||jT(e,t)):!1}function VT(e,t){const i=e.message,s=t.message;return!(!i&&!s||i&&!s||!i&&s||i!==s||!om(e,t)||!nm(e,t))}function jT(e,t){const i=Zu(t),s=Zu(e);return!(!i||!s||i.type!==s.type||i.value!==s.value||!om(e,t)||!nm(e,t))}function nm(e,t){let i=Ju(e),s=Ju(t);if(!i&&!s)return!0;if(i&&!s||!i&&s||(i=i,s=s,s.length!==i.length))return!1;for(let r=0;r<s.length;r++){const n=s[r],o=i[r];if(n.filename!==o.filename||n.lineno!==o.lineno||n.colno!==o.colno||n.function!==o.function)return!1}return!0}function om(e,t){let i=e.fingerprint,s=t.fingerprint;if(!i&&!s)return!0;if(i&&!s||!i&&s)return!1;i=i,s=s;try{return i.join("")===s.join("")}catch{return!1}}function Zu(e){return e.exception&&e.exception.values&&e.exception.values[0]}function Ju(e){const t=e.exception;if(t)try{return t.values[0].stacktrace.frames}catch{return}}const qT=[new ys,new wr,new Tr,new Sr,new di,new vs,new Es,new bs];function KT(e={}){e.defaultIntegrations===void 0&&(e.defaultIntegrations=qT),e.release===void 0&&(typeof __SENTRY_RELEASE__=="string"&&(e.release=__SENTRY_RELEASE__),dt.SENTRY_RELEASE&&dt.SENTRY_RELEASE.id&&(e.release=dt.SENTRY_RELEASE.id)),e.autoSessionTracking===void 0&&(e.autoSessionTracking=!0),e.sendClientReports===void 0&&(e.sendClientReports=!0);const t={...e,stackParser:dx(e.stackParser||MT),integrations:CS(e),transport:e.transport||(mp()?mT:gT)};FS(dT,t),e.autoSessionTracking&&ZT()}function Qu(e){e.startSession({ignoreDuration:!0}),e.captureSession()}function ZT(){if(typeof dt.document>"u"){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Session tracking in non-browser environment with @sentry/browser is not supported.");return}const e=tt();e.captureSession&&(Qu(e),$t("history",({from:t,to:i})=>{t===void 0||t===i||Qu(tt())}))}const ht=Jt,Nl="sentryReplaySession",JT="replay_event",Bl="Unable to send Replay",QT=3e5,t1=9e5,e1=36e5,i1=5e3,s1=5500,r1=6e4,n1=5e3,o1=3,Sn=15e4,Tn=5e3;var Ft;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(Ft||(Ft={}));function a1(e){return e.nodeType===e.ELEMENT_NODE}function dr(e){const t=e==null?void 0:e.host;return!!(t&&t.shadowRoot&&t.shadowRoot===e)}function am({maskInputOptions:e,tagName:t,type:i}){t.toLowerCase()==="option"&&(t="select");const s=typeof i=="string"?i.toLowerCase():void 0;return e[t.toLowerCase()]||s&&e[s]||s==="password"||t==="input"&&!i&&e.text}function h1({tagName:e,type:t,maskInputOptions:i,maskInputSelector:s}){return s||am({maskInputOptions:i,tagName:e,type:t})}function Ar({input:e,maskInputSelector:t,unmaskInputSelector:i,maskInputOptions:s,tagName:r,type:n,value:o,maskInputFn:a}){let h=o||"";return i&&e.matches(i)||(e.hasAttribute("data-rr-is-password")&&(n="password"),(am({maskInputOptions:s,tagName:r,type:n})||t&&e.matches(t))&&(a?h=a(h):h="*".repeat(h.length))),h}const td="__rrweb_original__";function l1(e){const t=e.getContext("2d");if(!t)return!0;const i=50;for(let s=0;s<e.width;s+=i)for(let r=0;r<e.height;r+=i){const n=t.getImageData,o=td in n?n[td]:n;if(new Uint32Array(o.call(t,s,r,Math.min(i,e.width-s),Math.min(i,e.height-r)).data.buffer).some(h=>h!==0))return!1}return!0}function hm(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?t.toLowerCase():null}function Uh(e,t,i){return typeof i=="string"&&i.toLowerCase(),t==="INPUT"&&(i==="radio"||i==="checkbox")?e.getAttribute("value")||"":e.value}let c1=1;const u1=new RegExp("[^a-z0-9-_:]"),Rr=-2;function lm(e){return e?e.replace(/[\S]/g,"*"):""}function d1(){return c1++}function f1(e){if(e instanceof HTMLFormElement)return"form";const t=e.tagName.toLowerCase().trim();return u1.test(t)?"div":t}function Gh(e){try{const t=e.rules||e.cssRules;return t?Array.from(t).map(p1).join(""):null}catch{return null}}function p1(e){let t=e.cssText;if(m1(e))try{t=Gh(e.styleSheet)||t}catch{}return cm(t)}function cm(e){if(e.indexOf(":")>-1){const t=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return e.replace(t,"$1\\$2")}return e}function m1(e){return"styleSheet"in e}function _1(e){return e.cssRules?Array.from(e.cssRules).map(t=>t.cssText?cm(t.cssText):"").join(""):""}function g1(e){let t="";return e.indexOf("//")>-1?t=e.split("/").slice(0,3).join("/"):t=e.split("/")[0],t=t.split("?")[0],t}let Ki,ed;const y1=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,v1=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,b1=/^(data:)([^,]*),(.*)/i;function Yn(e,t){return(e||"").replace(y1,(i,s,r,n,o,a)=>{const h=r||o||a,l=s||n||"";if(!h)return i;if(!v1.test(h))return`url(${l}${h}${l})`;if(b1.test(h))return`url(${l}${h}${l})`;if(h[0]==="/")return`url(${l}${g1(t)+h}${l})`;const c=t.split("/"),u=h.split("/");c.pop();for(const d of u)d!=="."&&(d===".."?c.pop():c.push(d));return`url(${l}${c.join("/")}${l})`})}const E1=/^[^ \t\n\r\u000c]+/,x1=/^[, \t\n\r\u000c]+/;function w1(e,t){if(t.trim()==="")return t;let i=0;function s(n){let o,a=n.exec(t.substring(i));return a?(o=a[0],i+=o.length,o):""}let r=[];for(;s(x1),!(i>=t.length);){let n=s(E1);if(n.slice(-1)===",")n=as(e,n.substring(0,n.length-1)),r.push(n);else{let o="";n=as(e,n);let a=!1;for(;;){let h=t.charAt(i);if(h===""){r.push((n+o).trim());break}else if(a)h===")"&&(a=!1);else if(h===","){i+=1,r.push((n+o).trim());break}else h==="("&&(a=!0);o+=h,i+=1}}}return r.join(", ")}function as(e,t){if(!t||t.trim()==="")return t;const i=e.createElement("a");return i.href=t,i.href}function S1(e){return!!(e.tagName==="svg"||e.ownerSVGElement)}function Hh(){const e=document.createElement("a");return e.href="",e.href}function um(e,t,i,s,r,n,o,a){if(!r)return r;const h=s.toLowerCase(),l=i.toLowerCase();return h==="src"||h==="href"||h==="xlink:href"&&r[0]!=="#"||h==="background"&&(l==="table"||l==="td"||l==="th")?as(e,r):h==="srcset"?w1(e,r):h==="style"?Yn(r,Hh()):l==="object"&&h==="data"?as(e,r):n&&T1(t,h,l,o)?a?a(r):lm(r):r}function T1(e,t,i,s){return s&&e.matches(s)?!1:["placeholder","title","aria-label"].indexOf(t)>-1||i==="input"&&t==="value"&&e.hasAttribute("type")&&["submit","button"].indexOf(e.getAttribute("type").toLowerCase())>-1}function A1(e,t,i,s){if(s&&e.matches(s))return!1;if(typeof t=="string"){if(e.classList.contains(t))return!0}else for(let r=0;r<e.classList.length;r++){const n=e.classList[r];if(t.test(n))return!0}return i?e.matches(i):!1}function po(e,t,i,s,r){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return po(e.parentNode,t,i,s,r);if(s&&(e.matches(s)||e.closest(s)))return!1;if(r)return!0;if(typeof t=="string"){if(e.classList.contains(t))return!0}else for(let n=0;n<e.classList.length;n++){const o=e.classList[n];if(t.test(o))return!0}return i&&e.matches(i)?!0:po(e.parentNode,t,i,s,r)}function R1(e,t,i){const s=e.contentWindow;if(!s)return;let r=!1,n;try{n=s.document.readyState}catch{return}if(n!=="complete"){const a=setTimeout(()=>{r||(t(),r=!0)},i);e.addEventListener("load",()=>{clearTimeout(a),r=!0,t()});return}const o="about:blank";if(s.location.href!==o||e.src===o||e.src===""){setTimeout(t,0);return}e.addEventListener("load",t)}function I1(e,t){var i;const{doc:s,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:a,maskTextSelector:h,unmaskTextSelector:l,inlineStylesheet:c,maskInputSelector:u,unmaskInputSelector:d,maskAllText:f,maskInputOptions:p={},maskTextFn:m,maskInputFn:_,dataURLOptions:y={},inlineImages:b,recordCanvas:g,keepIframeSrcFn:v}=t;let S;if(s.__sn){const R=s.__sn.id;S=R===1?void 0:R}switch(e.nodeType){case e.DOCUMENT_NODE:return e.compatMode!=="CSS1Compat"?{type:Ft.Document,childNodes:[],compatMode:e.compatMode,rootId:S}:{type:Ft.Document,childNodes:[],rootId:S};case e.DOCUMENT_TYPE_NODE:return{type:Ft.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:S};case e.ELEMENT_NODE:const R=A1(e,r,n,o),T=f1(e);let x={};for(const{name:E,value:w}of Array.from(e.attributes))D1(T,E)||(x[E]=um(s,e,T,E,w,f,l,m));if(T==="link"&&c){const E=Array.from(s.styleSheets).find(F=>F.href===e.href);let w=null;E&&(w=Gh(E)),w&&(delete x.rel,delete x.href,x._cssText=Yn(w,E.href))}if(T==="style"&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const E=Gh(e.sheet);E&&(x._cssText=Yn(E,Hh()))}if(T==="input"||T==="textarea"||T==="select"||T==="option"){const E=e,w=hm(E),F=Uh(E,T.toUpperCase(),w),G=e.checked;w!=="submit"&&w!=="button"&&F&&(x.value=Ar({input:E,type:w,tagName:T,value:F,maskInputSelector:u,unmaskInputSelector:d,maskInputOptions:p,maskInputFn:_})),G&&(x.checked=G)}if(T==="option"&&(e.selected&&!p.select?x.selected=!0:delete x.selected),T==="canvas"&&g){if(e.__context==="2d")l1(e)||(x.rr_dataURL=e.toDataURL(y.type,y.quality));else if(!("__context"in e)){const E=e.toDataURL(y.type,y.quality),w=document.createElement("canvas");w.width=e.width,w.height=e.height;const F=w.toDataURL(y.type,y.quality);E!==F&&(x.rr_dataURL=E)}}if(T==="img"&&b){Ki||(Ki=s.createElement("canvas"),ed=Ki.getContext("2d"));const E=e,w=E.crossOrigin;E.crossOrigin="anonymous";const F=()=>{try{Ki.width=E.naturalWidth,Ki.height=E.naturalHeight,ed.drawImage(E,0,0),x.rr_dataURL=Ki.toDataURL(y.type,y.quality)}catch(G){console.warn(`Cannot inline img src=${E.currentSrc}! Error: ${G}`)}w?x.crossOrigin=w:delete x.crossOrigin};E.complete&&E.naturalWidth!==0?F():E.onload=F}if((T==="audio"||T==="video")&&(x.rr_mediaState=e.paused?"paused":"played",x.rr_mediaCurrentTime=e.currentTime),e.scrollLeft&&(x.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(x.rr_scrollTop=e.scrollTop),R){const{width:E,height:w}=e.getBoundingClientRect();x={class:x.class,rr_width:`${E}px`,rr_height:`${w}px`}}return T==="iframe"&&!v(x.src)&&(e.contentDocument||(x.rr_src=x.src),delete x.src),{type:Ft.Element,tagName:T,attributes:x,childNodes:[],isSVG:S1(e)||void 0,needBlock:R,rootId:S};case e.TEXT_NODE:const C=e.parentNode&&e.parentNode.tagName;let P=e.textContent;const I=C==="STYLE"?!0:void 0,D=C==="SCRIPT"?!0:void 0;if(I&&P){try{e.nextSibling||e.previousSibling||!((i=e.parentNode.sheet)===null||i===void 0)&&i.cssRules&&(P=_1(e.parentNode.sheet))}catch(E){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${E}`,e)}P=Yn(P,Hh())}if(D&&(P="SCRIPT_PLACEHOLDER"),C==="TEXTAREA"&&P)P="";else if(C==="OPTION"&&P){const E=e.parentNode;P=Ar({input:E,type:null,tagName:C,value:P,maskInputSelector:u,unmaskInputSelector:d,maskInputOptions:p,maskInputFn:_})}else!I&&!D&&po(e,a,h,l,f)&&P&&(P=m?m(P):lm(P));return{type:Ft.Text,textContent:P||"",isStyle:I,rootId:S};case e.CDATA_SECTION_NODE:return{type:Ft.CDATA,textContent:"",rootId:S};case e.COMMENT_NODE:return{type:Ft.Comment,textContent:e.textContent||"",rootId:S};default:return!1}}function mt(e){return e==null?"":e.toLowerCase()}function C1(e,t){if(t.comment&&e.type===Ft.Comment)return!0;if(e.type===Ft.Element){if(t.script&&(e.tagName==="script"||e.tagName==="link"&&(e.attributes.rel==="preload"||e.attributes.rel==="modulepreload")&&e.attributes.as==="script"||e.tagName==="link"&&e.attributes.rel==="prefetch"&&typeof e.attributes.href=="string"&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&(e.tagName==="link"&&e.attributes.rel==="shortcut icon"||e.tagName==="meta"&&(mt(e.attributes.name).match(/^msapplication-tile(image|color)$/)||mt(e.attributes.name)==="application-name"||mt(e.attributes.rel)==="icon"||mt(e.attributes.rel)==="apple-touch-icon"||mt(e.attributes.rel)==="shortcut icon")))return!0;if(e.tagName==="meta"){if(t.headMetaDescKeywords&&mt(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(mt(e.attributes.property).match(/^(og|twitter|fb):/)||mt(e.attributes.name).match(/^(og|twitter):/)||mt(e.attributes.name)==="pinterest"))return!0;if(t.headMetaRobots&&(mt(e.attributes.name)==="robots"||mt(e.attributes.name)==="googlebot"||mt(e.attributes.name)==="bingbot"))return!0;if(t.headMetaHttpEquiv&&e.attributes["http-equiv"]!==void 0)return!0;if(t.headMetaAuthorship&&(mt(e.attributes.name)==="author"||mt(e.attributes.name)==="generator"||mt(e.attributes.name)==="framework"||mt(e.attributes.name)==="publisher"||mt(e.attributes.name)==="progid"||mt(e.attributes.property).match(/^article:/)||mt(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&(mt(e.attributes.name)==="google-site-verification"||mt(e.attributes.name)==="yandex-verification"||mt(e.attributes.name)==="csrf-token"||mt(e.attributes.name)==="p:domain_verify"||mt(e.attributes.name)==="verify-v1"||mt(e.attributes.name)==="verification"||mt(e.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function fr(e,t){const{doc:i,map:s,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:a,maskTextSelector:h,unmaskTextSelector:l,skipChild:c=!1,inlineStylesheet:u=!0,maskInputSelector:d,unmaskInputSelector:f,maskAllText:p,maskInputOptions:m={},maskTextFn:_,maskInputFn:y,slimDOMOptions:b,dataURLOptions:g={},inlineImages:v=!1,recordCanvas:S=!1,onSerialize:R,onIframeLoad:T,iframeLoadTimeout:x=5e3,keepIframeSrcFn:C=()=>!1}=t;let{preserveWhiteSpace:P=!0}=t;const I=I1(e,{doc:i,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:a,maskTextSelector:h,unmaskTextSelector:l,inlineStylesheet:u,maskInputSelector:d,unmaskInputSelector:f,maskAllText:p,maskInputOptions:m,maskTextFn:_,maskInputFn:y,dataURLOptions:g,inlineImages:v,recordCanvas:S,keepIframeSrcFn:C});if(!I)return console.warn(e,"not serialized"),null;let D;"__sn"in e?D=e.__sn.id:C1(I,b)||!P&&I.type===Ft.Text&&!I.isStyle&&!I.textContent.replace(/^\s+|\s+$/gm,"").length?D=Rr:D=d1();const E=Object.assign(I,{id:D});if(e.__sn=E,D===Rr)return null;s[D]=e,R&&R(e);let w=!c;if(E.type===Ft.Element&&(w=w&&!E.needBlock,delete E.needBlock,e.shadowRoot&&(E.isShadowHost=!0)),(E.type===Ft.Document||E.type===Ft.Element)&&w){b.headWhitespace&&I.type===Ft.Element&&I.tagName==="head"&&(P=!1);const F={doc:i,map:s,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:a,maskTextSelector:h,unmaskTextSelector:l,skipChild:c,inlineStylesheet:u,maskInputSelector:d,unmaskInputSelector:f,maskAllText:p,maskInputOptions:m,maskTextFn:_,maskInputFn:y,slimDOMOptions:b,dataURLOptions:g,inlineImages:v,recordCanvas:S,preserveWhiteSpace:P,onSerialize:R,onIframeLoad:T,iframeLoadTimeout:x,keepIframeSrcFn:C};for(const G of Array.from(e.childNodes)){const N=fr(G,F);N&&E.childNodes.push(N)}if(a1(e)&&e.shadowRoot)for(const G of Array.from(e.shadowRoot.childNodes)){const N=fr(G,F);N&&(N.isShadow=!0,E.childNodes.push(N))}}return e.parentNode&&dr(e.parentNode)&&(E.isShadow=!0),E.type===Ft.Element&&E.tagName==="iframe"&&R1(e,()=>{const F=e.contentDocument;if(F&&T){const G=fr(F,{doc:F,map:s,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:a,maskTextSelector:h,unmaskTextSelector:l,skipChild:!1,inlineStylesheet:u,maskInputSelector:d,unmaskInputSelector:f,maskAllText:p,maskInputOptions:m,maskTextFn:_,maskInputFn:y,slimDOMOptions:b,dataURLOptions:g,inlineImages:v,recordCanvas:S,preserveWhiteSpace:P,onSerialize:R,onIframeLoad:T,iframeLoadTimeout:x,keepIframeSrcFn:C});G&&T(e,G)}},x),E}function k1(e,t){const{blockClass:i="rr-block",blockSelector:s=null,unblockSelector:r=null,maskTextClass:n="rr-mask",maskTextSelector:o=null,unmaskTextSelector:a=null,inlineStylesheet:h=!0,inlineImages:l=!1,recordCanvas:c=!1,maskInputSelector:u=null,unmaskInputSelector:d=null,maskAllText:f=!1,maskAllInputs:p=!1,maskTextFn:m,maskInputFn:_,slimDOM:y=!1,dataURLOptions:b,preserveWhiteSpace:g,onSerialize:v,onIframeLoad:S,iframeLoadTimeout:R,keepIframeSrcFn:T=()=>!1}=t||{},x={};return[fr(e,{doc:e,map:x,blockClass:i,blockSelector:s,unblockSelector:r,maskTextClass:n,maskTextSelector:o,unmaskTextSelector:a,skipChild:!1,inlineStylesheet:h,maskInputSelector:u,unmaskInputSelector:d,maskAllText:f,maskInputOptions:p===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:p===!1?{}:p,maskTextFn:m,maskInputFn:_,slimDOMOptions:y===!0||y==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:y==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:y===!1?{}:y,dataURLOptions:b,inlineImages:l,recordCanvas:c,preserveWhiteSpace:g,onSerialize:v,onIframeLoad:S,iframeLoadTimeout:R,keepIframeSrcFn:T}),x]}function D1(e,t,i){return(e==="video"||e==="audio")&&t==="autoplay"}var ut;(function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin"})(ut||(ut={}));var Gt;(function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration"})(Gt||(Gt={}));var mo;(function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel"})(mo||(mo={}));var ks;(function(e){e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2"})(ks||(ks={}));var id;(function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange"})(id||(id={}));var sd;(function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"})(sd||(sd={}));function ie(e,t,i=document){const s={capture:!0,passive:!0};return i.addEventListener(e,t,s),()=>i.removeEventListener(e,t,s)}function P1(){return{map:{},getId(e){return!e||!e.__sn?-1:e.__sn.id},getNode(e){return this.map[e]||null},removeNodeFromMap(e){const t=e.__sn&&e.__sn.id;delete this.map[t],e.childNodes&&e.childNodes.forEach(i=>this.removeNodeFromMap(i))},has(e){return this.map.hasOwnProperty(e)},reset(){this.map={}}}}const rs=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;let rd={map:{},getId(){return console.error(rs),-1},getNode(){return console.error(rs),null},removeNodeFromMap(){console.error(rs)},has(){return console.error(rs),!1},reset(){console.error(rs)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(rd=new Proxy(rd,{get(e,t,i){return t==="map"&&console.error(rs),Reflect.get(e,t,i)}}));function Ir(e,t,i={}){let s=null,r=0;return function(n){let o=Date.now();!r&&i.leading===!1&&(r=o);let a=t-(o-r),h=this,l=arguments;a<=0||a>t?(s&&(clearTimeout(s),s=null),r=o,e.apply(h,l)):!s&&i.trailing!==!1&&(s=setTimeout(()=>{r=i.leading===!1?0:Date.now(),s=null,e.apply(h,l)},a))}}function Go(e,t,i,s,r=window){const n=r.Object.getOwnPropertyDescriptor(e,t);return r.Object.defineProperty(e,t,s?i:{set(o){setTimeout(()=>{i.set.call(this,o)},0),n&&n.set&&n.set.call(this,o)}}),()=>Go(e,t,n||{},!0)}function Ds(e,t,i){try{if(!(t in e))return()=>{};const s=e[t],r=i(s);return typeof r=="function"&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:s}})),e[t]=r,()=>{e[t]=s}}catch{return()=>{}}}function dm(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function fm(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function Kt(e,t,i,s){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){let r=!1;const n=s&&e.matches(s);return typeof t=="string"?e.closest!==void 0?r=!n&&e.closest("."+t)!==null:r=!n&&e.classList.contains(t):!n&&e.classList.forEach(o=>{t.test(o)&&(r=!0)}),!r&&i&&(r=e.matches(i)),!n&&r||Kt(e.parentNode,t,i,s)}return e.nodeType===e.TEXT_NODE,Kt(e.parentNode,t,i,s)}function Ma(e){return"__sn"in e?e.__sn.id===Rr:!1}function pm(e,t){if(dr(e))return!1;const i=t.getId(e);return t.has(i)?e.parentNode&&e.parentNode.nodeType===e.DOCUMENT_NODE?!1:e.parentNode?pm(e.parentNode,t):!0:!0}function mm(e){return!!e.changedTouches}function M1(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(i){if(!(0 in arguments))throw new TypeError("1 argument is required");do if(this===i)return!0;while(i=i&&i.parentNode);return!1})}function _m(e){return"__sn"in e?e.__sn.type===Ft.Element&&e.__sn.tagName==="iframe":!1}function gm(e){return!!(e!=null&&e.shadowRoot)}function nd(e){return"__ln"in e}class N1{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let i=this.head;for(let s=0;s<t;s++)i=(i==null?void 0:i.next)||null;return i}addNode(t){const i={value:t,previous:null,next:null};if(t.__ln=i,t.previousSibling&&nd(t.previousSibling)){const s=t.previousSibling.__ln.next;i.next=s,i.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=i,s&&(s.previous=i)}else if(t.nextSibling&&nd(t.nextSibling)&&t.nextSibling.__ln.previous){const s=t.nextSibling.__ln.previous;i.previous=s,i.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=i,s&&(s.next=i)}else this.head&&(this.head.previous=i),i.next=this.head,this.head=i;this.length++}removeNode(t){const i=t.__ln;this.head&&(i.previous?(i.previous.next=i.next,i.next&&(i.next.previous=i.previous)):(this.head=i.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const od=(e,t)=>`${e}@${t}`;function ad(e){return"__sn"in e}class B1{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],i=new N1,s=a=>{let h=a,l=Rr;for(;l===Rr;)h=h&&h.nextSibling,l=h&&this.mirror.getId(h);return l},r=a=>{var h,l,c,u,d;const f=a.getRootNode?(h=a.getRootNode())===null||h===void 0?void 0:h.host:null;let p=f;for(;!((c=(l=p==null?void 0:p.getRootNode)===null||l===void 0?void 0:l.call(p))===null||c===void 0)&&c.host;)p=((d=(u=p==null?void 0:p.getRootNode)===null||u===void 0?void 0:u.call(p))===null||d===void 0?void 0:d.host)||null;const m=!this.doc.contains(a)&&(!p||!this.doc.contains(p));if(!a.parentNode||m)return;const _=dr(a.parentNode)?this.mirror.getId(f):this.mirror.getId(a.parentNode),y=s(a);if(_===-1||y===-1)return i.addNode(a);let b=fr(a,{doc:this.doc,map:this.mirror.map,blockClass:this.blockClass,blockSelector:this.blockSelector,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,maskInputSelector:this.maskInputSelector,unmaskInputSelector:this.unmaskInputSelector,skipChild:!0,inlineStylesheet:this.inlineStylesheet,maskAllText:this.maskAllText,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:g=>{_m(g)&&this.iframeManager.addIframe(g),gm(a)&&this.shadowDomManager.addShadowRoot(a.shadowRoot,document)},onIframeLoad:(g,v)=>{this.iframeManager.attachIframe(g,v),this.shadowDomManager.observeAttachShadow(g)}});b&&t.push({parentId:_,nextId:y,node:b})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const a of this.movedSet)$h(this.removes,a,this.mirror)&&!this.movedSet.has(a.parentNode)||r(a);for(const a of this.addedSet)!Yh(this.droppedSet,a)&&!$h(this.removes,a,this.mirror)||Yh(this.movedSet,a)?r(a):this.droppedSet.add(a);let n=null;for(;i.length;){let a=null;if(n){const h=this.mirror.getId(n.value.parentNode),l=s(n.value);h!==-1&&l!==-1&&(a=n)}if(!a)for(let h=i.length-1;h>=0;h--){const l=i.get(h);if(l){const c=this.mirror.getId(l.value.parentNode),u=s(l.value);if(c!==-1&&u!==-1){a=l;break}}}if(!a){for(;i.head;)i.removeNode(i.head.value);break}n=a.previous,i.removeNode(a.value),r(a.value)}const o={texts:this.texts.map(a=>({id:this.mirror.getId(a.node),value:a.value})).filter(a=>this.mirror.has(a.id)),attributes:this.attributes.map(a=>({id:this.mirror.getId(a.node),attributes:a.attributes})).filter(a=>this.mirror.has(a.id)),removes:this.removes,adds:t};!o.texts.length&&!o.attributes.length&&!o.removes.length&&!o.adds.length||(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(o))},this.processMutation=t=>{if(!Ma(t.target))switch(t.type){case"characterData":{const i=t.target.textContent;!Kt(t.target,this.blockClass,this.blockSelector,this.unblockSelector)&&i!==t.oldValue&&this.texts.push({value:po(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextSelector,this.maskAllText)&&i?this.maskTextFn?this.maskTextFn(i):i.replace(/[\S]/g,"*"):i,node:t.target});break}case"attributes":{const i=t.target;let s=i.getAttribute(t.attributeName);if(t.attributeName==="value"&&(s=Ar({input:i,maskInputSelector:this.maskInputSelector,unmaskInputSelector:this.unmaskInputSelector,maskInputOptions:this.maskInputOptions,tagName:i.tagName,type:i.getAttribute("type"),value:s,maskInputFn:this.maskInputFn})),Kt(t.target,this.blockClass,this.blockSelector,this.unblockSelector)||s===t.oldValue)return;let r=this.attributes.find(n=>n.node===t.target);if(r||(r={node:t.target,attributes:{}},this.attributes.push(r)),t.attributeName==="type"&&i.tagName==="INPUT"&&(t.oldValue||"").toLowerCase()==="password"&&i.setAttribute("data-rr-is-password","true"),t.attributeName==="style"){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),(r.attributes.style===void 0||r.attributes.style===null)&&(r.attributes.style={});try{const o=r.attributes.style;for(const a of Array.from(i.style)){const h=i.style.getPropertyValue(a),l=i.style.getPropertyPriority(a);(h!==n.style.getPropertyValue(a)||l!==n.style.getPropertyPriority(a))&&(l===""?o[a]=h:o[a]=[h,l])}for(const a of Array.from(n.style))i.style.getPropertyValue(a)===""&&(o[a]=!1)}catch(o){console.warn("[rrweb] Error when parsing update to style attribute:",o)}}else{const n=t.target;r.attributes[t.attributeName]=um(this.doc,n,n.tagName,t.attributeName,s,this.maskAllText,this.unmaskTextSelector,this.maskTextFn)}break}case"childList":{t.addedNodes.forEach(i=>this.genAdds(i,t.target)),t.removedNodes.forEach(i=>{const s=this.mirror.getId(i),r=dr(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);Kt(t.target,this.blockClass,this.blockSelector,this.unblockSelector)||Ma(i)||(this.addedSet.has(i)?(zh(this.addedSet,i),this.droppedSet.add(i)):this.addedSet.has(t.target)&&s===-1||pm(t.target,this.mirror)||(this.movedSet.has(i)&&this.movedMap[od(s,r)]?zh(this.movedSet,i):this.removes.push({parentId:r,id:s,isShadow:dr(t.target)?!0:void 0})),this.mapRemoves.push(i))});break}}},this.genAdds=(t,i)=>{if(!(i&&Kt(i,this.blockClass,this.blockSelector,this.unblockSelector))){if(ad(t)){if(Ma(t))return;this.movedSet.add(t);let s=null;i&&ad(i)&&(s=i.__sn.id),s&&(this.movedMap[od(t.__sn.id,s)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);Kt(t,this.blockClass,this.blockSelector,this.unblockSelector)||t.childNodes.forEach(s=>this.genAdds(s))}}}init(t){["mutationCb","blockClass","blockSelector","unblockSelector","maskTextClass","maskTextSelector","unmaskTextSelector","maskInputSelector","unmaskInputSelector","inlineStylesheet","maskAllText","maskInputOptions","maskTextFn","maskInputFn","recordCanvas","inlineImages","slimDOMOptions","doc","mirror","iframeManager","shadowDomManager","canvasManager"].forEach(i=>{this[i]=t[i]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function zh(e,t){e.delete(t),t.childNodes.forEach(i=>zh(e,i))}function $h(e,t,i){const{parentNode:s}=t;if(!s)return!1;const r=i.getId(s);return e.some(n=>n.id===r)?!0:$h(e,s,i)}function Yh(e,t){const{parentNode:i}=t;return i?e.has(i)?!0:Yh(e,i):!1}const rt=e=>(...i)=>{try{return e(...i)}catch(s){try{s.__rrweb__=!0}catch{}throw s}},Pi=[];function Gr(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch{}return e&&e.target}function ym(e,t){var i,s;const r=new B1;Pi.push(r),r.init(e);let n=window.MutationObserver||window.__rrMutationObserver;const o=(s=(i=window==null?void 0:window.Zone)===null||i===void 0?void 0:i.__symbol__)===null||s===void 0?void 0:s.call(i,"MutationObserver");o&&window[o]&&(n=window[o]);const a=new n(rt(h=>{e.onMutation&&e.onMutation(h)===!1||r.processMutations(h)}));return a.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function O1({mousemoveCb:e,sampling:t,doc:i,mirror:s}){if(t.mousemove===!1)return()=>{};const r=typeof t.mousemove=="number"?t.mousemove:50,n=typeof t.mousemoveCallback=="number"?t.mousemoveCallback:500;let o=[],a;const h=Ir(u=>{const d=Date.now()-a;rt(e)(o.map(f=>(f.timeOffset-=d,f)),u),o=[],a=null},n),l=Ir(u=>{const d=Gr(u),{clientX:f,clientY:p}=mm(u)?u.changedTouches[0]:u;a||(a=Date.now()),o.push({x:f,y:p,id:s.getId(d),timeOffset:Date.now()-a}),h(typeof DragEvent<"u"&&u instanceof DragEvent?Gt.Drag:u instanceof MouseEvent?Gt.MouseMove:Gt.TouchMove)},r,{trailing:!1}),c=[ie("mousemove",rt(l),i),ie("touchmove",rt(l),i),ie("drag",rt(l),i)];return rt(()=>{c.forEach(u=>u())})}function L1({mouseInteractionCb:e,doc:t,mirror:i,blockClass:s,blockSelector:r,unblockSelector:n,sampling:o}){if(o.mouseInteraction===!1)return()=>{};const a=o.mouseInteraction===!0||o.mouseInteraction===void 0?{}:o.mouseInteraction,h=[],l=c=>u=>{const d=Gr(u);if(Kt(d,s,r,n))return;const f=mm(u)?u.changedTouches[0]:u;if(!f)return;const p=i.getId(d),{clientX:m,clientY:_}=f;rt(e)({type:mo[c],id:p,x:m,y:_})};return Object.keys(mo).filter(c=>Number.isNaN(Number(c))&&!c.endsWith("_Departed")&&a[c]!==!1).forEach(c=>{const u=c.toLowerCase(),d=rt(l(c));h.push(ie(u,d,t))}),rt(()=>{h.forEach(c=>c())})}function vm({scrollCb:e,doc:t,mirror:i,blockClass:s,blockSelector:r,unblockSelector:n,sampling:o}){const a=Ir(h=>{const l=Gr(h);if(!l||Kt(l,s,r,n))return;const c=i.getId(l);if(l===t){const u=t.scrollingElement||t.documentElement;rt(e)({id:c,x:u.scrollLeft,y:u.scrollTop})}else rt(e)({id:c,x:l.scrollLeft,y:l.scrollTop})},o.scroll||100);return ie("scroll",rt(a),t)}function F1({viewportResizeCb:e}){let t=-1,i=-1;const s=Ir(()=>{const r=dm(),n=fm();(t!==r||i!==n)&&(rt(e)({width:Number(n),height:Number(r)}),t=r,i=n)},200);return ie("resize",rt(s),window)}function hd(e,t){const i=Object.assign({},e);return t||delete i.userTriggered,i}const U1=["INPUT","TEXTAREA","SELECT"],ld=new WeakMap;function G1({inputCb:e,doc:t,mirror:i,blockClass:s,blockSelector:r,unblockSelector:n,ignoreClass:o,ignoreSelector:a,maskInputSelector:h,unmaskInputSelector:l,maskInputOptions:c,maskInputFn:u,sampling:d,userTriggeredOnInput:f}){function p(v){let S=Gr(v);const R=S&&S.tagName,T=v.isTrusted;if(R==="OPTION"&&(S=S.parentElement),!S||!R||U1.indexOf(R)<0||Kt(S,s,r,n))return;const x=S,C=hm(x);if(x.classList.contains(o)||a&&x.matches(a))return;let P=Uh(x,R,C),I=!1;(C==="radio"||C==="checkbox")&&(I=S.checked),h1({maskInputOptions:c,maskInputSelector:h,tagName:R,type:C})&&(P=Ar({input:x,maskInputOptions:c,maskInputSelector:h,unmaskInputSelector:l,tagName:R,type:C,value:P,maskInputFn:u})),m(S,rt(hd)({text:P,isChecked:I,userTriggered:T},f));const D=S.name;C==="radio"&&D&&I&&t.querySelectorAll(`input[type="radio"][name="${D}"]`).forEach(E=>{if(E!==S){const w=Ar({input:E,maskInputOptions:c,maskInputSelector:h,unmaskInputSelector:l,tagName:R,type:C,value:Uh(E,R,C),maskInputFn:u});m(E,rt(hd)({text:w,isChecked:!I,userTriggered:!1},f))}})}function m(v,S){const R=ld.get(v);if(!R||R.text!==S.text||R.isChecked!==S.isChecked){ld.set(v,S);const T=i.getId(v);e(Object.assign(Object.assign({},S),{id:T}))}}const y=(d.input==="last"?["change"]:["input","change"]).map(v=>ie(v,rt(p),t)),b=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),g=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"],[HTMLOptionElement.prototype,"selected"]];return b&&b.set&&y.push(...g.map(v=>Go(v[0],v[1],{set(){rt(p)({target:this})}}))),rt(()=>{y.forEach(v=>v())})}function _o(e){const t=[];function i(s,r){if(An("CSSGroupingRule")&&s.parentRule instanceof CSSGroupingRule||An("CSSMediaRule")&&s.parentRule instanceof CSSMediaRule||An("CSSSupportsRule")&&s.parentRule instanceof CSSSupportsRule||An("CSSConditionRule")&&s.parentRule instanceof CSSConditionRule){const o=Array.from(s.parentRule.cssRules).indexOf(s);r.unshift(o)}else{const o=Array.from(s.parentStyleSheet.cssRules).indexOf(s);r.unshift(o)}return r}return i(e,t)}function H1({styleSheetRuleCb:e,mirror:t},{win:i}){if(!i.CSSStyleSheet||!i.CSSStyleSheet.prototype)return()=>{};const s=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=new Proxy(s,{apply:rt((a,h,l)=>{const[c,u]=l,d=t.getId(h.ownerNode);return d!==-1&&e({id:d,adds:[{rule:c,index:u}]}),a.apply(h,l)})});const r=i.CSSStyleSheet.prototype.deleteRule;i.CSSStyleSheet.prototype.deleteRule=new Proxy(r,{apply:rt((a,h,l)=>{const[c]=l,u=t.getId(h.ownerNode);return u!==-1&&e({id:u,removes:[{index:c}]}),a.apply(h,l)})});const n={};Rn("CSSGroupingRule")?n.CSSGroupingRule=i.CSSGroupingRule:(Rn("CSSMediaRule")&&(n.CSSMediaRule=i.CSSMediaRule),Rn("CSSConditionRule")&&(n.CSSConditionRule=i.CSSConditionRule),Rn("CSSSupportsRule")&&(n.CSSSupportsRule=i.CSSSupportsRule));const o={};return Object.entries(n).forEach(([a,h])=>{o[a]={insertRule:h.prototype.insertRule,deleteRule:h.prototype.deleteRule},h.prototype.insertRule=new Proxy(o[a].insertRule,{apply:rt((l,c,u)=>{const[d,f]=u,p=t.getId(c.parentStyleSheet.ownerNode);return p!==-1&&e({id:p,adds:[{rule:d,index:[..._o(c),f||0]}]}),l.apply(c,u)})}),h.prototype.deleteRule=new Proxy(o[a].deleteRule,{apply:rt((l,c,u)=>{const[d]=u,f=t.getId(c.parentStyleSheet.ownerNode);return f!==-1&&e({id:f,removes:[{index:[..._o(c),d]}]}),l.apply(c,u)})})}),rt(()=>{i.CSSStyleSheet.prototype.insertRule=s,i.CSSStyleSheet.prototype.deleteRule=r,Object.entries(n).forEach(([a,h])=>{h.prototype.insertRule=o[a].insertRule,h.prototype.deleteRule=o[a].deleteRule})})}function z1({styleDeclarationCb:e,mirror:t},{win:i}){const s=i.CSSStyleDeclaration.prototype.setProperty;i.CSSStyleDeclaration.prototype.setProperty=new Proxy(s,{apply:rt((n,o,a)=>{var h,l;const[c,u,d]=a,f=t.getId((l=(h=o.parentRule)===null||h===void 0?void 0:h.parentStyleSheet)===null||l===void 0?void 0:l.ownerNode);return f!==-1&&e({id:f,set:{property:c,value:u,priority:d},index:_o(o.parentRule)}),n.apply(o,a)})});const r=i.CSSStyleDeclaration.prototype.removeProperty;return i.CSSStyleDeclaration.prototype.removeProperty=new Proxy(r,{apply:rt((n,o,a)=>{var h,l;const[c]=a,u=t.getId((l=(h=o.parentRule)===null||h===void 0?void 0:h.parentStyleSheet)===null||l===void 0?void 0:l.ownerNode);return u!==-1&&e({id:u,remove:{property:c},index:_o(o.parentRule)}),n.apply(o,a)})}),rt(()=>{i.CSSStyleDeclaration.prototype.setProperty=s,i.CSSStyleDeclaration.prototype.removeProperty=r})}function $1({mediaInteractionCb:e,blockClass:t,blockSelector:i,unblockSelector:s,mirror:r,sampling:n}){const o=h=>Ir(rt(l=>{const c=Gr(l);if(!c||Kt(c,t,i,s))return;const{currentTime:u,volume:d,muted:f}=c;e({type:h,id:r.getId(c),currentTime:u,volume:d,muted:f})}),n.media||500),a=[ie("play",o(0)),ie("pause",o(1)),ie("seeked",o(2)),ie("volumechange",o(3))];return rt(()=>{a.forEach(h=>h())})}function Y1({fontCb:e,doc:t}){const i=t.defaultView;if(!i)return()=>{};const s=[],r=new WeakMap,n=i.FontFace;i.FontFace=function(h,l,c){const u=new n(h,l,c);return r.set(u,{family:h,buffer:typeof l!="string",descriptors:c,fontSource:typeof l=="string"?l:JSON.stringify(Array.from(new Uint8Array(l)))}),u};const o=Ds(t.fonts,"add",function(a){return function(h){return setTimeout(()=>{const l=r.get(h);l&&(e(l),r.delete(h))},0),a.apply(this,[h])}});return s.push(()=>{i.FontFace=n}),s.push(o),rt(()=>{s.forEach(a=>a())})}function W1(e,t){const{mutationCb:i,mousemoveCb:s,mouseInteractionCb:r,scrollCb:n,viewportResizeCb:o,inputCb:a,mediaInteractionCb:h,styleSheetRuleCb:l,styleDeclarationCb:c,canvasMutationCb:u,fontCb:d}=e;e.mutationCb=(...f)=>{t.mutation&&t.mutation(...f),i(...f)},e.mousemoveCb=(...f)=>{t.mousemove&&t.mousemove(...f),s(...f)},e.mouseInteractionCb=(...f)=>{t.mouseInteraction&&t.mouseInteraction(...f),r(...f)},e.scrollCb=(...f)=>{t.scroll&&t.scroll(...f),n(...f)},e.viewportResizeCb=(...f)=>{t.viewportResize&&t.viewportResize(...f),o(...f)},e.inputCb=(...f)=>{t.input&&t.input(...f),a(...f)},e.mediaInteractionCb=(...f)=>{t.mediaInteaction&&t.mediaInteaction(...f),h(...f)},e.styleSheetRuleCb=(...f)=>{t.styleSheetRule&&t.styleSheetRule(...f),l(...f)},e.styleDeclarationCb=(...f)=>{t.styleDeclaration&&t.styleDeclaration(...f),c(...f)},e.canvasMutationCb=(...f)=>{t.canvasMutation&&t.canvasMutation(...f),u(...f)},e.fontCb=(...f)=>{t.font&&t.font(...f),d(...f)}}function X1(e,t={}){const i=e.doc.defaultView;if(!i)return()=>{};W1(e,t);const s=ym(e,e.doc),r=O1(e),n=L1(e),o=vm(e),a=F1(e),h=G1(e),l=$1(e),c=H1(e,{win:i}),u=z1(e,{win:i}),d=e.collectFonts?Y1(e):()=>{},f=[];for(const p of e.plugins)f.push(p.observer(p.callback,i,p.options));return rt(()=>{Pi.forEach(p=>p.reset()),s.disconnect(),r(),n(),o(),a(),h(),l();try{c(),u()}catch{}d(),f.forEach(p=>p())})}function An(e){return typeof window[e]<"u"}function Rn(e){return!!(typeof window[e]<"u"&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class V1{constructor(t){this.iframes=new WeakMap,this.mutationCb=t.mutationCb}addIframe(t){this.iframes.set(t,!0)}addLoadListener(t){this.loadListener=t}attachIframe(t,i){var s;this.mutationCb({adds:[{parentId:t.__sn.id,nextId:null,node:i}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),(s=this.loadListener)===null||s===void 0||s.call(this,t)}}class j1{constructor(t){this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const i=this;this.restorePatches.push(Ds(HTMLElement.prototype,"attachShadow",function(s){return function(){const r=s.apply(this,arguments);return this.shadowRoot&&i.addShadowRoot(this.shadowRoot,this.ownerDocument),r}}))}addShadowRoot(t,i){ym(Object.assign(Object.assign({},this.bypassOptions),{doc:i,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),vm(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror}))}observeAttachShadow(t){if(t.contentWindow){const i=this;this.restorePatches.push(Ds(t.contentWindow.HTMLElement.prototype,"attachShadow",function(s){return function(){const r=s.apply(this,arguments);return this.shadowRoot&&i.addShadowRoot(this.shadowRoot,t.contentDocument),r}}))}}reset(){this.restorePatches.forEach(t=>t())}}function q1(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]]);return i}function K1(e,t,i,s,r,n){const o=[],a=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const h of a)try{if(typeof t.CanvasRenderingContext2D.prototype[h]!="function")continue;const l=Ds(t.CanvasRenderingContext2D.prototype,h,function(c){return function(...u){return Kt(this.canvas,i,r,s)||setTimeout(()=>{const d=[...u];if(h==="drawImage"&&d[0]&&d[0]instanceof HTMLCanvasElement){const f=d[0],p=f.getContext("2d");let m=p==null?void 0:p.getImageData(0,0,f.width,f.height),_=m==null?void 0:m.data;d[0]=JSON.stringify(_)}e(this.canvas,{type:ks["2D"],property:h,args:d})},0),c.apply(this,u)}});o.push(l)}catch{const c=Go(t.CanvasRenderingContext2D.prototype,h,{set(u){e(this.canvas,{type:ks["2D"],property:h,args:[u],setter:!0})}});o.push(c)}return()=>{o.forEach(h=>h())}}function Z1(e,t,i,s){const r=[];try{const n=Ds(e.HTMLCanvasElement.prototype,"getContext",function(o){return function(a,...h){return Kt(this,t,i,s)||"__context"in this||(this.__context=a),o.apply(this,[a,...h])}});r.push(n)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{r.forEach(n=>n())}}var hs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var In=0;In<hs.length;In++)J1[hs.charCodeAt(In)]=In;var Q1=function(e){var t=new Uint8Array(e),i,s=t.length,r="";for(i=0;i<s;i+=3)r+=hs[t[i]>>2],r+=hs[(t[i]&3)<<4|t[i+1]>>4],r+=hs[(t[i+1]&15)<<2|t[i+2]>>6],r+=hs[t[i+2]&63];return s%3===2?r=r.substring(0,r.length-1)+"=":s%3===1&&(r=r.substring(0,r.length-2)+"=="),r};const cd=new Map;function tA(e,t){let i=cd.get(e);return i||(i=new Map,cd.set(e,i)),i.has(t)||i.set(t,[]),i.get(t)}const bm=(e,t,i)=>{if(!e||!(Em(e,t)||typeof e=="object"))return;const s=e.constructor.name,r=tA(i,s);let n=r.indexOf(e);return n===-1&&(n=r.length,r.push(e)),n};function Wn(e,t,i){if(e instanceof Array)return e.map(s=>Wn(s,t,i));if(e===null)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray)return{rr_type:e.constructor.name,args:[Object.values(e)]};if(e instanceof ArrayBuffer){const s=e.constructor.name,r=Q1(e);return{rr_type:s,base64:r}}else{if(e instanceof DataView)return{rr_type:e.constructor.name,args:[Wn(e.buffer,t,i),e.byteOffset,e.byteLength]};if(e instanceof HTMLImageElement){const s=e.constructor.name,{src:r}=e;return{rr_type:s,src:r}}else{if(e instanceof ImageData)return{rr_type:e.constructor.name,args:[Wn(e.data,t,i),e.width,e.height]};if(Em(e,t)||typeof e=="object"){const s=e.constructor.name,r=bm(e,t,i);return{rr_type:s,index:r}}}}return e}const eA=(e,t,i)=>[...e].map(s=>Wn(s,t,i)),Em=(e,t)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(r=>typeof t[r]=="function").find(r=>e instanceof t[r]);function ud(e,t,i,s,r,n,o,a){const h=[],l=Object.getOwnPropertyNames(e);for(const c of l)try{if(typeof e[c]!="function")continue;const u=Ds(e,c,function(d){return function(...f){const p=d.apply(this,f);if(bm(p,a,e),!Kt(this.canvas,s,n,r)){const m=o.getId(this.canvas),_=eA([...f],a,e),y={type:t,property:c,args:_};i(this.canvas,y)}return p}});h.push(u)}catch{const d=Go(e,c,{set(f){i(this.canvas,{type:t,property:c,args:[f],setter:!0})}});h.push(d)}return h}function iA(e,t,i,s,r,n){const o=[];return o.push(...ud(t.WebGLRenderingContext.prototype,ks.WebGL,e,i,s,r,n,t)),typeof t.WebGL2RenderingContext<"u"&&o.push(...ud(t.WebGL2RenderingContext.prototype,ks.WebGL2,e,i,s,r,n,t)),()=>{o.forEach(a=>a())}}class sA{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=function(i,s){(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(i)||this.pendingCanvasMutations.set(i,[]),this.pendingCanvasMutations.get(i).push(s)},this.mutationCb=t.mutationCb,this.mirror=t.mirror,t.recordCanvas===!0&&this.initCanvasMutationObserver(t.win,t.blockClass,t.blockSelector,t.unblockSelector)}initCanvasMutationObserver(t,i,s,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const n=Z1(t,i,r,s),o=K1(this.processMutation.bind(this),t,i,r,s,this.mirror),a=iA(this.processMutation.bind(this),t,i,r,s,this.mirror);this.resetObservers=()=>{n(),o(),a()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const t=i=>{this.rafStamps.latestId=i,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,i)=>{const s=this.mirror.getId(i);this.flushPendingCanvasMutationFor(i,s)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,i){if(this.frozen||this.locked)return;const s=this.pendingCanvasMutations.get(t);if(!s||i===-1)return;const r=s.map(o=>q1(o,["type"])),{type:n}=s[0];this.mutationCb({id:i,type:n,commands:r}),this.pendingCanvasMutations.delete(t)}}function Ut(e){return Object.assign(Object.assign({},e),{timestamp:Date.now()})}let Pt,pr;const rr=P1();function Hi(e={}){const{emit:t,checkoutEveryNms:i,checkoutEveryNth:s,blockClass:r="rr-block",blockSelector:n=null,unblockSelector:o=null,ignoreClass:a="rr-ignore",ignoreSelector:h=null,maskTextClass:l="rr-mask",maskTextSelector:c=null,maskInputSelector:u=null,unmaskTextSelector:d=null,unmaskInputSelector:f=null,inlineStylesheet:p=!0,maskAllText:m=!1,maskAllInputs:_,maskInputOptions:y,slimDOMOptions:b,maskInputFn:g,maskTextFn:v,hooks:S,packFn:R,sampling:T={},mousemoveWait:x,recordCanvas:C=!1,userTriggeredOnInput:P=!1,collectFonts:I=!1,inlineImages:D=!1,plugins:E,keepIframeSrcFn:w=()=>!1,onMutation:F}=e;if(!t)throw new Error("emit function is required");x!==void 0&&T.mousemove===void 0&&(T.mousemove=x);const G=_===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:y!==void 0?y:{},N=b===!0||b==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:b==="all",headMetaDescKeywords:b==="all"}:b||{};M1();let nt,pt=0;const k=Y=>{for(const lt of E||[])lt.eventProcessor&&(Y=lt.eventProcessor(Y));return R&&(Y=R(Y)),Y};Pt=(Y,lt)=>{var yt;if(!((yt=Pi[0])===null||yt===void 0)&&yt.isFrozen()&&Y.type!==ut.FullSnapshot&&!(Y.type===ut.IncrementalSnapshot&&Y.data.source===Gt.Mutation)&&Pi.forEach(at=>at.unfreeze()),t(k(Y),lt),Y.type===ut.FullSnapshot)nt=Y,pt=0;else if(Y.type===ut.IncrementalSnapshot){if(Y.data.source===Gt.Mutation&&Y.data.isAttachIframe)return;pt++;const at=s&&pt>=s,K=i&&Y.timestamp-nt.timestamp>i;(at||K)&&pr(!0)}};const $=Y=>{Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.Mutation},Y)}))},q=Y=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.Scroll},Y)})),ot=Y=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.CanvasMutation},Y)})),it=new V1({mutationCb:$}),At=new sA({recordCanvas:C,mutationCb:ot,win:window,blockClass:r,blockSelector:n,unblockSelector:o,mirror:rr}),gt=new j1({mutationCb:$,scrollCb:q,bypassOptions:{onMutation:F,blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:l,maskTextSelector:c,unmaskTextSelector:d,maskInputSelector:u,unmaskInputSelector:f,inlineStylesheet:p,maskAllText:m,maskInputOptions:G,maskTextFn:v,maskInputFn:g,recordCanvas:C,inlineImages:D,sampling:T,slimDOMOptions:N,iframeManager:it,canvasManager:At},mirror:rr});pr=(Y=!1)=>{var lt,yt,at,K;Pt(Ut({type:ut.Meta,data:{href:window.location.href,width:fm(),height:dm()}}),Y),Pi.forEach(St=>St.lock());const[X,_t]=k1(document,{blockClass:r,blockSelector:n,unblockSelector:o,maskTextClass:l,maskTextSelector:c,unmaskTextSelector:d,maskInputSelector:u,unmaskInputSelector:f,inlineStylesheet:p,maskAllText:m,maskAllInputs:G,maskTextFn:v,slimDOM:N,recordCanvas:C,inlineImages:D,onSerialize:St=>{_m(St)&&it.addIframe(St),gm(St)&&gt.addShadowRoot(St.shadowRoot,document)},onIframeLoad:(St,se)=>{it.attachIframe(St,se),gt.observeAttachShadow(St)},keepIframeSrcFn:w});if(!X)return console.warn("Failed to snapshot the document");rr.map=_t,Pt(Ut({type:ut.FullSnapshot,data:{node:X,initialOffset:{left:window.pageXOffset!==void 0?window.pageXOffset:(document==null?void 0:document.documentElement.scrollLeft)||((yt=(lt=document==null?void 0:document.body)===null||lt===void 0?void 0:lt.parentElement)===null||yt===void 0?void 0:yt.scrollLeft)||(document==null?void 0:document.body.scrollLeft)||0,top:window.pageYOffset!==void 0?window.pageYOffset:(document==null?void 0:document.documentElement.scrollTop)||((K=(at=document==null?void 0:document.body)===null||at===void 0?void 0:at.parentElement)===null||K===void 0?void 0:K.scrollTop)||(document==null?void 0:document.body.scrollTop)||0}}})),Pi.forEach(St=>St.unlock())};try{const Y=[];Y.push(ie("DOMContentLoaded",()=>{Pt(Ut({type:ut.DomContentLoaded,data:{}}))}));const lt=at=>{var K;return rt(X1)({onMutation:F,mutationCb:$,mousemoveCb:(X,_t)=>Pt(Ut({type:ut.IncrementalSnapshot,data:{source:_t,positions:X}})),mouseInteractionCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.MouseInteraction},X)})),scrollCb:q,viewportResizeCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.ViewportResize},X)})),inputCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.Input},X)})),mediaInteractionCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.MediaInteraction},X)})),styleSheetRuleCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.StyleSheetRule},X)})),styleDeclarationCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.StyleDeclaration},X)})),canvasMutationCb:ot,fontCb:X=>Pt(Ut({type:ut.IncrementalSnapshot,data:Object.assign({source:Gt.Font},X)})),blockClass:r,ignoreClass:a,ignoreSelector:h,maskTextClass:l,maskTextSelector:c,unmaskTextSelector:d,maskInputSelector:u,unmaskInputSelector:f,maskInputOptions:G,inlineStylesheet:p,sampling:T,recordCanvas:C,inlineImages:D,userTriggeredOnInput:P,collectFonts:I,doc:at,maskAllText:m,maskInputFn:g,maskTextFn:v,blockSelector:n,unblockSelector:o,slimDOMOptions:N,mirror:rr,iframeManager:it,shadowDomManager:gt,canvasManager:At,plugins:((K=E==null?void 0:E.filter(X=>X.observer))===null||K===void 0?void 0:K.map(X=>({observer:X.observer,options:X.options,callback:_t=>Pt(Ut({type:ut.Plugin,data:{plugin:X.name,payload:_t}}))})))||[]},S)};it.addLoadListener(at=>{try{Y.push(lt(at.contentDocument))}catch(K){console.warn(K)}});const yt=()=>{pr(),Y.push(lt(document))};return document.readyState==="interactive"||document.readyState==="complete"?yt():Y.push(ie("load",()=>{Pt(Ut({type:ut.Load,data:{}})),yt()},window)),()=>{Y.forEach(at=>at())}}catch(Y){console.warn(Y)}}Hi.addCustomEvent=(e,t)=>{if(!Pt)throw new Error("please add custom event after start recording");Pt(Ut({type:ut.Custom,data:{tag:e,payload:t}}))};Hi.freezePage=()=>{Pi.forEach(e=>e.freeze())};Hi.takeFullSnapshot=e=>{if(!pr)throw new Error("please take full snapshot after start recording");pr(e)};Hi.mirror=rr;function Ve(e){return{timestamp:Date.now()/1e3,type:"default",...e}}var go;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(go||(go={}));function Ho(e,t){t.category!=="sentry.transaction"&&(["ui.click","ui.input"].includes(t.category)?e.triggerUserActivity():e.checkAndHandleExpiredSession(),e.addUpdate(()=>(e.throttledAddEvent({type:ut.Custom,timestamp:(t.timestamp||0)*1e3,data:{tag:"breadcrumb",payload:ke(t,10,1e3)}}),t.category==="console")))}function rA(e,t,i,s){if(oA(s,t))return;let r=()=>{};const n=setTimeout(()=>{xm(e,i,t.timeout,"timeout"),r()},t.timeout),o=()=>{dd(e,i,t.threshold,t.timeout,"mutation"),r()},a=()=>{dd(e,i,t.scrollTimeout,t.timeout,"scroll"),r()},h=new MutationObserver(o);h.observe(ht.document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),ht.addEventListener("scroll",a);const l=setTimeout(()=>{ht.removeEventListener("scroll",a)},t.scrollTimeout);r=()=>{clearTimeout(n),clearTimeout(l),h.disconnect(),ht.removeEventListener("scroll",a)}}function dd(e,t,i,s,r){const o=Date.now()-t.timestamp*1e3;return o>i?(xm(e,t,Math.min(o,s),r),!0):!1}function xm(e,t,i,s){const r={message:t.message,timestamp:t.timestamp,category:"ui.slowClickDetected",data:{...t.data,url:ht.location.href,timeAfterClickMs:i,endReason:s}};Ho(e,r)}const nA=["SELECT","OPTION"];function oA(e,t){return!!(e.tagName==="INPUT"&&!["submit","button"].includes(e.getAttribute("type")||"")||nA.includes(e.tagName)||e.tagName==="A"&&(e.hasAttribute("download")||e.hasAttribute("target")&&e.getAttribute("target")!=="_self")||t.ignoreSelector&&e.matches(t.ignoreSelector))}const aA=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid"]);function hA(e){const t={};for(const i in e)if(aA.has(i)){let s=i;(i==="data-testid"||i==="data-test-id")&&(s="testId"),t[s]=e[i]}return t}const lA=e=>{const t=e.getOptions()._experiments.slowClicks,i=t?{threshold:t.threshold,timeout:t.timeout,scrollTimeout:t.scrollTimeout,ignoreSelector:t.ignoreSelectors?t.ignoreSelectors.join(","):""}:void 0;return s=>{if(!e.isEnabled())return;const r=cA(s);if(!r)return;const n=s.name==="click",o=n&&s.event;n&&i&&o&&!o.altKey&&!o.metaKey&&!o.ctrlKey&&rA(e,i,r,Tm(s.event)),Ho(e,r)}};function wm(e,t){const i=e&&dA(e)&&e.__sn.type===go.Element?e.__sn:null;return{message:t,data:i?{nodeId:i.id,node:{id:i.id,tagName:i.tagName,textContent:e?Array.from(e.childNodes).map(s=>"__sn"in s&&s.__sn.type===go.Text&&s.__sn.textContent).filter(Boolean).map(s=>s.trim()).join(""):"",attributes:hA(i.attributes)}}:{}}}function cA(e){const{target:t,message:i}=uA(e);return Ve({category:`ui.${e.name}`,...wm(t,i)})}function uA(e){const t=e.name==="click";let i,s=null;try{s=t?Tm(e.event):Sm(e.event),i=vi(s,{maxStringLength:200})||"<unknown>"}catch{i="<unknown>"}return{target:s,message:i}}function dA(e){return"__sn"in e}function Sm(e){return pA(e)?e.target:e}const fA="button,a";function Tm(e){const t=Sm(e);return!t||!(t instanceof Element)?t:t.closest(fA)||t}function pA(e){return typeof e=="object"&&!!e&&"target"in e}function mA(e,t){if(!e.isEnabled())return;e.triggerUserActivity();const i=_A(t);i&&Ho(e,i)}function _A(e){const{metaKey:t,shiftKey:i,ctrlKey:s,altKey:r,key:n,target:o}=e;if(!o||gA(o)||!n)return null;const a=t||s||r,h=n.length===1;if(!a&&h)return null;const l=vi(o,{maxStringLength:200})||"<unknown>",c=wm(o,l);return Ve({category:"ui.keyDown",message:l,data:{...c.data,metaKey:t,shiftKey:i,ctrlKey:s,altKey:r,key:n}})}function gA(e){return e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable}const yA=["name","type","startTime","transferSize","duration"];function fd(e){return function(t){return yA.every(i=>e[i]===t[i])}}function vA(e,t){const[i,s,r]=e.reduce((h,l)=>(l.entryType==="navigation"?h[0].push(l):l.entryType==="largest-contentful-paint"?h[1].push(l):h[2].push(l),h),[[],[],[]]),n=[],o=[];let a=s.length?s[s.length-1]:void 0;return t.forEach(h=>{if(h.entryType==="largest-contentful-paint"){(!a||a.startTime<h.startTime)&&(a=h);return}if(h.entryType==="navigation"){const l=h;h.duration>0&&!i.find(fd(l))&&!o.find(fd(l))&&o.push(l);return}n.push(h)}),[...a?[a]:[],...i,...r,...n,...o].sort((h,l)=>h.startTime-l.startTime)}function bA(e){const t=s=>{const r=vA(e.performanceEvents,s.getEntries());e.performanceEvents=r},i=new PerformanceObserver(t);return["element","event","first-input","largest-contentful-paint","layout-shift","longtask","navigation","paint","resource"].forEach(s=>{try{i.observe({type:s,buffered:!0})}catch{}}),i}const EA=`/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
function t(t){let e=t.length;for(;--e>=0;)t[e]=0}const e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Array(576);t(s);const r=new Array(60);t(r);const o=new Array(512);t(o);const l=new Array(256);t(l);const h=new Array(29);t(h);const d=new Array(30);function _(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}let f,c,u;function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}t(d);const m=t=>t<256?o[t]:o[256+(t>>>7)],b=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},g=(t,e,a)=>{t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},p=(t,e,a)=>{g(t,a[2*e],a[2*e+1])},k=(t,e)=>{let a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},v=(t,e,a)=>{const i=new Array(16);let n,s,r=0;for(n=1;n<=15;n++)r=r+a[n-1]<<1,i[n]=r;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=k(i[e]++,e))}},y=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},x=t=>{t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},z=(t,e,a,i)=>{const n=2*e,s=2*a;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[a]},A=(t,e,a)=>{const i=t.heap[a];let n=a<<1;for(;n<=t.heap_len&&(n<t.heap_len&&z(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!z(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i},E=(t,i,n)=>{let s,r,o,_,f=0;if(0!==t.sym_next)do{s=255&t.pending_buf[t.sym_buf+f++],s+=(255&t.pending_buf[t.sym_buf+f++])<<8,r=t.pending_buf[t.sym_buf+f++],0===s?p(t,r,i):(o=l[r],p(t,o+256+1,i),_=e[o],0!==_&&(r-=h[o],g(t,r,_)),s--,o=m(s),p(t,o,n),_=a[o],0!==_&&(s-=d[o],g(t,s,_)))}while(f<t.sym_next);p(t,256,i)},R=(t,e)=>{const a=e.dyn_tree,i=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems;let r,o,l,h=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<s;r++)0!==a[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,a[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=i[2*l+1]);for(e.max_code=h,r=t.heap_len>>1;r>=1;r--)A(t,a,r);l=s;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],A(t,a,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,a[2*l]=a[2*r]+a[2*o],t.depth[l]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,a[2*r+1]=a[2*o+1]=l,t.heap[1]=l++,A(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const a=e.dyn_tree,i=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,d,_,f,c,u,w=0;for(f=0;f<=15;f++)t.bl_count[f]=0;for(a[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)d=t.heap[h],f=a[2*a[2*d+1]+1]+1,f>l&&(f=l,w++),a[2*d+1]=f,d>i||(t.bl_count[f]++,c=0,d>=o&&(c=r[d-o]),u=a[2*d],t.opt_len+=u*(f+c),s&&(t.static_len+=u*(n[2*d+1]+c)));if(0!==w){do{for(f=l-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[l]--,w-=2}while(w>0);for(f=l;0!==f;f--)for(d=t.bl_count[f];0!==d;)_=t.heap[--h],_>i||(a[2*_+1]!==f&&(t.opt_len+=(f-a[2*_+1])*a[2*_],a[2*_+1]=f),d--)}})(t,e),v(a,h,t.bl_count)},Z=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=r,r=e[2*(i+1)+1],++o<l&&n===r||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4))},U=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),i=0;i<=a;i++)if(n=r,r=e[2*(i+1)+1],!(++o<l&&n===r)){if(o<h)do{p(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(p(t,n,t.bl_tree),o--),p(t,16,t.bl_tree),g(t,o-3,2)):o<=10?(p(t,17,t.bl_tree),g(t,o-3,3)):(p(t,18,t.bl_tree),g(t,o-11,7));o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4)}};let S=!1;const D=(t,e,a,i)=>{g(t,0+(i?1:0),3),x(t),b(t,a),b(t,~a),a&&t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a};var T=(t,e,a,i)=>{let o,l,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),R(t,t.l_desc),R(t,t.d_desc),h=(t=>{let e;for(Z(t,t.dyn_ltree,t.l_desc.max_code),Z(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*n[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),o=t.opt_len+3+7>>>3,l=t.static_len+3+7>>>3,l<=o&&(o=l)):o=l=a+5,a+4<=o&&-1!==e?D(t,e,a,i):4===t.strategy||l===o?(g(t,2+(i?1:0),3),E(t,s,r)):(g(t,4+(i?1:0),3),((t,e,a,i)=>{let s;for(g(t,e-257,5),g(t,a-1,5),g(t,i-4,4),s=0;s<i;s++)g(t,t.bl_tree[2*n[s]+1],3);U(t,t.dyn_ltree,e-1),U(t,t.dyn_dtree,a-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),E(t,t.dyn_ltree,t.dyn_dtree)),y(t),i&&x(t)},O={_tr_init:t=>{S||((()=>{let t,n,w,m,b;const g=new Array(16);for(w=0,m=0;m<28;m++)for(h[m]=w,t=0;t<1<<e[m];t++)l[w++]=m;for(l[w-1]=m,b=0,m=0;m<16;m++)for(d[m]=b,t=0;t<1<<a[m];t++)o[b++]=m;for(b>>=7;m<30;m++)for(d[m]=b<<7,t=0;t<1<<a[m]-7;t++)o[256+b++]=m;for(n=0;n<=15;n++)g[n]=0;for(t=0;t<=143;)s[2*t+1]=8,t++,g[8]++;for(;t<=255;)s[2*t+1]=9,t++,g[9]++;for(;t<=279;)s[2*t+1]=7,t++,g[7]++;for(;t<=287;)s[2*t+1]=8,t++,g[8]++;for(v(s,287,g),t=0;t<30;t++)r[2*t+1]=5,r[2*t]=k(t,5);f=new _(s,e,257,286,15),c=new _(r,a,0,30,15),u=new _(new Array(0),i,0,19,7)})(),S=!0),t.l_desc=new w(t.dyn_ltree,f),t.d_desc=new w(t.dyn_dtree,c),t.bl_desc=new w(t.bl_tree,u),t.bi_buf=0,t.bi_valid=0,y(t)},_tr_stored_block:D,_tr_flush_block:T,_tr_tally:(t,e,a)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=a,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(l[a]+256+1)]++,t.dyn_dtree[2*m(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{g(t,2,3),p(t,256,s),(t=>{16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var F=(t,e,a,i)=>{let n=65535&t|0,s=t>>>16&65535|0,r=0;for(;0!==a;){r=a>2e3?2e3:a,a-=r;do{n=n+e[i++]|0,s=s+n|0}while(--r);n%=65521,s%=65521}return n|s<<16|0};const L=new Uint32Array((()=>{let t,e=[];for(var a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e})());var N=(t,e,a,i)=>{const n=L,s=i+a;t^=-1;for(let a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t},I={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},B={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:C,_tr_stored_block:H,_tr_flush_block:M,_tr_tally:j,_tr_align:K}=O,{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:Y,Z_FULL_FLUSH:G,Z_FINISH:X,Z_BLOCK:W,Z_OK:q,Z_STREAM_END:J,Z_STREAM_ERROR:Q,Z_DATA_ERROR:V,Z_BUF_ERROR:$,Z_DEFAULT_COMPRESSION:tt,Z_FILTERED:et,Z_HUFFMAN_ONLY:at,Z_RLE:it,Z_FIXED:nt,Z_DEFAULT_STRATEGY:st,Z_UNKNOWN:rt,Z_DEFLATED:ot}=B,lt=(t,e)=>(t.msg=I[e],e),ht=t=>2*t-(t>4?9:0),dt=t=>{let e=t.length;for(;--e>=0;)t[e]=0},_t=t=>{let e,a,i,n=t.w_size;e=t.hash_size,i=e;do{a=t.head[--i],t.head[i]=a>=n?a-n:0}while(--e);e=n,i=e;do{a=t.prev[--i],t.prev[i]=a>=n?a-n:0}while(--e)};let ft=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask;const ct=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},ut=(t,e)=>{M(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ct(t.strm)},wt=(t,e)=>{t.pending_buf[t.pending++]=e},mt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},bt=(t,e,a,i)=>{let n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),a),1===t.state.wrap?t.adler=F(t.adler,e,n,a):2===t.state.wrap&&(t.adler=N(t.adler,e,n,a)),t.next_in+=n,t.total_in+=n,n)},gt=(t,e)=>{let a,i,n=t.max_chain_length,s=t.strstart,r=t.prev_length,o=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,d=t.w_mask,_=t.prev,f=t.strstart+258;let c=h[s+r-1],u=h[s+r];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(a=e,h[a+r]===u&&h[a+r-1]===c&&h[a]===h[s]&&h[++a]===h[s+1]){s+=2,a++;do{}while(h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&s<f);if(i=258-(f-s),s=f-258,i>r){if(t.match_start=e,r=i,i>=o)break;c=h[s+r-1],u=h[s+r]}}}while((e=_[e&d])>l&&0!=--n);return r<=t.lookahead?r:t.lookahead},pt=t=>{const e=t.w_size;let a,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),_t(t),i+=e),0===t.strm.avail_in)break;if(a=bt(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=a,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=ft(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=ft(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},kt=(t,e)=>{let a,i,n,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r=0,o=t.strm.avail_in;do{if(a=65535,n=t.bi_valid+42>>3,t.strm.avail_out<n)break;if(n=t.strm.avail_out-n,i=t.strstart-t.block_start,a>i+t.strm.avail_in&&(a=i+t.strm.avail_in),a>n&&(a=n),a<s&&(0===a&&e!==X||e===P||a!==i+t.strm.avail_in))break;r=e===X&&a===i+t.strm.avail_in?1:0,H(t,0,0,r),t.pending_buf[t.pending-4]=a,t.pending_buf[t.pending-3]=a>>8,t.pending_buf[t.pending-2]=~a,t.pending_buf[t.pending-1]=~a>>8,ct(t.strm),i&&(i>a&&(i=a),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,a-=i),a&&(bt(t.strm,t.strm.output,t.strm.next_out,a),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a)}while(0===r);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?4:e!==P&&e!==X&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(n=t.window_size-t.strstart,t.strm.avail_in>n&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,n+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),n>t.strm.avail_in&&(n=t.strm.avail_in),n&&(bt(t.strm,t.window,t.strstart,n),t.strstart+=n,t.insert+=n>t.w_size-t.insert?t.w_size-t.insert:n),t.high_water<t.strstart&&(t.high_water=t.strstart),n=t.bi_valid+42>>3,n=t.pending_buf_size-n>65535?65535:t.pending_buf_size-n,s=n>t.w_size?t.w_size:n,i=t.strstart-t.block_start,(i>=s||(i||e===X)&&e!==P&&0===t.strm.avail_in&&i<=n)&&(a=i>n?n:i,r=e===X&&0===t.strm.avail_in&&a===i?1:0,H(t,t.block_start,a,r),t.block_start+=a,ct(t.strm)),r?3:1)},vt=(t,e)=>{let a,i;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a)),t.match_length>=3)if(i=j(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ft(t,t.ins_h,t.window[t.strstart+1]);else i=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2},yt=(t,e)=>{let a,i,n;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a),t.match_length<=5&&(t.strategy===et||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=j(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ut(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=j(t,0,t.window[t.strstart-1]),i&&ut(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=j(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2};function xt(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}const zt=[new xt(0,0,0,0,kt),new xt(4,4,8,4,vt),new xt(4,5,16,8,vt),new xt(4,6,32,32,vt),new xt(4,4,16,16,yt),new xt(8,16,32,32,yt),new xt(8,16,128,128,yt),new xt(8,32,128,256,yt),new xt(32,128,258,1024,yt),new xt(32,258,258,4096,yt)];function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ot,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),dt(this.dyn_ltree),dt(this.dyn_dtree),dt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),dt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),dt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Et=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||42!==e.status&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&113!==e.status&&666!==e.status?1:0},Rt=t=>{if(Et(t))return lt(t,Q);t.total_in=t.total_out=0,t.data_type=rt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=-2,C(e),q},Zt=t=>{const e=Rt(t);var a;return e===q&&((a=t.state).window_size=2*a.w_size,dt(a.head),a.max_lazy_match=zt[a.level].max_lazy,a.good_match=zt[a.level].good_length,a.nice_match=zt[a.level].nice_length,a.max_chain_length=zt[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),e},Ut=(t,e,a,i,n,s)=>{if(!t)return Q;let r=1;if(e===tt&&(e=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>9||a!==ot||i<8||i>15||e<0||e>9||s<0||s>nt||8===i&&1!==r)return lt(t,Q);8===i&&(i=9);const o=new At;return t.state=o,o.strm=t,o.status=42,o.wrap=r,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=s,o.method=a,Zt(t)};var St={deflateInit:(t,e)=>Ut(t,e,ot,15,8,st),deflateInit2:Ut,deflateReset:Zt,deflateResetKeep:Rt,deflateSetHeader:(t,e)=>Et(t)||2!==t.state.wrap?Q:(t.state.gzhead=e,q),deflate:(t,e)=>{if(Et(t)||e>W||e<0)return t?lt(t,Q):Q;const a=t.state;if(!t.output||0!==t.avail_in&&!t.input||666===a.status&&e!==X)return lt(t,0===t.avail_out?$:Q);const i=a.last_flush;if(a.last_flush=e,0!==a.pending){if(ct(t),0===t.avail_out)return a.last_flush=-1,q}else if(0===t.avail_in&&ht(e)<=ht(i)&&e!==X)return lt(t,$);if(666===a.status&&0!==t.avail_in)return lt(t,$);if(42===a.status&&0===a.wrap&&(a.status=113),42===a.status){let e=ot+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=at||a.level<2?0:a.level<6?1:6===a.level?2:3,e|=i<<6,0!==a.strstart&&(e|=32),e+=31-e%31,mt(a,e),0!==a.strstart&&(mt(a,t.adler>>>16),mt(a,65535&t.adler)),t.adler=1,a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(57===a.status)if(t.adler=0,wt(a,31),wt(a,139),wt(a,8),a.gzhead)wt(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),wt(a,255&a.gzhead.time),wt(a,a.gzhead.time>>8&255),wt(a,a.gzhead.time>>16&255),wt(a,a.gzhead.time>>24&255),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(wt(a,255&a.gzhead.extra.length),wt(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=N(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,3),a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q;if(69===a.status){if(a.gzhead.extra){let e=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let n=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex+=n,ct(t),0!==a.pending)return a.last_flush=-1,q;e=0,i-=n}let n=new Uint8Array(a.gzhead.extra);a.pending_buf.set(n.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(ct(t),0!==a.pending))return a.last_flush=-1,q;wt(a,255&t.adler),wt(a,t.adler>>8&255),t.adler=0}if(a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(0!==t.avail_in||0!==a.lookahead||e!==P&&666!==a.status){let i=0===a.level?kt(a,e):a.strategy===at?((t,e)=>{let a;for(;;){if(0===t.lookahead&&(pt(t),0===t.lookahead)){if(e===P)return 1;break}if(t.match_length=0,a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):a.strategy===it?((t,e)=>{let a,i,n,s;const r=t.window;for(;;){if(t.lookahead<=258){if(pt(t),t.lookahead<=258&&e===P)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){s=t.strstart+258;do{}while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<s);t.match_length=258-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=j(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):zt[a.level].func(a,e);if(3!==i&&4!==i||(a.status=666),1===i||3===i)return 0===t.avail_out&&(a.last_flush=-1),q;if(2===i&&(e===Y?K(a):e!==W&&(H(a,0,0,!1),e===G&&(dt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ct(t),0===t.avail_out))return a.last_flush=-1,q}return e!==X?q:a.wrap<=0?J:(2===a.wrap?(wt(a,255&t.adler),wt(a,t.adler>>8&255),wt(a,t.adler>>16&255),wt(a,t.adler>>24&255),wt(a,255&t.total_in),wt(a,t.total_in>>8&255),wt(a,t.total_in>>16&255),wt(a,t.total_in>>24&255)):(mt(a,t.adler>>>16),mt(a,65535&t.adler)),ct(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?q:J)},deflateEnd:t=>{if(Et(t))return Q;const e=t.state.status;return t.state=null,113===e?lt(t,V):q},deflateSetDictionary:(t,e)=>{let a=e.length;if(Et(t))return Q;const i=t.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return Q;if(1===n&&(t.adler=F(t.adler,e,a,0)),i.wrap=0,a>=i.w_size){0===n&&(dt(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(a-i.w_size,a),0),e=t,a=i.w_size}const s=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,pt(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=ft(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,pt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=r,t.input=o,t.avail_in=s,i.wrap=n,q},deflateInfo:"pako deflate (from Nodeca project)"};const Dt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Tt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const e in a)Dt(a,e)&&(t[e]=a[e])}}return t},Ot=t=>{let e=0;for(let a=0,i=t.length;a<i;a++)e+=t[a].length;const a=new Uint8Array(e);for(let e=0,i=0,n=t.length;e<n;e++){let n=t[e];a.set(n,i),i+=n.length}return a};let Ft=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Ft=!1}const Lt=new Uint8Array(256);for(let t=0;t<256;t++)Lt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Lt[254]=Lt[254]=1;var Nt=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,i,n,s,r=t.length,o=0;for(n=0;n<r;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(o),s=0,n=0;s<o;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},It=(t,e)=>{const a=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,n;const s=new Array(2*a);for(n=0,i=0;i<a;){let e=t[i++];if(e<128){s[n++]=e;continue}let r=Lt[e];if(r>4)s[n++]=65533,i+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&i<a;)e=e<<6|63&t[i++],r--;r>1?s[n++]=65533:e<65536?s[n++]=e:(e-=65536,s[n++]=55296|e>>10&1023,s[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Ft)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a})(s,n)},Bt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let a=e-1;for(;a>=0&&128==(192&t[a]);)a--;return a<0||0===a?e:a+Lt[t[a]]>e?a:e};var Ct=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ht=Object.prototype.toString,{Z_NO_FLUSH:Mt,Z_SYNC_FLUSH:jt,Z_FULL_FLUSH:Kt,Z_FINISH:Pt,Z_OK:Yt,Z_STREAM_END:Gt,Z_DEFAULT_COMPRESSION:Xt,Z_DEFAULT_STRATEGY:Wt,Z_DEFLATED:qt}=B;function Jt(t){this.options=Tt({level:Xt,method:qt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=St.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==Yt)throw new Error(I[a]);if(e.header&&St.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Nt(e.dictionary):"[object ArrayBuffer]"===Ht.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=St.deflateSetDictionary(this.strm,t),a!==Yt)throw new Error(I[a]);this._dict_set=!0}}function Qt(t,e){const a=new Jt(e);if(a.push(t,!0),a.err)throw a.msg||I[a.err];return a.result}Jt.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Pt:Mt,"string"==typeof t?a.input=Nt(t):"[object ArrayBuffer]"===Ht.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(s===jt||s===Kt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(n=St.deflate(a,s),n===Gt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),n=St.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Yt;if(0!==a.avail_out){if(s>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Jt.prototype.onData=function(t){this.chunks.push(t)},Jt.prototype.onEnd=function(t){t===Yt&&(this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Vt={Deflate:Jt,deflate:Qt,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Qt(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Qt(t,e)},constants:B};var $t=function(t,e){let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z,A;const E=t.state;a=t.next_in,z=t.input,i=a+(t.avail_in-5),n=t.next_out,A=t.output,s=n-(e-t.avail_out),r=n+(t.avail_out-257),o=E.dmax,l=E.wsize,h=E.whave,d=E.wnext,_=E.window,f=E.hold,c=E.bits,u=E.lencode,w=E.distcode,m=(1<<E.lenbits)-1,b=(1<<E.distbits)-1;t:do{c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=u[f&m];e:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,0===p)A[n++]=65535&g;else{if(!(16&p)){if(0==(64&p)){g=u[(65535&g)+(f&(1<<p)-1)];continue e}if(32&p){E.mode=16191;break t}t.msg="invalid literal/length code",E.mode=16209;break t}k=65535&g,p&=15,p&&(c<p&&(f+=z[a++]<<c,c+=8),k+=f&(1<<p)-1,f>>>=p,c-=p),c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=w[f&b];a:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,!(16&p)){if(0==(64&p)){g=w[(65535&g)+(f&(1<<p)-1)];continue a}t.msg="invalid distance code",E.mode=16209;break t}if(v=65535&g,p&=15,c<p&&(f+=z[a++]<<c,c+=8,c<p&&(f+=z[a++]<<c,c+=8)),v+=f&(1<<p)-1,v>o){t.msg="invalid distance too far back",E.mode=16209;break t}if(f>>>=p,c-=p,p=n-s,v>p){if(p=v-p,p>h&&E.sane){t.msg="invalid distance too far back",E.mode=16209;break t}if(y=0,x=_,0===d){if(y+=l-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}else if(d<p){if(y+=l+d-p,p-=d,p<k){k-=p;do{A[n++]=_[y++]}while(--p);if(y=0,d<k){p=d,k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}}else if(y+=d-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}for(;k>2;)A[n++]=x[y++],A[n++]=x[y++],A[n++]=x[y++],k-=3;k&&(A[n++]=x[y++],k>1&&(A[n++]=x[y++]))}else{y=n-v;do{A[n++]=A[y++],A[n++]=A[y++],A[n++]=A[y++],k-=3}while(k>2);k&&(A[n++]=A[y++],k>1&&(A[n++]=A[y++]))}break}}break}}while(a<i&&n<r);k=c>>3,a-=k,c-=k<<3,f&=(1<<c)-1,t.next_in=a,t.next_out=n,t.avail_in=a<i?i-a+5:5-(a-i),t.avail_out=n<r?r-n+257:257-(n-r),E.hold=f,E.bits=c};const te=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ee=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ie=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ne=(t,e,a,i,n,s,r,o)=>{const l=o.bits;let h,d,_,f,c,u,w=0,m=0,b=0,g=0,p=0,k=0,v=0,y=0,x=0,z=0,A=null;const E=new Uint16Array(16),R=new Uint16Array(16);let Z,U,S,D=null;for(w=0;w<=15;w++)E[w]=0;for(m=0;m<i;m++)E[e[a+m]]++;for(p=l,g=15;g>=1&&0===E[g];g--);if(p>g&&(p=g),0===g)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(b=1;b<g&&0===E[b];b++);for(p<b&&(p=b),y=1,w=1;w<=15;w++)if(y<<=1,y-=E[w],y<0)return-1;if(y>0&&(0===t||1!==g))return-1;for(R[1]=0,w=1;w<15;w++)R[w+1]=R[w]+E[w];for(m=0;m<i;m++)0!==e[a+m]&&(r[R[e[a+m]]++]=m);if(0===t?(A=D=r,u=20):1===t?(A=te,D=ee,u=257):(A=ae,D=ie,u=0),z=0,m=0,w=b,c=s,k=p,v=0,_=-1,x=1<<p,f=x-1,1===t&&x>852||2===t&&x>592)return 1;for(;;){Z=w-v,r[m]+1<u?(U=0,S=r[m]):r[m]>=u?(U=D[r[m]-u],S=A[r[m]-u]):(U=96,S=0),h=1<<w-v,d=1<<k,b=d;do{d-=h,n[c+(z>>v)+d]=Z<<24|U<<16|S|0}while(0!==d);for(h=1<<w-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,m++,0==--E[w]){if(w===g)break;w=e[a+r[m]]}if(w>p&&(z&f)!==_){for(0===v&&(v=p),c+=b,k=w-v,y=1<<k;k+v<g&&(y-=E[k+v],!(y<=0));)k++,y<<=1;if(x+=1<<k,1===t&&x>852||2===t&&x>592)return 1;_=z&f,n[_]=p<<24|k<<16|c-s|0}}return 0!==z&&(n[c+z]=w-v<<24|64<<16|0),o.bits=p,0};const{Z_FINISH:se,Z_BLOCK:re,Z_TREES:oe,Z_OK:le,Z_STREAM_END:he,Z_NEED_DICT:de,Z_STREAM_ERROR:_e,Z_DATA_ERROR:fe,Z_MEM_ERROR:ce,Z_BUF_ERROR:ue,Z_DEFLATED:we}=B,me=16209,be=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function ge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pe=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<16180||e.mode>16211?1:0},ke=t=>{if(pe(t))return _e;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=16180,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,le},ve=t=>{if(pe(t))return _e;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,ke(t)},ye=(t,e)=>{let a;if(pe(t))return _e;const i=t.state;return e<0?(a=0,e=-e):(a=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?_e:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,ve(t))},xe=(t,e)=>{if(!t)return _e;const a=new ge;t.state=a,a.strm=t,a.window=null,a.mode=16180;const i=ye(t,e);return i!==le&&(t.state=null),i};let ze,Ae,Ee=!0;const Re=t=>{if(Ee){ze=new Int32Array(512),Ae=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ne(1,t.lens,0,288,ze,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ne(2,t.lens,0,32,Ae,0,t.work,{bits:5}),Ee=!1}t.lencode=ze,t.lenbits=9,t.distcode=Ae,t.distbits=5},Ze=(t,e,a,i)=>{let n;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(a-s.wsize,a),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(e.subarray(a-i,a-i+n),s.wnext),(i-=n)?(s.window.set(e.subarray(a-i,a),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var Ue={inflateReset:ve,inflateReset2:ye,inflateResetKeep:ke,inflateInit:t=>xe(t,15),inflateInit2:xe,inflate:(t,e)=>{let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z=0;const A=new Uint8Array(4);let E,R;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pe(t)||!t.output||!t.input&&0!==t.avail_in)return _e;a=t.state,16191===a.mode&&(a.mode=16192),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,_=o,f=l,x=le;t:for(;;)switch(a.mode){case 16180:if(0===a.wrap){a.mode=16192;break}for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(2&a.wrap&&35615===h){0===a.wbits&&(a.wbits=15),a.check=0,A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0),h=0,d=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",a.mode=me;break}if((15&h)!==we){t.msg="unknown compression method",a.mode=me;break}if(h>>>=4,d-=4,y=8+(15&h),0===a.wbits&&(a.wbits=y),y>15||y>a.wbits){t.msg="invalid window size",a.mode=me;break}a.dmax=1<<a.wbits,a.flags=0,t.adler=a.check=1,a.mode=512&h?16189:16191,h=0,d=0;break;case 16181:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.flags=h,(255&a.flags)!==we){t.msg="unknown compression method",a.mode=me;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=me;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16182;case 16182:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.time=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,A[2]=h>>>16&255,A[3]=h>>>24&255,a.check=N(a.check,A,4,0)),h=0,d=0,a.mode=16183;case 16183:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16184;case 16184:if(1024&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(c=a.length,c>o&&(c=o),c&&(a.head&&(y=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(s,s+c),y)),512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,a.length-=c),a.length))break t;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.name+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.comment+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(65535&a.check)){t.msg="header crc mismatch",a.mode=me;break}h=0,d=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=16191;break;case 16189:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}t.adler=a.check=be(h),h=0,d=0,a.mode=16190;case 16190:if(0===a.havedict)return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,de;t.adler=a.check=1,a.mode=16191;case 16191:if(e===re||e===oe)break t;case 16192:if(a.last){h>>>=7&d,d-=7&d,a.mode=16206;break}for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}switch(a.last=1&h,h>>>=1,d-=1,3&h){case 0:a.mode=16193;break;case 1:if(Re(a),a.mode=16199,e===oe){h>>>=2,d-=2;break t}break;case 2:a.mode=16196;break;case 3:t.msg="invalid block type",a.mode=me}h>>>=2,d-=2;break;case 16193:for(h>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",a.mode=me;break}if(a.length=65535&h,h=0,d=0,a.mode=16194,e===oe)break t;case 16194:a.mode=16195;case 16195:if(c=a.length,c){if(c>o&&(c=o),c>l&&(c=l),0===c)break t;n.set(i.subarray(s,s+c),r),o-=c,s+=c,l-=c,r+=c,a.length-=c;break}a.mode=16191;break;case 16196:for(;d<14;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.nlen=257+(31&h),h>>>=5,d-=5,a.ndist=1+(31&h),h>>>=5,d-=5,a.ncode=4+(15&h),h>>>=4,d-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=me;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.lens[Z[a.have++]]=7&h,h>>>=3,d-=3}for(;a.have<19;)a.lens[Z[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,E={bits:a.lenbits},x=ne(0,a.lens,0,19,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid code lengths set",a.mode=me;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(g<16)h>>>=m,d-=m,a.lens[a.have++]=g;else{if(16===g){for(R=m+2;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(h>>>=m,d-=m,0===a.have){t.msg="invalid bit length repeat",a.mode=me;break}y=a.lens[a.have-1],c=3+(3&h),h>>>=2,d-=2}else if(17===g){for(R=m+3;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=3+(7&h),h>>>=3,d-=3}else{for(R=m+7;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=11+(127&h),h>>>=7,d-=7}if(a.have+c>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=me;break}for(;c--;)a.lens[a.have++]=y}}if(a.mode===me)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=me;break}if(a.lenbits=9,E={bits:a.lenbits},x=ne(1,a.lens,0,a.nlen,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid literal/lengths set",a.mode=me;break}if(a.distbits=6,a.distcode=a.distdyn,E={bits:a.distbits},x=ne(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,E),a.distbits=E.bits,x){t.msg="invalid distances set",a.mode=me;break}if(a.mode=16199,e===oe)break t;case 16199:a.mode=16200;case 16200:if(o>=6&&l>=258){t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,$t(t,f),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,16191===a.mode&&(a.back=-1);break}for(a.back=0;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(b&&0==(240&b)){for(p=m,k=b,v=g;z=a.lencode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,a.length=g,0===b){a.mode=16205;break}if(32&b){a.back=-1,a.mode=16191;break}if(64&b){t.msg="invalid literal/length code",a.mode=me;break}a.extra=15&b,a.mode=16201;case 16201:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;z=a.distcode[h&(1<<a.distbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(0==(240&b)){for(p=m,k=b,v=g;z=a.distcode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,64&b){t.msg="invalid distance code",a.mode=me;break}a.offset=g,a.extra=15&b,a.mode=16203;case 16203:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=me;break}a.mode=16204;case 16204:if(0===l)break t;if(c=f-l,a.offset>c){if(c=a.offset-c,c>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=me;break}c>a.wnext?(c-=a.wnext,u=a.wsize-c):u=a.wnext-c,c>a.length&&(c=a.length),w=a.window}else w=n,u=r-a.offset,c=a.length;c>l&&(c=l),l-=c,a.length-=c;do{n[r++]=w[u++]}while(--c);0===a.length&&(a.mode=16200);break;case 16205:if(0===l)break t;n[r++]=a.length,l--,a.mode=16200;break;case 16206:if(a.wrap){for(;d<32;){if(0===o)break t;o--,h|=i[s++]<<d,d+=8}if(f-=l,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,r-f):F(a.check,n,f,r-f)),f=l,4&a.wrap&&(a.flags?h:be(h))!==a.check){t.msg="incorrect data check",a.mode=me;break}h=0,d=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=me;break}h=0,d=0}a.mode=16208;case 16208:x=he;break t;case me:x=fe;break t;case 16210:return ce;default:return _e}return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,(a.wsize||f!==t.avail_out&&a.mode<me&&(a.mode<16206||e!==se))&&Ze(t,t.output,t.next_out,f-t.avail_out),_-=t.avail_in,f-=t.avail_out,t.total_in+=_,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,t.next_out-f):F(a.check,n,f,t.next_out-f)),t.data_type=a.bits+(a.last?64:0)+(16191===a.mode?128:0)+(16199===a.mode||16194===a.mode?256:0),(0===_&&0===f||e===se)&&x===le&&(x=ue),x},inflateEnd:t=>{if(pe(t))return _e;let e=t.state;return e.window&&(e.window=null),t.state=null,le},inflateGetHeader:(t,e)=>{if(pe(t))return _e;const a=t.state;return 0==(2&a.wrap)?_e:(a.head=e,e.done=!1,le)},inflateSetDictionary:(t,e)=>{const a=e.length;let i,n,s;return pe(t)?_e:(i=t.state,0!==i.wrap&&16190!==i.mode?_e:16190===i.mode&&(n=1,n=F(n,e,a,0),n!==i.check)?fe:(s=Ze(t,e,a,a),s?(i.mode=16210,ce):(i.havedict=1,le)))},inflateInfo:"pako inflate (from Nodeca project)"};var Se=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const De=Object.prototype.toString,{Z_NO_FLUSH:Te,Z_FINISH:Oe,Z_OK:Fe,Z_STREAM_END:Le,Z_NEED_DICT:Ne,Z_STREAM_ERROR:Ie,Z_DATA_ERROR:Be,Z_MEM_ERROR:Ce}=B;function He(t){this.options=Tt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=Ue.inflateInit2(this.strm,e.windowBits);if(a!==Fe)throw new Error(I[a]);if(this.header=new Se,Ue.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Nt(e.dictionary):"[object ArrayBuffer]"===De.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=Ue.inflateSetDictionary(this.strm,e.dictionary),a!==Fe)))throw new Error(I[a])}He.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,r,o;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Oe:Te,"[object ArrayBuffer]"===De.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),s=Ue.inflate(a,r),s===Ne&&n&&(s=Ue.inflateSetDictionary(a,n),s===Fe?s=Ue.inflate(a,r):s===Be&&(s=Ne));a.avail_in>0&&s===Le&&a.state.wrap>0&&0!==t[a.next_in];)Ue.inflateReset(a),s=Ue.inflate(a,r);switch(s){case Ie:case Be:case Ne:case Ce:return this.onEnd(s),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||s===Le))if("string"===this.options.to){let t=Bt(a.output,a.next_out),e=a.next_out-t,n=It(a.output,t);a.next_out=e,a.avail_out=i-e,e&&a.output.set(a.output.subarray(t,t+e),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(s!==Fe||0!==o){if(s===Le)return s=Ue.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},He.prototype.onData=function(t){this.chunks.push(t)},He.prototype.onEnd=function(t){t===Fe&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const{Deflate:Me,deflate:je,deflateRaw:Ke,gzip:Pe}=Vt;var Ye=Me,Ge=je,Xe=B;const We=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const e=this._hasEvents?",":"";this.deflate.push(e+t,Xe.Z_SYNC_FLUSH),this._hasEvents=!0}finish(){if(this.deflate.push("]",Xe.Z_FINISH),this.deflate.err)throw this.deflate.err;const t=this.deflate.result;return this._init(),t}_init(){this._hasEvents=!1,this.deflate=new Ye,this.deflate.push("[",Xe.Z_NO_FLUSH)}},qe={clear:()=>{We.clear()},addEvent:t=>We.addEvent(t),finish:()=>We.finish(),compress:t=>function(t){return Ge(t)}(t)};addEventListener("message",(function(t){const e=t.data.method,a=t.data.id,i=t.data.arg;if(e in qe&&"function"==typeof qe[e])try{const t=qe[e](i);postMessage({id:a,method:e,success:!0,response:t})}catch(t){postMessage({id:a,method:e,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});`;function xA(){const e=new Blob([EA]);return URL.createObjectURL(e)}function Ol(e){return e>9999999999?e:e*1e3}class Am{constructor(){this.events=[]}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(t){this.events.push(t)}finish(){return new Promise(t=>{const i=this.events;this.events=[],t(JSON.stringify(i))})}clear(){this.events=[]}getEarliestTimestamp(){const t=this.events.map(i=>i.timestamp).sort()[0];return t?Ol(t):null}}class wA{constructor(t){this._worker=t,this._id=0}ensureReady(){return this._ensureReadyPromise?this._ensureReadyPromise:(this._ensureReadyPromise=new Promise((t,i)=>{this._worker.addEventListener("message",({data:s})=>{s.success?t():i()},{once:!0}),this._worker.addEventListener("error",s=>{i(s)},{once:!0})}),this._ensureReadyPromise)}destroy(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(t,i){const s=this._getAndIncrementId();return new Promise((r,n)=>{const o=({data:a})=>{const h=a;if(h.method===t&&h.id===s){if(this._worker.removeEventListener("message",o),!h.success){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay]",h.response),n(new Error("Error in compression worker"));return}r(h.response)}};this._worker.addEventListener("message",o),this._worker.postMessage({id:s,method:t,arg:i})})}_getAndIncrementId(){return this._id++}}class SA{constructor(t){this._worker=new wA(t),this._earliestTimestamp=null}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(t){const i=Ol(t.timestamp);return(!this._earliestTimestamp||i<this._earliestTimestamp)&&(this._earliestTimestamp=i),this._sendEventToWorker(t)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._worker.postMessage("clear")}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(t){return this._worker.postMessage("addEvent",JSON.stringify(t))}async _finishRequest(){const t=await this._worker.postMessage("finish");return this._earliestTimestamp=null,t}}class TA{constructor(t){this._fallback=new Am,this._compression=new SA(t),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(t){return this._used.addEvent(t)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:t}=this._fallback,i=[];for(const s of t)i.push(this._compression.addEvent(s));this._used=this._compression;try{await Promise.all(i)}catch(s){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("[Replay] Failed to add events when switching buffers.",s)}}}function AA({useCompression:e}){if(e&&window.Worker)try{const t=xA();(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Using compression worker");const i=new Worker(t);return new TA(i)}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Failed to create compression worker")}return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Using simple buffer"),new Am}function RA(e){IA(),e.session=void 0}function IA(){if("sessionStorage"in ht)try{ht.sessionStorage.removeItem(Nl)}catch{}}function Wh(e,t,i=+new Date){return e===null||t===void 0||t<0?!0:t===0?!1:e+t<=i}function Rm(e,t,i=+new Date){return Wh(e.started,t.maxSessionLife,i)||Wh(e.lastActivity,t.sessionIdleExpire,i)}function Im(e){return e===void 0?!1:Math.random()<e}function Ll(e){if("sessionStorage"in ht)try{ht.sessionStorage.setItem(Nl,JSON.stringify(e))}catch{}}function Fl(e){const t=Date.now(),i=e.id||qe(),s=e.started||t,r=e.lastActivity||t,n=e.segmentId||0,o=e.sampled;return{id:i,started:s,lastActivity:r,segmentId:n,sampled:o,shouldRefresh:!0}}function CA(e,t){return Im(e)?"session":t?"buffer":!1}function kA({sessionSampleRate:e,allowBuffering:t,stickySession:i=!1}){const s=CA(e,t),r=Fl({sampled:s});return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Replay] Creating new session: ${r.id}`),i&&Ll(r),r}function DA(){if(!("sessionStorage"in ht))return null;try{const t=ht.sessionStorage.getItem(Nl);if(!t)return null;const i=JSON.parse(t);return Fl(i)}catch{return null}}function Na({timeouts:e,currentSession:t,stickySession:i,sessionSampleRate:s,allowBuffering:r}){const n=t||i&&DA();if(n)if(Rm(n,e))if(n.shouldRefresh)(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Session has expired");else return{type:"new",session:Fl({sampled:!1})};else return{type:"saved",session:n};return{type:"new",session:kA({stickySession:i,sessionSampleRate:s,allowBuffering:r})}}var yo;(function(e){e[e.DomContentLoaded=0]="DomContentLoaded";const i=1;e[e.Load=i]="Load";const s=2;e[e.FullSnapshot=s]="FullSnapshot";const r=3;e[e.IncrementalSnapshot=r]="IncrementalSnapshot";const n=4;e[e.Meta=n]="Meta";const o=5;e[e.Custom=o]="Custom";const a=6;e[e.Plugin=a]="Plugin"})(yo||(yo={}));async function vo(e,t,i){if(!e.eventBuffer||e.isPaused()||Ol(t.timestamp)+e.timeouts.sessionIdlePause<Date.now())return null;try{i&&e.eventBuffer.clear();const r=e.getOptions(),n=typeof r.beforeAddRecordingEvent=="function"&&t.type===yo.Custom?r.beforeAddRecordingEvent(t):t;return n?await e.eventBuffer.addEvent(n):void 0}catch(r){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(r),await e.stop("addEvent");const n=tt().getClient();n&&n.recordDroppedEvent("internal_sdk_error","replay")}}function Xh(e){return!e.type}function Vh(e){return e.type==="transaction"}function PA(e){return e.type==="replay_event"}function Cm(e){const t=MA();return(i,s)=>{if(!Xh(i)&&!Vh(i))return;const r=s&&s.statusCode;if(!(t&&(!r||r<200||r>=300))){if(Vh(i)&&i.contexts&&i.contexts.trace&&i.contexts.trace.trace_id){e.getContext().traceIds.add(i.contexts.trace.trace_id);return}Xh(i)&&(i.event_id&&e.getContext().errorIds.add(i.event_id),e.recordingMode==="buffer"&&i.tags&&i.tags.replayId&&setTimeout(()=>{e.sendBufferedReplayOrFlush()}))}}}function MA(){const e=tt().getClient();if(!e)return!1;const t=e.getTransport();return t&&t.send.__sentry__baseTransport__||!1}function NA(e,t){return e.type||!e.exception||!e.exception.values||!e.exception.values.length?!1:t.originalException&&t.originalException.__rrweb__?!0:e.exception.values.some(i=>!i.stacktrace||!i.stacktrace.frames||!i.stacktrace.frames.length?!1:i.stacktrace.frames.some(s=>s.filename&&s.filename.includes("/rrweb/src/")))}function BA(e,t){return e.recordingMode!=="buffer"||t.message===Bl||!t.exception||t.type?!1:Im(e.getOptions().errorSampleRate)}function OA(e,t=!1){const i=t?Cm(e):void 0;return(s,r)=>PA(s)?(delete s.breadcrumbs,s):!Xh(s)&&!Vh(s)?s:NA(s,r)&&!e.getOptions()._experiments.captureExceptions?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Ignoring error from rrweb internals",s),null):((BA(e,s)||e.recordingMode==="session")&&(s.tags={...s.tags,replayId:e.getSessionId()}),i&&i(s,{statusCode:200}),s)}function zo(e,t){return t.map(({type:i,start:s,end:r,name:n,data:o})=>{const a=e.throttledAddEvent({type:ut.Custom,timestamp:s,data:{tag:"performanceSpan",payload:{op:i,description:n,startTimestamp:s,endTimestamp:r,data:o}}});return typeof a=="string"?Promise.resolve(null):a})}function LA(e){const{from:t,to:i}=e,s=Date.now()/1e3;return{type:"navigation.push",start:s,end:s,name:i,data:{previous:t}}}function FA(e){return t=>{if(!e.isEnabled())return;const i=LA(t);i!==null&&(e.getContext().urls.push(i.name),e.triggerUserActivity(),e.addUpdate(()=>(zo(e,[i]),!1)))}}function UA(e,t){return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&e.getOptions()._experiments.traceInternals?!1:GA(t)}function GA(e){const t=tt().getClient(),i=t&&t.getDsn();return i?e.includes(i.host):!1}function $o(e,t){e.isEnabled()&&t!==null&&(UA(e,t.name)||e.addUpdate(()=>(zo(e,[t]),!0)))}function HA(e){const{startTimestamp:t,endTimestamp:i,fetchData:s,response:r}=e;if(!i)return null;const{method:n,url:o}=s;return{type:"resource.fetch",start:t/1e3,end:i/1e3,name:o,data:{method:n,statusCode:r&&r.status}}}function zA(e){return t=>{if(!e.isEnabled())return;const i=HA(t);$o(e,i)}}function $A(e){const{startTimestamp:t,endTimestamp:i,xhr:s}=e,r=s[hi];if(!t||!i||!r)return null;const{method:n,url:o,status_code:a}=r;return o===void 0?null:{type:"resource.xhr",name:o,start:t/1e3,end:i/1e3,data:{method:n,statusCode:a}}}function YA(e){return t=>{if(!e.isEnabled())return;const i=$A(t);$o(e,i)}}const li=10,Ul=11,jh=12,Je=13,qh=14,Ps=15,We=20,ne=21,Kh=22,Ms=23,km=["true","false","null"];function WA(e,t){if(!t.length)return e;let i=e;const s=t.length-1,r=t[s];i=XA(i,r);for(let n=s;n>=0;n--)switch(t[n]){case li:i=`${i}}`;break;case We:i=`${i}]`;break}return i}function XA(e,t){switch(t){case li:return`${e}"~~":"~~"`;case Ul:return`${e}:"~~"`;case jh:return`${e}~~":"~~"`;case Je:return qA(e);case qh:return`${e}~~"`;case Ps:return`${e},"~~":"~~"`;case We:return`${e}"~~"`;case ne:return VA(e);case Kh:return`${e}~~"`;case Ms:return`${e},"~~"`}return e}function VA(e){const t=jA(e);if(t>-1){const i=e.slice(t+1);return km.includes(i.trim())?`${e},"~~"`:`${e.slice(0,t+1)}"~~"`}return e}function jA(e){for(let t=e.length-1;t>=0;t--){const i=e[t];if(i===","||i==="[")return t}return-1}function qA(e){const t=e.lastIndexOf(":"),i=e.slice(t+1);return km.includes(i.trim())?`${e},"~~":"~~"`:`${e.slice(0,t+1)}"~~"`}function KA(e){const t=[];for(let i=0;i<e.length;i++)ZA(t,e,i);return t}function ZA(e,t,i){const s=e[e.length-1],r=t[i];if(!/\s/.test(r)){if(r==='"'&&!Dm(t,i)){JA(e,s);return}switch(r){case"{":QA(e,s);break;case"[":tR(e,s);break;case":":eR(e,s);break;case",":iR(e,s);break;case"}":sR(e,s);break;case"]":rR(e,s);break}}}function JA(e,t){if(t===qh){e.pop(),e.push(Ps);return}if(t===Kh){e.pop(),e.push(Ms);return}if(t===Je){e.push(qh);return}if(t===ne){e.push(Kh);return}if(t===li){e.push(jh);return}if(t===jh){e.pop(),e.push(Ul);return}}function QA(e,t){if(!t){e.push(li);return}if(t===Je){e.push(li);return}if(t===ne&&e.push(li),t===We){e.push(li);return}}function tR(e,t){if(!t){e.push(We),e.push(ne);return}if(t===Je){e.push(We),e.push(ne);return}if(t===ne&&(e.push(We),e.push(ne)),t===We){e.push(We),e.push(ne);return}}function eR(e,t){t===Ul&&(e.pop(),e.push(Je))}function iR(e,t){if(t===Je){e.pop();return}if(t===Ps){e.pop(),e.pop();return}if(t!==ne&&t===Ms){e.pop();return}}function sR(e,t){t===li&&e.pop(),t===Je&&(e.pop(),e.pop()),t===Ps&&(e.pop(),e.pop(),e.pop()),e[e.length-1]===Je&&e.push(Ps),e[e.length-1]===ne&&e.push(Ms)}function rR(e,t){t===We&&e.pop(),t===ne&&(e.pop(),e.pop()),t===Ms&&(e.pop(),e.pop(),e.pop()),e[e.length-1]===Je&&e.push(Ps),e[e.length-1]===ne&&e.push(Ms)}function Dm(e,t){return e[t-1]==="\\"&&!Dm(e,t-1)}function Pm(e){const t=KA(e);return WA(e,t)}function bo(e,t){if(e)try{if(typeof e=="string")return t.encode(e).length;if(e instanceof URLSearchParams)return t.encode(e.toString()).length;if(e instanceof FormData){const i=Om(e);return t.encode(i).length}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength}catch{}}function Mm(e){if(!e)return;const t=parseInt(e,10);return isNaN(t)?void 0:t}function Nm(e){if(typeof e=="string")return e;if(e instanceof URLSearchParams)return e.toString();if(e instanceof FormData)return Om(e)}function Bm(e,t){if(!t)return null;const{startTimestamp:i,endTimestamp:s,url:r,method:n,statusCode:o,request:a,response:h}=t;return{type:e,start:i/1e3,end:s/1e3,name:r,data:Be({method:n,statusCode:o,request:a,response:h})}}function Cr(e){return{headers:{},size:e,_meta:{warnings:["URL_SKIPPED"]}}}function ci(e,t,i){if(!t&&Object.keys(e).length===0)return;if(!t)return{headers:e};if(!i)return{headers:e,size:t};const s={headers:e,size:t},{body:r,warnings:n}=nR(i);return s.body=r,n.length>0&&(s._meta={warnings:n}),s}function Zh(e,t){return Object.keys(e).reduce((i,s)=>{const r=s.toLowerCase();return t.includes(r)&&e[s]&&(i[r]=e[s]),i},{})}function Om(e){return new URLSearchParams(e).toString()}function nR(e){if(!e||typeof e!="string")return{body:e,warnings:[]};const t=e.length>Sn;if(oR(e))try{const i=t?Pm(e.slice(0,Sn)):e;return{body:JSON.parse(i),warnings:t?["JSON_TRUNCATED"]:[]}}catch{return{body:t?`${e.slice(0,Sn)}…`:e,warnings:t?["INVALID_JSON","TEXT_TRUNCATED"]:["INVALID_JSON"]}}return{body:t?`${e.slice(0,Sn)}…`:e,warnings:t?["TEXT_TRUNCATED"]:[]}}function oR(e){const t=e[0],i=e[e.length-1];return t==="["&&i==="]"||t==="{"&&i==="}"}function Lm(e,t){const i=aR(e);return Us(i,t)}function aR(e,t=ht.document.baseURI){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith(ht.location.origin))return e;const i=new URL(e,t);if(i.origin!==new URL(t).origin)return e;const s=i.href;return!e.endsWith("/")&&s.endsWith("/")?s.slice(0,-1):s}async function hR(e,t,i){try{const s=await cR(e,t,i),r=Bm("resource.fetch",s);$o(i.replay,r)}catch(s){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay] Failed to capture fetch breadcrumb",s)}}function lR(e,t,i){const{input:s,response:r}=t,n=Fm(s),o=bo(n,i.textEncoder),a=r?Mm(r.headers.get("content-length")):void 0;o!==void 0&&(e.data.request_body_size=o),a!==void 0&&(e.data.response_body_size=a)}async function cR(e,t,i){const{startTimestamp:s,endTimestamp:r}=t,{url:n,method:o,status_code:a=0,request_body_size:h,response_body_size:l}=e.data,c=Lm(n,i.networkDetailAllowUrls),u=c?uR(i,t.input,h):Cr(h),d=await dR(c,i,t.response,l);return{startTimestamp:s,endTimestamp:r,url:n,method:o,statusCode:a,request:u,response:d}}function uR({networkCaptureBodies:e,networkRequestHeaders:t},i,s){const r=pR(i,t);if(!e)return ci(r,s,void 0);const n=Fm(i),o=Nm(n);return ci(r,s,o)}async function dR(e,{networkCaptureBodies:t,textEncoder:i,networkResponseHeaders:s},r,n){if(!e&&n!==void 0)return Cr(n);const o=Um(r.headers,s);if(!t&&n!==void 0)return ci(o,n,void 0);try{const a=r.clone(),h=await fR(a),l=h&&h.length&&n===void 0?bo(h,i):n;return e?t?ci(o,l,h):ci(o,l,void 0):Cr(l)}catch{return ci(o,n,void 0)}}async function fR(e){try{return await e.text()}catch{return}}function Fm(e=[]){if(!(e.length!==2||typeof e[1]!="object"))return e[1].body}function Um(e,t){const i={};return t.forEach(s=>{e.get(s)&&(i[s]=e.get(s))}),i}function pR(e,t){return e.length===1&&typeof e[0]!="string"?pd(e[0],t):e.length===2?pd(e[1],t):{}}function pd(e,t){if(!e)return{};const i=e.headers;return i?i instanceof Headers?Um(i,t):Array.isArray(i)?{}:Zh(i,t):{}}async function mR(e,t,i){try{const s=gR(e,t,i),r=Bm("resource.xhr",s);$o(i.replay,r)}catch(s){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay] Failed to capture fetch breadcrumb",s)}}function _R(e,t,i){const{xhr:s,input:r}=t,n=bo(r,i.textEncoder),o=s.getResponseHeader("content-length")?Mm(s.getResponseHeader("content-length")):bo(s.response,i.textEncoder);n!==void 0&&(e.data.request_body_size=n),o!==void 0&&(e.data.response_body_size=o)}function gR(e,t,i){const{startTimestamp:s,endTimestamp:r,input:n,xhr:o}=t,{url:a,method:h,status_code:l=0,request_body_size:c,response_body_size:u}=e.data;if(!a)return null;if(!Lm(a,i.networkDetailAllowUrls)){const y=Cr(c),b=Cr(u);return{startTimestamp:s,endTimestamp:r,url:a,method:h,statusCode:l,request:y,response:b}}const d=o[hi],f=d?Zh(d.request_headers,i.networkRequestHeaders):{},p=Zh(yR(o),i.networkResponseHeaders),m=ci(f,c,i.networkCaptureBodies?Nm(n):void 0),_=ci(p,u,i.networkCaptureBodies?t.xhr.responseText:void 0);return{startTimestamp:s,endTimestamp:r,url:a,method:h,statusCode:l,request:m,response:_}}function yR(e){const t=e.getAllResponseHeaders();return t?t.split(`\r
`).reduce((i,s)=>{const[r,n]=s.split(": ");return i[r.toLowerCase()]=n,i},{}):{}}function vR(e){const t=tt().getClient();try{const i=new TextEncoder,{networkDetailAllowUrls:s,networkCaptureBodies:r,networkRequestHeaders:n,networkResponseHeaders:o}=e.getOptions(),a={replay:e,textEncoder:i,networkDetailAllowUrls:s,networkCaptureBodies:r,networkRequestHeaders:n,networkResponseHeaders:o};t&&t.on?t.on("beforeAddBreadcrumb",(h,l)=>bR(a,h,l)):($t("fetch",zA(e)),$t("xhr",YA(e)))}catch{}}function bR(e,t,i){if(t.data)try{ER(t)&&wR(i)&&(_R(t,i,e),mR(t,i,e)),xR(t)&&SR(i)&&(lR(t,i,e),hR(t,i,e))}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Error when enriching network breadcrumb")}}function ER(e){return e.category==="xhr"}function xR(e){return e.category==="fetch"}function wR(e){return e&&e.xhr}function SR(e){return e&&e.response}let md=null;const TR=e=>t=>{if(!e.isEnabled())return;const i=AR(t);i&&Ho(e,i)};function AR(e){const t=e.getLastBreadcrumb&&e.getLastBreadcrumb();return md===t||!t||(md=t,t.category&&(["fetch","xhr","sentry.event","sentry.transaction"].includes(t.category)||t.category.startsWith("ui.")))?null:t.category==="console"?RR(t):Ve(t)}function RR(e){const t=e.data&&e.data.arguments;if(!Array.isArray(t)||t.length===0)return Ve(e);let i=!1;const s=t.map(r=>{if(!r)return r;if(typeof r=="string")return r.length>Tn?(i=!0,`${r.slice(0,Tn)}…`):r;if(typeof r=="object")try{const n=ke(r,7),o=JSON.stringify(n);if(o.length>Tn){const a=Pm(o.slice(0,Tn)),h=JSON.parse(a);return i=!0,h}return n}catch{}return r});return Ve({...e,data:{...e.data,arguments:s,...i?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function IR(e){const t=tt().getScope(),i=tt().getClient();t&&t.addScopeListener(TR(e)),$t("dom",lA(e)),$t("history",FA(e)),vR(e),Lo(OA(e,!_d(i))),_d(i)&&(i.on("afterSendEvent",Cm(e)),i.on("createDsc",s=>{const r=e.getSessionId();r&&e.isEnabled()&&e.recordingMode==="session"&&(s.replay_id=r)}),i.on("startTransaction",s=>{e.lastTransaction=s}),i.on("finishTransaction",s=>{e.lastTransaction=s}))}function _d(e){return!!(e&&e.on)}async function CR(e){try{return Promise.all(zo(e,[kR(ht.performance.memory)]))}catch{return[]}}function kR(e){const{jsHeapSizeLimit:t,totalJSHeapSize:i,usedJSHeapSize:s}=e,r=Date.now()/1e3;return{type:"memory",name:"memory",start:r,end:r,data:{memory:{jsHeapSizeLimit:t,totalJSHeapSize:i,usedJSHeapSize:s}}}}const gd={resource:BR,paint:MR,navigation:NR,["largest-contentful-paint"]:OR};function DR(e){return e.map(PR).filter(Boolean)}function PR(e){return gd[e.entryType]===void 0?null:gd[e.entryType](e)}function Ns(e){return((Ze||ht.performance.timeOrigin)+e)/1e3}function MR(e){const{duration:t,entryType:i,name:s,startTime:r}=e,n=Ns(r);return{type:i,name:s,start:n,end:n+t,data:void 0}}function NR(e){const{entryType:t,name:i,decodedBodySize:s,duration:r,domComplete:n,encodedBodySize:o,domContentLoadedEventStart:a,domContentLoadedEventEnd:h,domInteractive:l,loadEventStart:c,loadEventEnd:u,redirectCount:d,startTime:f,transferSize:p,type:m}=e;return r===0?null:{type:`${t}.${m}`,start:Ns(f),end:Ns(n),name:i,data:{size:p,decodedBodySize:s,encodedBodySize:o,duration:r,domInteractive:l,domContentLoadedEventStart:a,domContentLoadedEventEnd:h,loadEventStart:c,loadEventEnd:u,domComplete:n,redirectCount:d}}}function BR(e){const{entryType:t,initiatorType:i,name:s,responseEnd:r,startTime:n,decodedBodySize:o,encodedBodySize:a,responseStatus:h,transferSize:l}=e;return["fetch","xmlhttprequest"].includes(i)?null:{type:`${t}.${i}`,start:Ns(n),end:Ns(r),name:s,data:{size:l,statusCode:h,decodedBodySize:o,encodedBodySize:a}}}function OR(e){const{entryType:t,startTime:i,size:s}=e;let r=0;if(ht.performance){const a=ht.performance.getEntriesByType("navigation")[0];r=a&&a.activationStart||0}const n=Math.max(i-r,0),o=Ns(r)+n/1e3;return{type:t,name:t,start:o,end:o,data:{value:n,size:s,nodeId:Hi.mirror.getId(e.element)}}}function LR(e,t,i){let s,r,n;const o=i&&i.maxWait?Math.max(i.maxWait,t):0;function a(){return h(),s=e(),s}function h(){r!==void 0&&clearTimeout(r),n!==void 0&&clearTimeout(n),r=n=void 0}function l(){return r!==void 0||n!==void 0?a():s}function c(){return r&&clearTimeout(r),r=setTimeout(a,t),o&&n===void 0&&(n=setTimeout(a,o)),s}return c.cancel=h,c.flush=l,c}function FR(e){let t=!1;return(i,s)=>{if(!e.checkAndHandleExpiredSession()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("[Replay] Received replay event after session expired.");return}const r=s||!t;t=!0,e.addUpdate(()=>{if(e.recordingMode==="buffer"&&r&&e.setInitialState(),vo(e,i,r),!r)return!1;if(GR(e,r),e.session&&e.session.previousSessionId)return!0;if(e.recordingMode==="buffer"&&e.session&&e.eventBuffer){const o=e.eventBuffer.getEarliestTimestamp();o&&(e.session.started=o,e.getOptions().stickySession&&Ll(e.session))}const n=e.getOptions();return n._experiments.delayFlushOnCheckout?(setTimeout(()=>e.conditionalFlush(),n._experiments.delayFlushOnCheckout),e.cancelFlush(),!0):(e.recordingMode==="session"&&e.flushImmediate(),!0)})}}function UR(e){const t=e.getOptions();return{type:yo.Custom,timestamp:Date.now(),data:{tag:"options",payload:{sessionSampleRate:t.sessionSampleRate,errorSampleRate:t.errorSampleRate,useCompressionOption:t.useCompression,blockAllMedia:t.blockAllMedia,maskAllText:t.maskAllText,maskAllInputs:t.maskAllInputs,useCompression:e.eventBuffer?e.eventBuffer.type==="worker":!1,networkDetailHasUrls:t.networkDetailAllowUrls.length>0,networkCaptureBodies:t.networkCaptureBodies,networkRequestHasHeaders:t.networkRequestHeaders.length>0,networkResponseHasHeaders:t.networkResponseHeaders.length>0}}}}function GR(e,t){return!t||!e.session||e.session.segmentId!==0?Promise.resolve(null):vo(e,UR(e),!1)}function HR(e,t,i,s){return Gs(Ep(e,Tl(e),s,i),[[{type:"replay_event"},e],[{type:"replay_recording",length:typeof t=="string"?new TextEncoder().encode(t).length:t.length},t]])}function zR({recordingData:e,headers:t}){let i;const s=`${JSON.stringify(t)}
`;if(typeof e=="string")i=`${s}${e}`;else{const n=new TextEncoder().encode(s);i=new Uint8Array(n.length+e.length),i.set(n),i.set(e,n.length)}return i}async function $R({client:e,scope:t,replayId:i,event:s}){const r=typeof e._integrations=="object"&&e._integrations!==null&&!Array.isArray(e._integrations)?Object.keys(e._integrations):void 0,n=await Vp(e.getOptions(),s,{event_id:i,integrations:r},t);if(!n)return null;n.platform=n.platform||"javascript";const o=e.getSdkMetadata&&e.getSdkMetadata(),{name:a,version:h}=o&&o.sdk||{};return n.sdk={...n.sdk,name:a||"sentry.javascript.unknown",version:h||"0.0.0"},n}async function YR({recordingData:e,replayId:t,segmentId:i,eventContext:s,timestamp:r,session:n}){const o=zR({recordingData:e,headers:{segment_id:i}}),{urls:a,errorIds:h,traceIds:l,initialTimestamp:c}=s,u=tt(),d=u.getClient(),f=u.getScope(),p=d&&d.getTransport(),m=d&&d.getDsn();if(!d||!f||!p||!m||!n.sampled)return;const _={type:JT,replay_start_timestamp:c/1e3,timestamp:r/1e3,error_ids:h,trace_ids:l,urls:a,replay_id:t,segment_id:i,replay_type:n.sampled},y=await $R({scope:f,client:d,replayId:t,event:_});if(!y){d.recordDroppedEvent("event_processor","replay",_),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("An event processor returned `null`, will not send event.");return}const b=HR(y,o,m,d.getOptions().tunnel);let g;try{g=await p.send(b)}catch(v){const S=new Error(Bl);try{S.cause=v}catch{}throw S}if(!g)return g;if(typeof g.statusCode=="number"&&(g.statusCode<200||g.statusCode>=300))throw new Gm(g.statusCode);return g}class Gm extends Error{constructor(t){super(`Transport returned status code ${t}`)}}async function Hm(e,t={count:0,interval:n1}){const{recordingData:i,options:s}=e;if(i.length)try{return await YR(e),!0}catch(r){if(r instanceof Gm)throw r;if(yS("Replays",{_retryCount:t.count}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&s._experiments&&s._experiments.captureExceptions&&kl(r),t.count>=o1){const n=new Error(`${Bl} - max retries exceeded`);try{n.cause=r}catch{}throw n}return t.interval*=++t.count,await new Promise((n,o)=>{setTimeout(async()=>{try{await Hm(e,t),n(!0)}catch(a){o(a)}},t.interval)})}}const zm="__THROTTLED",WR="__SKIPPED";function XR(e,t,i){const s=new Map,r=a=>{const h=a-i;s.forEach((l,c)=>{c<h&&s.delete(c)})},n=()=>[...s.values()].reduce((a,h)=>a+h,0);let o=!1;return(...a)=>{const h=Math.floor(Date.now()/1e3);if(r(h),n()>=t){const c=o;return o=!0,c?WR:zm}o=!1;const l=s.get(h)||0;return s.set(h,l+1),e(...a)}}class It{__init(){this.eventBuffer=null}__init2(){this.performanceEvents=[]}__init3(){this.recordingMode="session"}__init4(){this.timeouts={sessionIdlePause:QT,sessionIdleExpire:t1,maxSessionLife:e1}}__init5(){this._performanceObserver=null}__init6(){this._flushLock=null}__init7(){this._lastActivity=Date.now()}__init8(){this._isEnabled=!1}__init9(){this._isPaused=!1}__init10(){this._hasInitializedCoreListeners=!1}__init11(){this._stopRecording=null}__init12(){this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""}}constructor({options:t,recordingOptions:i}){It.prototype.__init.call(this),It.prototype.__init2.call(this),It.prototype.__init3.call(this),It.prototype.__init4.call(this),It.prototype.__init5.call(this),It.prototype.__init6.call(this),It.prototype.__init7.call(this),It.prototype.__init8.call(this),It.prototype.__init9.call(this),It.prototype.__init10.call(this),It.prototype.__init11.call(this),It.prototype.__init12.call(this),It.prototype.__init13.call(this),It.prototype.__init14.call(this),It.prototype.__init15.call(this),It.prototype.__init16.call(this),It.prototype.__init17.call(this),It.prototype.__init18.call(this),this._recordingOptions=i,this._options=t,this._debouncedFlush=LR(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=XR((s,r)=>vo(this,s,r),300,5)}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}getOptions(){return this._options}initializeSampling(){const{errorSampleRate:t,sessionSampleRate:i}=this._options;if(!(t<=0&&i<=0||!this._loadAndCheckSession())){if(!this.session){this._handleException(new Error("Unable to initialize and create session"));return}this.session.sampled&&this.session.sampled!=="session"&&(this.recordingMode="buffer"),this._initializeRecording()}}start(){if(this._isEnabled&&this.recordingMode==="session")throw new Error("Replay recording is already in progress");if(this._isEnabled&&this.recordingMode==="buffer")throw new Error("Replay buffering is in progress, call `flush()` to save the replay");const t=this.session&&this.session.id,{session:i}=Na({timeouts:this.timeouts,stickySession:!!this._options.stickySession,currentSession:this.session,sessionSampleRate:1,allowBuffering:!1});i.previousSessionId=t,this.session=i,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw new Error("Replay recording is already in progress");const t=this.session&&this.session.id,{session:i}=Na({timeouts:this.timeouts,stickySession:!!this._options.stickySession,currentSession:this.session,sessionSampleRate:0,allowBuffering:!0});i.previousSessionId=t,this.session=i,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{this._stopRecording=Hi({...this._recordingOptions,...this.recordingMode==="buffer"&&{checkoutEveryNms:r1},emit:FR(this),onMutation:this._onMutationHandler})}catch(t){this._handleException(t)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(t){return this._handleException(t),!1}}async stop(t){if(this._isEnabled)try{if(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__){const i=`[Replay] Stopping Replay${t?` triggered by ${t}`:""}`;(this.getOptions()._experiments.traceInternals?console.warn:A.log)(i)}this._isEnabled=!1,this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),this.recordingMode==="session"&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,RA(this)}catch(i){this._handleException(i)}}pause(){this._isPaused=!0,this.stopRecording()}resume(){this._loadAndCheckSession()&&(this._isPaused=!1,this.startRecording())}async sendBufferedReplayOrFlush({continueRecording:t=!0}={}){if(this.recordingMode==="session")return this.flushImmediate();await this.flushImmediate();const i=this.stopRecording();!t||!i||(this.recordingMode="session",this.session&&(this.session.shouldRefresh=!1,this._maybeSaveSession()),this.startRecording())}addUpdate(t){const i=t();this.recordingMode!=="buffer"&&i!==!0&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),!this._stopRecording){if(!this._loadAndCheckSession())return;this.resume();return}this.checkAndHandleExpiredSession(),this._updateSessionActivity()}conditionalFlush(){return this.recordingMode==="buffer"?Promise.resolve():this.flushImmediate()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){const t=this.getSessionId();if(this._lastActivity&&Wh(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&this.session.sampled==="session"){this.pause();return}return this._loadAndCheckSession()?t!==this.getSessionId()?(this._triggerFullSnapshot(),!1):!0:void 0}setInitialState(){const t=`${ht.location.pathname}${ht.location.hash}${ht.location.search}`,i=`${ht.location.origin}${t}`;this.performanceEvents=[],this._clearContext(),this._context.initialUrl=i,this._context.initialTimestamp=Date.now(),this._context.urls.push(i)}throttledAddEvent(t,i){const s=this._throttledAddEvent(t,i);if(s===zm){const r=Ve({category:"replay.throttled"});this.addUpdate(()=>{vo(this,{type:ut.Custom,timestamp:r.timestamp||0,data:{tag:"breadcrumb",payload:r,metric:!0}})})}return s}getCurrentRoute(){const t=this.lastTransaction||tt().getScope().getTransaction();if(!(!t||!["route","custom"].includes(t.metadata.source)))return t.name}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=AA({useCompression:this._options.useCompression}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this.startRecording()}_handleException(t){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay]",t),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this._options._experiments&&this._options._experiments.captureExceptions&&kl(t)}_loadAndCheckSession(){const{type:t,session:i}=Na({timeouts:this.timeouts,stickySession:!!this._options.stickySession,currentSession:this.session,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:this._options.errorSampleRate>0});t==="new"&&this.setInitialState();const s=this.getSessionId();return i.id!==s&&(i.previousSessionId=s),this.session=i,this.session.sampled?!0:(this.stop("session unsampled"),!1)}_addListeners(){try{ht.document.addEventListener("visibilitychange",this._handleVisibilityChange),ht.addEventListener("blur",this._handleWindowBlur),ht.addEventListener("focus",this._handleWindowFocus),ht.addEventListener("keydown",this._handleKeyboardEvent),this._hasInitializedCoreListeners||(IR(this),this._hasInitializedCoreListeners=!0)}catch(t){this._handleException(t)}"PerformanceObserver"in ht&&(this._performanceObserver=bA(this))}_removeListeners(){try{ht.document.removeEventListener("visibilitychange",this._handleVisibilityChange),ht.removeEventListener("blur",this._handleWindowBlur),ht.removeEventListener("focus",this._handleWindowFocus),ht.removeEventListener("keydown",this._handleKeyboardEvent),this._performanceObserver&&(this._performanceObserver.disconnect(),this._performanceObserver=null)}catch(t){this._handleException(t)}}__init13(){this._handleVisibilityChange=()=>{ht.document.visibilityState==="visible"?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init14(){this._handleWindowBlur=()=>{const t=Ve({category:"ui.blur"});this._doChangeToBackgroundTasks(t)}}__init15(){this._handleWindowFocus=()=>{const t=Ve({category:"ui.focus"});this._doChangeToForegroundTasks(t)}}__init16(){this._handleKeyboardEvent=t=>{mA(this,t)}}_doChangeToBackgroundTasks(t){if(!this.session)return;const i=Rm(this.session,this.timeouts);t&&!i&&this._createCustomBreadcrumb(t),this.conditionalFlush()}_doChangeToForegroundTasks(t){if(!this.session)return;if(!this.checkAndHandleExpiredSession()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Document has become active, but session has expired");return}t&&this._createCustomBreadcrumb(t)}_triggerFullSnapshot(t=!0){try{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Replay] Taking full rrweb snapshot"),Hi.takeFullSnapshot(t)}catch(i){this._handleException(i)}}_updateUserActivity(t=Date.now()){this._lastActivity=t}_updateSessionActivity(t=Date.now()){this.session&&(this.session.lastActivity=t,this._maybeSaveSession())}_createCustomBreadcrumb(t){this.addUpdate(()=>{this.throttledAddEvent({type:ut.Custom,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t}})})}_addPerformanceEntries(){const t=[...this.performanceEvents];return this.performanceEvents=[],Promise.all(zo(this,DR(t)))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:t,eventBuffer:i}=this;if(!t||!i||t.segmentId)return;const s=i.getEarliestTimestamp();s&&s<this._context.initialTimestamp&&(this._context.initialTimestamp=s)}_popEventContext(){const t={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),t}async _runFlush(){if(!this.session||!this.eventBuffer){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay] No session or eventBuffer found to flush.");return}if(await this._addPerformanceEntries(),!(!this.eventBuffer||!this.eventBuffer.hasEvents)&&(await CR(this),!!this.eventBuffer))try{this._updateInitialTimestampFromEventBuffer();const t=await this.eventBuffer.finish(),i=this.session.id,s=this._popEventContext(),r=this.session.segmentId++;this._maybeSaveSession(),await Hm({replayId:i,recordingData:t,segmentId:r,eventContext:s,session:this.session,options:this.getOptions(),timestamp:Date.now()})}catch(t){this._handleException(t),this.stop("sendReplay");const i=tt().getClient();i&&i.recordDroppedEvent("send_error","replay")}}__init17(){this._flush=async({force:t=!1}={})=>{if(!(!this._isEnabled&&!t)){if(!this.checkAndHandleExpiredSession()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay] Attempting to finish replay event after session expired.");return}if(!this.session){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error("[Replay] No session found to flush.");return}if(this._debouncedFlush.cancel(),!this._flushLock){this._flushLock=this._runFlush(),await this._flushLock,this._flushLock=null;return}try{await this._flushLock}catch(i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.error(i)}finally{this._debouncedFlush()}}}}_maybeSaveSession(){this.session&&this._options.stickySession&&Ll(this.session)}__init18(){this._onMutationHandler=t=>{const i=t.length,s=this._options.mutationLimit,r=this._options.mutationBreadcrumbLimit,n=s&&i>s;if(i>r||n){const o=Ve({category:"replay.mutations",data:{count:i,limit:n}});this._createCustomBreadcrumb(o)}return n?(this.stop("mutationLimit"),!1):!0}}}function Ks(e,t,i,s){const r=typeof s=="string"?s.split(","):[],n=[...e,...r,...t];return typeof i<"u"&&(typeof i=="string"&&n.push(`.${i}`),console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")),n.join(",")}function VR({mask:e,unmask:t,block:i,unblock:s,ignore:r,blockClass:n,blockSelector:o,maskTextClass:a,maskTextSelector:h,ignoreClass:l}){const c=['base[href="/"]'],u=Ks(e,[".sentry-mask","[data-sentry-mask]"],a,h),d=Ks(t,[".sentry-unmask","[data-sentry-unmask]"]),f={maskTextSelector:u,unmaskTextSelector:d,maskInputSelector:u,unmaskInputSelector:d,blockSelector:Ks(i,[".sentry-block","[data-sentry-block]",...c],n,o),unblockSelector:Ks(s,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:Ks(r,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],l)};return n instanceof RegExp&&(f.blockClass=n),a instanceof RegExp&&(f.maskTextClass=a),f}function yd(){return typeof window<"u"&&(!yp()||jR())}function jR(){return typeof process<"u"&&process.type==="renderer"}const vd='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',qR=["content-length","content-type","accept"];let bd=!1;class kr{static __initStatic(){this.id="Replay"}__init(){this.name=kr.id}constructor({flushMinDelay:t=i1,flushMaxDelay:i=s1,stickySession:s=!0,useCompression:r=!0,_experiments:n={},sessionSampleRate:o,errorSampleRate:a,maskAllText:h=!0,maskAllInputs:l=!0,blockAllMedia:c=!0,mutationBreadcrumbLimit:u=750,mutationLimit:d=1e4,networkDetailAllowUrls:f=[],networkCaptureBodies:p=!0,networkRequestHeaders:m=[],networkResponseHeaders:_=[],mask:y=[],unmask:b=[],block:g=[],unblock:v=[],ignore:S=[],maskFn:R,beforeAddRecordingEvent:T,blockClass:x,blockSelector:C,maskInputOptions:P,maskTextClass:I,maskTextSelector:D,ignoreClass:E}={}){if(kr.prototype.__init.call(this),this._recordingOptions={maskAllInputs:l,maskAllText:h,maskInputOptions:{...P||{},password:!0},maskTextFn:R,maskInputFn:R,...VR({mask:y,unmask:b,block:g,unblock:v,ignore:S,blockClass:x,blockSelector:C,maskTextClass:I,maskTextSelector:D,ignoreClass:E}),slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0},this._initialOptions={flushMinDelay:t,flushMaxDelay:i,stickySession:s,sessionSampleRate:o,errorSampleRate:a,useCompression:r,blockAllMedia:c,maskAllInputs:l,maskAllText:h,mutationBreadcrumbLimit:u,mutationLimit:d,networkDetailAllowUrls:f,networkCaptureBodies:p,networkRequestHeaders:Ed(m),networkResponseHeaders:Ed(_),beforeAddRecordingEvent:T,_experiments:n},typeof o=="number"&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysSessionSampleRate: ${o} })`),this._initialOptions.sessionSampleRate=o),typeof a=="number"&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysOnErrorSampleRate: ${a} })`),this._initialOptions.errorSampleRate=a),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${vd}`:vd),this._isInitialized&&yd())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return bd}set _isInitialized(t){bd=t}setupOnce(){yd()&&(this._setup(),setTimeout(()=>this._initialize()))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop():Promise.resolve()}flush(t){return!this._replay||!this._replay.isEnabled()?Promise.resolve():this._replay.sendBufferedReplayOrFlush(t)}getReplayId(){if(!(!this._replay||!this._replay.isEnabled()))return this._replay.getSessionId()}_initialize(){this._replay&&this._replay.initializeSampling()}_setup(){const t=KR(this._initialOptions);this._replay=new It({options:t,recordingOptions:this._recordingOptions})}}kr.__initStatic();function KR(e){const t=tt().getClient(),i=t&&t.getOptions(),s={sessionSampleRate:0,errorSampleRate:0,...Be(e)};return i?(e.sessionSampleRate==null&&e.errorSampleRate==null&&i.replaysSessionSampleRate==null&&i.replaysOnErrorSampleRate==null&&console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set."),typeof i.replaysSessionSampleRate=="number"&&(s.sessionSampleRate=i.replaysSessionSampleRate),typeof i.replaysOnErrorSampleRate=="number"&&(s.errorSampleRate=i.replaysOnErrorSampleRate),s):(console.warn("SDK client is not available."),s)}function Ed(e){return[...qR,...e.map(t=>t.toLowerCase())]}const ft=Jt;function ZR(){ft&&ft.document?ft.document.addEventListener("visibilitychange",()=>{const e=Ur();if(ft.document.hidden&&e){const t="cancelled";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Transaction: ${t} -> since tab moved to the background, op: ${e.op}`),e.status||e.setStatus(t),e.setTag("visibilitychange","document.hidden"),e.finish()}}):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const Gl=(e,t,i)=>{let s,r;return n=>{t.value>=0&&(n||i)&&(r=t.value-(s||0),(r||s===void 0)&&(s=t.value,t.delta=r,e(t)))}},JR=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,QR=()=>{const e=ft.performance.timing,t=ft.performance.navigation.type,i={entryType:"navigation",startTime:0,type:t==2?"back_forward":t===1?"reload":"navigate"};for(const s in e)s!=="navigationStart"&&s!=="toJSON"&&(i[s]=Math.max(e[s]-e.navigationStart,0));return i},$m=()=>ft.__WEB_VITALS_POLYFILL__?ft.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||QR()):ft.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],Ym=()=>{const e=$m();return e&&e.activationStart||0},Hl=(e,t)=>{const i=$m();let s="navigate";return i&&(ft.document.prerendering||Ym()>0?s="prerender":s=i.type.replace(/_/g,"-")),{name:e,value:typeof t>"u"?-1:t,rating:"good",delta:0,entries:[],id:JR(),navigationType:s}},Hr=(e,t,i)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const s=new PerformanceObserver(r=>{t(r.getEntries())});return s.observe(Object.assign({type:e,buffered:!0},i||{})),s}}catch{}},Yo=(e,t)=>{const i=s=>{(s.type==="pagehide"||ft.document.visibilityState==="hidden")&&(e(s),t&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))};addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)},tI=e=>{const t=Hl("CLS",0);let i,s=0,r=[];const n=a=>{a.forEach(h=>{if(!h.hadRecentInput){const l=r[0],c=r[r.length-1];s&&r.length!==0&&h.startTime-c.startTime<1e3&&h.startTime-l.startTime<5e3?(s+=h.value,r.push(h)):(s=h.value,r=[h]),s>t.value&&(t.value=s,t.entries=r,i&&i())}})},o=Hr("layout-shift",n);if(o){i=Gl(e,t);const a=()=>{n(o.takeRecords()),i(!0)};return Yo(a),a}};let Xn=-1;const eI=()=>ft.document.visibilityState==="hidden"&&!ft.document.prerendering?0:1/0,iI=()=>{Yo(({timeStamp:e})=>{Xn=e},!0)},zl=()=>(Xn<0&&(Xn=eI(),iI()),{get firstHiddenTime(){return Xn}}),sI=e=>{const t=zl(),i=Hl("FID");let s;const r=a=>{a.startTime<t.firstHiddenTime&&(i.value=a.processingStart-a.startTime,i.entries.push(a),s(!0))},n=a=>{a.forEach(r)},o=Hr("first-input",n);s=Gl(e,i),o&&Yo(()=>{n(o.takeRecords()),o.disconnect()},!0)},xd={},rI=e=>{const t=zl(),i=Hl("LCP");let s;const r=o=>{const a=o[o.length-1];if(a){const h=Math.max(a.startTime-Ym(),0);h<t.firstHiddenTime&&(i.value=h,i.entries=[a],s())}},n=Hr("largest-contentful-paint",r);if(n){s=Gl(e,i);const o=()=>{xd[i.id]||(r(n.takeRecords()),n.disconnect(),xd[i.id]=!0,s(!0))};return["keydown","click"].forEach(a=>{addEventListener(a,o,{once:!0,capture:!0})}),Yo(o,!0),o}};function Ba(e){return typeof e=="number"&&isFinite(e)}function Bs(e,{startTimestamp:t,...i}){return t&&e.startTimestamp>t&&(e.startTimestamp=t),e.startChild({startTimestamp:t,...i})}function Nt(e){return e/1e3}function Wm(){return ft&&ft.addEventListener&&ft.performance}let wd=0,Tt={},Re,mr;function nI(){const e=Wm();if(e&&Ze){e.mark&&ft.performance.mark("sentry-tracing-init"),cI();const t=hI(),i=lI();return()=>{t&&t(),i&&i()}}return()=>{}}function oI(){Hr("longtask",t=>{for(const i of t){const s=Ur();if(!s)return;const r=Nt(Ze+i.startTime),n=Nt(i.duration);s.startChild({description:"Main UI thread blocked",op:"ui.long-task",startTimestamp:r,endTimestamp:r+n})}})}function aI(){Hr("event",t=>{for(const i of t){const s=Ur();if(!s)return;if(i.name==="click"){const r=Nt(Ze+i.startTime),n=Nt(i.duration);s.startChild({description:vi(i.target),op:`ui.interaction.${i.name}`,startTimestamp:r,endTimestamp:r+n})}}},{durationThreshold:0})}function hI(){return tI(e=>{const t=e.entries.pop();t&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding CLS"),Tt.cls={value:e.value,unit:""},mr=t)})}function lI(){return rI(e=>{const t=e.entries.pop();t&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding LCP"),Tt.lcp={value:e.value,unit:"millisecond"},Re=t)})}function cI(){sI(e=>{const t=e.entries.pop();if(!t)return;const i=Nt(Ze),s=Nt(t.startTime);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding FID"),Tt.fid={value:e.value,unit:"millisecond"},Tt["mark.fid"]={value:i+s,unit:"second"}})}function uI(e){const t=Wm();if(!t||!ft.performance.getEntries||!Ze)return;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Tracing] Adding & adjusting spans using Performance API");const i=Nt(Ze),s=t.getEntries();let r,n;if(s.slice(wd).forEach(o=>{const a=Nt(o.startTime),h=Nt(o.duration);if(!(e.op==="navigation"&&i+a<e.startTimestamp))switch(o.entryType){case"navigation":{fI(e,o,i),r=i+Nt(o.responseStart),n=i+Nt(o.requestStart);break}case"mark":case"paint":case"measure":{dI(e,o,a,h,i);const l=zl(),c=o.startTime<l.firstHiddenTime;o.name==="first-paint"&&c&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding FP"),Tt.fp={value:o.startTime,unit:"millisecond"}),o.name==="first-contentful-paint"&&c&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding FCP"),Tt.fcp={value:o.startTime,unit:"millisecond"});break}case"resource":{const l=o.name.replace(ft.location.origin,"");mI(e,o,l,a,h,i);break}}}),wd=Math.max(s.length-1,0),_I(e),e.op==="pageload"){typeof r=="number"&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding TTFB"),Tt.ttfb={value:(r-e.startTimestamp)*1e3,unit:"millisecond"},typeof n=="number"&&n<=r&&(Tt["ttfb.requestTime"]={value:(r-n)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(a=>{if(!Tt[a]||i>=e.startTimestamp)return;const h=Tt[a].value,l=i+Nt(h),c=Math.abs((l-e.startTimestamp)*1e3),u=c-h;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Measurements] Normalized ${a} from ${h} to ${c} (${u})`),Tt[a].value=c});const o=Tt["mark.fid"];o&&Tt.fid&&(Bs(e,{description:"first input delay",endTimestamp:o.value+Nt(Tt.fid.value),op:"ui.action",startTimestamp:o.value}),delete Tt["mark.fid"]),"fcp"in Tt||delete Tt.cls,Object.keys(Tt).forEach(a=>{e.setMeasurement(a,Tt[a].value,Tt[a].unit)}),gI(e)}Re=void 0,mr=void 0,Tt={}}function dI(e,t,i,s,r){const n=r+i,o=n+s;return Bs(e,{description:t.name,endTimestamp:o,op:t.entryType,startTimestamp:n}),n}function fI(e,t,i){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(s=>{Cn(e,t,s,i)}),Cn(e,t,"secureConnection",i,"TLS/SSL","connectEnd"),Cn(e,t,"fetch",i,"cache","domainLookupStart"),Cn(e,t,"domainLookup",i,"DNS"),pI(e,t,i)}function Cn(e,t,i,s,r,n){const o=n?t[n]:t[`${i}End`],a=t[`${i}Start`];!a||!o||Bs(e,{op:"browser",description:r||i,startTimestamp:s+Nt(a),endTimestamp:s+Nt(o)})}function pI(e,t,i){Bs(e,{op:"browser",description:"request",startTimestamp:i+Nt(t.requestStart),endTimestamp:i+Nt(t.responseEnd)}),Bs(e,{op:"browser",description:"response",startTimestamp:i+Nt(t.responseStart),endTimestamp:i+Nt(t.responseEnd)})}function mI(e,t,i,s,r,n){if(t.initiatorType==="xmlhttprequest"||t.initiatorType==="fetch")return;const o={};"transferSize"in t&&(o["http.response_transfer_size"]=t.transferSize),"encodedBodySize"in t&&(o["http.response_content_length"]=t.encodedBodySize),"decodedBodySize"in t&&(o["http.decoded_response_content_length"]=t.decodedBodySize),"renderBlockingStatus"in t&&(o["resource.render_blocking_status"]=t.renderBlockingStatus);const a=n+s,h=a+r;Bs(e,{description:i,endTimestamp:h,op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",startTimestamp:a,data:o})}function _I(e){const t=ft.navigator;if(!t)return;const i=t.connection;i&&(i.effectiveType&&e.setTag("effectiveConnectionType",i.effectiveType),i.type&&e.setTag("connectionType",i.type),Ba(i.rtt)&&(Tt["connection.rtt"]={value:i.rtt,unit:"millisecond"})),Ba(t.deviceMemory)&&e.setTag("deviceMemory",`${t.deviceMemory} GB`),Ba(t.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(t.hardwareConcurrency))}function gI(e){Re&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding LCP Data"),Re.element&&e.setTag("lcp.element",vi(Re.element)),Re.id&&e.setTag("lcp.id",Re.id),Re.url&&e.setTag("lcp.url",Re.url.trim().slice(0,200)),e.setTag("lcp.size",Re.size)),mr&&mr.sources&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log("[Measurements] Adding CLS Data"),mr.sources.forEach((t,i)=>e.setTag(`cls.source.${i+1}`,vi(t.node))))}const Jh=["localhost",/^\/(?!\/)/],Qh={traceFetch:!0,traceXHR:!0,tracingOrigins:Jh,tracePropagationTargets:Jh};function yI(e){const{traceFetch:t,traceXHR:i,tracePropagationTargets:s,tracingOrigins:r,shouldCreateSpanForRequest:n}={traceFetch:Qh.traceFetch,traceXHR:Qh.traceXHR,...e},o=typeof n=="function"?n:l=>!0,a=l=>vI(l,s||r),h={};t&&$t("fetch",l=>{bI(l,o,a,h)}),i&&$t("xhr",l=>{xI(l,o,a,h)})}function vI(e,t){return Us(e,t||Jh)}function bI(e,t,i,s){if(!Cl()||!(e.fetchData&&t(e.fetchData.url)))return;if(e.endTimestamp){const a=e.fetchData.__span;if(!a)return;const h=s[a];if(h){if(e.response){h.setHttpStatus(e.response.status);const l=e.response&&e.response.headers&&e.response.headers.get("content-length"),c=parseInt(l);c>0&&h.setData("http.response_content_length",c)}else e.error&&h.setStatus("internal_error");h.finish(),delete s[a]}return}const r=tt().getScope(),n=r&&r.getSpan(),o=n&&n.transaction;if(n&&o){const{method:a,url:h}=e.fetchData,l=n.startChild({data:{url:h,type:"fetch","http.method":a},description:`${a} ${h}`,op:"http.client"});e.fetchData.__span=l.spanId,s[l.spanId]=l;const c=e.args[0];e.args[1]=e.args[1]||{};const u=e.args[1];i(e.fetchData.url)&&(u.headers=EI(c,o.getDynamicSamplingContext(),l,u))}}function EI(e,t,i,s){const r=wp(t),n=i.toTraceparent(),o=typeof Request<"u"&&yi(e,Request)?e.headers:s.headers;if(o)if(typeof Headers<"u"&&yi(o,Headers)){const a=new Headers(o);return a.append("sentry-trace",n),r&&a.append(Ch,r),a}else if(Array.isArray(o)){const a=[...o,["sentry-trace",n]];return r&&a.push([Ch,r]),a}else{const a="baggage"in o?o.baggage:void 0,h=[];return Array.isArray(a)?h.push(...a):a&&h.push(a),r&&h.push(r),{...o,"sentry-trace":n,baggage:h.length>0?h.join(","):void 0}}else return{"sentry-trace":n,baggage:r}}function xI(e,t,i,s){const r=e.xhr,n=r&&r[hi];if(!Cl()||r&&r.__sentry_own_request__||!(r&&n&&t(n.url)))return;if(e.endTimestamp){const l=r.__sentry_xhr_span_id__;if(!l)return;const c=s[l];c&&(c.setHttpStatus(n.status_code),c.finish(),delete s[l]);return}const o=tt().getScope(),a=o&&o.getSpan(),h=a&&a.transaction;if(a&&h){const l=a.startChild({data:{...n.data,type:"xhr","http.method":n.method,url:n.url},description:`${n.method} ${n.url}`,op:"http.client"});if(r.__sentry_xhr_span_id__=l.spanId,s[r.__sentry_xhr_span_id__]=l,r.setRequestHeader&&i(n.url))try{r.setRequestHeader("sentry-trace",l.toTraceparent());const c=h.getDynamicSamplingContext(),u=wp(c);u&&r.setRequestHeader(Ch,u)}catch{}}}function wI(e,t=!0,i=!0){if(!ft||!ft.location){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn("Could not initialize routing instrumentation due to invalid location");return}let s=ft.location.href,r;t&&(r=e({name:ft.location.pathname,startTimestamp:Ze?Ze/1e3:void 0,op:"pageload",metadata:{source:"url"}})),i&&$t("history",({to:n,from:o})=>{if(o===void 0&&s&&s.indexOf(n)!==-1){s=void 0;return}o!==n&&(s=void 0,r&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Finishing current transaction with op: ${r.op}`),r.finish()),r=e({name:ft.location.pathname,op:"navigation",metadata:{source:"url"}}))})}const SI="BrowserTracing",TI={...$n,markBackgroundTransactions:!0,routingInstrumentation:wI,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,_experiments:{},...Qh};class $l{__init(){this.name=SI}constructor(t){$l.prototype.__init.call(this),gS(),this.options={...TI,...t},this.options._experiments.enableLongTask!==void 0&&(this.options.enableLongTask=this.options._experiments.enableLongTask),t&&!t.tracePropagationTargets&&t.tracingOrigins&&(this.options.tracePropagationTargets=t.tracingOrigins),this._collectWebVitals=nI(),this.options.enableLongTask&&oI(),this.options._experiments.enableInteractions&&aI()}setupOnce(t,i){this._getCurrentHub=i;const{routingInstrumentation:s,startTransactionOnLocationChange:r,startTransactionOnPageLoad:n,markBackgroundTransactions:o,traceFetch:a,traceXHR:h,tracePropagationTargets:l,shouldCreateSpanForRequest:c,_experiments:u}=this.options;s(d=>{const f=this._createRouteTransaction(d);return this.options._experiments.onStartRouteTransaction&&this.options._experiments.onStartRouteTransaction(f,d,i),f},n,r),o&&ZR(),u.enableInteractions&&this._registerInteractionListener(),yI({traceFetch:a,traceXHR:h,tracePropagationTargets:l,shouldCreateSpanForRequest:c})}_createRouteTransaction(t){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Did not create ${t.op} transaction because _getCurrentHub is invalid.`);return}const{beforeNavigate:i,idleTimeout:s,finalTimeout:r,heartbeatInterval:n}=this.options,o=t.op==="pageload",a=o?Sd("sentry-trace"):null,h=o?Sd("baggage"):null,l=a?zx(a):void 0,c=h?iw(h):void 0,u={...t,...l,metadata:{...t.metadata,dynamicSamplingContext:l&&!c?{}:c},trimEnd:!0},d=typeof i=="function"?i(u):u,f=d===void 0?{...u,sampled:!1}:d;f.metadata=f.name!==u.name?{...f.metadata,source:"custom"}:f.metadata,this._latestRouteName=f.name,this._latestRouteSource=f.metadata&&f.metadata.source,f.sampled===!1&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Will not send ${f.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.log(`[Tracing] Starting ${f.op} transaction on scope`);const p=this._getCurrentHub(),{location:m}=ft,_=$u(p,f,s,r,!0,{location:m},n);return _.registerBeforeFinishCallback(y=>{this._collectWebVitals(),uI(y)}),_}_registerInteractionListener(){let t;const i=()=>{const{idleTimeout:s,finalTimeout:r,heartbeatInterval:n}=this.options,o="ui.action.click",a=Ur();if(a&&a.op&&["navigation","pageload"].includes(a.op)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Did not create ${o} transaction because a pageload or navigation transaction is in progress.`);return}if(t&&(t.setFinishReason("interactionInterrupted"),t.finish(),t=void 0),!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Did not create ${o} transaction because _getCurrentHub is invalid.`);return}if(!this._latestRouteName){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&A.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}const h=this._getCurrentHub(),{location:l}=ft,c={name:this._latestRouteName,op:o,trimEnd:!0,metadata:{source:this._latestRouteSource||"url"}};t=$u(h,c,s,r,!0,{location:l},n)};["click"].forEach(s=>{addEventListener(s,i,{once:!1,capture:!0})})}}function Sd(e){const t=ix(`meta[name=${e}]`);return t?t.getAttribute("content"):null}function AI(e){e.innerHTML=`
        <div class="reload-button">
        </div>
        `,e.querySelector(".reload-button").addEventListener("click",()=>{window.location.reload()})}class RI{constructor(t,i){et(this,"mapDrawer");et(this,"container");et(this,"progressBar");et(this,"statusText");this.mapDrawer=t,this.container=i,this.progressBar=document.createElement("progress"),this.statusText=document.createElement("div"),this.statusText.classList.add("loading-screen-status"),i.appendChild(this.progressBar),i.appendChild(this.statusText)}updateLoading(t,i){this.progressBar.value=i,this.statusText.innerText=t}async show(){this.updateLoading("Ladataan karttaa...",0),await this.mapDrawer.buildBackground(),this.updateLoading("Ladataan esineitä...",.5);const t=Object.values(this.mapDrawer.entities),i=t.length;let s=0;for(const r of t)await this.mapDrawer.updateEntity(r),s++,this.updateLoading("Ladataan esineitä...",.5+.5*s/i);this.updateLoading("Valmis!",1),await new Promise(r=>setTimeout(r,1e3)),this.container.remove()}}async function II(e){const t=document.createElement("div");t.id="loading-screen",document.body.appendChild(t),await new RI(e,t).show()}KT({dsn:"https://632d9591067c4f76a1a51e42ec9b75e5@o4505339492433920.ingest.sentry.io/4505339494989824",integrations:[new $l({tracePropagationTargets:["localhost",/^https:\/\/ahdintie.duckdns\.org\/castcraft/]}),new kr],tracesSampleRate:1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1});typeof console>"u"&&(console={});document.querySelector("#app").innerHTML=`
  <div id="main-container">
    <div id="touch-element"></div>
    <div id="inventory"></div>
    <div id="top-bar"></div>
  </div>
`;function CI(){const e=new URLSearchParams(window.location.search),t={};for(const[i,s]of e.entries())t[i]=s;return t}function kI(e,t){const i=new URL(window.location.href);i.searchParams.set(e,t),window.history.replaceState({},"",i.toString())}async function DI(){window.spritesDrawn=0;const e={},t=window.innerWidth<600,i=new ml({resizeTo:window});V.defaultOptions.scaleMode=Pe.NEAREST,i.ticker.minFPS=25,i.ticker.maxFPS=30,document.querySelector("#main-container").insertBefore(i.view,document.querySelector("#touch-element"));let s=CI().nickname;!s&&t?s=prompt("Kirjoita nimesi")||"Anonymous":t||(s="TV",document.querySelector("#top-bar").remove()),kI("nickname",s),window.nickname=s;let r,n;const o=await qw({entities:e,fullDumpCallback:d=>{r=d.background,n=d.mapSize},nickname:s});await new Promise(d=>{const f=()=>{n?d(null):setTimeout(f,100)};f()}),n=n,r=r;let a=null;if(t){for(const d of Object.values(e))if(d.nickname===s){a=d.id;break}}console.log("main: ",e);const h=nw(i,e,a,n);h.setBackground(r),await II(h),i.ticker.add(()=>{h.updateAllEntities()});const l=document.querySelector("#touch-element");Zw(l,{tapNextToPlayer:d=>{console.log("tapNextToPlayer",d),o.movePlayer(d)},tapOnPlayer:()=>{console.log("tapOnPlayer"),o.playerAction()}});const u=document.querySelector("#inventory");if(a){iS(u,e,a,{selectItem:p=>{console.log("selectItemCallback",p),o.selectItem(p)}});const f=document.querySelector("#top-bar");AI(f)}else u.remove()}DI()});export default PI();
//# sourceMappingURL=index-b4efb3f8.js.map
